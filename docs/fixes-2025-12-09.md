# December 9, 2025 Fixes

## Scan Flow

- Added weight persistence across Start → Capture and cleared stale capture state when beginning a new scan.
- Wired the capture step to store the processed photos so the Result screen can access them without re-uploading.
- Reworked the Result screen to submit via `startScanSession`/`submitScan`, show live progress, and surface failures immediately instead of silently failing Firestore writes.

## Nutrition Add Food

- Exported the `addMeal`/`deleteMeal` Cloud Functions so the `/addMeal` endpoint exists in production, restoring the “Add” button functionality from search.

## Workout Programs

- Added a secure Cloud Function (`applyCatalogPlan`) that persists curated catalog plans into `users/{uid}/workoutPlans`.
- Updated the program detail page to call that endpoint before mirroring metadata into `coachPlans/current`, so Workouts immediately reflects the started program.

## Manual QA Checklist

1. **Scan flow**
   - Go to Start, update current & goal weight, continue to Capture.
   - Capture/attach all four poses, continue, and press “Finalize with AI”.
   - Confirm upload progress appears and that the app navigates to `/scan/{id}` once processing starts.
2. **Meals**
   - Search for a food item, click Add, confirm the dialog appears, save it, and verify it shows up in Today’s log totals.
3. **Workouts**
   - Pick a catalog program, click “Start program”, wait for success toast, and confirm the Workouts tab now shows the corresponding plan.
4. **Onboarding / gating**
   - For a partially onboarded user, confirm scan/meals/workout routes reroute to onboarding.
   - For a fully onboarded user, ensure those routes are accessible and no “offline” banners appear when system health is green.
