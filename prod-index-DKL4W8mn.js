const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-8xaIM8hJ.js","assets/vendor-DGcCiWpO.js","assets/OnboardingMBS-EeKFEXHb.js","assets/icons-DWxAvj0j.js","assets/tanstack-4TkyLJ_z.js","assets/recharts-_iztQit2.js","assets/DevAudit-IVNUHagv.js","assets/Scan-Czy1Ex5B.js","assets/scanPipeline-B3CFJQ6g.js","assets/Plans-D9-n0dRs.js","assets/Paywall-DstYQkfz.js","assets/index-CGD1fgoL.js","assets/nutritionGoals-X4o1yqLP.js","assets/Meals-BzVTUWy-.js","assets/ScanResult-MEd3xqHV.js","assets/ScanCompare-6x93etNp.js","assets/Nutrition-B6HJhuRK.js","assets/Diagnostics-DhpBERqP.js","assets/SmokeKit-SAguKesr.js","assets/Admin-CfRaJDEO.js","assets/AdminQuick-DNSZ3cg-.js","assets/ScanDiagnostics-8jSrWa2u.js"])))=>i.map(i=>d[i]);
var Ef=Object.defineProperty;var Cf=(t,s,n)=>s in t?Ef(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var vt=(t,s,n)=>Cf(t,typeof s!="symbol"?s+"":s,n);import{a as l,ag as _f,j as Pf,af as e,ah as Bd,ai as Od,aj as Sn,ak as Ud,al as $d,am as Wd,an as qd,ao as Af,ap as If,aq as Tf,ar as zd,as as Rf,at as Mf,au as Df,av as Ff,aw as Qt,ax as Le,ay as ja,az as Vd,aA as wa,aB as Kd,aC as va,aD as Na,aE as Gd,aF as Hd,aG as Yd,aH as Qd,aI as Jd,aJ as Xd,aK as Zd,aL as Lf,aM as eu,aN as tu,aO as su,aP as nu,aQ as ru,aR as au,aS as iu,aT as Bf,aU as Of,aV as jt,aW as ze,aX as Uf,aY as ou,aZ as Io,R as As,a_ as lu,a$ as $f,b0 as cu,b1 as du,b2 as Wf,b3 as uu,b4 as qf,b5 as mu,b6 as hu,b7 as zf,b8 as Vf,b9 as fu,ba as Kf,bb as Gf,bc as pu,bd as Hf,be as gu,bf as xu,bg as yu,bh as bu,bi as Yf,bj as ju,bk as Qf,bl as Tt,bm as $l,bn as Jf,bo as wu,bp as vu,bq as Xf,br as er,bs as Nu,bt as Zf,bu as To,bv as ep,bw as tp,bx as Su,by as sp,bz as np,bA as ku,bB as Eu,bC as rp,bD as Cu,bE as ap,bF as ip,bG as op,bH as _u,bI as lp,bJ as cp,bK as Pu,bL as dp,bM as up,bN as ne,bO as mp,bP as hp}from"./vendor-DGcCiWpO.js";import{g as fp,a as pp,b as gp,c as Au,G as Sa,O as Ro,d as Wl,i as ql,e as zl,s as Wa,f as xp,h as yp,j as Iu,k as bp,l as Se,m as ot,n as jp,R as wp,o as Mo,p as ur,q as kn,r as Do,t as vp,E as Tu,u as Np,v as Sp,w as dt,x as Ru,T as kp,y as qi,z as Ep,A as Fo,_ as lt,B as Vl,C as Cp,D as Mu,F as _p,H as oa,I as Ft,J as Ht,K as Lt,L as Ot,M as Pp,N as Ap,P as Ip,Q as Tp,S as at,U as Rp,V as mr,W as Mp,X as Dp,Y as Fp,Z as Lp,$ as Bp,a0 as Lo}from"./firebase-8xaIM8hJ.js";import{X as Bo,L as Dt,C as Hs,a as Oo,b as Du,U as Fu,M as Op,c as Uo,d as Up,H as $p,e as Lu,f as Wp,D as Hr,g as qp,B as zp,h as Vp,i as Bu,S as Kp,j as Gp,R as Ou,T as Hp,k as Yp,l as Uu,E as en,m as $u,n as Qp,F as Jp,o as Wu,P as $o,p as qu,q as Xp,r as Zp,s as zu,t as eg,u as tg,v as sg,A as la,I as ng,w as Vu,x as Ku,y as rg,z as ag,G as ig,J as Kl,K as og,N as lg,O as cg,Q as dg,V as ug,W as mg,Y as hg,Z as fg,_ as pg,$ as gg,a0 as xg,a1 as yg,a2 as bg}from"./icons-DWxAvj0j.js";import{u as Gu,a as Yr,Q as jg,b as wg}from"./tanstack-4TkyLJ_z.js";import{R as Wo,L as vg,X as qo,Y as ca,T as zo,a as da,C as Ng,b as Hu,c as Sg,B as Yu,A as kg,d as Eg}from"./recharts-_iztQit2.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const Cg=/iPhone|iPad|iPod/,_g="(display-mode: standalone)";function ks(){return typeof window<"u"&&typeof document<"u"}function Bt(){try{const s=globalThis.Capacitor;if(!s||typeof s!="object")return!1;if(typeof s.isNativePlatform=="function")return!!s.isNativePlatform();if(typeof s.getPlatform=="function"){const n=s.getPlatform();return n==="ios"||n==="android"}return!1}catch{return!1}}function Vo(){return!ks()||typeof navigator>"u"?"":navigator.userAgent||""}function Pg(){if(!ks())return!1;if(typeof navigator<"u"&&navigator.standalone===!0)return!0;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia(_g).matches}catch{return!1}return!1}function Ag(){if(!ks()||typeof navigator>"u")return!1;const t=Vo();if(Cg.test(t))return!0;const s=navigator.platform??"",n=Number(navigator.maxTouchPoints??0);return s==="MacIntel"&&n>1}function Ig(){if(!ks()||!Ag()||Pg())return!1;const t=Vo();return/Safari/i.test(t)&&!/CriOS|FxiOS|OPiOS|EdgiOS/i.test(t)}function ka(){if(!ks())return!1;const t=window.Capacitor;if(!t)return!1;try{if(typeof t.isNativePlatform=="function"){const s=t.isNativePlatform();if(typeof s=="boolean")return s}}catch{}return!!t.isNative}function Ko(){if(!ks()||typeof navigator>"u")return!1;const t=Vo();if(!/Android/i.test(t))return!1;const s=t.includes("; wv")||t.includes("Version/");return/Chrome\/\d+/.test(t)&&!/Mobile/.test(t)?!1:s?!0:!/Chrome\/\d+/.test(t)}function Tg(){return Ig()||Ko()||ka()}function tr(){var t,s;if(typeof window>"u")return!1;try{return!!((s=(t=window.Capacitor)==null?void 0:t.isNativePlatform)!=null&&s.call(t))}catch{return!1}}async function Sr(t){var n;const s=globalThis;try{const r=s.Capacitor;if(r){const a=((n=r.Plugins)==null?void 0:n.Browser)||r.Browser;if(a&&typeof a.open=="function"){await a.open({url:t});return}}}catch{}typeof window<"u"&&t&&(window.location.href=t)}function Qu(){return!!(typeof navigator<"u"&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}function Ju(){return typeof window>"u"?!1:typeof window.isSecureContext=="boolean"&&window.isSecureContext?!0:typeof window.location<"u"?window.location.hostname==="localhost":!1}function Rg(){return tr()||Ju()&&Qu()}var Ad;const tn=((Ad=import.meta)==null?void 0:Ad.env)??{},kr={commit:tn.VITE_COMMIT_SHA||tn.COMMIT_SHA||"",branch:tn.VITE_GIT_BRANCH||tn.BRANCH||"",builtAt:tn.VITE_BUILD_TIME||"",version:tn.VITE_APP_VERSION||""},Is={VITE_FIREBASE_API_KEY:"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8",VITE_FIREBASE_AUTH_DOMAIN:"mybodyscan-f3daf.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"mybodyscan-f3daf",VITE_FIREBASE_STORAGE_BUCKET:"",VITE_FIREBASE_MESSAGING_SENDER_ID:"",VITE_FIREBASE_APP_ID:"",VITE_FIREBASE_MEASUREMENT_ID:""},Mg=(t,s=!1)=>s,Dg=Mg(void 0,!1),Go={apiKey:"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8",authDomain:"mybodyscan-f3daf.firebaseapp.com",projectId:"mybodyscan-f3daf",storageBucket:"mybodyscan-f3daf.appspot.com",messagingSenderId:"157018993008",appId:"1:157018993008:web:8bed67e098ca04dc4b1fb5",measurementId:"G-TV8M3PY1X3"},Ts=(...t)=>{for(const s of t){if(s==null)continue;const n=String(s).trim();if(n)return n}},Fg=t=>{if(t==null)return t;let s=String(t).trim();if(s){if(s.startsWith("gs://")&&(s=s.slice(5)),s.includes("://"))try{const n=new URL(s),r=n.pathname||"",a=r.match(/\/v0\/b\/([^/]+)/)||r.match(/\/upload\/storage\/v1\/b\/([^/]+)/)||r.match(/\/b\/([^/]+)/);a!=null&&a[1]?s=decodeURIComponent(a[1]):n.hostname&&(s=n.hostname)}catch{}return s.endsWith(".firebasestorage.app")&&(s=s.replace(/\.firebasestorage\.app$/,".appspot.com")),s}},Xu={apiKey:Ts(Is.VITE_FIREBASE_API_KEY,"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8"),authDomain:Ts(Is.VITE_FIREBASE_AUTH_DOMAIN,"mybodyscan-f3daf.firebaseapp.com"),projectId:Ts(Is.VITE_FIREBASE_PROJECT_ID,"mybodyscan-f3daf"),storageBucket:Ts(Is.VITE_FIREBASE_STORAGE_BUCKET,""),messagingSenderId:Ts(Is.VITE_FIREBASE_MESSAGING_SENDER_ID,""),appId:Ts(Is.VITE_FIREBASE_APP_ID,""),measurementId:Ts(Is.VITE_FIREBASE_MEASUREMENT_ID,"")},Qr=typeof globalThis<"u"?globalThis.__FIREBASE_CONFIG__||globalThis.__FIREBASE_RUNTIME_CONFIG__:void 0;function Lg(){var n;if(typeof window>"u")return;const t=(n=window.location.hostname)==null?void 0:n.trim();if(!t)return;const s=t.toLowerCase();if(!(s==="localhost"||s==="127.0.0.1")&&!s.endsWith(".local")&&!/^\d{1,3}(\.\d{1,3}){3}$/.test(s))return t}const Er=Lg(),qa=Ts(Xu.authDomain,Qr==null?void 0:Qr.authDomain),ht={...Go,...Xu,...Qr??{}};Er&&(qa&&qa.toLowerCase()!==Er.toLowerCase()&&typeof console<"u"&&console.warn("[firebase] authDomain overridden to same-origin",{configured:qa,runtime:Er}),ht.authDomain=Er);const Gl=Fg(ht.storageBucket);Gl&&(ht.storageBucket=Gl);function ua(t){return t==null?!0:String(t).trim()===""}for(const[t,s]of Object.entries(Go)){const n=ht[t];ua(n)&&!ua(s)&&(ht[t]=s)}const Bg=["apiKey","authDomain","projectId"],Og=["storageBucket","messagingSenderId","appId","measurementId"],Bs=Bg.filter(t=>{const s=ht==null?void 0:ht[t];return ua(s)}),ys=Og.filter(t=>{const s=ht==null?void 0:ht[t];return ua(s)}),Ea=Bs.length===0;ys.length&&typeof console<"u"&&console.warn("[firebase] Optional config keys missing; continuing with defaults",ys);let Jr=null;function Zu(){return Jr||(Ea?null:`Missing Firebase config keys: ${Bs.join(", ")}`)}function Ug(){!Ea&&!Jr&&(Jr=`Missing Firebase config keys: ${Bs.join(", ")}`,console.warn("[firebase] partial configuration detected",{missing:Bs}));try{return Wl().length?zl():ql(ht)}catch(t){return Jr=t instanceof Error?t.message:String(t),console.warn("[firebase] initialization failed; falling back to built-in config",t),Wl().length?zl():ql(Go)}}const En=Ug(),$g=En,U=fp(En);let qs="unknown",Cr=null;function Wg(){return qs}async function em(){return Cr||(Cr=(async()=>{try{return await Wa(U,xp),qs="indexeddb",qs}catch{}try{return await Wa(U,yp),qs="local",qs}catch{}return await Wa(U,bp).catch(()=>{}),qs="session",qs})(),Cr)}const de=pp(En),qg=Is.VITE_FIREBASE_REGION??"us-central1",hr=gp(En,qg),zi=Au(En);try{zi.maxUploadRetryTime=12e4,zi.maxOperationRetryTime=12e4}catch{}let Hl=!1;function zg(){const t={projectId:String(ht.projectId||"").trim(),authDomain:String(ht.authDomain||"").trim()},s=["storageBucket","messagingSenderId","appId","measurementId"];for(const n of s){const r=String((ht==null?void 0:ht[n])||"").trim();r&&(t[n]=r)}return t}function Vg(){if(!Hl){Hl=!0;try{console.info("[firebase] config",zg()),ys.length&&console.warn("[firebase] Optional config keys missing; some features may be unavailable",ys)}catch{}}}async function Ca(){await em().catch(()=>{})}function Kg(){return En}function bn(){return U}function Gg(){return de}function tm(){return zi}function fr(){return ht}const Yl=ht.apiKey,_r=(t,s)=>{const n=t.toString().trim().toLowerCase();return n?["false","0","off","no"].includes(n)?!1:["true","1","yes","on"].includes(n)?!0:s:s},Xr={google:_r("true",!0),apple:_r("true",!0),email:_r("true",!0),demo:_r("true",!0)},f_=Xr;new Sa;new Ro("apple.com");async function Hg(t,s){return Iu(U,t,s)}var Id;const Zt=((Id=import.meta)==null?void 0:Id.env)??{};function _a(t,s=!1){if(t==null)return s;const n=String(t).toLowerCase().trim();return n==="1"||n==="true"||n==="yes"||n==="on"}const Yg=Zt.VITE_APPCHECK_SITE_KEY||void 0,sm=_a(Zt.VITE_ENABLE_DEMO??Zt.VITE_DEMO_MODE??Zt.VITE_DEMO_ENABLED,!1),nm=_a(Zt.VITE_ENABLE_APPLE??Zt.VITE_SHOW_APPLE??Zt.VITE_SHOW_APPLE_WEB,!1),rm=Zt.VITE_STRIPE_PK||Zt.VITE_STRIPE_PUBLISHABLE_KEY||void 0,Qg=_a(Zt.VITE_SW_ENABLED,!1),Ho={ENABLE_PUBLIC_MARKETING_PAGE:_a(Zt.VITE_ENABLE_PUBLIC_MARKETING_PAGE,!1)},Jg={flags:{enableApple:nm,enableCoach:!0,enableNutrition:!0,enableDemo:sm},environment:{stripeMode:am()},loaded:!1};let zs={...Jg},Mn=null;const Vi=new Set;let Ql=!1;function am(){return(rm||"").startsWith("pk_live")?"live":"test"}function za(t){const s=t.flags?{...zs.flags,...t.flags}:zs.flags,n=t.environment?{...zs.environment,...t.environment}:zs.environment;zs={...zs,...t,flags:s,environment:n};for(const r of Vi)try{r()}catch(a){console.warn("flags_listener_error",a)}}async function Xg(){if(Mn)return Mn;Mn=(async()=>{try{await Ca();const t=Gg(),s=Se(t,"app","publicConfig"),n=await ot(s);if(!n.exists()){za({loaded:!0});return}const r=n.data(),a=r!=null&&r.flags&&typeof r.flags=="object"?r.flags:{},i=r!=null&&r.environment&&typeof r.environment=="object"?r.environment:{},o=(i==null?void 0:i.stripeMode)==="live"?"live":(i==null?void 0:i.stripeMode)==="test"?"test":am();za({flags:{enableApple:a.enableApple===!0,enableCoach:a.enableCoach!==!1,enableNutrition:a.enableNutrition!==!1,enableDemo:a.enableDemo===!0},environment:{stripeMode:o},loaded:!0})}catch(t){((t==null?void 0:t.code)||(t==null?void 0:t.message))==="permission-denied"?Ql||(console.warn("flags_fetch_failed","permission-denied"),Ql=!0):console.warn("flags_fetch_failed",t),za({loaded:!0})}})().finally(()=>{Mn=null}),await Mn}function Zg(t){return Vi.add(t),()=>{Vi.delete(t)}}function Jl(){return zs}function ex(){const t=l.useSyncExternalStore(Zg,Jl,Jl);return l.useEffect(()=>{t.loaded||Xg()},[t.loaded]),t}ks()&&(async()=>{const t="AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8".trim(),s=!!t;let n=null,r,a=null,i=null,o;try{const c=new URLSearchParams;t&&c.set("clientKey",t);const h=await fetch(`/systemHealth${c.size?`?${c.toString()}`:""}`,{cache:"no-store"});if(h.ok){const m=await h.json().catch(()=>null);m&&(n=!!m.identityToolkitReachable,r=m.identityToolkitReason,a=typeof m.stripeSecretPresent=="boolean"?m.stripeSecretPresent:null,i=typeof m.openaiKeyPresent=="boolean"?m.openaiKeyPresent:null,o=typeof m.appCheck=="string"?m.appCheck:void 0)}}catch{}try{console.log("[boot] summary:",{origin:location.origin,apiKey:s,identityToolkit:{reachable:n,reason:r},stripe:a,openai:i,appCheck:o,flags:{demo:sm,appleWeb:nm,sw:Qg,appCheckKey:!!Yg},build:{commit:kr.commit||"",branch:kr.branch||"",time:kr.builtAt||"",version:kr.version||""}});try{window.dispatchEvent(new CustomEvent("mbs:boot",{detail:{apiKey:s,identityToolkit:n,identityToolkitReason:r,stripeSecretPresent:a,openaiKeyPresent:i}}))}catch{}}catch{}})();const tx=1,sx=1e6;let Va=0;function nx(){return Va=(Va+1)%Number.MAX_SAFE_INTEGER,Va.toString()}const Ka=new Map,Xl=t=>{if(Ka.has(t))return;const s=setTimeout(()=>{Ka.delete(t),Vn({type:"REMOVE_TOAST",toastId:t})},sx);Ka.set(t,s)},rx=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,tx)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===s.toast.id?{...n,...s.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=s;return n?Xl(n):t.toasts.forEach(r=>{Xl(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==s.toastId)}}},Zr=[];let ea={toasts:[]};function Vn(t){ea=rx(ea,t),Zr.forEach(s=>{s(ea)})}function V({...t}){const s=nx(),n=a=>Vn({type:"UPDATE_TOAST",toast:{...a,id:s}}),r=()=>Vn({type:"DISMISS_TOAST",toastId:s});return Vn({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:a=>{a||r()}}}),{id:s,dismiss:r,update:n}}function Cn(){const[t,s]=l.useState(ea);return l.useEffect(()=>(Zr.push(s),()=>{const n=Zr.indexOf(s);n>-1&&Zr.splice(n,1)}),[t]),{...t,toast:V,dismiss:n=>Vn({type:"DISMISS_TOAST",toastId:n})}}function ae(...t){return _f(Pf(t))}const ax=Af,im=l.forwardRef(({className:t,...s},n)=>e.jsx(Bd,{ref:n,className:ae("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));im.displayName=Bd.displayName;const ix=Sn("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),om=l.forwardRef(({className:t,variant:s,...n},r)=>e.jsx(Od,{ref:r,className:ae(ix({variant:s}),t),...n}));om.displayName=Od.displayName;const ox=l.forwardRef(({className:t,...s},n)=>e.jsx(Ud,{ref:n,className:ae("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));ox.displayName=Ud.displayName;const lm=l.forwardRef(({className:t,...s},n)=>e.jsx($d,{ref:n,className:ae("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(Bo,{className:"h-4 w-4"})}));lm.displayName=$d.displayName;const cm=l.forwardRef(({className:t,...s},n)=>e.jsx(Wd,{ref:n,className:ae("text-sm font-semibold",t),...s}));cm.displayName=Wd.displayName;const dm=l.forwardRef(({className:t,...s},n)=>e.jsx(qd,{ref:n,className:ae("text-sm opacity-90",t),...s}));dm.displayName=qd.displayName;function lx(){const{toasts:t}=Cn();return e.jsxs(ax,{children:[t.map(function({id:s,title:n,description:r,action:a,...i}){return e.jsxs(om,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[n&&e.jsx(cm,{children:n}),r&&e.jsx(dm,{children:r})]}),a,e.jsx(lm,{})]},s)}),e.jsx(im,{})]})}const cx=({...t})=>{const{theme:s="system"}=If();return e.jsx(Tf,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},dx=Df,ma=Rf,ha=Mf,sr=l.forwardRef(({className:t,sideOffset:s=4,...n},r)=>e.jsx(zd,{ref:r,sideOffset:s,className:ae("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));sr.displayName=zd.displayName;const ux=Sn("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),tt=l.forwardRef(({className:t,variant:s,...n},r)=>e.jsx("div",{ref:r,role:"alert",className:ae(ux({variant:s}),t),...n}));tt.displayName="Alert";const rt=l.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:ae("mb-1 font-medium leading-none tracking-tight",t),...s}));rt.displayName="AlertTitle";const st=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ae("text-sm [&_p]:leading-relaxed",t),...s}));st.displayName="AlertDescription";const mx=Sn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),_=l.forwardRef(({className:t,variant:s,size:n,asChild:r=!1,...a},i)=>{const o=r?Ff:"button";return e.jsx(o,{className:ae(mx({variant:s,size:n,className:t})),ref:i,...a})});_.displayName="Button";function hx(){const[s,n]=l.useState(null),[r,a]=l.useState(!1);return l.useEffect(()=>{},[!1]),null}function St({className:t,...s}){return e.jsx("div",{className:ae("animate-pulse rounded-md bg-muted",t),...s})}const Y=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ae("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));Y.displayName="Card";const oe=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ae("flex flex-col space-y-1.5 p-6",t),...s}));oe.displayName="CardHeader";const he=l.forwardRef(({className:t,...s},n)=>e.jsx("h3",{ref:n,className:ae("text-2xl font-semibold leading-none tracking-tight",t),...s}));he.displayName="CardTitle";const fa=l.forwardRef(({className:t,...s},n)=>e.jsx("p",{ref:n,className:ae("text-sm text-muted-foreground",t),...s}));fa.displayName="CardDescription";const Q=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ae("p-6 pt-0",t),...s}));Q.displayName="CardContent";const fx=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ae("flex items-center p-6 pt-0",t),...s}));fx.displayName="CardFooter";function gs({label:t="Loading…",className:s="",...n}){return e.jsx("div",{className:`min-h-screen w-full flex items-center justify-center bg-background ${s}`.trim(),role:"status","aria-live":"polite",...n,children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsx("span",{className:"h-8 w-8 rounded-full border-2 border-muted-foreground/40 border-t-primary animate-spin","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]})})}function px(){return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(St,{className:"h-8 w-40 mb-4"}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(St,{className:"h-6 w-24"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("div",{className:"relative w-full aspect-[3/4] overflow-hidden rounded-lg",children:e.jsx(St,{className:"h-full w-full"})}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Array.from({length:4}).map((t,s)=>e.jsx(St,{className:"h-12 w-full"},s))}),e.jsx(St,{className:"h-10 w-full"})]})]})]})}const xs={},Zl=(xs==null?void 0:xs.VITE_APPCHECK_SITE_KEY)||(xs==null?void 0:xs.VITE_RECAPTCHA_SITE_KEY)||"",um=Zl==="__DISABLE__"?"":Zl,ec=(xs==null?void 0:xs.VITE_APPCHECK_DEBUG_TOKEN)||"";let tc=!1,sc=!1;ec&&typeof self<"u"&&(self.FIREBASE_APPCHECK_DEBUG_TOKEN=ec);let sn=null;function mm(){return!!um}function Yo(){if(typeof window>"u"||!mm())return null;if(sn||tc)return sn;tc=!0;try{sn=jp($g,{provider:new wp(um),isTokenAutoRefreshEnabled:!0})}catch(t){console.warn("[AppCheck] init_failed_soft",t),sn=null}return sn}const Kn=Yo();function hm(){return mm()}async function ts(){Yo()}async function _n(t=!1){try{const s=Yo();if(!s)return{};const{token:n}=await Mo(s,t);return n?{"X-Firebase-AppCheck":n}:{}}catch(s){const n=(s==null?void 0:s.code)||(s==null?void 0:s.message);return n==="appCheck/recaptcha-error"||n==="appcheck/recaptcha-error"?(sc||(console.warn("appcheck_recaptcha_error_soft",s),sc=!0),{}):{}}}async function fm(t=!1){return _n(t)}const gx="/telemetry/log",xx=40,nc=new Set;let rc=0,ac=!1;function pm(){try{const t="production"}catch{}return!!(globalThis.__vitest_worker__||globalThis.jest)}function yx(){if(typeof window>"u")return null;try{return new URL(gx,window.location.origin).toString()}catch{return null}}function bx(t,s){return`${t||""}|${s||""}`.slice(0,500)}function Ki(t,s=0){if(!(s>6)&&t!==void 0){if(t===null)return null;if(Array.isArray(t))return t.map(r=>Ki(r,s+1)).filter(r=>r!==void 0);if(typeof t=="object"){const n={};for(const[r,a]of Object.entries(t)){const i=Ki(a,s+1);i!==void 0&&(n[r]=i)}return n}return t}}function jx(t){const s={kind:t.kind,message:t.message,code:t.code,stack:t.stack,url:t.url||(typeof window<"u"?window.location.href:void 0),component:t.component,extra:t.extra||void 0};return Ki(s)||{}}async function wx(){try{const t=U==null?void 0:U.currentUser;return t?await t.getIdToken():void 0}catch(t){pm()||console.warn("telemetry_token_error",t==null?void 0:t.message);return}}async function Ye(t){if(!t||!t.kind||rc>=xx||pm())return;const s=bx(t.message,t.stack);if(s&&nc.has(s))return;s&&nc.add(s),rc+=1;const n=jx(t);try{const r=yx();if(!r)return;const a={"Content-Type":"application/json"},i=await wx();i&&(a.Authorization=`Bearer ${i}`);const o=await fm(!1);Object.assign(a,o),(await fetch(r,{method:"POST",headers:a,body:JSON.stringify(n),keepalive:!0})).ok}catch{}}function gm(t){if(t instanceof Error)return{message:t.message,stack:t.stack??void 0};if(typeof t=="string")return{message:t};try{return{message:JSON.stringify(t)}}catch{return{message:String(t)}}}function vx(t){const s=gm(t.error??t.message??"Unhandled error");Ye({kind:"window_error",message:s.message,stack:s.stack,url:t.filename||window.location.href,extra:{col:t.colno,line:t.lineno,type:t.type}})}function Nx(t){const s=gm(t.reason??"unhandled rejection");Ye({kind:"unhandled_rejection",message:s.message,stack:s.stack,url:typeof window<"u"?window.location.href:void 0})}function Sx(){typeof window>"u"||ac||(ac=!0,window.addEventListener("error",vx),window.addEventListener("unhandledrejection",Nx))}const jn="mbs_demo",Gi="demo";let pa=null,Gn=xm();const Hi=new Set;let ic=!1,Ga=!1,Ha=null;function kx(){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(jn);return t==null?null:t==="1"||t==="true"}catch{return null}}function Ex(){if(typeof window>"u")return null;try{const t=window.sessionStorage.getItem(jn);return t==null?null:t==="1"||t==="true"}catch{return null}}function Cx(){if(typeof window>"u")return!1;try{return new URLSearchParams(window.location.search||"").get(Gi)==="1"}catch{return!1}}function xm(){if(pa!==null)return pa;const t=kx();if(t!==null)return t;const s=Ex();return s!==null?s:Cx()}function ym(t){if(Ga){Ha=t;return}Ga=!0;try{Hi.forEach(n=>{try{n()}catch(r){ic||(console.error("demo_state_listener_error",r),ic=!0)}})}finally{Ga=!1}const s=Ha;Ha=null,s!==null&&s!==t&&ym(s)}function bm(t){Gn!==t&&(Gn=t,ym(t))}function jm(t){if(!(typeof window>"u"))try{t?window.localStorage.setItem(jn,"1"):window.localStorage.removeItem(jn)}catch{}}function pr(){const t=xm();return t!==Gn&&(Gn=t),{demo:Gn}}function Pn(){pa=!0,jm(!0),bm(!0)}function Qo(){pa=!1,jm(!1),bm(!1)}function An(t){var s;if(Qo(),typeof window<"u")try{window.localStorage.removeItem(jn),window.localStorage.removeItem("mbs.demo"),window.localStorage.removeItem("mbs:demo"),window.sessionStorage.removeItem(jn),window.sessionStorage.removeItem("mbs.demo"),window.sessionStorage.removeItem("mbs:demo")}catch{}if(typeof window<"u"&&typeof((s=window.history)==null?void 0:s.replaceState)=="function")try{const n=new URL(window.location.href);n.searchParams.has(Gi)&&(n.searchParams.delete(Gi),window.history.replaceState({},"",`${n.pathname}${n.search}${n.hash}`))}catch{}}function _x(t){return Hi.add(t),()=>{Hi.delete(t)}}function Yi(){return pr().demo}function Px(t){Qo()}function wm(t){return t?!1:pr().demo}function Js(){return U.currentUser?!1:!!pr().demo}class gr extends Error{constructor(s="Demo mode is read-only"){super(s),this.name="DemoWriteError"}}function Pa(){if(Js()){try{}catch{}throw new gr}}const vm=Js,Ax="mbs_demo",Ix=["/","/welcome","/home","/demo","/meals","/workouts","/programs","/coach","/settings","/history","/scan","/scan/new","/scan/history","/scan/tips","/results","/results/:scanId","/results/:id","/report","/report/:scanId","/plans","/system/check","/dev/audit","/diagnostics"];function js(){return pr().demo}function Ct(){return js()&&Js()}function Tx(t){return Ix.some(s=>s==="/"?t==="/":s.includes(":")?new RegExp(`^${s.replace(/:[^/]+/g,"[^/]+")}$`).test(t):t===s||t.startsWith(`${s}/`))}async function es(t,s){return await ts(),ur(hr,t)(s)}function Rx(){if(typeof navigator>"u")return!1;const t=navigator.userAgent||"",s=navigator.platform||"",n=navigator.maxTouchPoints||0,r=/iPad|iPhone|iPod/.test(t),a=s==="MacIntel"&&n>1;return r||a}function Mx(){if(typeof navigator>"u")return!1;const t=navigator.userAgent||"",s=/Safari/.test(t)&&!/CriOS|FxiOS|OPiOS|EdgiOS/.test(t);return Rx()&&s}let Aa=typeof window<"u"&&U?U.currentUser:null,gn=!U||!!Aa;const Qi=new Set;let oc=null,Ya=null,Pr=null,Ji=null,ta={user:gn?Aa:null,authReady:gn};function Dx(){Qi.forEach(t=>{try{t()}catch{}})}async function Fx(t){try{await t.getIdToken(!0)}catch{}try{await es("refreshClaims",{})}catch{}try{await t.getIdToken(!0)}catch{}}function Lx(t){Aa=t,gn=!0,Ye({kind:"auth.state_changed",message:"auth.state_changed",extra:{signedIn:!!t,anonymous:!!(t!=null&&t.isAnonymous),providerCount:Array.isArray(t==null?void 0:t.providerData)?t==null?void 0:t.providerData.length:0}});const s=Wx();if(!t)return Ya=null,s;if(!t.isAnonymous&&typeof window<"u")try{window.sessionStorage.removeItem(Ax)}catch{}const n=!t.isAnonymous,r=n?`${t.uid}:claims`:`${t.uid}:anon`;return Ya===r||(Ya=r,!n)||Fx(t),s}function Nm(){!U||oc||(Ji||(Ji=new Promise(t=>{Pr=t})),oc=kn(U,t=>{Lx(t)&&Dx(),Pr&&(Pr(),Pr=null)}))}async function Bx(){U&&(Nm(),await(Ji??Promise.resolve()))}function Ox(t){return Nm(),Qi.add(t),()=>{Qi.delete(t)}}function Ux(){return ta}function $x(){return{user:null,authReady:!1}}function Wx(){const t=gn?Aa:null;return ta.user===t&&ta.authReady===gn?!1:(ta={user:t,authReady:gn},!0)}async function Ia(){if(!U){const t=Zu()||(Ea?"Authentication unavailable":"Firebase not configured");throw new Error(t)}return U}function In(){return U}function He(){const t=l.useSyncExternalStore(Ox,Ux,$x);return{user:t.authReady?t.user:null,loading:!t.authReady,authReady:t.authReady}}function qx(){const{user:t,authReady:s}=He();return s?t?"signedIn":"signedOut":"booting"}async function lc(){const t=await Ia();await Do(t),window.location.href="/auth"}async function zx(t,s,n){const r=await Ia(),a=r.currentUser,i=Tu.credential(t,s);return a!=null&&a.isAnonymous?(await Np(a,i)).user:(await Sp(r,t,s)).user}function Vx(t){return Ia().then(s=>vp(s,t))}function ga(){return Ia().then(t=>Do(t))}const Sm=l.createContext({demo:!1});function Kx({children:t}){const s=l.useSyncExternalStore(_x,Yi,Yi),n=l.useMemo(()=>({demo:s}),[s]);return e.jsx(Sm.Provider,{value:n,children:t})}function ft(){return l.useContext(Sm).demo}function we({children:t}){return e.jsx(Gx,{children:t})}function Gx({children:t}){const{user:s,authReady:n}=He(),r=qx(),a=Qt(),i=!!s,o=ft(),c=!i&&o&&Js(),h=c&&Tx(a.pathname),m=l.useRef(null);if(l.useEffect(()=>{const u=`${a.pathname}${a.search}`,d=`/auth?next=${encodeURIComponent(u)}`,f=n?i?"allow_authed":h?"allow_demo":"redirect_auth":"booting",p=`${f}:${a.pathname}:${a.search}`;m.current!==p&&(m.current=p,Ye({kind:"auth.route_guard_decision",message:"auth.route_guard_decision",extra:{phase:r,pathname:a.pathname,authed:i,demoEnabled:o,demoActive:c,allowDemo:h,destination:f==="redirect_auth"?d:null}}))},[n,i,h,c,o,a.pathname,a.search,r]),!n)return e.jsx(gs,{label:"Checking your session…"});if(!s){if(h)return e.jsx(e.Fragment,{children:t});const u=`${a.pathname}${a.search}`,d=`/auth?next=${encodeURIComponent(u)}`;return e.jsx(Le,{to:d,replace:!0,state:{from:u}})}return e.jsx(e.Fragment,{children:t})}const Hx={authResolved:!U,metaLoading:!!U,personalizationCompleted:!1,hasDraft:!1,hasRootData:!1},cc=t=>!t||typeof t!="object"?!1:Object.keys(t).length>0;function km(){const[t,s]=l.useState(Hx);return l.useEffect(()=>{if(!U||!de){s({authResolved:!0,metaLoading:!1,personalizationCompleted:!1,hasDraft:!1,hasRootData:!1});return}let n=null,r=!1;const a=kn(U,i=>{if(r)return;if(n&&(n(),n=null),!i){s({authResolved:!0,metaLoading:!1,personalizationCompleted:!1,hasDraft:!1,hasRootData:!1});return}s({authResolved:!0,metaLoading:!0,personalizationCompleted:!1,hasDraft:!1,hasRootData:!1});const o=Se(de,"users",i.uid,"meta","onboarding");n=dt(o,c=>{if(r)return;const h=c.exists()?c.data():null,m=(h==null?void 0:h.completed)===!0,u=cc(h==null?void 0:h.draft);s(d=>({...d,metaLoading:!1,personalizationCompleted:m,hasDraft:u}))},()=>{r||s(c=>({...c,metaLoading:!1,personalizationCompleted:!1,hasDraft:!1}))}),ot(Se(de,"users",i.uid)).then(c=>{var m;if(r)return;const h=cc((m=c.data())==null?void 0:m.onboarding);s(u=>({...u,hasRootData:h}))}).catch(()=>{r||s(c=>({...c,hasRootData:!1}))})},()=>{r||s({authResolved:!0,metaLoading:!1,personalizationCompleted:!1,hasDraft:!1,hasRootData:!1})});return()=>{r=!0,n&&n(),a()}},[]),l.useMemo(()=>{const n=!t.authResolved||t.metaLoading,r=t.personalizationCompleted||t.hasDraft||t.hasRootData;return{loading:n,personalizationCompleted:t.personalizationCompleted,hasAnyOnboardingData:r}},[t])}function Jo({label:t="Loading…",className:s}){return e.jsxs("div",{className:ae("flex min-h-[240px] flex-col items-center justify-center gap-3 p-6",s),children:[e.jsx(Dt,{className:"h-8 w-8 animate-spin text-primary","aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t})]})}function Em(t){if(!t)return null;const s=t.trim();return!s||!s.startsWith("/")||s.startsWith("//")?null:s}function Oe({children:t,returnToOverride:s}){const n=Qt(),{loading:r,personalizationCompleted:a}=km();if(r)return e.jsx(Jo,{label:"Checking your profile…"});if(a)return e.jsx(e.Fragment,{children:t});const i=`${n.pathname}${n.search}${n.hash}`,o=Em(s)??i,c=encodeURIComponent(o);return e.jsx(Le,{to:`/onboarding?returnTo=${c}`,replace:!0})}const Yx=Gd,Qx=Hd,Jx=Vd,Cm=l.forwardRef(({className:t,...s},n)=>e.jsx(ja,{className:ae("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:n}));Cm.displayName=ja.displayName;const Xx=Sn("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),_m=l.forwardRef(({side:t="right",className:s,children:n,...r},a)=>e.jsxs(Jx,{children:[e.jsx(Cm,{}),e.jsxs(wa,{ref:a,className:ae(Xx({side:t}),s),...r,children:[n,e.jsxs(Kd,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Bo,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_m.displayName=wa.displayName;const Zx=l.forwardRef(({className:t,...s},n)=>e.jsx(va,{ref:n,className:ae("text-lg font-semibold text-foreground",t),...s}));Zx.displayName=va.displayName;const ey=l.forwardRef(({className:t,...s},n)=>e.jsx(Na,{ref:n,className:ae("text-sm text-muted-foreground",t),...s}));ey.displayName=Na.displayName;const Pm=l.forwardRef(({className:t,...s},n)=>e.jsx(Yd,{ref:n,className:ae("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));Pm.displayName=Yd.displayName;const ty=l.forwardRef(({className:t,...s},n)=>e.jsx(Qd,{ref:n,className:ae("aspect-square h-full w-full",t),...s}));ty.displayName=Qd.displayName;const Am=l.forwardRef(({className:t,...s},n)=>e.jsx(Jd,{ref:n,className:ae("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));Am.displayName=Jd.displayName;const sy=Bf,ny=Of,ry=l.forwardRef(({className:t,inset:s,children:n,...r},a)=>e.jsxs(Xd,{ref:a,className:ae("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...r,children:[n,e.jsx(Hs,{className:"ml-auto h-4 w-4"})]}));ry.displayName=Xd.displayName;const ay=l.forwardRef(({className:t,...s},n)=>e.jsx(Zd,{ref:n,className:ae("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));ay.displayName=Zd.displayName;const Im=l.forwardRef(({className:t,sideOffset:s=4,...n},r)=>e.jsx(Lf,{children:e.jsx(eu,{ref:r,sideOffset:s,className:ae("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));Im.displayName=eu.displayName;const sa=l.forwardRef(({className:t,inset:s,...n},r)=>e.jsx(tu,{ref:r,className:ae("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...n}));sa.displayName=tu.displayName;const iy=l.forwardRef(({className:t,children:s,checked:n,...r},a)=>e.jsxs(su,{ref:a,className:ae("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nu,{children:e.jsx(Oo,{className:"h-4 w-4"})})}),s]}));iy.displayName=su.displayName;const oy=l.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(ru,{ref:r,className:ae("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nu,{children:e.jsx(Du,{className:"h-2 w-2 fill-current"})})}),s]}));oy.displayName=ru.displayName;const ly=l.forwardRef(({className:t,inset:s,...n},r)=>e.jsx(au,{ref:r,className:ae("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));ly.displayName=au.displayName;const cy=l.forwardRef(({className:t,...s},n)=>e.jsx(iu,{ref:n,className:ae("-mx-1 my-1 h-px bg-muted",t),...s}));cy.displayName=iu.displayName;const bs={pro:!1};var Td;let fs={uid:((Td=U==null?void 0:U.currentUser)==null?void 0:Td.uid)??null,entitlements:bs,loading:!0,error:null};const Xi=new Set;let dc=null,na=null,Ar=null;function dy(){Xi.forEach(t=>{try{t()}catch{}})}function Ls(t){const s={...fs,...t};s.uid===fs.uid&&s.loading===fs.loading&&s.error===fs.error&&s.entitlements.pro===fs.entitlements.pro&&s.entitlements.source===fs.entitlements.source&&(s.entitlements.expiresAt??null)===(fs.entitlements.expiresAt??null)||(fs=s,dy())}function uy(t){if(t==null||typeof t=="number"&&Number.isFinite(t))return t;if(t instanceof Date)return t.getTime();if(t instanceof kp)return t.toMillis();if(typeof(t==null?void 0:t.toMillis)=="function")try{const s=t.toMillis();if(typeof s=="number"&&Number.isFinite(s))return s}catch{}}function my(t){const s=t&&typeof t=="object"?t:{},n=(s==null?void 0:s.pro)===!0,r=(s==null?void 0:s.source)==="iap"||(s==null?void 0:s.source)==="stripe"||(s==null?void 0:s.source)==="admin"?s.source:void 0,a=uy(s==null?void 0:s.expiresAt),i={pro:n};return r&&(i.source=r),a!==void 0&&(i.expiresAt=a),i}function Zi(){if(na){try{na()}catch{}na=null}}function hy(t){if(Zi(),!de){Ls({uid:t,entitlements:bs,loading:!1,error:"firestore_unavailable"});return}Ls({uid:t,loading:!0,error:null,entitlements:bs});const s=Se(de,`users/${t}/entitlements/current`);na=dt(s,n=>{if(!n.exists()){Ls({uid:t,entitlements:bs,loading:!1,error:null});return}Ls({uid:t,entitlements:my(n.data()),loading:!1,error:null})},n=>{Ls({uid:t,entitlements:bs,loading:!1,error:n!=null&&n.message?String(n.message):"entitlements_read_failed"})})}function fy(){if(dc||!U){U||Ls({uid:null,entitlements:bs,loading:!1,error:"auth_unavailable"});return}dc=Ru(U,t=>{const s=(t==null?void 0:t.uid)??null;if(!s){Ar=null,Zi(),Ls({uid:null,entitlements:bs,loading:!1,error:null});return}Ar!==s&&(Ar=s,hy(s))},t=>{Ar=null,Zi(),Ls({uid:null,entitlements:bs,loading:!1,error:t!=null&&t.message?String(t.message):"auth_listener_failed"})})}function py(t){return fy(),Xi.add(t),()=>{Xi.delete(t)}}function gy(){return fs}function xy(){return{uid:null,entitlements:bs,loading:!0,error:null}}function xr(){return l.useSyncExternalStore(py,gy,xy)}function Ta(t){if(!(t!=null&&t.pro))return!1;const s=t.expiresAt;return s==null?!0:typeof s!="number"||!Number.isFinite(s)?!1:s>Date.now()}function Ra(){const[t,s]=l.useState(0),[n,r]=l.useState(!0),[a,i]=l.useState(null),[o,c]=l.useState(null),[h,m]=l.useState(!1),[u,d]=l.useState(!1),f=l.useRef(null),[p,x]=l.useState(0),{entitlements:g}=xr();let v="";try{v=fr().projectId}catch{v=""}l.useEffect(()=>{if(!U){i("auth_unavailable"),r(!1);return}const b=Ru(U,async w=>{if(c((w==null?void 0:w.uid)??null),!w)s(0),m(!1),d(!1),r(!1),f.current=null;else{let I=await w.getIdTokenResult();if(f.current!==w.uid){f.current=w.uid;try{await es("refreshClaims"),I=await w.getIdTokenResult(!0),x(E=>E+1)}catch{}}const F=I.claims.unlimitedCredits===!0||I.claims.unlimited===!0||I.claims.admin===!0||I.claims.staff===!0;m(!!F)}},w=>{i(w.message),r(!1)});return()=>{b()}},[]),l.useEffect(()=>{if(!o)return;if(!de){i("firestore_unavailable"),r(!1);return}r(!0);const b=Se(de,`users/${o}/private/credits`),w=Se(de,"users",o),I=dt(b,E=>{var k,C;const P=(C=(k=E.data())==null?void 0:k.creditsSummary)==null?void 0:C.totalAvailable;s(P??0),r(!1)},E=>{console.error("Error fetching credits:",E),i(E.message),r(!1)}),F=dt(w,E=>{var P;d(((P=E.data())==null?void 0:P.unlimitedCredits)===!0)},()=>{d(!1)});return()=>{I(),F()}},[o,p]);const j=l.useCallback(()=>{x(b=>b+1)},[]);return Ta(h||u?{pro:!0,expiresAt:null}:g)?{credits:1/0,loading:n,error:a,uid:o,projectId:v,unlimited:!0,remaining:1/0,used:0,refresh:j}:{credits:t,loading:n,error:a,uid:o,projectId:v,unlimited:!1,remaining:t,used:0,refresh:j}}function Tm(){const{user:t,loading:s}=He(),{credits:n,loading:r,unlimited:a}=Ra();if(s||r||!t)return null;const i=(()=>{if(a||n===1/0)return"Unlimited";const o=Number.isFinite(n)?Math.max(0,Math.floor(Number(n))):0;return`${o} ${o===1?"credit":"credits"}`})();return i?e.jsx("span",{"data-testid":"credit-badge",className:"inline-flex items-center rounded-full border px-2 py-0.5 text-xs",title:"Your available scan credits",children:i}):null}const yy={scan:"VITE_FEATURE_SCAN",nutrition:"VITE_FEATURE_NUTRITION",workouts:"VITE_FEATURE_WORKOUTS",coach:"VITE_FEATURE_COACH",health:"VITE_FEATURE_HEALTH",reminders:"VITE_FEATURE_REMINDERS",i18n:"VITE_FEATURE_I18N",marketing:"VITE_FEATURE_MARKETING",account:"VITE_FEATURE_ACCOUNT"};function by(t){var n,r;const s=((r=(n=import.meta)==null?void 0:n.env)==null?void 0:r[t])??(globalThis==null?void 0:globalThis[t]);if(typeof s=="string"){const a=s.toLowerCase();if(a==="1"||a==="true"||a==="yes")return!0;if(a==="0"||a==="false"||a==="no")return!1}return typeof s=="boolean"?s:!0}function Ma(t){return by(yy[t])}function jy(){return e.jsx("footer",{className:"w-full border-t mt-10 py-6 text-xs text-muted-foreground",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl flex-wrap items-center gap-3 px-4",children:[e.jsxs("span",{children:["© ",new Date().getFullYear()," MyBodyScan"]}),e.jsx("span",{children:"•"}),e.jsx(jt,{to:"/system/check",className:"underline",children:"System check"}),e.jsx("span",{children:"•"}),e.jsx("a",{href:"/legal/terms.html",className:"underline",children:"Terms"}),e.jsx("span",{children:"•"}),e.jsx("a",{href:"/legal/privacy.html",className:"underline",children:"Privacy"})]})})}const wy=[{to:"/home",label:"Home"},{to:"/scan",label:"Scan",feature:"scan"},{to:"/meals",label:"Meals",feature:"nutrition"},{to:"/workouts",label:"Workouts",feature:"workouts"},{to:"/programs",label:"Programs",feature:"coach"},{to:"/coach",label:"Coach",feature:"coach"},{to:"/history",label:"History",feature:"scan"},{to:"/plans",label:"Plans",feature:"account"},{to:"/settings",label:"Settings",feature:"account"}];function uc(){An(),window.location.href="/auth"}function ve({children:t}){const s=ze(),[n,r]=l.useState(!1),a=ft(),{user:i}=He(),c=!!!i&&a&&wm(i),h=wy.filter(u=>!u.feature||Ma(u.feature)),m=({mobile:u=!1})=>e.jsx(e.Fragment,{children:h.map(d=>e.jsx(Uf,{to:d.to,className:({isActive:f})=>`transition-opacity ${f?"underline underline-offset-8 decoration-2 font-medium":"opacity-80 hover:opacity-100"} ${u?"block py-2":""}`,onClick:()=>u&&r(!1),children:d.label},d.to))});return e.jsxs("div",{className:"flex min-h-screen flex-col",children:[e.jsxs("header",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur border-b",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6 h-14 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex items-center gap-2 font-semibold",onClick:()=>s("/home"),children:[e.jsx("img",{src:"/logo.svg",alt:"MyBodyScan",className:"w-6 h-6"}),"MyBodyScan"]}),c?e.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-800",children:"Demo"}):null]}),e.jsx("nav",{className:"hidden md:flex items-center gap-6 text-sm","data-testid":"app-nav",children:e.jsx(m,{})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Tm,{}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(sy,{children:[e.jsx(ny,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Pm,{className:"h-8 w-8",children:e.jsx(Am,{children:e.jsx(Fu,{className:"h-4 w-4"})})})})}),e.jsxs(Im,{align:"end",children:[e.jsx(sa,{onClick:()=>s("/settings"),children:"Settings"}),e.jsx(sa,{onClick:uc,children:"Exit demo"}),e.jsx(sa,{onClick:lc,children:"Sign out"})]})]})}),e.jsx("div",{className:"md:hidden",children:e.jsxs(Yx,{open:n,onOpenChange:r,children:[e.jsx(Qx,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Op,{className:"h-4 w-4"})})}),e.jsx(_m,{side:"right",className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4 mt-8",children:[e.jsx("nav",{className:"flex flex-col gap-2 text-sm",children:e.jsx(m,{mobile:!0})}),e.jsx("hr",{className:"border-t"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("button",{className:"text-left py-2 opacity-80 hover:opacity-100 transition-opacity",onClick:()=>{s("/settings"),r(!1)},children:"Settings"}),e.jsx("button",{className:"text-left py-2 opacity-80 hover:opacity-100 transition-opacity",onClick:()=>{uc(),r(!1)},children:"Exit demo"}),e.jsx("button",{className:"text-left py-2 opacity-80 hover:opacity-100 transition-opacity",onClick:()=>{lc(),r(!1)},children:"Sign out"})]})]})})]})})]})]}),c?e.jsx("div",{className:"border-t bg-amber-50 text-amber-900 text-xs",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6 py-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsx("span",{children:"Demo preview — read-only experience."}),e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx(jt,{to:"/plans",className:"underline-offset-4 hover:underline font-medium",children:"Sign up to save progress"}):null,e.jsx(jt,{to:"/system/check",className:"underline-offset-4 hover:underline",children:"Diagnostics"})]})]})}):null]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 py-6 md:px-6",children:t})}),e.jsx(jy,{})]})}const vy=()=>{var s;const t=(s=In())==null?void 0:s.currentUser;return e.jsx(Le,{to:t?"/home":"/auth",replace:!0})},Rm=()=>e.jsx(vy,{}),Ny=()=>{const[t,s]=l.useState(1.5),{user:n,authReady:r}=He(),a=l.useMemo(()=>{if(typeof window>"u")return!1;try{return new URLSearchParams(window.location.search).get("demo")==="1"}catch{return!1}},[]);return l.useEffect(()=>{if(!n)return;const i=setInterval(()=>{s(o=>Math.max(0,o-.1))},100);return()=>clearInterval(i)},[n]),r?n?t<=0?e.jsx(Le,{to:"/home",replace:!0}):e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Taking you to the app..."}),e.jsx("div",{className:"w-32 h-1 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-100 ease-out",style:{width:`${(1.5-t)/1.5*100}%`}})})]})}):a?e.jsx(Le,{to:"/demo",replace:!0}):e.jsx(Le,{to:"/auth",replace:!0}):null},We=l.forwardRef(({className:t,type:s,...n},r)=>e.jsx("input",{type:s,className:ae("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...n}));We.displayName="Input";const Sy=Sn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),je=l.forwardRef(({className:t,...s},n)=>e.jsx(ou,{ref:n,className:ae(Sy(),t),...s}));je.displayName=ou.displayName;const Ce=({title:t,description:s,canonical:n})=>(l.useEffect(()=>{if(document.title=t,s){let r=document.querySelector('meta[name="description"]');r||(r=document.createElement("meta"),r.setAttribute("name","description"),document.head.appendChild(r)),r.setAttribute("content",s)}if(n){let r=document.querySelector('link[rel="canonical"]');r||(r=document.createElement("link"),r.rel="canonical",document.head.appendChild(r)),r.href=n}},[t,s,n]),null);function Mm(){if(typeof navigator>"u")return!1;const t=navigator.userAgent||"",s=/(iPhone|iPad|iPod)/.test(t),n=/WebKit\//.test(t),r=/(CriOS|FxiOS)/.test(t);return s&&n&&!r}async function ky(t,s){if(Mm()){await qi(t,s);return}try{return await Ep(t,s)}catch(n){const r=Ey(n);if(r==="auth/popup-blocked"||r==="auth/cancelled-popup-request"||r==="auth/popup-closed-by-user"||r==="auth/internal-error"||r==="auth/web-storage-unsupported"||r==="auth/operation-not-supported-in-this-environment"){await qi(t,s);return}throw n}}function Ey(t){return t&&typeof t=="object"&&"code"in t&&typeof t.code=="string"?t.code:""}const eo="mybodyscan:auth:return";function Cy(t){if(!(typeof window>"u"))try{sessionStorage.setItem(eo,t)}catch{}}function Dm(){if(typeof window>"u")return null;try{const t=sessionStorage.getItem(eo);if(t)return sessionStorage.removeItem(eo),t}catch{}return null}const Xo="mybodyscan:auth:oauth:pending",ra=15e3;let Ir=null,Tr=null,_y=ky;function Ks(t,s){const n=Date.now();Ye({kind:t,message:`${t}:${n}`,extra:{at:n,...s??{}}})}function Py(){if(typeof navigator>"u")return!1;const t=navigator.userAgent||"";return/iPad|iPhone|iPod|Android|Mobile|IEMobile|Opera Mini/i.test(t)}function mc(){var t,s;if(typeof window>"u"||Py())return!0;try{if((s=(t=window.Capacitor)==null?void 0:t.isNativePlatform)!=null&&s.call(t))return!0}catch{}try{if(window.flutter_inappwebview!=null)return!0}catch{}return!1}function to(t,s,n){let r=null;const a=new Promise((i,o)=>{r=setTimeout(()=>{const c=new Error("Sign-in timed out.");c.code=n,o(c)},s)});return Promise.race([t,a]).finally(()=>{r&&clearTimeout(r)})}function Ay(t){if(!(typeof window>"u"))try{sessionStorage.setItem(Xo,JSON.stringify(t))}catch{}}function nr(){if(!(typeof window>"u"))try{sessionStorage.removeItem(Xo)}catch{}}function Iy(){if(typeof window>"u")return null;try{const t=sessionStorage.getItem(Xo);if(!t)return null;const s=JSON.parse(t),n=s.providerId==="google.com"||s.providerId==="apple.com"?s.providerId:null,r=typeof s.startedAt=="number"&&Number.isFinite(s.startedAt)?s.startedAt:null;return!n||r==null?null:{providerId:n,startedAt:r}}catch{return null}}function Qa(){nr()}async function Fm(t){const s=Date.now();if(Ks("auth_start",{provider:t.providerId,next:t.next??null,startedAt:s,preferRedirect:mc()}),Ir&&s-Ir.startedAt<ra){const i=new Error("Sign-in already in progress.");throw i.code="auth/signin-already-in-progress",i}Ir={providerId:t.providerId,startedAt:s};const n=bn(),r=fr(),a=typeof window<"u"?window.location.origin:"(unknown)";Ye({kind:"auth_origin_check",message:"auth_origin_check",extra:{origin:a,authDomain:(r==null?void 0:r.authDomain)??null,projectId:(r==null?void 0:r.projectId)??null,provider:t.providerId}}),t.next&&Cy(t.next),Ay({providerId:t.providerId,startedAt:s});try{if(mc())return Ks("auth_redirect_start",{provider:t.providerId}),await to((async()=>{await Fo(n).catch(()=>{}),await qi(n,t.provider)})(),ra,"auth/timeout"),{user:null,credential:null};Ks("auth_popup_start",{provider:t.providerId});const i=await to(_y(n,t.provider),ra,"auth/timeout");return i?(Ks("auth_success",{provider:t.providerId,method:"popup"}),nr(),{user:i.user??null,credential:i}):{user:null,credential:null}}catch(i){throw Ks("auth_error",{provider:t.providerId,code:typeof(i==null?void 0:i.code)=="string"?i.code:null,message:typeof(i==null?void 0:i.message)=="string"?i.message:null}),nr(),i}finally{Ir=null}}async function Ty(){if(Tr){const s=await Tr;return s?{user:s.user??null,credential:s}:null}Tr=to($m().then(s=>s.result),ra,"auth/timeout").then(s=>(nr(),s&&Ks("auth_success",{provider:"redirect",method:"redirect"}),s??null)).catch(async s=>{nr();const n=typeof(s==null?void 0:s.code)=="string"?s.code:void 0,r=typeof(s==null?void 0:s.message)=="string"?s.message:"Redirect sign-in failed.";throw Ye({kind:"auth_redirect_finalize_failed",message:r,code:n}),Ks("auth_error",{provider:"redirect",code:n,message:r}),s});const t=await Tr.catch(()=>null);return t?{user:t.user??null,credential:t}:null}function hc(t){const s=t&&typeof t=="object"&&"code"in t?String(t.code):void 0,n=t&&typeof t=="object"&&"message"in t?String(t.message):"";return s==="auth/unauthorized-domain"?{code:s,message:n,userMessage:"This domain isn’t authorized for sign-in. Please use mybodyscanapp.com"}:s==="auth/timeout"?{code:s,message:n,userMessage:"Sign-in timed out. Please try again."}:{code:s,message:n,userMessage:"Sign-in failed. Please try again."}}async function Ry(t){const s=new Sa;s.addScope("email"),s.addScope("profile"),await Fm({providerId:"google.com",provider:s,next:t})}async function My(t){const s=new Ro("apple.com");s.addScope("email"),s.addScope("name"),await Fm({providerId:"apple.com",provider:s,next:t})}async function Dy(){try{return await Fo(U)}catch{return null}}const so={async signInGoogle(t){await Ry(t)},async signInApple(t){await My(t)},async signOut(){await ga()},getCurrentUser(){var t;return((t=In())==null?void 0:t.currentUser)??null}},Fy={async signInGoogle(t){try{const{FirebaseAuthentication:s}=await lt(async()=>{const{FirebaseAuthentication:c}=await import("./firebase-8xaIM8hJ.js").then(h=>h.a1);return{FirebaseAuthentication:c}},__vite__mapDeps([0,1])),n=await s.signInWithGoogle(),r=n==null?void 0:n.credential,a=(r==null?void 0:r.idToken)??void 0,i=(r==null?void 0:r.accessToken)??void 0;if(!a&&!i)throw new Error("Native Google sign-in did not return usable tokens.");const o=Sa.credential(a,i);await Vl(bn(),o);return}catch{await so.signInGoogle(t);return}},async signInApple(t){try{const{FirebaseAuthentication:s}=await lt(async()=>{const{FirebaseAuthentication:m}=await import("./firebase-8xaIM8hJ.js").then(u=>u.a1);return{FirebaseAuthentication:m}},__vite__mapDeps([0,1])),n=await s.signInWithApple(),r=n==null?void 0:n.credential,a=(r==null?void 0:r.idToken)??void 0,i=(r==null?void 0:r.nonce)??void 0,o=(r==null?void 0:r.accessToken)??void 0;if(!a)throw new Error("Native Apple sign-in did not return an idToken.");const h=new Ro("apple.com").credential({idToken:a,rawNonce:i,accessToken:o});await Vl(bn(),h);return}catch{await so.signInApple(t);return}},async signOut(){try{const{FirebaseAuthentication:t}=await lt(async()=>{const{FirebaseAuthentication:s}=await import("./firebase-8xaIM8hJ.js").then(n=>n.a1);return{FirebaseAuthentication:s}},__vite__mapDeps([0,1]));await t.signOut().catch(()=>{})}catch{}await ga()},getCurrentUser(){var t;return((t=In())==null?void 0:t.currentUser)??null}};function Lm(){return tr()?Fy:so}function Bm(t){return Lm().signInGoogle(t)}function Om(t){return Lm().signInApple(t)}function Ly(t){const s=Um(t);switch(s){case"auth/api-key-not-valid":return{code:s,message:"Firebase Web API key is invalid for this project. Verify Hosting init.json and GCP restrictions."};case"auth/internal-error":return{code:s,message:"Sign-in failed due to an Auth service error. Try again in a moment or contact support if it persists."};case"auth/network-request-failed":return{code:s,message:"Network error contacting Auth. Check your connection and try again."};case"auth/operation-not-allowed":return{code:s,message:"Sign-in provider is disabled in Firebase Auth."};case"auth/popup-blocked":return{code:s,message:"Popup was blocked. Retrying via redirect…"};case"auth/popup-closed-by-user":return{code:s,message:"Popup was closed before completing sign-in."};case"auth/cancelled-popup-request":return{code:s,message:"Another popup was already open. Redirect will continue."};case"auth/unauthorized-domain":return{code:s,message:"This domain isn't authorized for Firebase Auth. Add it in Firebase Console -> Auth -> Settings -> Authorized domains."};case"auth/invalid-client":return{code:s,message:"Apple credentials invalid. Check Services ID, Key ID, and private key."};case"auth/redirect-uri-mismatch":return{code:s,message:"Apple return URL mismatch. Add your domain(s) to the Services ID."};case"auth/invalid-email":return{code:s,message:"That email looks invalid."};case"auth/user-not-found":case"auth/wrong-password":return{code:s,message:"Email or password is incorrect."};case"auth/account-exists-with-different-credential":return{code:s,message:"This email is already linked to a different sign-in method. Use that method, then link Google from Settings."};default:return{code:s,message:"Sign-in failed. Please try again."}}}function Um(t){if(t&&typeof t=="object"&&"code"in t&&typeof t.code=="string")return t.code}async function By(t,s){const n=Um(s);if(n==="auth/account-exists-with-different-credential"){const r=await Oy(t,s);return{code:n,message:r}}return Ly(s)}async function Oy(t,s){var i;const n="This email is already linked to a different sign-in method. Use that method, then link Google from Settings.",r=s,a=(i=r==null?void 0:r.customData)==null?void 0:i.email;if(!a)return n;try{const o=await Cp(t,a);if(!Array.isArray(o)||o.length===0)return n;const c=o.map(d=>Uy[d]||d).filter(Boolean);if(c.length===0)return n;if(c.length===1)return`Sign in with ${c[0]} for ${a}, then link Google from Settings.`;const h=c[c.length-1];return`Sign in with ${`${c.slice(0,-1).join(", ")} or ${h}`} for ${a}, then link Google from Settings.`}catch{return n}}const Uy={password:"email and password","google.com":"Google","apple.com":"Apple"},$y=new Set(["auth/no-auth-event","auth/popup-blocked","auth/popup-closed-by-user"]);let fc=!1,Dn=null,Ja=null,pc=!1;function Rr(t,s){const n=Date.now();Ye({kind:t,message:`${t}:${n}`,extra:{at:n,...s??{}}}),t==="auth_redirect_result"&&Ye({kind:"auth.redirect_result",message:`auth.redirect_result:${n}`,extra:{at:n,...s??{}}})}async function Wy(){let t=null;try{await Ca(),t=bn(),Rr("auth_redirect_result",{phase:"start"});const s=await Fo(t);s&&await Vy(s);const n=s?Mu(s):null;Rr("auth_redirect_result",{phase:"done",hasResult:!!s,providerId:(n==null?void 0:n.providerId)??null,isNewUser:(n==null?void 0:n.isNewUser)??null});const r={result:s??null,error:null,normalizedError:null};return Ja=r,r}catch(s){const n=s??null;if(n!=null&&n.code&&$y.has(n.code)){Rr("auth_redirect_result",{phase:"benign",code:n.code});const i={result:null,error:null,normalizedError:null};return Ja=i,i}Rr("auth_error",{phase:"redirect_result",code:(n==null?void 0:n.code)??null,message:typeof(n==null?void 0:n.message)=="string"?n.message:null});let r=null;if(n)try{t??(t=bn()),r=await By(t,n)}catch{}const a={result:null,error:n,normalizedError:r};return Ja=a,a}}function $m(){return fc&&Dn||Dn||(Dn=Wy().finally(()=>{fc=!0})),Dn}async function qy(){const t=await $m();if(pc||(pc=!0,!t.error))return null;const s=t.error;return t.normalizedError?(s.friendlyMessage=t.normalizedError.message??null,s.friendlyCode=t.normalizedError.code??t.error.code??null):(s.friendlyMessage??(s.friendlyMessage=null),s.friendlyCode??(s.friendlyCode=t.error.code??null)),s}const zy="apple.com";async function Vy(t){var o,c;if(!t)return;const s=Mu(t);if((s==null?void 0:s.providerId)!==zy||!s.isNewUser||!t.user||t.user.displayName)return;const n=s.profile,r=((o=n==null?void 0:n.name)==null?void 0:o.firstName)??(n==null?void 0:n.firstName)??"",a=((c=n==null?void 0:n.name)==null?void 0:c.lastName)??(n==null?void 0:n.lastName)??"",i=`${r} ${a}`.trim();if(i)try{await _p(t.user,{displayName:i})}catch{}}const nn={},Ky=new Set(["1","true","yes","on","enabled"]),Gy=new Set(["0","false","no","off","disabled"]);function gc(t){return typeof t=="string"?t.trim().toLowerCase():""}function Hy(){const t=gc(nn==null?void 0:nn.VITE_IDENTITY_PROBE);return t||gc(nn==null?void 0:nn.VITE_ENABLE_IDENTITY_PROBES)}function Yy(){const t=Hy();if(t){if(Ky.has(t))return!0;if(Gy.has(t))return!1}return!1}let is=!1,Zo=null;const rn=t=>(Zo=t,t);function Qy(){return Zo}async function Wm(){if(typeof window>"u")return{identityToolkit:Zo};if(!Yy())return is=!0,{identityToolkit:rn({status:"warning",message:"IdentityToolkit probe disabled for this build"})};const t=window.location.origin,s=(async()=>{try{const r=await fetch("/__/firebase/init.json",{cache:"no-store"});if(!r.ok)return console.warn("[probe] init.json fetch failed",r.status),{apiKey:void 0,projectId:void 0};const a=await r.json(),{projectId:i,authDomain:o,apiKey:c}=a||{};console.log("[probe] runtime init.json:",{projectId:i,authDomain:o,apiKeyPresent:!!c});const h="mybodyscan-f3daf";return h&&i&&h!==i&&console.warn("[probe] build/runtime projectId mismatch:",h,"vs",i),{apiKey:typeof c=="string"?c:void 0,projectId:typeof i=="string"?i:void 0}}catch(r){return console.warn("[probe] init.json fetch error:",r),{apiKey:void 0,projectId:void 0}}})();return{identityToolkit:await(async()=>{try{const{apiKey:r,projectId:a}=await s;if(console.log("[probe] origin:",t,"apiKey present:",!!r),!r)return console.info("[probe] IdentityToolkit probe skipped: no runtime apiKey"),rn({status:"warning",message:"IdentityToolkit probe skipped: missing runtime apiKey"});const i=a||"mybodyscan-f3daf",o=`https://identitytoolkit.googleapis.com/v2/projects/${encodeURIComponent(i)}/clientConfig?key=${encodeURIComponent(r)}`,c=await fetch(o,{mode:"cors"}).catch(f=>(is||(console.info("[probe] IdentityToolkit fetch error (network)",f),is=!0),null));if(!c)return rn({status:"warning",message:"IdentityToolkit probe failed"});if(c.ok)return is||(console.info("[probe] IdentityToolkit clientConfig ok",c.status),is=!0),rn({status:"ok",statusCode:c.status});const h=c.status,m=h===404?"clientConfig not provisioned for this origin":`clientConfig responded ${h}`,u=h===404||h===403?"warning":"error";return is||((u==="warning"?console.info:console.warn)("[probe] IdentityToolkit clientConfig",{status:h,reason:m}),is=!0),rn({status:u,statusCode:h,message:m})}catch(r){return is||(console.info("[probe] IdentityToolkit fetch error",r),is=!0),rn({status:"warning",message:"IdentityToolkit probe error"})}})()}}function $s(t,s="info"){if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("mbs:toast",{detail:{message:t,level:s}}))}catch(n){typeof window<"u"&&console.warn("[toast] dispatch failed",n,t)}}function qm(){An()}function p_(t){return t?!1:pr().demo}const Jy=t=>e.jsx("svg",{viewBox:"0 0 14 17",width:"16",height:"16","aria-hidden":"true",...t,children:e.jsx("path",{d:"M10.24 9.1c.01 2.16 1.86 2.88 1.88 2.89-.01.04-.3 1.03-1 2.03-.6.86-1.23 1.72-2.22 1.74-.97.02-1.28-.56-2.38-.56-1.1 0-1.44.54-2.35.58-.94.04-1.66-.93-2.27-1.79C.68 12.5-.2 10 0 7.66c.13-1.26.73-2.43 1.7-3.11.75-.51 1.67-.73 2.56-.6.6.12 1.1.36 1.48.56.38.2.68.37.88.36.18 0 .5-.18.88-.37.53-.28 1.13-.6 1.93-.6.01 0 .01 0 .02 0 .72.01 2.26.18 3.33 1.77-.09.06-1.98 1.15-1.93 3.43ZM7.3 1.62C7.9.88 8.97.33 9.88.32c.1.98-.29 1.96-.87 2.64C8.4 3.7 7.39 4.28 6.37 4.2c-.1-.96.4-1.98.93-2.58Z",fill:"currentColor"})}),Xy=()=>{var pe,Ee,Ie,be;const t=Qt(),s=ze(),n=((pe=t.state)==null?void 0:pe.from)||"/home",i=l.useMemo(()=>new URLSearchParams(t.search),[t.search]).get("next")||n,[o,c]=l.useState("signin"),[h,m]=l.useState(""),[u,d]=l.useState(""),[f,p]=l.useState(!1),[x,g]=l.useState(null),[v,j]=l.useState(null),[y,N]=l.useState(!1),[b,w]=l.useState(()=>Qy()),{user:I}=He(),E="true".toLowerCase()!=="false"&&!0,P=l.useMemo(()=>Zu(),[]),k=l.useMemo(()=>bn(),[]),C=l.useCallback(()=>{Pn(),s("/demo",{replace:!1})},[s]),T=typeof window<"u"?window.location.href:void 0;l.useEffect(()=>{I&&(qm(),t.pathname!==i&&window.location.replace(i))},[I,t.pathname,i]),l.useEffect(()=>{if(I){Qa();return}const me=Iy();if(!me)return;j(me.providerId);const xe=Date.now()-me.startedAt,S=Math.max(0,15e3-xe);if(S===0){Qa();const A="Sign-in timed out. Please try again.";g(A),$s(A,"error");return}p(!0);const K=window.setTimeout(()=>{Qa(),p(!1);const A="Sign-in timed out. Please try again.";g(A),$s(A,"error")},S);return()=>window.clearTimeout(K)},[I]),l.useEffect(()=>{let me=!1;return(async()=>{const xe=await qy();if(me||!xe)return;const S=xe.friendlyMessage??xe.message??"Sign-in failed.",K=xe.friendlyCode??xe.code,A=Mr(S,K);g(A),$s(A,"error")})(),()=>{me=!0}},[$s]),l.useEffect(()=>{},[]),l.useEffect(()=>{var S;const me=typeof window<"u"?window.location.origin:"(unknown)",xe=((S=U==null?void 0:U.app)==null?void 0:S.options)??{};Ye({kind:"auth_origin_check",message:"auth_origin_check",extra:{origin:me,authDomain:xe.authDomain||null,projectId:xe.projectId||null}})},[]),l.useEffect(()=>{let me=!1;return Wm().then(xe=>{me||w(xe.identityToolkit)}),()=>{me=!0}},[]);const L=async me=>{me.preventDefault(),p(!0);try{if(g(null),o==="signin")try{await Iu(k,h,u);return}catch(xe){const S=xe,K=(S==null?void 0:S.code)??"unknown",A=(S==null?void 0:S.message)??"";typeof window<"u"&&console.error("[Auth] Email sign-in failed",{code:K,message:A,origin:window.location.origin});let O="Sign-in failed. Please try again.";switch(K){case"auth/network-request-failed":O="Network error contacting Auth. Please check your connection and try again.";break;case"auth/invalid-email":O="That email address looks invalid.";break;case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":O="Email or password is incorrect.";break;case"auth/too-many-requests":O="Too many attempts. Please wait a bit and try again.";break;case"auth/operation-not-allowed":O="Sign-in is not enabled for this project. Contact support.";break;default:console.error("[Auth] Unhandled sign-in error",S);break}const $=h.trim().toLowerCase()==="developer@adlrlabs.com"?` [debug: ${K}]`:"";g(`${O}${$}`);return}else await zx(h,u)}catch(xe){const S=Zy(xe),K=o==="signin"?"Email sign-in failed.":"Account creation failed.",A=Mr(S.message??K,S.code);g(A),$s(A,"error")}finally{p(!1)}},M=l.useCallback(async()=>{g(null),p(!0),j("google.com");try{await Bm(i)}catch(me){const xe=hc(me),S=Mr(xe.userMessage,xe.code);console.error("[Auth] Google sign-in failed",{code:xe.code,message:xe.message}),Ye({kind:"auth_oauth_failed",message:xe.message||"Google sign-in failed",code:xe.code,extra:{provider:"google.com",origin:typeof window<"u"?window.location.origin:void 0}}),g(S),$s(S,"error")}finally{p(!1)}},[i]),X=l.useCallback(async()=>{g(null),p(!0),j("apple.com");try{await Om(i)}catch(me){const xe=hc(me),S=Mr(xe.userMessage,xe.code);console.error("[Auth] Apple sign-in failed",{code:xe.code,message:xe.message}),Ye({kind:"auth_oauth_failed",message:xe.message||"Apple sign-in failed",code:xe.code,extra:{provider:"apple.com",origin:typeof window<"u"?window.location.origin:void 0}}),g(S),$s(S,"error")}finally{p(!1)}},[i]),ce=typeof window<"u"?window.location.hostname:"",re=typeof window<"u"?window.location.origin:"(unknown)",ge=((Ee=U==null?void 0:U.app)==null?void 0:Ee.options)??{},z=ce.startsWith("localhost")||(I==null?void 0:I.email)==="developer@adlrlabs.com",fe=l.useMemo(()=>P?{tone:"error",message:P}:b&&b.status!=="ok"?{tone:"warning",message:b.message||(b.status==="error"?"IdentityToolkit clientConfig probe failed.":"IdentityToolkit clientConfig returned a warning (often a missing authorized domain).")}:ys.length?{tone:"warning",message:`Optional Firebase keys missing: ${ys.join(", ")}`}:{tone:"ok",message:"Firebase configuration detected."},[ys,P,b]);return e.jsxs("main",{className:"min-h-screen flex items-center justify-center bg-background p-6",children:[e.jsx(Ce,{title:"Sign In · MyBodyScan",description:"Access your MyBodyScan account to start and review scans.",canonical:T}),e.jsxs(Y,{className:"w-full max-w-md shadow-md",children:[e.jsx(oe,{children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"text-2xl mb-2",children:o==="signin"?"Welcome back":"Create your account"}),e.jsx(fa,{className:"text-slate-600",children:"Track body fat, weight and progress — private and secure."})]})}),e.jsxs(Q,{children:[z&&e.jsx("div",{className:"mb-2 flex justify-end",children:e.jsx(_,{type:"button",size:"xs",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>N(me=>!me),children:y?"Hide config status":"Show config status"})}),y&&z&&e.jsxs("div",{className:`mb-3 rounded-md border p-3 text-xs ${fe.tone==="warning"?"border-amber-300 bg-amber-50 text-amber-900":fe.tone==="ok"?"border-emerald-300 bg-emerald-50 text-emerald-900":"border-muted bg-muted/30 text-muted-foreground"}`,children:[e.jsx("div",{className:"font-semibold text-sm",children:fe.tone==="warning"?"Config warning":"Config status"}),e.jsx("div",{className:"mt-1",children:fe.message}),(b==null?void 0:b.status)==="warning"&&e.jsx("div",{className:"mt-1 text-[11px] text-amber-800",children:"IdentityToolkit clientConfig returned a warning (404/403). Login continues; add this origin to Firebase Auth authorized domains if needed."}),b==null&&e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Probing runtime configuration…"})]}),P&&e.jsxs(tt,{className:"mb-4 border-amber-300 bg-amber-50 text-amber-900",children:[e.jsx(rt,{children:"Configuration warning"}),e.jsx(st,{children:P})]}),x&&e.jsx("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm text-destructive",children:x}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(_,{size:"sm",variant:o==="signin"?"default":"outline",onClick:()=>c("signin"),children:"Sign in"}),e.jsx(_,{size:"sm",variant:o==="signup"?"default":"outline",onClick:()=>c("signup"),children:"Create account"})]}),e.jsx("div",{className:"mb-4 p-4 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"space-y-2 text-sm text-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Accurate body-fat estimates from photos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Progress tracking & reminders"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Private by default — your data, your control"})]})]})}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"email",children:"Email"}),e.jsx(We,{id:"email",type:"email",value:h,onChange:me=>m(me.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"password",children:"Password"}),e.jsx(We,{id:"password",type:"password",value:u,onChange:me=>d(me.target.value),required:!0})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(_,{type:"submit",className:"mbs-btn mbs-btn-primary w-full",disabled:f,children:f?o==="signin"?"Signing in...":"Creating...":o==="signin"?"Sign in":"Create account"}),e.jsx(_,{type:"button",variant:"link",disabled:f,onClick:async()=>{try{await Vx(h),V({title:"Reset link sent",description:"Check your email for reset instructions."})}catch(me){V({title:"Couldn't send reset",description:(me==null?void 0:me.message)||"Please try again."})}},children:"Forgot password?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"button",onClick:M,disabled:f,className:"w-full rounded border px-3 py-2 text-sm font-medium hover:bg-muted focus:outline-none focus:ring","data-testid":"btn-google",children:"Continue with Google"}),e.jsxs("button",{type:"button",onClick:X,disabled:f,className:"w-full rounded border px-3 py-2 text-sm font-medium hover:bg-muted focus:outline-none focus:ring inline-flex items-center justify-center gap-2","data-testid":"btn-apple","aria-label":"Continue with Apple",children:[e.jsx(Jy,{}),"Continue with Apple"]})]}),x&&v?e.jsxs("div",{className:"mt-3",children:[e.jsx(_,{type:"button",variant:"outline",className:"w-full",disabled:f,onClick:()=>{if(v==="google.com"){M();return}v==="apple.com"&&X()},children:"Try again"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground text-center",children:"If this keeps failing, check your connection or use a different sign-in method."})]}):null,e.jsxs("div",{className:"mt-6",children:[E&&!I&&e.jsxs("div",{className:"mt-4",children:[e.jsx(_,{type:"button",variant:"outline",className:"w-full",onClick:C,children:"Just looking? Browse the demo"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Preview the experience with sample data. Sign up to save your progress."})]}),e.jsxs("div",{className:"mt-4 text-center text-xs text-muted-foreground space-x-2",children:[e.jsx("a",{href:"/privacy",className:"underline hover:no-underline",children:"Privacy"}),e.jsx("span",{children:"?"}),e.jsx("a",{href:"/terms",className:"underline hover:no-underline",children:"Terms"})]}),z&&e.jsxs("div",{className:"mt-6 rounded-lg border bg-muted/30 p-3 text-[11px] leading-relaxed text-muted-foreground space-y-1",children:[e.jsx("div",{className:"font-semibold text-xs text-foreground",children:"Debug info"}),e.jsxs("div",{children:["Origin: ",re]}),e.jsxs("div",{children:["Project ID: ",ge.projectId||"(unknown)"]}),e.jsxs("div",{children:["Auth domain:"," ",ge.authDomain||"(unknown)"]}),e.jsxs("div",{children:["Has config: ",String(Ea)]}),e.jsxs("div",{children:["Missing config:"," ",Bs.length?Bs.join(", "):"none"]}),e.jsxs("div",{children:["Optional missing:"," ",ys.length?ys.join(", "):"none"]}),e.jsxs("div",{children:["IdentityToolkit probe: ",(b==null?void 0:b.status)||"pending",b!=null&&b.statusCode?` (${b.statusCode})`:""]}),e.jsxs("div",{children:["Current user: ",((Ie=U==null?void 0:U.currentUser)==null?void 0:Ie.email)||"(none)"," · UID:"," ",((be=U==null?void 0:U.currentUser)==null?void 0:be.uid)||"-"]}),e.jsxs("div",{children:["Last auth error: ",x||P||"none"]})]})]})]})]})]})};function Zy(t){if(!t)return{};if(typeof t=="string")return{message:t};if(typeof t=="object"){const s=t,n=typeof s.message=="string"?s.message:void 0,r=typeof s.code=="string"?s.code:void 0;return{message:n,code:r}}return{}}function eb(t){if(!t)return;let s=t.replace(/^Firebase:\s*/i,"");return s=s.replace(/\s*\(auth\/[\w-]+\)\.?$/i,"").trim(),s||void 0}function Mr(t,s){const n=eb(t)??t??"Firebase sign-in failed.";return s?`${n} (${s})`:n}const tb=Sn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Xe({className:t,variant:s,...n}){return e.jsx("div",{className:ae(tb({variant:s}),t),...n})}const zm=.45359237,el=2.54;function Pt(t){return t/zm}function gt(t){return t*zm}function Da(t){return t/el}function tl(t){const s=Math.floor(t/12),n=Math.round(t-s*12);return{ft:s,inches:n}}function sb(t,s){return(t*12+s)*el}function Vm(t,s,n){const r=typeof t=="object"&&t!==null?{kg:t.kg,preferredUnit:t.preferredUnit,digits:t.digits}:{kg:t,preferredUnit:s??"lb",digits:n},a=r.kg,i=typeof r.digits=="number"?r.digits:1;if(a==null||!Number.isFinite(a))return{value:null,unitLabel:r.preferredUnit,label:r.preferredUnit};const o=r.preferredUnit==="kg"?a:Pt(a),c=Math.pow(10,i),h=Number.isFinite(o)?Math.round(o*c)/c:NaN;return{value:Number.isFinite(h)?h:null,unitLabel:r.preferredUnit,label:r.preferredUnit}}function g_(t,s=0,n="us"){if(t==null)return"—";const a=Vm({kg:t,preferredUnit:n==="metric"?"kg":"lb",digits:s});return a.value!=null?`${a.value.toFixed(s)} ${a.unitLabel}`:"—"}function no(t){if(t==null)return"—";const{ft:s,inches:n}=tl(Da(t));return`${s}′ ${n}″`}function nb(t,s=1){return t==null?"—":t.toFixed(s)}function an(...t){for(const s of t)if(typeof s=="number"&&Number.isFinite(s))return s;return null}function rr(t){const s=(t==null?void 0:t.metrics)??{},n=(t==null?void 0:t.result)??{},r=(t==null?void 0:t.results)??n,a=(t==null?void 0:t.measurements)??{},i=t??{},o=an(s.bf_percent,s.bodyFatPct,s.bfPct,s.body_fat,r.bf_percent,r.bodyFatPct,i.bfPct,i.bodyFatPercentage,i.body_fat,i.bodyfat,a.bodyFatPct),c=an(s.bmi,s.body_mass_index,r.bmi,i.bmi,i.bmiValue,a.bmi),h=an(s.weight_kg,s.weightKg,r.weight_kg,r.weightKg,i.weightKg,i.weight_kg,a.weightKg,a.weight_kg),m=an(s.weight_lb,s.weightLb,r.weight_lb,r.weightLb,i.weight_lbs,i.weightLb,a.weightLb,a.weight_lbs),u=an(s.weight,r.weight,i.weight),d=(()=>{if(h!=null){const x=m??Pt(h),g=m!=null&&Math.abs(m-h)<.75?Pt(h):x;return{weightKg:h,weightLb:g}}return m!=null?{weightKg:gt(m),weightLb:m}:u!=null?u>=140?{weightKg:gt(u),weightLb:u}:{weightKg:u,weightLb:Pt(u)}:{weightKg:null,weightLb:null}})(),f=typeof s.method=="string"?s.method:typeof i.method=="string"?i.method:typeof r.method=="string"?r.method:null,p=an(s.confidence,i.confidence,r.confidence);return{bodyFatPercent:o,bmi:c,weightKg:d.weightKg,weightLb:d.weightLb,method:f,confidence:p}}function x_(t){var n;const s=(n=U.currentUser)==null?void 0:n.uid;if(!s)throw new Error("No current user");return Se(de,"users",s,"scans",t)}function rb(t){return Math.round(t*10)/10}function sl(t,s="us"){const n=(t==null?void 0:t.bodyFatPercent)??null,r=n!=null?`${n.toFixed(1)}%`:"—",a=typeof(t==null?void 0:t.weightKg)=="number"&&Number.isFinite(t.weightKg)?t.weightKg:null;let i=typeof(t==null?void 0:t.weightLb)=="number"&&Number.isFinite(t.weightLb)?t.weightLb:null;a!=null&&i!=null&&Math.abs(i-a)<.75&&(i=null);const o=a??(i!=null?gt(i):null),h=Vm({kg:o,preferredUnit:s==="metric"?"kg":"lb",digits:1}),m=h.value!=null?`${h.value.toFixed(1)} ${h.unitLabel}`:"—";if(i==null&&o!=null){const f=Pt(o);i=Number.isFinite(f)?rb(f):null}const u=(t==null?void 0:t.bmi)??null,d=u!=null?nb(u,1):"—";return{bodyFatPercent:n,bodyFatText:r,weightLb:i,weightText:m,bmi:u,bmiText:d}}function ab(t){V({title:t})}const _t=()=>ab("Demo mode: sign in to save"),ib={id:"demo-scan-003",status:"complete",takenAt:"2024-05-18T14:20:00Z",completedAt:"2024-05-18T14:21:45Z",notes:"Trimmed 0.3% body fat over the last month by staying consistent with protein and steps.",metrics:{bodyFatPct:22.1,weightLb:182.4,bmi:25.3},thumbnails:{front:"/demo/scan-front.png",left:"/demo/scan-left.png",right:"/demo/scan-right.png",back:"/demo/scan-back.png"}},ob=[{id:"demo-scan-002",status:"complete",completedAt:"2024-04-15T13:52:00Z",notes:"Held weight steady while tightening macros.",metrics:{bodyFatPct:22.4,weightLb:183.1,bmi:25.5},thumbnails:{front:"/demo/scan-front.png",left:"/demo/scan-left.png",right:"/demo/scan-right.png",back:"/demo/scan-back.png"}},{id:"demo-scan-001",status:"complete",completedAt:"2024-03-10T11:18:00Z",notes:"Baseline scan to kick off the current training block.",metrics:{bodyFatPct:23,weightLb:185.2,bmi:25.9},thumbnails:{front:"/demo/scan-front.png",left:"/demo/scan-left.png",right:"/demo/scan-right.png",back:"/demo/scan-back.png"}}],lb={latest:ib,history:ob},cb="2024-05-18",db={calories:1985,protein:142,carbs:186,fat:61},ub=[{id:"demo-breakfast",name:"Greek yogurt parfait",time:"07:45",calories:380,protein:32,carbs:46,fat:9,notes:"Non-fat yogurt, berries, granola"},{id:"demo-lunch",name:"Chicken quinoa bowl",time:"12:30",calories:520,protein:45,carbs:52,fat:16,notes:"Roasted veggies, avocado drizzle"},{id:"demo-snack",name:"Protein shake",time:"15:30",calories:240,protein:30,carbs:18,fat:4},{id:"demo-dinner",name:"Salmon with roasted potatoes",time:"19:00",calories:620,protein:35,carbs:48,fat:24,notes:"Side salad with olive oil"},{id:"demo-evening",name:"Dark chocolate square",time:"21:00",calories:225,protein:0,carbs:22,fat:8}],mb={date:cb,totals:db,meals:ub},hb="Welcome to the MyBodyScan demo! Here's how a typical check-in feels.",fb=[{id:"coach-welcome",role:"user",message:"Coach, what should I focus on this month?",reply:"Keep chasing consistent protein (~0.8-1.0g per lb), three strength sessions, and 10-12k steps. We'll reassess in two weeks."},{id:"coach-followup",role:"user",message:"Nutrition has been okay but weekends are tough.",reply:"Block time for meal prep on Friday, keep protein-forward snacks handy, and log one weekend day so we can spot trends."},{id:"coach-cardio",role:"user",message:"Should I add more cardio?",reply:"Keep two 20-minute Zone 2 sessions for recovery and add a short interval ride if energy is high. Prioritize sleep before stacking extra work."}],pb={intro:hb,messages:fb};function Xa(t){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"){const s=Date.parse(t);if(Number.isFinite(s))return s}return Date.now()}function gb(t){return Number.isFinite(t)?Number((t/2.20462).toFixed(1)):null}function Km(t){const s=t.createdAt??t.takenAt??t.completedAt,n=Xa(t.completedAt),r=Xa(s),a=Xa(t.updatedAt??t.completedAt??s),i=gb(t.metrics.weightLb);return{id:t.id,status:t.status??"complete",takenAt:t.takenAt??t.completedAt,completedAt:n,createdAt:r,updatedAt:a,charged:!0,mode:"4",note:t.notes,notes:t.notes,metrics:{bodyFatPct:t.metrics.bodyFatPct,weightLb:t.metrics.weightLb,weight_lb:t.metrics.weightLb,weightKg:i,weight_kg:i??void 0,bmi:t.metrics.bmi},results:{bodyFatPct:t.metrics.bodyFatPct,weightLb:t.metrics.weightLb,weight_kg:i??void 0,bmi:t.metrics.bmi},measurements:{bodyFatPct:t.metrics.bodyFatPct,weightLb:t.metrics.weightLb,weightKg:i,bmi:t.metrics.bmi},method:t.method??"photo",confidence:t.confidence??.86,analysis:{},thumbnails:t.thumbnails??{}}}const Gm=lb,Hm=Gm.history.map(Km),Ds=Km(Gm.latest),ms=mb,ro=pb,xb={sex:"male",age:34,height_cm:178,heightCm:178,weight_kg:82.7,weightKg:82.7,unit:"us",goal:"lose_fat",activity_level:"moderate",currentProgramId:"demo-balanced",activeProgramId:"demo-balanced",currentWeekIdx:0,currentDayIdx:1},yb=15*60*1e3;function bb(t){if(!t)return null;if(t instanceof Date){const s=t.getTime();return Number.isFinite(s)?s:null}if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="object"){const s=typeof t.toMillis=="function"?t.toMillis():null;if(s!=null&&Number.isFinite(s))return s;if(typeof t.seconds=="number")return Math.round(t.seconds*1e3)}return null}function jb(t){const s=(t||"").toLowerCase();return s==="uploading"?"uploading":s==="uploaded"?"uploaded":s==="queued"?"queued":s==="processing"||s==="in_progress"||s==="analyzing"?"processing":s==="complete"||s==="completed"||s==="done"||s==="success"?"complete":s==="error"||s==="failed"||s==="failure"||s==="aborted"?"error":"pending"}function wb(t,s,n=Date.now()){if(t!=="pending"&&t!=="queued"&&t!=="processing"&&t!=="uploading"&&t!=="uploaded")return!1;const r=bb(s);return r==null?!1:n-r>yb}function vb(t,s,n=Date.now()){const r=jb(t),a=wb(r,s,n);return r==="complete"&&!a?{canonical:r,label:"Complete",helperText:"View your latest scan metrics.",badgeVariant:"default",stale:!1,showMetrics:!0,recommendRescan:!1}:r==="error"||a?{canonical:r==="error"?"error":"processing",label:a?r==="uploading"?"Upload stalled":r==="uploaded"?"Upload complete, awaiting analysis":r==="queued"?"Queued longer than usual":r==="pending"?"Preparing longer than usual":r==="processing"?"Still processing":"Failed":"Failed",helperText:a?r==="uploading"?"Check your connection and retry the failed photo upload.":r==="uploaded"||r==="pending"?"Processing will start shortly. You can also retry processing.":r==="queued"||r==="processing"?"We’re still working on this scan. You can retry processing if needed.":"Start a new scan to try again.":"Start a new scan to try again.",badgeVariant:r==="error"?"destructive":"secondary",stale:a,showMetrics:!1,recommendRescan:r==="error"}:r==="uploading"?{canonical:r,label:"Uploading photos…",helperText:"Keep this tab open – uploads usually complete in seconds.",badgeVariant:"secondary",stale:!1,showMetrics:!1,recommendRescan:!1}:r==="uploaded"?{canonical:r,label:"Upload complete",helperText:"Starting analysis…",badgeVariant:"secondary",stale:!1,showMetrics:!1,recommendRescan:!1}:r==="queued"?{canonical:r,label:"Queued for processing…",helperText:"We’re warming up the scan engine. This should start shortly.",badgeVariant:"secondary",stale:!1,showMetrics:!1,recommendRescan:!1}:{canonical:r,label:"Processing…",helperText:"Keep this tab open – this usually takes a minute.",badgeVariant:"secondary",stale:!1,showMetrics:!1,recommendRescan:!1}}function Hn(t,s,n=Date.now()){return vb(t,s,n)}const Fn="us";function Os(){const{user:t}=He(),s=ft(),[n,r]=l.useState(Fn),[a,i]=l.useState(!0),[o,c]=l.useState(!1),[h,m]=l.useState(null);l.useEffect(()=>{if(s){r(Fn),i(!1);return}if(!t||!de){r(Fn),i(!1);return}i(!0);const d=Se(de,"users",t.uid),f=dt(d,p=>{var g,v;const x=(v=(g=p.data())==null?void 0:g.preferences)==null?void 0:v.units;r(x==="metric"?"metric":Fn),i(!1)},p=>{m(p.message||"Failed to load units"),r(Fn),i(!1)});return()=>f()},[t==null?void 0:t.uid,s]);const u=l.useCallback(async d=>{if(r(d),!(s||!t||!de)){c(!0);try{await oa(Se(de,"users",t.uid),{preferences:{units:d}},{merge:!0}),await oa(Se(de,"users",t.uid,"coach","profile"),{unit:d==="metric"?"kg":"lb"},{merge:!0}),m(null)}catch(f){throw m((f==null?void 0:f.message)||"Unable to save units"),r(p=>p),f}finally{c(!1)}}},[t,s]);return{units:n,loading:a,saving:o,error:h,setUnits:u}}function Ys(t){if(!t)return null;if(t instanceof Date)return Number.isFinite(t.getTime())?t:null;if(typeof(t==null?void 0:t.toDate)=="function")try{const s=t.toDate();return Number.isFinite(s.getTime())?s:null}catch{return null}if(typeof(t==null?void 0:t.seconds)=="number")return new Date(t.seconds*1e3);if(typeof t=="string"||typeof t=="number"){const s=new Date(t);return Number.isNaN(s.getTime())?null:s}return null}function xc(){return{id:Ds.id,createdAt:Ys(Ds.completedAt)??Ys(Ds.updatedAt)??Ys(Ds.createdAt)??new Date,status:Ds.status,raw:Ds}}function yc(t){const s=t.raw??{},n=Ys(s==null?void 0:s.completedAt),r=Ys(s==null?void 0:s.updatedAt),a=t.createdAt??Ys(s==null?void 0:s.createdAt);return(n==null?void 0:n.getTime())??(r==null?void 0:r.getTime())??(a==null?void 0:a.getTime())??0}const Ym=()=>{var X,ce,re,ge,z,fe,pe,Ee,Ie;const{user:t}=He(),s=ze(),n=ft(),{units:r}=Os(),a=km(),i=js()?xc():null,[o,c]=l.useState(i?[i]:[]),[h,m]=l.useState(0),u=l.useRef(!1),d=l.useMemo(()=>o.length<=1?o:[...o].sort((be,me)=>yc(me)-yc(be)),[o]),f=d[0]??null,p=l.useMemo(()=>{var be,me,xe;if(!d.length)return null;for(const S of d)if(Hn(S.status,((be=S.raw)==null?void 0:be.updatedAt)??((me=S.raw)==null?void 0:me.completedAt)??((xe=S.raw)==null?void 0:xe.createdAt)).showMetrics)return S;return d[0]??null},[d,h]),x=p?rr(p.raw):null,g=sl(x,r),v=p?Hn(p.status,((X=p.raw)==null?void 0:X.updatedAt)??((ce=p.raw)==null?void 0:ce.completedAt)??((re=p.raw)==null?void 0:re.createdAt)):null,j=f?Hn(f.status,((ge=f.raw)==null?void 0:ge.updatedAt)??((z=f.raw)==null?void 0:z.completedAt)??((fe=f.raw)==null?void 0:fe.createdAt)):null,y=!!(p&&f&&p.id===f.id),N=(j==null?void 0:j.canonical)==="error",b=!N&&(j==null?void 0:j.stale)&&!(j!=null&&j.showMetrics),w=f!=null&&f.createdAt?f.createdAt.toLocaleString():null,I=(v==null?void 0:v.showMetrics)??!1,F=p!=null&&p.createdAt?p.createdAt.toLocaleDateString():"—",E=g.bodyFatPercent!=null?g.bodyFatPercent.toFixed(1):"—",P=g.weightText,k=g.bmiText,C=!n&&!a.loading&&!a.personalizationCompleted,T=a.hasAnyOnboardingData?"Pick up where you left off to unlock personalized scans and workouts.":"Share your goals once to unlock personalized scans and workouts.",L=l.useMemo(()=>`/onboarding?returnTo=${encodeURIComponent("/home")}`,[]);l.useEffect(()=>{if(typeof window>"u")return;const be=window.setInterval(()=>{m(me=>me+1)},6e4);return()=>window.clearInterval(be)},[m]),l.useEffect(()=>{if(n&&!t){const S=xc();c([S]);return}if(!(t!=null&&t.uid)){c([]);return}const be=t.uid,me=Ft(Ot(de,"users",be,"scans"),Lt("updatedAt","desc"),Ht(5)),xe=dt(me,S=>{var A;if(S.empty){c([]);return}const K=S.docs.map(O=>{const J=O.data();return{id:O.id,createdAt:Ys(J==null?void 0:J.createdAt),status:(J==null?void 0:J.status)??"unknown",raw:J}});!u.current&&K.length&&(console.log("Home lastScan:",(A=K[0])==null?void 0:A.raw),u.current=!0),c(K)},S=>{console.error("Home last scan error",S),(S==null?void 0:S.code)==="permission-denied"&&(V({title:"Permission denied—please sign in again"}),s("/auth",{replace:!0}))});return()=>xe()},[t,n,s]);const M=(be={})=>{if(!n||t)return e.jsx(_,{variant:be.variant,className:be.className,onClick:()=>s("/scan/new"),children:"Start a Scan"});const me=be.className?`inline-flex ${be.className}`:"inline-flex",xe=be.className?`${be.className} pointer-events-none`:"pointer-events-none";return e.jsxs(ma,{children:[e.jsx(ha,{asChild:!0,children:e.jsx("span",{className:me,onClick:()=>_t(),children:e.jsx(_,{variant:be.variant,disabled:!0,className:xe,children:"Start a Scan"})})}),e.jsx(sr,{children:"Sign up to use this feature"})]})};return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Home – MyBodyScan",description:"Your latest body scan and quick actions.",canonical:window.location.href}),e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(Y,{className:"w-40",children:e.jsx(Q,{className:"p-4 text-center",children:e.jsx("img",{src:"/logo.svg",alt:"MyBodyScan Logo",className:"mx-auto h-10 w-auto max-w-full object-contain"})})})}),e.jsx("header",{className:"mb-6 text-center",children:e.jsx("h1",{className:"text-3xl font-semibold",children:"MyBodyScan"})}),e.jsxs("section",{className:"space-y-4",children:[C&&e.jsxs(Y,{className:"border-primary/40 bg-primary/5",children:[e.jsxs(oe,{children:[e.jsx(he,{className:"text-base",children:"Complete your profile"}),e.jsx(fa,{children:T})]}),e.jsx(Q,{children:e.jsx(_,{size:"sm",onClick:()=>s(L),children:"Finish setup"})})]}),e.jsxs(Y,{children:[e.jsxs(oe,{children:[e.jsx(he,{children:"Last scan"}),e.jsx(fa,{children:"The most recent result for your account"})]}),e.jsxs(Q,{children:[N&&e.jsxs("div",{className:"mb-3 rounded-md border border-destructive/40 bg-destructive/5 p-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-destructive",children:["Last scan failed",(pe=f==null?void 0:f.raw)!=null&&pe.errorReason?` (${f.raw.errorReason})`:(Ee=f==null?void 0:f.raw)!=null&&Ee.lastStep?` (${f.raw.lastStep})`:""]}),e.jsx("p",{className:"text-xs text-destructive/80",children:((Ie=f==null?void 0:f.raw)==null?void 0:Ie.errorMessage)||"Start a new scan to try again."}),e.jsx("div",{className:"mt-2",children:M({className:"w-full"})})]}),b&&e.jsxs("div",{className:"mb-3 rounded-md border border-amber-200 bg-amber-50 p-3 text-xs text-amber-900",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Scan appears stuck"}),e.jsx("p",{children:y?"We haven't received the final result. Start a new scan to continue.":`Your most recent scan${w?` from ${w}`:""} looks stuck. Showing the last completed result below.`})]}),!p&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:"No scans yet — Start a Scan to see your first result."})}),p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:F}),I?e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:E}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Body Fat"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:P}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weight"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:k}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BMI"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(Xe,{variant:(v==null?void 0:v.badgeVariant)??"secondary",children:(v==null?void 0:v.label)??"Processing…"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(v==null?void 0:v.helperText)??"Check History for progress."}),(v==null?void 0:v.recommendRescan)&&e.jsx(_,{size:"sm",variant:"outline",onClick:()=>s("/scan"),children:"Rescan"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[M(),e.jsx(_,{variant:"secondary",onClick:()=>s("/history"),children:"View History"})]})]})]})]}),e.jsxs("div",{className:"grid gap-3",children:[M({className:"w-full"}),e.jsx("a",{href:n&&!t?"/auth":L,className:"block text-center text-sm text-slate-500 hover:text-slate-700 mt-2",children:n&&!t?"Sign up to personalize results":"Personalize results (1 min)"}),e.jsx(_,{variant:"secondary",onClick:()=>s("/history"),children:"History"}),e.jsx(_,{variant:"outline",onClick:()=>s("/plans"),children:"Plans"}),e.jsx(_,{variant:"outline",onClick:()=>s("/settings"),children:"Settings"})]})]})]})},bc=()=>{const t=ze(),s=ft(),{user:n}=He(),r=s&&!n,a=(i,o)=>r?e.jsxs(ma,{children:[e.jsx(ha,{asChild:!0,children:e.jsx("span",{className:"inline-flex w-full",onClick:()=>_t(),children:e.jsx(_,{className:"w-full pointer-events-none",disabled:!0,children:i})})}),e.jsx(sr,{children:"Sign up to use this feature"})]}):e.jsx(_,{className:"w-full",onClick:()=>t(o),children:i});return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Choose Capture – MyBodyScan",description:"Pick the four photo angles required for your scan.",canonical:window.location.href}),e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Start a Scan"}),e.jsx("div",{className:"grid gap-4",children:e.jsxs(Y,{className:"shadow-md",children:[e.jsx(oe,{children:e.jsx(he,{children:"Photos"})}),e.jsx(Q,{children:a("Capture Photos","/capture/photos")})]})})]})};function jc(){const t=ze();return l.useEffect(()=>{t("/scan",{replace:!0})},[t]),e.jsxs("main",{className:"min-h-screen flex items-center justify-center p-6",children:[e.jsx(Ce,{title:"Redirecting to Live Scan",description:"Redirecting to the latest scan experience."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting to the Live Body Scan experience…"})]})}const Nb="Going back may cancel the current action. Continue?";let wc=!1,Za=!1,Gs=[],ps=null,Sb=0;function vc(){ps=Gs.length?Gs[Gs.length-1].guard:null}function kb(t){const s=++Sb;return Gs=[...Gs,{id:s,guard:t}],vc(),()=>{Gs=Gs.filter(n=>n.id!==s),vc()}}function Qm(){if(ks())try{window.history.pushState({__mbsSentinel:Date.now()},document.title,window.location.href)}catch{}}function Eb(t){var r,a;if(Za){Za=!1;return}if(!ps||!ps.shouldBlock())return;typeof t.preventDefault=="function"&&t.preventDefault(),Qm();const s=((r=ps.getMessage)==null?void 0:r.call(ps))??Nb;if(typeof window<"u"&&typeof window.confirm=="function"?window.confirm(s):!0){Za=!0;try{(a=ps.onConfirm)==null||a.call(ps)}catch{}typeof window<"u"&&window.history.back()}}function Cb(){wc||ks()&&(!Ko()&&!ka()||(Qm(),window.addEventListener("popstate",Eb),wc=!0))}function nl(t,s){const n=l.useRef(t),r=l.useRef(s==null?void 0:s.message),a=l.useRef(s==null?void 0:s.onConfirm);l.useEffect(()=>{n.current=t},[t]),l.useEffect(()=>{r.current=s==null?void 0:s.message},[s==null?void 0:s.message]),l.useEffect(()=>{a.current=s==null?void 0:s.onConfirm},[s==null?void 0:s.onConfirm]),l.useEffect(()=>!Ko()&&!ka()?()=>{}:kb({shouldBlock:()=>{var o;try{return((o=n.current)==null?void 0:o.call(n))??!1}catch{return!1}},getMessage:()=>r.current,onConfirm:()=>{var o;try{(o=a.current)==null||o.call(a)}catch{}}}),[])}const _b={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APPCHECK_MODE:"soft",VITE_APP_BASE_URL:"https://mybodyscanapp.com",VITE_DEMO_ENABLED:"true",VITE_ENABLE_APPLE:"true",VITE_ENABLE_DEMO:"true",VITE_ENABLE_EMAIL:"true",VITE_ENABLE_GOOGLE:"true",VITE_FIREBASE_API_KEY:"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8",VITE_FIREBASE_APP_ID:"",VITE_FIREBASE_AUTH_DOMAIN:"mybodyscan-f3daf.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"",VITE_FIREBASE_MESSAGING_SENDER_ID:"",VITE_FIREBASE_PROJECT_ID:"mybodyscan-f3daf",VITE_FIREBASE_STORAGE_BUCKET:"",VITE_FUNCTIONS_BASE_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_ORIGIN:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_REGION:"us-central1",VITE_FUNCTIONS_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_PRICE_MONTHLY:"price_1S4XsVQQU5vuhlNjzdQzeySA",VITE_PRICE_ONE:"price_1RuOpKQQU5vuhlNjipfFBsR0",VITE_PRICE_YEARLY:"price_1S4Y6YQQU5vuhlNjeJFmshxX",VITE_STRIPE_MODE:"live",VITE_STRIPE_PUBLISHABLE_KEY:"pk_live_51RuLm5QQU5vuhlNjBb0nO9IO0zWk2Mql49wU0ORYDfXEAHKvHDFqVgUiS5QUvo07L2k9s3xgLY1YdzEVnO4YdHH100PhNSDrfr"},Pb="mybodyscan-f3daf",Ab="us-central1",Vs=`https://${Ab}-${Pb}.cloudfunctions.net`;function Jm(t,s){const r=(_b||{})[t];return r&&typeof r=="string"&&r.trim()?r.trim():`${Vs}/${s}`}const Ib={systemHealth:"/api/system/health",coachChat:"/api/coach/chat",nutritionSearch:"/api/nutrition/search",createCheckout:"/api/createCheckout",createCustomerPortal:"/api/createCustomerPortal",deleteAccount:"/api/account/delete"},Tb={systemHealth:`${Vs}/systemHealth`,coachChat:`${Vs}/coachChat`,nutritionSearch:`${Vs}/nutritionSearch`,createCheckout:`${Vs}/createCheckout`,createCustomerPortal:`${Vs}/createCustomerPortal`,deleteAccount:`${Vs}/deleteAccount`};function Xm(){try{return typeof window>"u"?null:window.localStorage}catch(t){return console.warn("api_urls.storage_unavailable",t),null}}function Zm(t){return`mbs_url_${t}`}function Rb(t){const s=Xm(),n=s==null?void 0:s.getItem(Zm(t));return n||Ib[t]}function Nc(t,s){const n=Xm();try{n==null||n.setItem(Zm(t),s)}catch(r){console.warn("api_urls.cache_failed",r)}}function Mb(t){return Tb[t]}function xa(t,s){if(s&&s.includes("text/html"))return!0;const n=t.trim().slice(0,200).toLowerCase();return n.startsWith("<!doctype")||n.startsWith("<html")||n.includes("<head")||n.includes("<body")}class un extends Error{constructor(n,r=0,a,i){super(n);vt(this,"status");vt(this,"code");vt(this,"data");this.status=r,this.code=a,this.data=i}}async function Db(){const t=U.currentUser,[s,n]=await Promise.all([t?Pp(t,!1).catch(()=>""):Promise.resolve(""),Kn?Mo(Kn,!1).catch(()=>null):Promise.resolve(null)]),r={};return s&&(r.Authorization=`Bearer ${s}`),n!=null&&n.token&&(r["X-Firebase-AppCheck"]=n.token),r}function Fb(t){return t==null?{headers:{},payload:void 0}:typeof t=="string"||t instanceof Blob||t instanceof FormData?{headers:{},payload:t}:{headers:{"Content-Type":"application/json"},payload:JSON.stringify(t)}}function Sc(t){return new Promise(s=>setTimeout(s,t))}async function ws(t,s={}){var v,j,y,N,b,w;const{method:n="GET",headers:r={},body:a,timeoutMs:i=15e3,retries:o=2,retryBaseMs:c=400,expectJson:h=!0,signal:m}=s,u=await Db(),{headers:d,payload:f}=Fb(a),p={...u,...d,...r};let x=0,g=null;for(;x<=o;){const I=new AbortController,F=setTimeout(()=>I.abort(),i),E=()=>I.abort();try{if(m){if(m.aborted)throw clearTimeout(F),Object.assign(new Error("Request aborted."),{name:"AbortError"});m.addEventListener("abort",E,{once:!0})}const P=await fetch(t,{method:n,headers:p,body:f,signal:I.signal});if(clearTimeout(F),m)try{m.removeEventListener("abort",E)}catch{}const k=P.headers.get("content-type")||"";let C=null;if(h&&(k.includes("text/html")||k.includes("text/plain")||!k))try{if(C=await P.clone().text(),C&&xa(C,k))throw new un("Received HTML instead of JSON",P.status||0,void 0,{raw:C,contentType:k})}catch(M){if(M instanceof un)throw M}const T=async()=>{try{return await P.clone().json()}catch{return C!=null?{raw:C,contentType:k}:null}};if(!P.ok){const M=h?await T():null,X=typeof(M==null?void 0:M.raw)=="string"?M.raw:C,ce=(((v=M==null?void 0:M.error)==null?void 0:v.message)||(M==null?void 0:M.message)||(X&&xa(X,k)?"HTML response":`${P.status} ${P.statusText}`)).toString(),re=((j=M==null?void 0:M.error)==null?void 0:j.code)||(M==null?void 0:M.code)||void 0;if([429,502,503,504].includes(P.status)&&x<o){const ge=c*Math.pow(2,x);await Sc(ge),x++;continue}throw new un(ce,P.status,re,M)}return h?await T()??void 0:void 0}catch(P){if(clearTimeout(F),m)try{m.removeEventListener("abort",E)}catch{}if(((P==null?void 0:P.name)==="AbortError"||((N=(y=P==null?void 0:P.message)==null?void 0:y.includes)==null?void 0:N.call(y,"NetworkError"))||((w=(b=P==null?void 0:P.message)==null?void 0:b.includes)==null?void 0:w.call(b,"Failed to fetch")))&&x<o){const T=c*Math.pow(2,x);await Sc(T),x++,g=P;continue}g=P;break}}throw g instanceof un?g:new un((g==null?void 0:g.message)||"Network request failed",0)}const Lb=(t,s,n={})=>ws(t,{...n,method:"POST",body:s});async function Bb(t,s,n={}){var r,a;try{const i=await ws(s,n);return Nc(t,s),i}catch(i){const o=i,c=typeof((r=o==null?void 0:o.data)==null?void 0:r.raw)=="string"?o.data.raw:void 0,h=typeof((a=o==null?void 0:o.data)==null?void 0:a.contentType)=="string"?o.data.contentType:void 0,m=String((o==null?void 0:o.message)||""),u=(c?xa(c,h):!1)||xa(m,h),d=(o==null?void 0:o.status)??(typeof(o==null?void 0:o.status)=="number"?o.status:0);if(!u&&d>0&&d<500)throw o;const f=Mb(t),p=await ws(f,n);return Nc(t,f),p}}const eh=1600,th=1280,Ob=.8,Ub=4500;let Ln=null;function $b(){return typeof Worker<"u"&&typeof OffscreenCanvas<"u"&&typeof createImageBitmap<"u"}function Wb(){if(!$b())return null;if(Ln)return Ln;try{return Ln=new Worker(new URL("/assets/preprocessWorker-CvDsUwM5.js",import.meta.url),{type:"module"}),Ln}catch(t){return console.warn("preprocessWorker_init_failed",t),Ln=null,null}}async function qb(t,s,n){const r=Wb();if(!r)return null;const a=`prep-${Date.now()}-${Math.random().toString(16).slice(2)}`,i=await t.arrayBuffer();return await new Promise(o=>{const c=setTimeout(()=>{o(null)},Ub),h=m=>{const u=m.data;if(!u||u.id!==a)return;if(r.removeEventListener("message",h),clearTimeout(c),!u.ok){o(null);return}const d=new Blob([u.buffer],{type:"image/jpeg"});o({blob:d,width:u.width,height:u.height})};r.addEventListener("message",h),r.postMessage({id:a,buffer:i,type:t.type||"application/octet-stream",maxEdge:s,quality:n},{transfer:[i]})})}async function kc(){if(typeof requestIdleCallback<"u"){await new Promise(t=>requestIdleCallback(()=>t(),{timeout:12}));return}await new Promise(t=>setTimeout(t,0))}async function zb(t,s=1800,n=.8){var r,a;try{const i=await nh(t).catch(()=>1),o=await sh(t),c=o.width,h=o.height,m=Math.min(1,s/Math.max(c,h));let u=Math.max(1,Math.round(c*m)),d=Math.max(1,Math.round(h*m));const f=i>=5&&i<=8,p=document.createElement("canvas");p.width=f?d:u,p.height=f?u:d;const x=p.getContext("2d");if(!x)throw new Error("Couldn’t prepare photo on this device");x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",io(x,i,p.width,p.height),x.drawImage(o.el,0,0,u,d);const g=3*1024*1024;let v=Fa(n),j=await ti(p,v),y=0;for(;j.size>g&&y<8;){if(y+=1,v>.62){v=Math.max(.62,v-.06),j=await ti(p,v);continue}const N=Math.max(1100,Math.round(Math.max(u,d)*.9));if(N>=Math.max(u,d))break;const b=N/Math.max(u,d);u=Math.max(1,Math.round(u*b)),d=Math.max(1,Math.round(d*b)),p.width=f?d:u,p.height=f?u:d,io(x,i,p.width,p.height),x.drawImage(o.el,0,0,u,d),j=await ti(p,v)}return(r=o.cleanup)==null||r.call(o),j}catch(i){throw new Error((a=i==null?void 0:i.message)!=null&&a.includes("Couldn’t prepare")?i.message:"Couldn’t prepare photo on this device")}}function ei(t){return{name:t.name||"image",size:typeof t.size=="number"?t.size:0,type:(t.type||"").trim()||"application/octet-stream"}}function ao(){if(typeof navigator>"u")return!1;const t=String(navigator.userAgent||"");if(!/iP(hone|ad|od)/i.test(t))return!1;const n=/CriOS/i.test(t),r=/FxiOS/i.test(t),a=/EdgiOS/i.test(t);return n||r||a?!1:/Safari/i.test(t)}function Vb(){if(typeof window>"u"||typeof navigator>"u")return!1;const t=String(navigator.userAgent||""),s=typeof navigator.maxTouchPoints=="number"?Number(navigator.maxTouchPoints):0,n=typeof window.innerWidth=="number"?window.innerWidth<=900:!1,r=ao(),a=/iP(hone|ad|od)/i.test(t);return r||s>0&&n||a&&s>0}function Ec(t){const s=t.source.width,n=t.source.height,r=Math.min(1,t.maxEdge/Math.max(s,n)),a=Math.max(1,Math.round(s*r)),i=Math.max(1,Math.round(n*r)),o=t.orientation>=5&&t.orientation<=8,c=document.createElement("canvas");c.width=o?i:a,c.height=o?a:i;const h=c.getContext("2d");if(!h)throw new Error("Canvas rendering unavailable.");return h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",io(h,t.orientation,c.width,c.height),h.drawImage(t.source.el,0,0,a,i),{canvas:c,ctx:h,outW:a,outH:i,swapDims:o}}async function Cc(t,s){return await new Promise(n=>{t.toBlob(r=>n(r??null),"image/jpeg",Fa(s))})}async function Kb(t,s){var y;const n=ei(t),r=(s==null?void 0:s.maxEdgeDesktop)??eh,a=(s==null?void 0:s.maxEdgeMobileSafari)??th,i=Vb(),o=i?a:r,c=Fa(s==null?void 0:s.jpegQualityStart),h=(s==null?void 0:s.outputBytesLimit)??Math.round(3*1024*1024),m=await nh(t).catch(()=>1),u=await qb(t,o,c);if(u){const N=((s==null?void 0:s.fileName)||"upload.jpg").replace(/\.(png|webp|heic|heif|jpeg|jpg)$/i,".jpg"),b=new File([u.blob],N,{type:"image/jpeg"}),w=ei(b);return{original:n,compressed:w,file:b,debug:{device:{isMobileUploadDevice:i,isProbablyMobileSafari:ao(),userAgent:typeof navigator<"u"?String(navigator.userAgent||""):"",maxTouchPoints:typeof navigator<"u"&&typeof navigator.maxTouchPoints=="number"?Number(navigator.maxTouchPoints):0,viewport:{width:typeof window<"u"?Number(window.innerWidth||0):0,height:typeof window<"u"?Number(window.innerHeight||0):0}},orientation:m,srcWidth:u.width,srcHeight:u.height,maxEdgeInitial:o,maxEdgeFinal:Math.max(u.width,u.height),qualityInitial:c,qualityFinal:c,outputBytesLimit:h,steps:[{maxEdge:o,quality:c,blobBytes:u.blob.size,toBlobNull:!1}]}}}const d=await sh(t),f={device:{isMobileUploadDevice:i,isProbablyMobileSafari:ao(),userAgent:typeof navigator<"u"?String(navigator.userAgent||""):"",maxTouchPoints:typeof navigator<"u"&&typeof navigator.maxTouchPoints=="number"?Number(navigator.maxTouchPoints):0,viewport:{width:typeof window<"u"?Number(window.innerWidth||0):0,height:typeof window<"u"?Number(window.innerHeight||0):0}},orientation:m,srcWidth:d.width,srcHeight:d.height,maxEdgeInitial:o,maxEdgeFinal:o,qualityInitial:c,qualityFinal:c,outputBytesLimit:h,steps:[]},p="el"in d?[o,Math.min(o,1400),1200,1024,900,768].filter((N,b,w)=>Number.isFinite(N)&&N>0&&w.indexOf(N)===b).sort((N,b)=>b-N):[o],x=[c,Math.min(c,.7),Math.min(c,.65),Math.min(c,.6),Math.min(c,.55)].filter((N,b,w)=>N>0&&N<=1&&w.indexOf(N)===b);let g=null,v=o,j=c;try{for(const w of p){await kc();const{canvas:I}=Ec({source:d,orientation:m,maxEdge:w});for(const F of x){const E=await Cc(I,F),P=E?E.size:null;if(f.steps.push({maxEdge:w,quality:F,blobBytes:P,toBlobNull:E==null}),!!E&&!(!Number.isFinite(E.size)||E.size<=0)){if(E.size<=h){g=E,v=w,j=F;break}(!g||E.size<g.size)&&(g=E,v=w,j=F)}}if(g&&g.size<=h)break}if(!g||g.size<=0)throw new Error("Image encoding failed (JPEG blob unavailable).");if(g.size>h){let w=v,I=j,F=0;const E=640,P=.5;for(;g.size>h&&F<18;){F+=1,await kc(),I>P?I=Math.max(P,Number((I-.05).toFixed(2))):(w=Math.max(E,Math.round(w*.85)),I=Math.max(P,Math.min(I+.05,c)));const{canvas:k}=Ec({source:d,orientation:m,maxEdge:w}),C=await Cc(k,I);f.steps.push({maxEdge:w,quality:I,blobBytes:C?C.size:null,toBlobNull:C==null}),!(!C||!Number.isFinite(C.size)||C.size<=0)&&(g=C,v=w,j=I)}if(g.size>h)throw new Error("Couldn’t prepare photo on this device")}const N=((s==null?void 0:s.fileName)||"upload.jpg").replace(/\.(png|webp|heic|heif|jpeg|jpg)$/i,".jpg"),b=new File([g],N,{type:"image/jpeg"});return f.maxEdgeFinal=v,f.qualityFinal=j,{original:n,compressed:ei(b),file:b,debug:f}}finally{(y=d.cleanup)==null||y.call(d)}}async function Gb(t,s){var n;try{const r=await Kb(t,{fileName:`${s}.jpg`,maxEdgeDesktop:eh,maxEdgeMobileSafari:th,jpegQualityStart:Ob,outputBytesLimit:3145728});return{preparedFile:r.file,meta:{original:r.original,prepared:r.compressed,debug:r.debug}}}catch(r){throw new Error((n=r==null?void 0:r.message)!=null&&n.includes("Couldn’t prepare")?r.message:"Couldn’t prepare photo on this device")}}async function sh(t){if(typeof window<"u"&&"createImageBitmap"in window)try{const n=await createImageBitmap(t);return{el:n,width:n.width,height:n.height,cleanup:()=>{var r;return(r=n.close)==null?void 0:r.call(n)}}}catch{}const s=await Hb(t);return{el:s,width:s.naturalWidth,height:s.naturalHeight}}function Hb(t){return new Promise((s,n)=>{const r=URL.createObjectURL(t),a=new Image;a.onload=()=>{URL.revokeObjectURL(r),s(a)},a.onerror=i=>{URL.revokeObjectURL(r),n(i)},a.src=r})}async function ti(t,s){return await new Promise(n=>{t.toBlob(r=>n(r??new Blob),"image/jpeg",Fa(s))})}function Fa(t){return Number.isFinite(t)?t<=0?0:t>=1?1:t:.8}function io(t,s,n,r){switch(t.setTransform(1,0,0,1,0,0),s){case 2:t.translate(n,0),t.scale(-1,1);break;case 3:t.translate(n,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(n,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-n,0);break}}async function nh(t){const s=(t.type||"").toLowerCase(),n=(t.name||"").toLowerCase();if(!(s==="image/jpeg"||s==="image/pjpeg"||n.endsWith(".jpg")||n.endsWith(".jpeg")))return 1;const a=await t.slice(0,256*1024).arrayBuffer(),i=new DataView(a);if(i.byteLength<4||i.getUint16(0,!1)!==65496)return 1;let o=2;for(;o+4<=i.byteLength;){const c=i.getUint16(o,!1);if(o+=2,c===65505){const m=i.getUint16(o,!1);if(o+=2,o+6>i.byteLength)return 1;if(i.getUint32(o,!1)!==1165519206||i.getUint16(o+4,!1)!==0){o+=m-2;continue}o+=6;const u=o,d=i.getUint16(u,!1),f=d===18761;if(!f&&d!==19789||i.getUint16(u+2,f)!==42)return 1;const p=i.getUint32(u+4,f);let x=u+p;if(x+2>i.byteLength)return 1;const g=i.getUint16(x,f);x+=2;for(let v=0;v<g;v+=1){const j=x+v*12;if(j+12>i.byteLength)break;if(i.getUint16(j,f)!==274)continue;const N=i.getUint16(j+2,f),b=i.getUint32(j+4,f);if(N!==3||b!==1)return 1;const w=i.getUint16(j+8,f);return w>=1&&w<=8?w:1}return 1}if(c===65498||c===65497)break;const h=i.getUint16(o,!1);o+=h}return 1}const Yt={};function Yb(){const t=Yt==null?void 0:Yt.VITE_SCAN_START_URL;return typeof t=="string"&&t.trim()?t.trim():"/api/scan/start"}function Qb(){const t=Yt==null?void 0:Yt.VITE_SCAN_SUBMIT_URL;return typeof t=="string"&&t.trim()?t.trim():"/api/scan/submit"}function Jb(){const t=Yt==null?void 0:Yt.VITE_SCAN_DELETE_URL;return typeof t=="string"&&t.trim()?t.trim():"/api/scan/delete"}function Xb(){const t=Yt==null?void 0:Yt.VITE_SCAN_UPLOAD_URL;return typeof t=="string"&&t.trim()?t.trim():"/api/scan/upload"}function Ws(t){if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch(s){console.error("scan: failed to parse timestamp",s)}if(typeof t=="string"){const s=new Date(t);if(!Number.isNaN(s.getTime()))return s}return new Date}function rh(t,s,n){const r=n.photoPaths,a=n.input,i=typeof(a==null?void 0:a.heightCm)=="number"&&Number.isFinite(a.heightCm)?a.heightCm:typeof(n==null?void 0:n.heightCm)=="number"&&Number.isFinite(n.heightCm)?n.heightCm:typeof(n==null?void 0:n.height_cm)=="number"&&Number.isFinite(n.height_cm)?n.height_cm:void 0,o=n.completedAt,c=n.lastStepAt,h=n.processingRequestedAt,m=n.processingStartedAt,u=n.processingHeartbeatAt,d=n.errorInfo;return{id:t,uid:s,createdAt:Ws(n.createdAt),updatedAt:Ws(n.updatedAt),completedAt:o?Ws(o):null,status:n.status??"pending",errorMessage:typeof n.errorMessage=="string"?n.errorMessage:null,errorReason:typeof n.errorReason=="string"?n.errorReason:null,errorInfo:d&&typeof d=="object"?{code:typeof d.code=="string"?d.code:void 0,message:typeof d.message=="string"?d.message:void 0,stage:typeof d.stage=="string"?d.stage:void 0,debugId:typeof d.debugId=="string"?d.debugId:void 0,stack:typeof d.stack=="string"?d.stack:void 0}:null,lastStep:typeof n.lastStep=="string"?n.lastStep:null,lastStepAt:c?Ws(c):null,progress:typeof n.progress=="number"&&Number.isFinite(n.progress)?n.progress:null,correlationId:typeof n.correlationId=="string"?n.correlationId:null,processingRequestedAt:h?Ws(h):null,processingStartedAt:m?Ws(m):null,processingHeartbeatAt:u?Ws(u):null,processingAttemptId:typeof n.processingAttemptId=="string"?n.processingAttemptId:null,submitRequestId:typeof n.submitRequestId=="string"?n.submitRequestId:null,recommendations:Array.isArray(n.recommendations)?n.recommendations.map(f=>typeof f=="string"?f.trim():"").filter(f=>f.length>0).slice(0,8):null,improvementAreas:Array.isArray(n.improvementAreas)?n.improvementAreas.map(f=>typeof f=="string"?f.trim():"").filter(f=>f.length>0).slice(0,10):null,disclaimer:typeof n.disclaimer=="string"&&n.disclaimer.trim()?n.disclaimer.trim().slice(0,280):null,planMarkdown:typeof n.planMarkdown=="string"?n.planMarkdown:null,metrics:n.metrics&&typeof n.metrics=="object"?n.metrics:null,usedFallback:typeof n.usedFallback=="boolean"?n.usedFallback:null,photoPaths:r??{front:"",back:"",left:"",right:""},uploadedPoses:n&&typeof n.uploadedPoses=="object"?{front:!!n.uploadedPoses.front,back:!!n.uploadedPoses.back,left:!!n.uploadedPoses.left,right:!!n.uploadedPoses.right}:null,weights:n&&typeof n.weights=="object"?{current:typeof n.weights.current=="number"?n.weights.current:null,goal:typeof n.weights.goal=="number"?n.weights.goal:null,unit:typeof n.weights.unit=="string"?n.weights.unit:null}:null,input:{currentWeightKg:typeof(a==null?void 0:a.currentWeightKg)=="number"&&Number.isFinite(a.currentWeightKg)?a.currentWeightKg:0,goalWeightKg:typeof(a==null?void 0:a.goalWeightKg)=="number"&&Number.isFinite(a.goalWeightKg)?a.goalWeightKg:0,heightCm:i??null},estimate:n.estimate??null,workoutPlan:n.workoutPlan??null,workoutProgram:n.workoutProgram??null,nutritionPlan:n.nutritionPlan??null,note:typeof n.note=="string"?n.note:void 0}}function wn(t,s,n){if(t instanceof un){const r=t.data??{},a=typeof r.message=="string"&&r.message.length?r.message:s,i=n??r.reason,o=i==="engine_not_configured"||i==="scan_engine_not_configured"?"Scan unavailable: add OPENAI_API_KEY and OPENAI_MODEL to Cloud Functions config.":a;return{code:t.code??r.code,message:o,debugId:r.debugId,status:t.status,reason:i}}return t instanceof Error?{message:t.message,reason:n}:{message:s,reason:n}}function Zb(t,s,n){return rh(t,s,n)}async function ej(t,s){if(!U.currentUser)return{ok:!1,error:{message:"Please sign in before starting a scan."}};try{const r=await ws(Yb(),{method:"POST",timeoutMs:(s==null?void 0:s.timeoutMs)??2e4,signal:s==null?void 0:s.signal,body:{currentWeightKg:t.currentWeightKg,goalWeightKg:t.goalWeightKg,heightCm:typeof t.heightCm=="number"&&Number.isFinite(t.heightCm)?Math.round(t.heightCm):void 0,correlationId:t.correlationId}});return r!=null&&r.scanId?{ok:!0,data:r}:{ok:!1,error:{message:"We couldn't start your scan. Please try again."}}}catch(r){return console.error("scan:start error",r),{ok:!1,error:wn(r,"Unable to start your scan right now.")}}}const tj=.01;function sj(t){if(!String(t.uid||"").trim())return{ok:!1,error:{message:"Missing scan session info.",reason:"upload_failed"}};const n=["front","back","left","right"],r=[];for(const o of n){const c=t.photos[o];if(!c)return{ok:!1,error:{message:`Missing ${o} photo.`,reason:"upload_failed"}};const h=Number.isFinite(c.size)?Number(c.size):0;r.push({pose:o,path:o,file:c,size:h})}if(!r.length)return{ok:!1,error:{message:"No photos selected for this scan.",reason:"upload_failed"}};const a=r.filter(o=>o.size<=0);if(a.length)return{ok:!1,error:{message:`We couldn't read your ${a.map(c=>c.pose).join(", ")} photo. Please retake and try again.`,reason:"upload_failed"}};const i=r.reduce((o,c)=>o+c.size,0);return{ok:!0,data:{uploadTargets:r,totalBytes:i}}}function oo(t){return!Number.isFinite(t)||t<=0?0:t>=1?1:t}function _c(t,s){if(!s)return oo(t);const n=t<=0?tj:t;return oo(n)}function nj(t,s){if((t.type||"").toLowerCase()===SCAN_UPLOAD_CONTENT_TYPE)return t;const r=t.name&&t.name.trim().length?t.name:`${s}.jpg`;return new File([t],r,{type:SCAN_UPLOAD_CONTENT_TYPE})}function rj(...t){const s=new AbortController,n=()=>s.abort();for(const r of t)if(r){if(r.aborted){n();break}r.addEventListener("abort",n,{once:!0})}return s.signal}function ah(t){const s=String(t||"scan").slice(0,12),n=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2);return`${s}-${n.slice(0,8)}`}async function si(t,s){var x,g,v,j;const n=U.currentUser;if(!n)return{ok:!1,error:{message:"Please sign in before submitting a scan."}};const r=["front","back","left","right"],a=t.scanCorrelationId??ah(t.scanId);t.heightCm==null&&console.warn("scan_submit_height_missing",{scanId:t.scanId,uid:n.uid});try{await n.getIdToken(!0)}catch(y){return{ok:!1,error:{code:"auth/token-refresh-failed",message:typeof(y==null?void 0:y.message)=="string"&&y.message.length?`Could not refresh your sign-in session: ${y.message}`:"Could not refresh your sign-in session. Please sign in again.",reason:"upload_failed"}}}const i=sj({uid:n.uid,photos:t.photos});if(!i.ok)return{ok:!1,error:i.error};const o=typeof(s==null?void 0:s.perPhotoTimeoutMs)=="number"&&Number.isFinite(s.perPhotoTimeoutMs)?Math.max(2500,Math.min(s.perPhotoTimeoutMs,8e3)):3500,c=typeof(s==null?void 0:s.perPhotoTimeoutMs)=="number"&&Number.isFinite(s.perPhotoTimeoutMs)?Math.max(3e4,s.perPhotoTimeoutMs):9e4,h=typeof(s==null?void 0:s.overallTimeoutMs)=="number"&&Number.isFinite(s.overallTimeoutMs)?Math.max(45e3,s.overallTimeoutMs):15e4,m=new AbortController,u=setTimeout(()=>m.abort(),h);s!=null&&s.signal&&(s.signal.aborted?m.abort():s.signal.addEventListener("abort",()=>m.abort(),{once:!0}));const d={front:null,back:null,left:null,right:null};for(const y of r){const N=t.photos[y];if(!N)return clearTimeout(u),{ok:!1,error:{message:`Missing ${y} photo.`,reason:"upload_failed"}};(x=s==null?void 0:s.onPhotoState)==null||x.call(s,{pose:y,status:"preparing"});const b=Date.now();try{const w=await Promise.race([Gb(N,y),new Promise(I=>setTimeout(()=>I(null),o))]);if(w)d[y]={file:w.preparedFile,meta:{original:w.meta.original,prepared:w.meta.prepared,debug:w.meta.debug}},(g=s==null?void 0:s.onPhotoState)==null||g.call(s,{pose:y,status:"preparing",original:w.meta.original,compressed:w.meta.prepared,preprocessDebug:w.meta.debug});else{const I=nj(N,y),F={name:I.name||`${y}.jpg`,size:I.size,type:I.type||"image/jpeg"};d[y]={file:I,meta:{original:F,prepared:F}},(v=s==null?void 0:s.onPhotoState)==null||v.call(s,{pose:y,status:"preparing",original:F,compressed:F})}console.info("scan.preprocess",{pose:y,ms:Date.now()-b,size:d[y].file.size})}catch{(j=s==null?void 0:s.onPhotoState)==null||j.call(s,{pose:y,status:"failed",message:"Couldn’t prepare photo on this device"});const I=new Error("Couldn’t prepare photo on this device");return I.code="preprocess_failed",I.pose=y,clearTimeout(u),{ok:!1,error:wn(I,I.message,"upload_failed")}}}const f=i.data.totalBytes;if(m.signal.aborted)return clearTimeout(u),{ok:!1,error:{code:"scan/overall-timeout",message:"This scan is taking too long. Please retry.",reason:"upload_failed"}};const p=(y,N)=>{var w;const b=f>0?oo(y/f):0;(w=s==null?void 0:s.onUploadProgress)==null||w.call(s,{pose:"front",fileIndex:0,fileCount:r.length,bytesTransferred:y,totalBytes:f,percent:_c(b,y>0),overallPercent:_c(b,y>0),hasBytesTransferred:y>0,status:N,attempt:1})};try{p(0,"uploading"),r.forEach((T,L)=>{var M,X,ce,re;(M=s==null?void 0:s.onPhotoState)==null||M.call(s,{pose:T,status:"uploading",attempt:1,percent:0,correlationId:a,uploadMethod:"function"}),(re=s==null?void 0:s.onUploadProgress)==null||re.call(s,{pose:T,fileIndex:L,fileCount:r.length,bytesTransferred:0,totalBytes:((ce=(X=d[T])==null?void 0:X.file)==null?void 0:ce.size)??1,percent:0,overallPercent:0,hasBytesTransferred:!1,status:"uploading",attempt:1})});const y=await n.getIdToken(),N=new FormData,b=t.unit==="lb"?"lb":"kg",w=b==="lb"?Pt(t.currentWeightKg):t.currentWeightKg,I=b==="lb"?Pt(t.goalWeightKg):t.goalWeightKg;N.set("currentWeight",String(w)),N.set("goalWeight",String(I)),N.set("unit",b),N.set("currentWeightKg",String(t.currentWeightKg)),N.set("goalWeightKg",String(t.goalWeightKg)),typeof t.heightCm=="number"&&N.set("height",String(t.heightCm)),t.scanId&&N.set("scanId",t.scanId),N.set("correlationId",a),r.forEach(T=>{var M;const L=((M=d[T])==null?void 0:M.file)??t.photos[T];N.append(T,L,(L==null?void 0:L.name)??`${T}.jpg`)});const F=new AbortController,E=setTimeout(()=>F.abort(),c),P=await fetch(Xb(),{method:"POST",headers:{Authorization:`Bearer ${y}`,"X-Correlation-Id":a},body:N,signal:rj(m.signal,F.signal)});if(clearTimeout(E),!P.ok){let T="Could not upload your photos. Please try again.",L;try{const M=await P.json();typeof(M==null?void 0:M.message)=="string"&&(T=M.message),typeof(M==null?void 0:M.debugId)=="string"&&(L=M.debugId)}catch{}throw Object.assign(new Error(T),{code:"upload_failed",debugId:L})}const k=await P.json(),C=(k==null?void 0:k.scanId)??t.scanId;return p(f,"done"),r.forEach(T=>{var L;(L=s==null?void 0:s.onPhotoState)==null||L.call(s,{pose:T,status:"done",percent:1,correlationId:a,uploadMethod:"function"})}),clearTimeout(u),{ok:!0,data:{...k??{},scanId:C,correlationId:(k==null?void 0:k.correlationId)??a,status:(k==null?void 0:k.status)??"queued"}}}catch(y){return clearTimeout(u),{ok:!1,error:wn(y,"Could not upload your photos. Please try again.","upload_failed")}}}async function lo(t){const s=U.currentUser;if(!s)return{ok:!1,error:{message:"Please sign in before retrying processing."}};const n=t.trim();if(!n)return{ok:!1,error:{message:"Missing scan id."}};try{await s.getIdToken(!0)}catch(r){return{ok:!1,error:{code:"auth/token-refresh-failed",message:typeof(r==null?void 0:r.message)=="string"&&r.message.length?`Could not refresh your sign-in session: ${r.message}`:"Could not refresh your sign-in session. Please sign in again.",reason:"submit_failed"}}}try{const r=Se(de,"users",s.uid,"scans",n),a=await ot(r);if(!a.exists())return{ok:!1,error:{message:"Scan not found.",reason:"submit_failed"}};const i=a.data(),o=i==null?void 0:i.photoPaths,c=i==null?void 0:i.input,h=Number(c==null?void 0:c.currentWeightKg),m=Number(c==null?void 0:c.goalWeightKg),u=typeof(c==null?void 0:c.heightCm)=="number"&&Number.isFinite(c.heightCm)?c.heightCm:typeof(i==null?void 0:i.heightCm)=="number"&&Number.isFinite(i.heightCm)?i.heightCm:null,d=typeof(i==null?void 0:i.correlationId)=="string"?i.correlationId:void 0;return!o||typeof o!="object"?{ok:!1,error:{message:"Missing photo paths for this scan.",reason:"submit_failed"}}:!Number.isFinite(h)||!Number.isFinite(m)?{ok:!1,error:{message:"Missing scan input (weights).",reason:"submit_failed"}}:(await ws(Qb(),{method:"POST",timeoutMs:3e4,retries:0,body:{scanId:n,photoPaths:{front:String(o.front||""),back:String(o.back||""),left:String(o.left||""),right:String(o.right||"")},currentWeightKg:h,goalWeightKg:m,heightCm:u??void 0,correlationId:d}}),{ok:!0,data:void 0})}catch(r){return{ok:!1,error:wn(r,"We couldn't restart processing right now.","submit_failed")}}}async function y_(t){var n;const s=(n=U.currentUser)==null?void 0:n.uid;if(!s)return{ok:!1,error:{message:"Please sign in to view this scan."}};if(!t.trim())return{ok:!1,error:{message:"Missing scan id."}};try{const r=Se(de,"users",s,"scans",t),a=await ot(r);if(!a.exists())return{ok:!1,error:{message:"Scan not found."}};const i=a.data();return{ok:!0,data:rh(a.id,s,i)}}catch(r){return console.error("scan:get error",r),{ok:!1,error:wn(r,"Unable to load this scan right now.")}}}async function ih(t){var n,r,a;const s=t.trim();if(!s)return{ok:!1,error:{message:"Missing scan id."}};try{const i=await ws(Jb(),{method:"POST",body:{scanId:s}});return i?"ok"in i&&!i.ok?{ok:!1,error:{message:(n=i.error)!=null&&n.message&&i.error.message!=="Bad Request"?i.error.message:"Unable to delete scan. Please try again.",code:((r=i.error)==null?void 0:r.code)??void 0,debugId:((a=i.error)==null?void 0:a.debugId)??void 0}}:{ok:!0,data:void 0}:{ok:!1,error:{message:"Unable to delete scan. Please try again."}}}catch(i){return console.error("scan:delete error",i),{ok:!1,error:wn(i,"Unable to delete scan. Please try again.")}}}const Pc=()=>{const{scanId:t}=Io(),s=ze(),[n,r]=l.useState("queued"),{user:a}=He(),[i,o]=l.useState(!1),[c,h]=l.useState(null),[m,u]=l.useState(null),[d,f]=l.useState(null),[p,x]=l.useState(null),[g,v]=l.useState({triggered:!1}),[j,y]=l.useState({triggered:!1}),N=l.useRef(null),b=typeof window<"u"?window.location.href:void 0;nl(()=>n==="queued"||n==="processing"||n==="pending",{message:"Going back may cancel the current action. Continue?"}),l.useEffect(()=>{const I=a==null?void 0:a.uid;if(!I||!t)return;const F=Se(de,"users",I,"scans",t),E=dt(F,P=>{const k=P.data(),C=typeof(k==null?void 0:k.status)=="string"?k.status.toLowerCase():"queued",T=C==="completed"||C==="complete"||C==="done"?"complete":C;r(T),h(typeof(k==null?void 0:k.lastStep)=="string"?k.lastStep:null),u(typeof(k==null?void 0:k.errorMessage)=="string"?k.errorMessage:null),f(typeof(k==null?void 0:k.errorReason)=="string"?k.errorReason:null);const L=(k==null?void 0:k.updatedAt)??(k==null?void 0:k.lastStepAt)??null;let M=null;try{if(L&&typeof(L==null?void 0:L.toDate)=="function")M=L.toDate().getTime();else if(typeof L=="string"){const X=Date.parse(L);M=Number.isFinite(X)?X:null}else L instanceof Date&&(M=L.getTime())}catch{M=null}typeof M=="number"&&Number.isFinite(M)&&(x(M),N.current=M),T==="complete"&&s(`/results/${t}`,{replace:!0})},P=>{console.error("Processing snapshot error",P),(P==null?void 0:P.code)==="permission-denied"&&(V({title:"Sign in required"}),s("/auth",{replace:!0}))});return()=>E()},[t,s,a]);const w=l.useMemo(()=>n==="processing"||n==="queued"||n==="pending",[n]);return l.useEffect(()=>{if(!w){v({triggered:!1}),y({triggered:!1});return}const I=5*60*1e3,F=()=>{const C=N.current;if(!C)return;const T=Date.now()-C;T>=9e4&&v({triggered:!0,sinceMs:T}),T>=I&&y({triggered:!0,sinceMs:T})},E=window.setInterval(F,1500),P=()=>{document.visibilityState==="visible"&&F()},k=()=>F();return document.addEventListener("visibilitychange",P),window.addEventListener("online",k),()=>{window.clearInterval(E),document.removeEventListener("visibilitychange",P),window.removeEventListener("online",k)}},[w]),l.useEffect(()=>{if(n==="processing"||n==="queued"||n==="pending"){const I=window.setTimeout(()=>o(!0),6e4);return()=>window.clearTimeout(I)}return o(!1),()=>{}},[n]),e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto flex flex-col items-center justify-center text-center",children:[e.jsx(Ce,{title:"Processing – MyBodyScan",description:"Analyzing your scan (about 1–2 minutes).",canonical:b}),e.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-muted border-t-primary animate-spin","aria-label":"Processing scan"}),e.jsx("h1",{className:"mt-6 text-2xl font-semibold",children:"Analyzing your scan"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"This can take ~1–2 minutes."}),e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 rounded-full px-3 py-1 bg-secondary text-secondary-foreground",children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${n==="complete"?"bg-primary":n==="error"?"bg-destructive":"bg-warning animate-pulse"}`}),e.jsx("span",{className:"text-sm font-medium",children:n==="queued"?"In queue...":n==="pending"?"Preparing...":n==="processing"?"Processing...":n==="complete"?"Complete!":n==="error"?"Failed":n})]}),i&&e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"This can take a bit. You can navigate; we’ll update automatically."}),n==="error"&&e.jsxs("div",{className:"mt-8 text-center space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:m||"Something went wrong during processing. Please try again."}),d?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["reason: ",d]}):null,e.jsx(_,{variant:"secondary",onClick:()=>s("/scan/new"),"aria-label":"Start a new scan",children:"Try Again"})]}),g.triggered&&w&&!j.triggered&&e.jsxs("div",{className:"mt-8 w-full max-w-sm space-y-3 rounded border p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Still working…"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["No status update for"," ",g.sinceMs?`${Math.round(g.sinceMs/1e3)}s`:"a while",". You can retry processing without re-uploading."]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[e.jsx(_,{variant:"secondary",onClick:async()=>{if(!t)return;const I=await lo(t);if(I.ok){V({title:"Retry started",description:"Processing restarted. Keep this tab open."}),v({triggered:!1});return}V({title:"Retry failed",description:I.error.message,variant:"destructive"})},children:"Retry processing"}),e.jsx(_,{variant:"outline",onClick:()=>window.location.reload(),children:"Refresh"}),e.jsx(_,{variant:"outline",onClick:()=>s("/scan"),children:"Back to Scan"})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["lastStep: ",c??"—"," · updatedAt:"," ",p?new Date(p).toLocaleTimeString():"—"]})]}),j.triggered&&w&&e.jsxs("div",{className:"mt-8 w-full max-w-sm space-y-3 rounded border border-destructive/40 bg-destructive/5 p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"This is taking too long"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["No update for"," ",j.sinceMs?`${Math.round(j.sinceMs/1e3)}s`:"a while",". We won’t keep you stuck on this screen."]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[e.jsx(_,{variant:"secondary",onClick:async()=>{if(!t)return;const I=await lo(t);if(I.ok){V({title:"Retry started",description:"Processing restarted. Keep this tab open."}),y({triggered:!1}),v({triggered:!1});return}V({title:"Retry failed",description:I.error.message,variant:"destructive"})},children:"Retry processing"}),e.jsx(_,{variant:"outline",onClick:()=>s("/scan/new"),children:"Start new scan"})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["lastStep: ",c??"—"," · updatedAt:"," ",p?new Date(p).toLocaleTimeString():"—"]})]})]})},vn=l.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:ae("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...s}));vn.displayName="Textarea";function aj(){const[t,s]=l.useState(null),[n,r]=l.useState(!0),[a,i]=l.useState(null),[o,c]=l.useState(null);return l.useEffect(()=>{if(!U){r(!1),i("auth_unavailable");return}const h=kn(U,m=>{c(m),m||(js()?s(Ds):s(null),r(!1),i(null))});return()=>{h()}},[]),l.useEffect(()=>{if(!o){js()&&r(!1);return}if(r(!0),i(null),!de){i("firestore_unavailable"),r(!1);return}const h=Ft(Ot(de,"users",o.uid,"scans"),Lt("createdAt","desc"),Ht(1)),m=dt(h,u=>{if(u.empty)s(null);else{const d=u.docs[0];s({id:d.id,...d.data()})}r(!1)},u=>{console.error("Error fetching latest scan:",u),i(u.message),r(!1)});return()=>m()},[o]),{scan:t,loading:n,error:a,user:o}}async function ij(t,s){try{Pa()}catch(n){if(n instanceof gr)return null;throw n}return Ip(t,s)}async function mt(t,s,n){try{Pa()}catch(r){if(r instanceof gr)return;throw r}return oa(t,s,n)}async function oh(t,s){try{Pa()}catch(n){if(n instanceof gr)return;throw n}return Tp(t,s)}async function lh(t){try{Pa()}catch(s){if(s instanceof gr)return;throw s}return Ap(t)}function ch(){return U.currentUser?!1:Js()}function oj(t){const s=`Sign up to use ${t}. You're viewing the demo.`;if(typeof window>"u")return;let n=!1;try{window.dispatchEvent(new CustomEvent("mbs:toast",{detail:{level:"info",message:s}})),n=!0}catch{}try{const r=window.toast;r!=null&&r.info&&(r.info(s),n=!0)}catch{}if(!n)try{typeof window.alert=="function"&&window.alert(s)}catch{}}function lj(t){return ch()?(oj(t),!1):!0}function cj(){return ch()?{disabled:!0,title:"Read-only demo mode"}:{disabled:!1}}const qt=As.forwardRef((t,s)=>{const{disabled:n,title:r}=cj();return e.jsx(_,{...t,ref:s,disabled:n||t.disabled,title:t.title??r})});qt.displayName="DemoWriteButton";function Xt(){const{loading:t}=He();return t||!Js()?null:e.jsx("div",{role:"status","data-testid":"demo-banner",className:"bg-amber-50 border border-amber-300 text-amber-900 px-3 py-2 text-sm",children:"Demo lets you browse; sign up to save your progress."})}const dj=t=>{if(!t)return"—";if(t.toDate)return t.toDate().toLocaleString();if(t instanceof Date)return t.toLocaleString();if(typeof t=="number"){const s=new Date(t);return Number.isNaN(s.getTime())?"—":s.toLocaleString()}if(typeof t=="string"){const s=new Date(t);return Number.isNaN(s.getTime())?"—":s.toLocaleString()}return"—"},uj=()=>{const[t,s]=l.useState(0),[n,r]=l.useState(0),a=["Lining up your measurements…","Estimating body fat…","Checking symmetry and posture…","Crunching numbers…","Almost there!"];return l.useEffect(()=>{const i=setInterval(()=>{s(c=>Math.min(c+1.1111111111111112,100))},1e3),o=setInterval(()=>{r(c=>(c+1)%a.length)},8e3);return()=>{clearInterval(i),clearInterval(o)}},[]),e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"max-w-xs mx-auto mb-6",children:[e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mb-3",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-1000 ease-out",style:{width:`${t}%`}})}),e.jsxs("p",{className:"text-sm font-medium mb-2",children:[Math.round(t),"%"]})]}),e.jsx("p",{className:"text-muted-foreground animate-fade-in",children:a[n]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"This usually takes ~1–2 minutes."})]})},mj=()=>{var E,P,k,C;const t=ze(),{scan:s,loading:n,error:r,user:a}=aj(),[i,o]=l.useState(""),[c,h]=l.useState(!1),m=js(),u=m&&!a,d=s??(m?Ds:null),{units:f}=Os();l.useEffect(()=>{d!=null&&d.note&&o(d.note)},[d==null?void 0:d.note]);const p=async()=>{if(!(!a||!s||!i.trim())){h(!0);try{const T=Se(de,"users",a.uid,"scans",s.id);await oh(T,{note:i.trim(),noteUpdatedAt:at()}),V({title:"Note saved successfully"})}catch(T){console.error("Error saving note:",T),V({title:"Failed to save note",variant:"destructive"})}finally{h(!1)}}};if(!a&&!m&&!n)return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsx(Xt,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Results"}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Sign in required to view your results."}),e.jsx(_,{onClick:()=>t("/auth"),className:"w-full",children:"Sign In"})]})})]})]});if(!d)return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsx(Xt,{}),e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Results"}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-6 space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"No scans yet — start your first scan to see results here."}),e.jsx(_,{onClick:()=>t(u?"/auth":"/scan/new"),className:"w-full",children:u?"Sign in to start":"Start a Scan"})]})})]});if(n&&!m)return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsx(Xt,{}),e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Results"}),e.jsxs(Y,{className:"mb-6",children:[e.jsxs(oe,{children:[e.jsx(St,{className:"h-6 w-32"}),e.jsx(St,{className:"h-4 w-24"})]}),e.jsx(Q,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(St,{className:"h-12 w-16 mx-auto mb-2"}),e.jsx(St,{className:"h-4 w-16 mx-auto"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(St,{className:"h-12 w-16 mx-auto mb-2"}),e.jsx(St,{className:"h-4 w-16 mx-auto"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(St,{className:"h-12 w-16 mx-auto mb-2"}),e.jsx(St,{className:"h-4 w-16 mx-auto"})]})]})})]})]});if(r)return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Results"}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to load your results. Please try again."}),e.jsx(_,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:"Retry"})]})})]})]});if(!d)return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Results"}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No scans yet. Start your first body scan to see results here."}),e.jsx(_,{onClick:()=>{if(u){_t();return}t("/scan/new")},className:"w-full",children:"Start Your First Scan"})]})})]})]});const x=rr(d),g=sl(x,f),v=g.bodyFatPercent!=null?`${g.bodyFatPercent.toFixed(1)}%`:"—",j=g.weightText,y=g.bmiText,N=typeof((E=d==null?void 0:d.estimate)==null?void 0:E.leanMassKg)=="number"?Number(d.estimate.leanMassKg):typeof((P=d==null?void 0:d.metrics)==null?void 0:P.leanMassKg)=="number"?Number(d.metrics.leanMassKg):null,b=typeof((k=d==null?void 0:d.estimate)==null?void 0:k.fatMassKg)=="number"?Number(d.estimate.fatMassKg):typeof((C=d==null?void 0:d.metrics)==null?void 0:C.fatMassKg)=="number"?Number(d.metrics.fatMassKg):null,w=N!=null?f==="us"?`${Pt(N).toFixed(1)} lb`:`${N.toFixed(1)} kg`:null,I=b!=null?f==="us"?`${Pt(b).toFixed(1)} lb`:`${b.toFixed(1)} kg`:null,F=Hn(d.status,d.completedAt??d.updatedAt??d.createdAt);return e.jsxs("main",{className:"min-h-screen p-6 max-w-md mx-auto",children:[e.jsx(Ce,{title:"Results – MyBodyScan",description:"Review your body scan results and add notes.",canonical:window.location.href}),e.jsx(Xt,{}),e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Results"}),e.jsxs(Y,{className:"mb-6",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(he,{className:"text-lg",children:dj(d.completedAt||d.createdAt)}),e.jsx(Xe,{variant:F.badgeVariant,children:F.label})]})}),e.jsx(Q,{children:F.showMetrics?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsx(Y,{children:e.jsxs(Q,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-3xl font-semibold text-primary",children:v}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Body Fat %"})]})}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-3xl font-semibold text-primary",children:j}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Weight"})]})}),e.jsx(Y,{children:e.jsxs(Q,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-3xl font-semibold text-primary",children:y}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"BMI"})]})})]}),(w||I)&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-2",children:[w?`Lean mass est: ${w}`:"",w&&I?" · ":"",I?`Fat mass est: ${I}`:""]})]}):F.canonical==="error"||F.recommendRescan?e.jsxs("div",{className:"text-center py-6 space-y-3",children:[e.jsx("p",{className:"text-destructive",children:F.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.error||d.errorMessage||F.helperText||"We couldn't process your scan. Please try again."}),e.jsx(_,{onClick:()=>{if(u){_t();return}t("/scan/new")},variant:"outline",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(uj,{}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:F.helperText})]})})]}),F.showMetrics&&d.planMarkdown?e.jsxs(Y,{className:"mb-6",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-lg",children:"Program & macros"})}),e.jsx(Q,{children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-left",children:d.planMarkdown})})]}):null,F.showMetrics&&e.jsxs(Y,{className:"mb-6",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-lg",children:"Notes"})}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(vn,{placeholder:u?"Demo preview — notes are read-only.":"Add a note about this scan...",value:i,onChange:T=>o(T.target.value),className:"min-h-[80px]",readOnly:u,disabled:u}),e.jsx(qt,{onClick:p,disabled:!i.trim()||c||u,title:u?"Demo preview — sign up to save notes":void 0,variant:"secondary",className:"w-full",children:c?"Saving...":u?"Sign up to save notes":"Save Note"})]})})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsx(_,{variant:"secondary",onClick:()=>t("/"),children:"Home"}),e.jsx(_,{variant:"secondary",onClick:()=>t("/history"),children:"History"}),e.jsx(_,{variant:"outline",onClick:()=>{if(u){_t();return}t("/scan/new")},children:"New Scan"})]})]})};function dh(t){if(!t)throw new Error("Not signed in");return Ot(de,"users",t,"scans")}function hj(t,s,n=20){const r=Ft(dh(t),Lt("createdAt","desc"),Ht(n));return dt(r,a=>s(a.docs.map(i=>({id:i.id,...i.data()}))))}async function fj(t,s,n=20){if(!t)throw new Error("Not signed in");const r=Se(de,"users",t,"scans",s),a=await ot(r);if(!a.exists())return[];const i=Ft(dh(t),Lt("createdAt","desc"),Rp(a),Ht(n));return(await mr(i)).docs.map(c=>({id:c.id,...c.data()}))}const pj=["front","back","left","right"];function gj(t){return t==="front"||t==="back"||t==="left"||t==="right"}function xj(t){if(gj(t))return;const s=typeof t=="string"?t:JSON.stringify(t);throw new Error(`Invalid scan pose "${s}". Expected one of: ${pj.join(", ")}`)}function bt(t,s,n){const r=String(t||"").trim(),a=String(s||"").trim();if(xj(n),!r)throw new Error("Missing uid for scan photo path.");if(!a)throw new Error("Missing scanId for scan photo path.");return`scans/${r}/${a}/${n}.jpg`}const yj=30*60*1e3,bj=1250,jj=2e4,Bn=new Map;function Ac(t){var r,a;const s=typeof(t==null?void 0:t.status)=="number"?t.status:typeof(t==null?void 0:t.httpStatus)=="number"?t.httpStatus:typeof(t==null?void 0:t.statusCode)=="number"?t.statusCode:void 0;if(typeof s=="number"&&Number.isFinite(s))return s;const n=typeof((r=t==null?void 0:t.customData)==null?void 0:r.serverResponse)=="string"?t.customData.serverResponse:typeof(t==null?void 0:t.serverResponse)=="string"?t.serverResponse:null;if(n)try{const i=JSON.parse(n),o=typeof((a=i==null?void 0:i.error)==null?void 0:a.code)=="number"?i.error.code:typeof(i==null?void 0:i.code)=="number"?i.code:void 0;return typeof o=="number"&&Number.isFinite(o)?o:void 0}catch{return}}function Ic(t){const s=t==null?void 0:t.code;if(typeof s=="string"&&s.trim())return s.trim();const n=t==null?void 0:t.name;if(typeof n=="string"&&n.trim())return n.trim()}function Tc(t){const s=Math.max(1,Math.floor(t||1)),n=Math.min(6,s-1),r=Math.min(jj,bj*Math.pow(2,n)),a=.75+Math.random()*.5;return Math.max(750,Math.round(r*a))}async function wj(t,s,n,r){const a=n||s,i=Date.now(),o=Bn.get(a);if((o==null?void 0:o.kind)==="ok"&&o.expiresAt>i)return{url:await o.promise};if((o==null?void 0:o.kind)==="pending")try{return{url:await o.promise}}catch(u){const d=Ic(u),f=Ac(u),p=1,x=Tc(p),g=i+x;return Bn.set(a,{kind:"miss",nextRetryAt:g,attempts:p,lastErrorCode:d,lastHttpStatus:f}),{url:null,nextRetryAt:g,errorCode:d,httpStatus:f}}if((o==null?void 0:o.kind)==="miss"&&o.nextRetryAt>i)return{url:null,nextRetryAt:o.nextRetryAt,errorCode:o.lastErrorCode,httpStatus:o.lastHttpStatus};const c=Math.max(1e3,yj),h=i,m=Mp(Dp(t,s));Bn.set(a,{kind:"pending",promise:m,startedAt:h});try{const u=await m;return Bn.set(a,{kind:"ok",promise:Promise.resolve(u),expiresAt:h+c}),{url:u}}catch(u){const d=Ic(u),f=Ac(u),p=(o==null?void 0:o.kind)==="miss"?o.attempts:0,x=Math.max(1,p+1),g=Tc(x),v=i+g;return Bn.set(a,{kind:"miss",nextRetryAt:v,attempts:x,lastErrorCode:d,lastHttpStatus:f}),{url:null,nextRetryAt:v,errorCode:d,httpStatus:f}}}const vj=5*60*1e3,Rc=new Map;async function Nj(t){var o;const s=(o=U.currentUser)==null?void 0:o.uid;if(!s)return null;const n=Au(),r=[bt(s,t,"front")];for(const c of r)try{const h=await wj(n,c,`${t}:front`);if(h.url)return h.url}catch{}const a=Date.now(),i=Rc.get(t)??0;return a-i>vj&&(Rc.set(t,a),Ye({kind:"scan_thumb_missing",message:"Unable to resolve scan thumbnail",extra:{scanId:t,candidates:r}})),null}function Jt(t){if(t==null)return null;if(t instanceof Date)return Number.isFinite(t.getTime())?t:null;if(typeof t=="string"||typeof t=="number"){const s=new Date(t);return Number.isNaN(s.getTime())?null:s}if(typeof t=="object"){if(typeof t.toDate=="function")try{const s=t.toDate();return s instanceof Date&&Number.isFinite(s.getTime())?s:null}catch{return null}if(typeof t.toMillis=="function")try{const s=t.toMillis();if(!Number.isFinite(s))return null;const n=new Date(s);return Number.isNaN(n.getTime())?null:n}catch{return null}if(typeof t.seconds=="number"){const s=new Date(t.seconds*1e3);return Number.isNaN(s.getTime())?null:s}}return null}function b_(t){const s=Jt(t);return s?s.toLocaleString():"—"}function Sj(){var F;const t=ze(),{toast:s}=Cn(),{user:n,authReady:r}=He(),{units:a}=Os(),i=ft(),o=r?(n==null?void 0:n.uid)??null:null,[c,h]=l.useState([]),[m,u]=l.useState([]),[d,f]=l.useState({}),[p,x]=l.useState(null),[g,v]=l.useState(!1),[j,y]=l.useState(null);l.useEffect(()=>{if(i&&!n){h(Hm),f({}),y(null);return}if(!o){h([]),f({}),y(null);return}try{const E=hj(o,h);return y(null),()=>E()}catch(E){const P=E instanceof Error?E.message:"Unable to load scans.";y(P);return}},[o,i,n]),l.useEffect(()=>{i&&!n||c.forEach(E=>{d[E.id]===void 0&&Nj(E.id).then(P=>f(k=>({...k,[E.id]:P})))})},[c,i,n]);function N(E){i&&!n||u(P=>P.includes(E)?P.filter(k=>k!==E):P.length>=2?[P[1],E]:[...P,E])}async function b(E){if(i&&!n){s({title:"Demo is read-only",description:"Sign up to save and manage your scans."});return}if(!o){s({title:"Sign in required",description:"Sign in to manage your scans.",variant:"destructive"});return}if(confirm("Delete this scan? This cannot be undone.")){x(E);try{await ih(E),h(P=>P.filter(k=>k.id!==E)),u(P=>P.filter(k=>k!==E)),f(P=>{const k={...P};return delete k[E],k}),s({title:"Scan deleted",description:"This scan has been removed from your history."})}catch(P){const k=P instanceof Error?P.message:"Unable to delete scan. Please try again.";s({title:"Delete failed",description:k,variant:"destructive"})}finally{x(null)}}}const w=(F=c.at(-1))==null?void 0:F.id;async function I(){if(!(i&&!n)&&!(!w||!o)){v(!0);try{const E=await fj(o,w);h(P=>[...P,...E])}finally{v(!1)}}}return e.jsxs("div",{className:"mx-auto max-w-2xl p-4",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"History"}),r&&!o&&!(i&&!n)&&e.jsxs(tt,{className:"mt-3 border-amber-200 bg-amber-50 text-amber-900",children:[e.jsx(rt,{children:"Sign in to view scans"}),e.jsx(st,{children:"Log in to review your scan history, delete results, or compare progress."})]}),j&&e.jsxs(tt,{className:"mt-3 border-destructive/30 text-destructive",children:[e.jsx(rt,{children:"Unable to load scans"}),e.jsx(st,{children:j})]}),c.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No scans yet."}),e.jsx("ul",{className:"mt-3 grid grid-cols-2 gap-3 sm:grid-cols-3",children:c.map(E=>{const P=rr(E),k=sl(P,a),C=m.includes(E.id),T=Hn(E.status,(E==null?void 0:E.updatedAt)??(E==null?void 0:E.completedAt)??E.createdAt);return e.jsxs("li",{className:`rounded border overflow-hidden ${C?"ring-2 ring-emerald-400":""}`,children:[e.jsxs("button",{className:"block w-full text-left",onClick:()=>N(E.id),children:[e.jsx("div",{className:"aspect-[3/4] bg-black/5 overflow-hidden",children:d[E.id]?e.jsx("img",{src:d[E.id],alt:"",loading:"lazy",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full animate-pulse"})}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:(Jt(E.createdAt)??new Date).toLocaleString()}),e.jsx("span",{children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-[10px] font-medium ${T.badgeVariant==="destructive"?"bg-red-50 text-red-700":T.badgeVariant==="default"?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-600"}`,children:T.label})})]}),T.showMetrics?e.jsxs("div",{className:"text-sm font-medium",children:[k.bodyFatText!=="—"?`${k.bodyFatText} BF`:"—"," ·"," ",k.weightText]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:T.helperText})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 px-2 pb-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{if(i&&!n){t(`/results/${E.id}`);return}t(`/scans/${E.id}`)},className:"text-[11px] underline",children:"Open"}),T.recommendRescan&&e.jsx("button",{onClick:()=>t("/scan"),className:"text-[11px] underline text-primary",children:"Rescan"})]}),e.jsx("button",{onClick:()=>b(E.id),className:"text-[11px] text-red-700 underline",disabled:p===E.id,children:p===E.id?"Deleting…":"Delete"})]})]},E.id)})}),w&&!(i&&!n)&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:I,disabled:g,className:"rounded border px-3 py-2 text-sm w-full",children:g?"Loading…":"Load more"})}),e.jsx("div",{className:"fixed inset-x-0 bottom-3 flex justify-center",children:e.jsxs("button",{disabled:i&&!n?!0:m.length!==2,onClick:()=>{if(i&&!n){s({title:"Demo is read-only",description:"Sign up to compare scans."});return}t(`/scans/compare/${m[0]}/${m[1]}`)},className:"rounded-full border bg-white px-4 py-2 text-sm shadow disabled:opacity-50",children:["Compare (",m.length,"/2)"]})})]})}function rl({valueCm:t,onChangeCm:s,disabled:n}){const[r,a]=l.useState(0),[i,o]=l.useState(0);return l.useEffect(()=>{if(t!=null){const{ft:c,inches:h}=tl(Da(t));a(c),o(h)}},[t]),l.useEffect(()=>{s(sb(r,i))},[r,i]),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm",children:"Feet"}),e.jsx(We,{type:"number",min:0,value:Number.isFinite(r)?r:0,onChange:c=>{const h=parseInt(c.target.value||"0",10);a(Number.isNaN(h)?0:h)},className:"w-20",disabled:n})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm",children:"Inches"}),e.jsx(We,{type:"number",min:0,max:11,value:Number.isFinite(i)?i:0,onChange:c=>{const h=parseInt(c.target.value||"0",10),m=Math.min(11,Math.max(0,Number.isNaN(h)?0:h));o(m)},className:"w-20",disabled:n})]}),e.jsx("div",{className:"text-xs opacity-70 ml-2",children:no(t)})]})}const Rt=Kf,Mt=Gf,kt=l.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(lu,{ref:r,className:ae("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx($f,{asChild:!0,children:e.jsx(Uo,{className:"h-4 w-4 opacity-50"})})]}));kt.displayName=lu.displayName;const uh=l.forwardRef(({className:t,...s},n)=>e.jsx(cu,{ref:n,className:ae("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Up,{className:"h-4 w-4"})}));uh.displayName=cu.displayName;const mh=l.forwardRef(({className:t,...s},n)=>e.jsx(du,{ref:n,className:ae("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Uo,{className:"h-4 w-4"})}));mh.displayName=du.displayName;const Et=l.forwardRef(({className:t,children:s,position:n="popper",...r},a)=>e.jsx(Wf,{children:e.jsxs(uu,{ref:a,className:ae("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[e.jsx(uh,{}),e.jsx(qf,{className:ae("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(mh,{})]})}));Et.displayName=uu.displayName;const kj=l.forwardRef(({className:t,...s},n)=>e.jsx(mu,{ref:n,className:ae("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));kj.displayName=mu.displayName;const Ue=l.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(hu,{ref:r,className:ae("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(zf,{children:e.jsx(Oo,{className:"h-4 w-4"})})}),e.jsx(Vf,{children:s})]}));Ue.displayName=hu.displayName;const Ej=l.forwardRef(({className:t,...s},n)=>e.jsx(fu,{ref:n,className:ae("-mx-1 my-1 h-px bg-muted",t),...s}));Ej.displayName=fu.displayName;const Xs=Gd,al=Hd,Cj=Vd,hh=l.forwardRef(({className:t,...s},n)=>e.jsx(ja,{ref:n,className:ae("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));hh.displayName=ja.displayName;const Us=l.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Cj,{children:[e.jsx(hh,{}),e.jsxs(wa,{ref:r,className:ae("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(Kd,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Bo,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Us.displayName=wa.displayName;const vs=({className:t,...s})=>e.jsx("div",{className:ae("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});vs.displayName="DialogHeader";const ya=({className:t,...s})=>e.jsx("div",{className:ae("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});ya.displayName="DialogFooter";const Ns=l.forwardRef(({className:t,...s},n)=>e.jsx(va,{ref:n,className:ae("text-lg font-semibold leading-none tracking-tight",t),...s}));Ns.displayName=va.displayName;const ar=l.forwardRef(({className:t,...s},n)=>e.jsx(Na,{ref:n,className:ae("text-sm text-muted-foreground",t),...s}));ar.displayName=Na.displayName;const _j=[{path:"/home",icon:$p,label:"Home"},{path:"/scan",icon:Lu,label:"Scan",feature:"scan"},{path:"/meals",icon:Wp,label:"Meals",feature:"nutrition"},{path:"/workouts",icon:Hr,label:"Workouts",feature:"workouts"},{path:"/programs",icon:qp,label:"Plans",feature:"coach"},{path:"/coach",icon:zp,label:"Coach",feature:"coach"},{path:"/history",icon:Vp,label:"History",feature:"scan"},{path:"/plans",icon:Bu,label:"Billing",feature:"account"},{path:"/settings",icon:Kp,label:"Settings",feature:"account"}];function xt(){const t=Qt(),s=_j.filter(n=>!n.feature||Ma(n.feature));return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t md:hidden",children:e.jsx("div",{className:"flex items-center justify-around",children:s.map(({path:n,icon:r,label:a})=>{const i=t.pathname===n||t.pathname.startsWith(`${n}/`);return e.jsxs(jt,{to:n,className:ae("flex flex-col items-center gap-1 px-3 py-2 min-h-[44px] text-xs transition-colors","hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",i?"text-primary font-medium":"text-muted-foreground"),children:[e.jsx(r,{size:20}),e.jsx("span",{children:a})]},n)})})})}const Mc={en:{"auth.welcome":"Welcome back","auth.create_account":"Create your account","auth.signin":"Sign in","auth.signup":"Create account","auth.email":"Email","auth.password":"Password","auth.forgot_password":"Forgot password?","auth.continue_apple":"Continue with Apple","auth.continue_google":"Continue with Google","today.title":"Today's Plan","today.workout":"Workout","today.meals":"Meals","today.coachingTip":"Coaching Tip","today.scan":"Scan","today.logMeal":"Log Meal","today.logWorkout":"Log Workout","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"Choose Your Plan","plans.description":"Get started with accurate body composition scanning","plans.starter":"Starter Scan","plans.pro":"Pro Monthly","plans.elite":"Elite Annual","plans.subscribe":"Subscribe","plans.buyNow":"Buy Now","plans.savings":"Save hundreds every month","settings.title":"Settings","settings.notifications":"Notifications","settings.language":"Language","settings.legal":"Legal & Support","settings.delete_account":"Delete my account & data","settings.sign_out":"Sign out","settings.export_data":"Export my data","workouts.title":"Workouts","workouts.noWorkouts":"No workout plan yet","workouts.createPlan":"Create Workout Plan","meals.title":"Meals","meals.search":"Search food or scan barcode","meals.scanBarcode":"Scan Barcode","meals.dailyProgress":"Daily Progress","meals.addMeal":"Add Meal","meals.logMeal":"Log a Meal","meals.noMeals":"No meals logged yet","meals.targets":"Daily Targets","meals.weeklyChart":"This Week","nutrition.protein":"Protein","nutrition.carbs":"Carbs","nutrition.fat":"Fat","nutrition.calories":"Calories","nutrition.servings":"Servings","nutrition.grams":"Grams","nutrition.per100g":"Per 100g","nutrition.perPortion":"Per portion","scan.title":"Body Scan","scan.newScan":"New Scan","scan.takePhotos":"Take 4 Photos","scan.photosRequired":"4 photos required (front, left, right, back)","scan.bodyFat":"Body Fat","scan.weight":"Weight","scan.bmi":"BMI","scan.leanMass":"Lean Mass","scan.muscleMass":"Muscle Mass","scan.bmr":"BMR","scan.tee":"Total Energy Expenditure","scan.visceralFat":"Visceral Fat","history.title":"Scan History","history.noScans":"No scans yet","history.compare":"Compare","history.selectTwo":"Select two scans to compare","coach.title":"Personal Coach","coach.onboarding":"Setup Your Plan","coach.goal":"Your Goal","coach.goalCut":"Cut (Lose Fat)","coach.goalRecomp":"Recomp (Build Muscle)","coach.goalGain":"Gain (Build Mass)","coach.difficulty":"Difficulty","coach.difficultyEasy":"Easy (-250 kcal)","coach.difficultyModerate":"Moderate (-500 kcal)","coach.difficultyAggressive":"Aggressive (-750 kcal)","coach.daysPerWeek":"Days per week","coach.sessionLength":"Session length","coach.equipment":"Available equipment","coach.injuries":"Injuries or limitations","coach.weakSpots":"Areas to focus on","coach.cardio":"Cardio preference","coach.dietType":"Diet type","coach.weeklyCheckin":"Weekly Check-in","coach.updated":"Coach updated your plan","notifications.scanReminder":"Scan reminder","notifications.workoutReminder":"Workout reminder","notifications.checkinReminder":"Weekly check-in","notifications.renewalReminder":"Renewal reminder","legal.consent":"By continuing, you agree to our Terms, Privacy Policy, and Disclaimer","legal.notMedicalAdvice":"This is not medical advice. Consult a healthcare professional.","legal.terms":"Terms of Service","legal.privacy":"Privacy Policy","legal.disclaimer":"Medical Disclaimer","legal.accept":"I Accept","common.save":"Save","common.cancel":"Cancel","common.next":"Next","common.back":"Back","common.finish":"Finish","common.loading":"Loading...","common.error":"Error","common.success":"Success"},zh:{"auth.welcome":"欢迎回来","auth.signin":"登录","auth.signup":"创建账户","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"选择您的计划","meals.title":"膳食","workouts.title":"锻炼","scan.title":"身体扫描","settings.title":"设置","common.save":"保存","common.cancel":"取消","common.next":"下一步","common.back":"返回"},hi:{"auth.welcome":"वापसी पर स्वागत है","auth.signin":"साइन इन करें","auth.signup":"खाता बनाएं","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"अपना प्लान चुनें","meals.title":"भोजन","workouts.title":"व्यायाम","scan.title":"बॉडी स्कैन","settings.title":"सेटिंग्स","common.save":"सेव करें","common.cancel":"रद्द करें","common.next":"अगला","common.back":"वापस"},es:{"auth.welcome":"Bienvenido de nuevo","auth.signin":"Iniciar sesión","auth.signup":"Crear cuenta","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"Elige tu plan","meals.title":"Comidas","workouts.title":"Entrenamientos","scan.title":"Escaneo corporal","settings.title":"Configuración","common.save":"Guardar","common.cancel":"Cancelar","common.next":"Siguiente","common.back":"Atrás"},fr:{"auth.welcome":"Bon retour","auth.signin":"Se connecter","auth.signup":"Créer un compte","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"Choisissez votre plan","meals.title":"Repas","workouts.title":"Entraînements","scan.title":"Scan corporel","settings.title":"Paramètres","common.save":"Enregistrer","common.cancel":"Annuler","common.next":"Suivant","common.back":"Retour"},ar:{"auth.welcome":"مرحباً بعودتك","auth.signin":"تسجيل الدخول","auth.signup":"إنشاء حساب","today.noCalorieTarget":"Set a calorie target in Coach to personalize this goal.","today.caloriesNoTarget":"Calorie target not set","plans.title":"اختر خطتك","meals.title":"الوجبات","workouts.title":"التمارين","scan.title":"مسح الجسم","settings.title":"الإعدادات","common.save":"حفظ","common.cancel":"إلغاء","common.next":"التالي","common.back":"العودة"},bn:{"auth.welcome":"ফিরে স্বাগতম","auth.signin":"সাইন ইন করুন","auth.signup":"অ্যাকাউন্ট তৈরি করুন","plans.title":"আপনার প্ল্যান বেছে নিন","meals.title":"খাবার","workouts.title":"ব্যায়াম","scan.title":"বডি স্ক্যান","settings.title":"সেটিংস","common.save":"সেভ করুন","common.cancel":"বাতিল","common.next":"পরবর্তী","common.back":"পিছনে"},pt:{"auth.welcome":"Bem-vindo de volta","auth.signin":"Entrar","auth.signup":"Criar conta","plans.title":"Escolha seu plano","meals.title":"Refeições","workouts.title":"Treinos","scan.title":"Escaneamento corporal","settings.title":"Configurações","common.save":"Salvar","common.cancel":"Cancelar","common.next":"Próximo","common.back":"Voltar"},ru:{"auth.welcome":"Добро пожаловать обратно","auth.signin":"Войти","auth.signup":"Создать аккаунт","plans.title":"Выберите свой план","meals.title":"Питание","workouts.title":"Тренировки","scan.title":"Сканирование тела","settings.title":"Настройки","common.save":"Сохранить","common.cancel":"Отмена","common.next":"Далее","common.back":"Назад"},ur:{"auth.welcome":"واپسی پر خوش آمدید","auth.signin":"سائن ان کریں","auth.signup":"اکاؤنٹ بنائیں","plans.title":"اپنا پلان منتخب کریں","meals.title":"کھانا","workouts.title":"ورزش","scan.title":"باڈی سکین","settings.title":"سیٹنگز","common.save":"محفوظ کریں","common.cancel":"منسوخ","common.next":"اگلا","common.back":"واپس"}},Dr=Ma("i18n")?Mc:{en:Mc.en};function La(){const[t,s]=l.useState("en"),n=a=>Dr[t][a]||a,r=a=>{s(a),localStorage.setItem("mbs-language",a)};return l.useEffect(()=>{const a=localStorage.getItem("mbs-language");if(a&&Dr[a]){s(a);return}const i=navigator.language.split("-")[0];Dr[i]?(s(i),localStorage.setItem("mbs-language",i)):s("en")},[]),{t:n,language:t,changeLanguage:r,availableLanguages:Object.keys(Dr)}}function fh(t){var o;const s=[];s.push("version=0.0.0");const r=(o=In())==null?void 0:o.currentUser;r&&(s.push(`uid=${r.uid}`),r.email&&s.push(`email=${r.email}`)),s.push(`route=${window.location.pathname}`),s.push(`timestamp=${new Date().toISOString()}`),s.push(`device=${navigator.userAgent}`);const a=window.__breadcrumbs||window.__mbsBreadcrumbs||window.__mbsLogs||[];return Array.isArray(a)&&a.length&&s.push("logs="+a.slice(-5).join(" | ")),`mailto:support@mybodyscanapp.com?subject=MyBodyScan%20Support&body=${encodeURIComponent(s.join(`
`))}`}const Pj=[];function Aj(){return[...Pj]}function Ij(){const t=U==null?void 0:U.currentUser,s={uid:(t==null?void 0:t.uid)||"signed-out",email:(t==null?void 0:t.email)||"",tz:Intl.DateTimeFormat().resolvedOptions().timeZone,ua:navigator.userAgent,path:window.location.pathname,ts:new Date().toISOString(),breadcrumbs:Aj()};return JSON.stringify(s,null,2)}async function ph(){const t=Ij();await navigator.clipboard.writeText(t)}function Tj({title:t,description:s,children:n}){return e.jsxs(Y,{children:[e.jsxs(oe,{children:[e.jsx(he,{className:"text-base font-semibold",children:t}),s&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s})]}),e.jsx(Q,{children:n})]})}const il=l.forwardRef(({className:t,...s},n)=>e.jsx(pu,{className:ae("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:n,children:e.jsx(Hf,{className:ae("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));il.displayName=pu.displayName;function Fr({label:t,description:s,checked:n,onChange:r}){return e.jsxs("div",{className:"flex items-center justify-between gap-3 py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:t}),s&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s})]}),e.jsx(il,{checked:n,onCheckedChange:r})]})}const Rj=t=>`users/${t}/coachPlans/current`,co=t=>`users/${t}/coach/chatMeta/chat`,Mj=t=>`users/${t}/coachThreads`,Dj=(t,s)=>`users/${t}/coachThreads/${s}/messages`,Fj=t=>Se(de,Rj(t)),Lj=t=>Ot(Se(de,"users",t,"coach","chatMeta"),"chat"),Bj=t=>Ot(Se(de,"users",t),"coachThreads"),ni=(t,s)=>Se(de,"users",t,"coachThreads",s),ri=(t,s)=>Ot(Se(de,"users",t,"coachThreads",s),"messages"),Dc=t=>Ot(de,"users",t,"workoutLogs"),Oj=2200,uo={totals:{calories:ms.totals.calories,protein:ms.totals.protein,carbs:ms.totals.carbs,fat:ms.totals.fat,alcohol:0},meals:ms.meals.map(t=>({id:t.id,name:t.name,protein:t.protein,carbs:t.carbs,fat:t.fat,calories:t.calories,notes:t.notes}))},Uj=Array.from({length:7}).map((t,s)=>{const n=new Date(ms.date),r=new Date(n);r.setDate(n.getDate()-s);const a=(s%3-1)*90,i=(s%2-.5)*8,o=(s%4-1.5)*12,c=(s%3-1)*5;return{date:r.toISOString().slice(0,10),totals:{calories:Math.max(1500,Math.round(ms.totals.calories+a)),protein:Math.max(90,Math.round(ms.totals.protein+i)),carbs:Math.max(120,Math.round(ms.totals.carbs+o)),fat:Math.max(35,Math.round(ms.totals.fat+c)),alcohol:0}}}),Fc={done:2,total:5},mo={id:"demo-plan",days:[{day:"Sun",exercises:[{id:"sun-1",name:"Restorative yoga",sets:1,reps:1},{id:"sun-2",name:"Light walk",sets:1,reps:1}]},{day:"Mon",exercises:[{id:"mon-1",name:"Back squat",sets:3,reps:10},{id:"mon-2",name:"Bench press",sets:3,reps:8},{id:"mon-3",name:"Bent-over row",sets:3,reps:10}]},{day:"Wed",exercises:[{id:"wed-1",name:"Deadlift",sets:3,reps:6},{id:"wed-2",name:"Pull-ups",sets:3,reps:8},{id:"wed-3",name:"Plank",sets:3,reps:45}]},{day:"Fri",exercises:[{id:"fri-1",name:"Walking lunges",sets:3,reps:12},{id:"fri-2",name:"Shoulder press",sets:3,reps:10},{id:"fri-3",name:"Farmer carry",sets:3,reps:40}]}]},$j={days:5,split:"Upper / Lower hybrid",sessions:[{day:"Mon",blocks:[{title:"Warm-up",focus:"Mobility + activation",work:["5 min incline walk","World's greatest stretch 2×8/side"]},{title:"Strength",focus:"Push emphasis",work:["Dumbbell bench 4×8 @ RPE7","Seated row 3×12","Incline push-up 3×12"]}]},{day:"Tue",blocks:[{title:"Lower body",focus:"Posterior chain",work:["Trap-bar deadlift 4×6","Split squat 3×10/side","Hamstring curl 3×15"]},{title:"Finisher",focus:"Core stability",work:["Plank 3×45s","Dead bug 3×12"]}]},{day:"Thu",blocks:[{title:"Push / Pull",focus:"Shoulders + back",work:["Overhead press 4×8","Lat pull-down 3×12","Face pull 3×15"]}]},{day:"Fri",blocks:[{title:"Lower + core",focus:"Glutes & abs",work:["Front squat 4×6","Romanian deadlift 3×10","Cable wood chop 3×12/side"]}]},{day:"Sat",blocks:[{title:"Conditioning",focus:"Zone 2 + strides",work:["20 min easy bike","6×20s strides","Walking stretch cooldown"]}]}],progression:{deloadEvery:4},calorieTarget:Oj,proteinFloor:150,disclaimer:"Demo plan — educational only. Sign in to generate your own week.",updatedAt:new Date},Wj={...xb},j_=[{id:"fav-oats",name:"Overnight oats",brand:"Home prepped",item:{id:"fav-oats",name:"Overnight oats",brand:"Home prepped",source:"Open Food Facts",basePer100g:{kcal:120,protein:6,carbs:18,fat:3},servings:[],serving:{qty:1,unit:"jar"},per_serving:{kcal:320,protein_g:18,carbs_g:38,fat_g:9}},updatedAt:new Date().toISOString()},{id:"fav-salad",name:"Power salad",brand:"Fresh Greens",item:{id:"fav-salad",name:"Power salad",brand:"Fresh Greens",source:"USDA",basePer100g:{kcal:80,protein:5,carbs:9,fat:3},servings:[],serving:{qty:1,unit:"bowl"},per_serving:{kcal:310,protein_g:18,carbs_g:26,fat_g:12}},updatedAt:new Date().toISOString()}],w_=[{id:"template-hydrate",name:"Hydration reminder",items:[{item:{id:"water",name:"Water",brand:null,source:"USDA",basePer100g:{kcal:0,protein:0,carbs:0,fat:0},servings:[],serving:{qty:1,unit:"glass"},per_serving:{kcal:0,protein_g:0,carbs_g:0,fat_g:0}},qty:1,unit:"glass"}],updatedAt:new Date().toISOString()},{id:"template-smoothie",name:"Recovery smoothie",items:[{item:{id:"banana",name:"Banana",brand:null,source:"USDA",basePer100g:{kcal:89,protein:1.1,carbs:22.8,fat:.3},servings:[],serving:{qty:1,unit:"medium"},per_serving:{kcal:105,protein_g:1.3,carbs_g:27,fat_g:.4}},qty:1,unit:"medium"},{item:{id:"protein-powder",name:"Whey protein",brand:"Demo Labs",source:"USDA",basePer100g:{kcal:360,protein:75,carbs:10,fat:5},servings:[],serving:{qty:1,unit:"scoop"},per_serving:{kcal:140,protein_g:27,carbs_g:4,fat_g:2}},qty:1,unit:"scoop"}],updatedAt:new Date().toISOString()}];function ai(t){return typeof t=="number"&&Number.isFinite(t)?t:null}function ii(t){if(t==="lb"||t==="kg")return t;if(typeof t=="string"){const s=t.trim().toLowerCase();if(s==="lb"||s==="lbs")return"lb";if(s==="kg"||s==="kgs")return"kg"}return null}function qj(t){const s=ai(t.weightKg),n=ai(t.weight_kg),r=ai(t.weight),a=ii(t.unit)??"lb",i=s??n??null,o=i??(r!=null?(()=>{const u=ii(t.unit);return u==="lb"?gt(r):u==="kg"?r:r>120?gt(r):r})():null),c=o!=null&&Number.isFinite(o)?o:null,m=c!=null&&(s==null||n==null||ii(t.unit)==null)&&c!=null?{weightKg:Number(c.toFixed(4)),weight_kg:Number(c.toFixed(4)),unit:a}:null;return{weightKg:c,unit:a,patch:m}}function Lr(t){return typeof t=="number"&&Number.isFinite(t)?t:null}function ir(t){return typeof t=="string"?t:null}function zj(t){if(!t||typeof t!="object")return null;const s=t,n=ir(s.title)??"",r=ir(s.focus)??"",a=Array.isArray(s.work)?s.work.map(i=>typeof i=="string"?i:"").filter(Boolean):[];return{title:n,focus:r,work:a}}function Vj(t){if(!t||typeof t!="object")return null;const s=t,n=ir(s.day)??"",r=Array.isArray(s.blocks)?s.blocks.map(zj).filter(Boolean):[];return{day:n,blocks:r}}function Kj(t){const s=t&&typeof t=="object"?t:{},n=Lr(s.days)??0,r=ir(s.split)??"",a=Array.isArray(s.sessions)?s.sessions.map(Vj).filter(Boolean):[],i=s.progression&&typeof s.progression=="object"?s.progression:null,o=Lr(i==null?void 0:i.deloadEvery)??4,c=Lr(s.calorieTarget)??0,h=Lr(s.proteinFloor)??0,m=ir(s.disclaimer)??void 0,u=Jt(s.updatedAt);return{days:n,split:r,sessions:a,progression:{deloadEvery:o},calorieTarget:c,proteinFloor:h,disclaimer:m,updatedAt:u}}function Zs(){const[t,s]=l.useState(null),[n,r]=l.useState(null),{user:a,authReady:i}=He(),o=!0,c=i?(a==null?void 0:a.uid)??null:null,h=ft(),m=l.useState(()=>new Set)[0];return l.useEffect(()=>{if(h){s(Wj),r($j);return}if(!i||!o||!c){s(null),r(null);return}const u=Se(de,"users",c,"coach","profile"),d=dt(u,x=>{const g=x.data()||null;if(!g){s(null);return}const v=typeof g.heightCm=="number"?g.heightCm:typeof g.height_cm=="number"?g.height_cm:void 0,j=qj(g);!h&&j.patch&&c&&!m.has(c)&&(m.add(c),mt(u,j.patch,{merge:!0}).catch(()=>{m.delete(c)}));const y=j.weightKg!=null?j.weightKg:g.weight_kg??void 0;s({...g,heightCm:v,height_cm:v??g.height_cm,weightKg:y,weight_kg:y,unit:j.unit??g.unit})},()=>{s(null)}),f=Fj(c),p=dt(f,x=>{if(!x.exists()){r(null);return}const g=x.data();r(Kj(g))},()=>{r(null)});return()=>{d(),p()}},[h,i,o,c]),{profile:t,plan:n}}async function Gj(){await Ca();const s=(await es("deleteMyAccount",{})).data;if(!(s!=null&&s.ok))throw new Error("delete_failed")}async function Hj(){await Ca();const s=(await es("exportMyData",{})).data;if(!(s!=null&&s.ok))throw new Error("export_failed");return s}const Yj={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APPCHECK_MODE:"soft",VITE_APP_BASE_URL:"https://mybodyscanapp.com",VITE_DEMO_ENABLED:"true",VITE_ENABLE_APPLE:"true",VITE_ENABLE_DEMO:"true",VITE_ENABLE_EMAIL:"true",VITE_ENABLE_GOOGLE:"true",VITE_FIREBASE_API_KEY:"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8",VITE_FIREBASE_APP_ID:"",VITE_FIREBASE_AUTH_DOMAIN:"mybodyscan-f3daf.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"",VITE_FIREBASE_MESSAGING_SENDER_ID:"",VITE_FIREBASE_PROJECT_ID:"mybodyscan-f3daf",VITE_FIREBASE_STORAGE_BUCKET:"",VITE_FUNCTIONS_BASE_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_ORIGIN:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_REGION:"us-central1",VITE_FUNCTIONS_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_PRICE_MONTHLY:"price_1S4XsVQQU5vuhlNjzdQzeySA",VITE_PRICE_ONE:"price_1RuOpKQQU5vuhlNjipfFBsR0",VITE_PRICE_YEARLY:"price_1S4Y6YQQU5vuhlNjeJFmshxX",VITE_STRIPE_MODE:"live",VITE_STRIPE_PUBLISHABLE_KEY:"pk_live_51RuLm5QQU5vuhlNjBb0nO9IO0zWk2Mql49wU0ORYDfXEAHKvHDFqVgUiS5QUvo07L2k9s3xgLY1YdzEVnO4YdHH100PhNSDrfr"};var oi={};const ho=Yj??{},Qj=new Proxy(ho,{get(t,s){const n=ho[s];return typeof n=="string"?n:typeof n=="number"||typeof n=="boolean"?String(n):""}});function yt(t){const s=ho[t];return typeof s=="string"?s:typeof s=="number"||typeof s=="boolean"?String(s):typeof process<"u"&&oi&&typeof oi[t]=="string"?oi[t]:""}function Jj(){const s=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID"].filter(r=>!yt(r).trim());s.length&&!0&&console.error("Missing required env:",s.join(", "))}const or=yt("VITE_STRIPE_PK")||yt("VITE_STRIPE_PUBLISHABLE_KEY"),li=yt("VITE_BUILD_SHA")||yt("VITE_COMMIT_SHA")||yt("COMMIT_SHA"),ci=yt("VITE_APP_VERSION"),Xj=yt("VITE_BUILD_TIME")||yt("BUILD_TIME"),Zj=yt("VITE_FUNCTIONS_URL")||yt("FUNCTIONS_URL"),gh=yt("VITE_FUNCTIONS_ORIGIN")||yt("FUNCTIONS_ORIGIN"),xh=yt("VITE_FUNCTIONS_BASE_URL")||yt("FUNCTIONS_BASE_URL"),ew=yt("VITE_FUNCTIONS_REGION")||yt("FUNCTIONS_REGION")||"us-central1",Lc=(Qj.VITE_FIREBASE_PROJECT_ID||yt("FIREBASE_PROJECT_ID")).trim(),Yn=t=>t.trim(),tw=or.startsWith("pk_test_"),sw=or.startsWith("pk_live_"),nw=or?or.slice(-6):"",rw=li&&li.length>=7?li.slice(0,7):ci&&ci.length>=4?ci:"dev",Bc=Xj||"";function yh(){return tw?"test":sw?"live":or?"custom":"missing"}function bh(t){const s=t.startsWith("/")?t:`/${t}`,n=Yn(Zj).replace(/\/?$/,"");if(n)return`${n}${s}`;const r=Yn(gh).replace(/\/?$/,"");if(r)return`${r}${s}`;const a=Yn(xh).replace(/\/?$/,"");return a?`${a}${s}`:Lc?`https://${ew}-${Lc}.cloudfunctions.net${s}`:s}Yn(gh);Yn(xh);function jh({className:t}){const s=yh();if(s==="live")return null;const n=s==="test"?"TEST":s==="custom"?"STRIPE":"NO KEY",r=s==="test"?"bg-amber-500/10 text-amber-700 dark:text-amber-300":s==="custom"?"bg-sky-500/10 text-sky-600 dark:text-sky-300":"bg-destructive/10 text-destructive";return e.jsx(Xe,{className:ae("uppercase tracking-wide",r,t),"aria-label":`Stripe mode ${n}`,children:n})}const aw=["ZmlyZWJhc2VzdG9yYWdlLmdvb2dsZWFwaXMuY29tL3YwL2Iv","bz9uYW1lPQ==","byUzZm5hbWUlM2Q="];function iw(t){if(!t)return t;try{if(typeof atob=="function")return atob(t)}catch{}try{if(typeof Buffer<"u")return Buffer.from(t,"base64").toString("utf-8")}catch{return t}return t}const ow=aw.map(t=>new RegExp(iw(t),"i"));function lw(t,s){var n,r;if(!(!t||typeof t!="string"))for(const a of ow){if(!a.test(t))continue;const i={url:t.slice(0,500),context:s,pattern:a.source};console.error("storage_rest_url_blocked",{...i,severity:"fatal"});const o="Uploads must use the Firebase Storage SDK. Please retry this scan.",c=new Error((r=(n=import.meta)==null?void 0:n.env)!=null&&r.DEV?`Forbidden Firebase Storage REST URL blocked: ${t}`:o);throw c.code="storage_rest_blocked",c}}function wh(t){return typeof t!="string"||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/api")?t:t.startsWith("/")?`/api${t}`:`/api/${t}`}async function ol(t,s={}){const n=new Headers(s.headers||{});!n.has("Content-Type")&&s.body&&!(s.body instanceof FormData)&&n.set("Content-Type","application/json");try{if(U.currentUser){const i=await U.currentUser.getIdToken();n.set("Authorization",`Bearer ${i}`)}}catch(i){console.warn("apiFetch.token_failed",i)}if(!n.has("x-tz-offset-mins"))try{n.set("x-tz-offset-mins",String(new Date().getTimezoneOffset()))}catch{}const r=await _n();Object.entries(r).forEach(([i,o])=>{n.set(i,o)}),lw(typeof t=="string"?t:typeof(t==null?void 0:t.url)=="string"?t.url:void 0,"apiFetch");const a=wh(t);try{return await fetch(a,{...s,headers:n,credentials:"same-origin"})}catch(i){throw i}}async function Tn(t,s={}){const n=await ol(t,s),a=(n.headers.get("Content-Type")||"").includes("application/json")?await n.json().catch(()=>({})):await n.text().catch(()=>"");if(!n.ok){const i=typeof a=="string"?a:(a==null?void 0:a.error)||`HTTP ${n.status}`,o=typeof t=="string"?wh(t):typeof(t==null?void 0:t.url)=="string"?t.url:"unknown",c=new Error(i);throw c.status=n.status,c.url=o,c.payload=a,a&&typeof a=="object"&&"code"in a&&typeof a.code=="string"&&(c.code=a.code),c}return a}const cw={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APPCHECK_MODE:"soft",VITE_APP_BASE_URL:"https://mybodyscanapp.com",VITE_DEMO_ENABLED:"true",VITE_ENABLE_APPLE:"true",VITE_ENABLE_DEMO:"true",VITE_ENABLE_EMAIL:"true",VITE_ENABLE_GOOGLE:"true",VITE_FIREBASE_API_KEY:"AIzaSyCmtvkIuKNP-NRzH_yFUt4PyWdWCCeO0k8",VITE_FIREBASE_APP_ID:"",VITE_FIREBASE_AUTH_DOMAIN:"mybodyscan-f3daf.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"",VITE_FIREBASE_MESSAGING_SENDER_ID:"",VITE_FIREBASE_PROJECT_ID:"mybodyscan-f3daf",VITE_FIREBASE_STORAGE_BUCKET:"",VITE_FUNCTIONS_BASE_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_ORIGIN:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_FUNCTIONS_REGION:"us-central1",VITE_FUNCTIONS_URL:"https://us-central1-mybodyscan-f3daf.cloudfunctions.net",VITE_PRICE_MONTHLY:"price_1S4XsVQQU5vuhlNjzdQzeySA",VITE_PRICE_ONE:"price_1RuOpKQQU5vuhlNjipfFBsR0",VITE_PRICE_YEARLY:"price_1S4Y6YQQU5vuhlNjeJFmshxX",VITE_STRIPE_MODE:"live",VITE_STRIPE_PUBLISHABLE_KEY:"pk_live_51RuLm5QQU5vuhlNjBb0nO9IO0zWk2Mql49wU0ORYDfXEAHKvHDFqVgUiS5QUvo07L2k9s3xgLY1YdzEVnO4YdHH100PhNSDrfr"},fo="pk_live_51RuLm5QQU5vuhlNjBb0nO9IO0zWk2Mql49wU0ORYDfXEAHKvHDFqVgUiS5QUvo07L2k9s3xgLY1YdzEVnO4YdHH100PhNSDrfr".trim();function dw(){if(fo)return fo;throw{error:"stripe_config_missing",code:"stripe_config_missing"}}function vh(){if(Bt())throw{error:"payments_disabled",code:"payments_disabled"}}const uw="".trim(),mw="".trim(),hw={createCheckout:uw||"https://createcheckout-534gpapj7q-uc.a.run.app",createCustomerPortal:mw||"https://createcustomerportal-534gpapj7q-uc.a.run.app"},fw=!1;function pw(t){return hw[t]}function gw(){return fw}const xw=cw,_s=t=>{const s=xw[t];return typeof s=="string"?s.trim():""},Gt={ONE_TIME_STARTER:_s("VITE_PRICE_STARTER"),EXTRA_ONE_TIME:_s("VITE_PRICE_EXTRA"),PRO_MONTHLY:_s("VITE_PRICE_MONTHLY"),ELITE_ANNUAL:_s("VITE_PRICE_YEARLY"),PACK3:_s("VITE_PRICE_PACK3"),PACK5:_s("VITE_PRICE_PACK5"),MONTHLY_ALT:_s("VITE_PRICE_MONTHLY_ALT"),ANNUAL_ALT:_s("VITE_PRICE_ANNUAL_ALT")},Br={one:Gt.ONE_TIME_STARTER,single:Gt.ONE_TIME_STARTER,extra:Gt.EXTRA_ONE_TIME,pack3:Gt.PACK3,pack5:Gt.PACK5,pro_monthly:Gt.PRO_MONTHLY,monthly:Gt.MONTHLY_ALT||Gt.PRO_MONTHLY,elite_annual:Gt.ELITE_ANNUAL,annual:Gt.ANNUAL_ALT||Gt.ELITE_ANNUAL},yw={stripe_config_missing:"Billing is temporarily unavailable.",payments_disabled:"Billing is temporarily unavailable.",no_secret:"Billing is temporarily unavailable.",stripe_unavailable:"Billing is having issues; please try again.",stripe_customer_error:"We couldn't sync your billing details. Contact support if it persists.",missing_email:"Add an email to your account before purchasing.",invalid_price:"Invalid plan, contact support.",auth_required:"Sign in to purchase a plan.",origin_not_allowed:"Open checkout from the MyBodyScan app or site.",network_error:"We couldn't reach billing right now. Check your connection and try again."},bw={no_customer:"Complete a purchase first to access the billing portal.",stripe_config_missing:"Billing is currently offline. Try again shortly.",payments_disabled:"Billing is currently offline. Try again shortly.",no_secret:"Billing is currently offline. Try again shortly.",stripe_unavailable:"Billing is having issues; please try again.",stripe_customer_error:"We couldn't open the portal. Contact support if the issue continues.",auth_required:"Sign in to manage billing.",network_error:"We couldn't reach billing right now. Check your connection and try again."};function jw(t){return t?yw[t]??"We couldn't open checkout. Please try again.":"We couldn't open checkout. Please try again."}function Nh(t){return t?bw[t]??"We couldn't open the billing portal. Please try again.":"We couldn't open the billing portal. Please try again."}function ww(t){if(typeof t=="string"){const s=t.trim();if(!s)return null;const n=s.toLowerCase();return Br[n]?{priceId:Br[n],plan:n}:{priceId:s,plan:null}}if(typeof t=="object"&&t!==null){const s=typeof t.priceId=="string"?t.priceId.trim():"",n=typeof t.plan=="string"?t.plan.trim():"",r=n?n.toLowerCase():"";if(s)return{priceId:s,plan:r||null};if(r&&Br[r])return{priceId:Br[r],plan:r}}return null}function Sh(t,s){if(t&&typeof t=="object"){const r=t,a=typeof r.code=="string"?r.code:typeof r.error=="string"?r.error:r.message,i=typeof r.error=="string"?r.error:r.message||s;throw{error:i??s,code:a??i??s}}const n=typeof t=="string"?t:s;throw{error:n,code:n}}async function vw(t,s){vh();const n=ww(t);if(!n)throw{error:"invalid_price",code:"invalid_price"};let r;try{r=await Tn("/billing/create-checkout-session",{method:"POST",body:JSON.stringify({priceId:n.priceId,plan:n.plan})})}catch(h){Sh(h,"network_error")}const a=typeof(r==null?void 0:r.sessionId)=="string"?r.sessionId:"",i=typeof(r==null?void 0:r.url)=="string"?r.url:"";dw();const o=await gu(fo);if(!o)throw{error:"stripe_not_loaded",code:"stripe_not_loaded"};if(!a){if(i)return window.location.assign(i),{sessionId:null,url:i};throw{error:"invalid_response",code:"invalid_response"}}const{error:c}=await o.redirectToCheckout({sessionId:a});if(c){const h=c.message||"stripe_redirect_failed",m=c.code||"stripe_redirect_failed";throw{error:h,code:m}}return{sessionId:a,url:i||null}}async function kh(t){vh();let s;try{s=await Tn("/billing/portal",{method:"POST"})}catch(r){Sh(r,"network_error")}const n=typeof(s==null?void 0:s.url)=="string"?s.url:"";if(!n)throw{error:"invalid_response",code:"invalid_response"};return(t==null?void 0:t.navigate)===!1?{url:n}:(window.location.assign(n),{url:n})}function Nw(t){if(!(!t||typeof window>"u"))try{if(ka()||Tg()){window.location.assign(t);return}window.location.assign(t)}catch{}}const Sw=new Set([404,405]);function Oc(t){return typeof t=="number"&&Sw.has(t)}async function po(){if(!U.currentUser)return null;try{const s=await ol("/system/bootstrap",{method:"POST"});if(Oc(s.status))return console.info("system_bootstrap_unavailable",{status:s.status}),null;if(!s.ok){const a=`HTTP ${s.status}`,i=await s.text().catch(()=>""),o=new Error(i||a);throw o.status=s.status,o}const r=(s.headers.get("Content-Type")||"").includes("application/json")?await s.json().catch(()=>null):await s.text().catch(()=>null);return r&&typeof r=="object"?r:null}catch(s){const n=s,r=typeof(n==null?void 0:n.status)=="number"?n.status:void 0;if(Oc(r))return console.info("system_bootstrap_unavailable",{status:r,message:n==null?void 0:n.message}),null;throw console.error("system_bootstrap_failed",s),n instanceof Error?n:new Error("bootstrap_failed")}}async function kw(){return Tn("/system/health")}async function Or(t,s){if(!t)return null;try{const n=await t.getIdTokenResult(s),r=(n==null?void 0:n.claims)||{},a=r.credits,i=typeof a=="number"?a:void 0,o=r.dev===!0,c=r.unlimitedCredits===!0;return{...r,dev:o,credits:i,unlimitedCredits:c}}catch{return null}}async function Ew(){var a,i,o,c,h,m,u;try{await es("refreshClaims")}catch(d){console.warn("refreshClaims failed",d)}await((a=U==null?void 0:U.currentUser)==null?void 0:a.getIdToken(!0));const t=await((i=U==null?void 0:U.currentUser)==null?void 0:i.getIdTokenResult()),s=!!((o=t==null?void 0:t.claims)!=null&&o.admin),n=!!((c=t==null?void 0:t.claims)!=null&&c.unlimited)||!!((h=t==null?void 0:t.claims)!=null&&h.unlimitedCredits),r=((m=U==null?void 0:U.currentUser)==null?void 0:m.email)||"";if(!n&&r.toLowerCase()==="developer@adlrlabs.com"){try{await es("grantUnlimitedCredits")}catch(d){console.warn("grantUnlimitedCredits failed",d)}try{await es("refreshClaims")}catch(d){console.warn("refreshClaims retry failed",d)}await((u=U.currentUser)==null?void 0:u.getIdToken(!0))}return{admin:s,unlimited:n}}function ll(){var m;const[t,s]=l.useState((U==null?void 0:U.currentUser)??null),[n,r]=l.useState(null),[a,i]=l.useState(!0),o=l.useRef(((m=U==null?void 0:U.currentUser)==null?void 0:m.uid)??null),c=l.useRef(null);l.useEffect(()=>{let u=!0;if(!U){i(!1),s(null);return}const d=kn(U,async f=>{if(!u)return;s(f),i(!0);const p=(f==null?void 0:f.uid)??null,x=p!=null&&o.current!==p,g=await Or(f,x);u&&(o.current=p,r(g),i(!1),f!=null&&f.uid?c.current!==f.uid&&(c.current=f.uid,(async()=>{try{const v=await po();if(!v)return;if(v.claimsUpdated){await f.getIdToken(!0);const j=await Or(f,!0);if(!u)return;o.current=f.uid,r(j)}else typeof v.credits=="number"&&r(j=>j&&{...j,credits:v.credits})}catch(v){console.error("claims_bootstrap_error",v)}})()):c.current=null)});return()=>{u=!1,d()}},[]);const h=l.useMemo(()=>async(u=!0)=>{const d=U==null?void 0:U.currentUser;i(!0);const f=await Or(d,u);if(u&&(d!=null&&d.uid)&&(o.current=d.uid),r(f),i(!1),d!=null&&d.uid)try{const p=await po();if(p!=null&&p.claimsUpdated){await d.getIdToken(!0);const x=await Or(d,!0);return r(x),x}p&&typeof p.credits=="number"&&r(x=>x&&{...x,credits:p.credits})}catch(p){console.error("claims_refresh_bootstrap_error",p)}return f},[]);return{user:t,claims:n,loading:a,refresh:h}}const Uc={title:"Something went wrong",description:"Try again in a moment.",variant:"destructive"},Cw={auth_required:{title:"Sign in required",description:"Sign in to continue."},coach_chat_in_flight:{title:"Coach is already replying",description:"Wait for the current response to finish."},message_required:{title:"Enter a message",description:"Type a message before sending."},file_too_large:{title:"Photo too large",description:"Each photo must be under 15 MB."},invalid_type:{title:"Unsupported file",description:"Use JPEG or PNG photos."},coach_chat_failed:{title:"Coach unavailable",description:"Try again shortly."}},_w={400:{title:"Request invalid",description:"Check your input and try again."},401:{title:"Sign in required",description:"Sign in again to continue."},402:{title:"Add credits",description:"Purchase credits to continue."},403:{title:"Access denied",description:"You don't have access to this action."},404:{title:"Not found",description:"That item is no longer available."},409:{title:"Conflict",description:"Another request conflicted. Try again."},422:{title:"Validation failed",description:"Check your input and try again."},429:{title:"Slow down",description:"Too many attempts. Try again shortly."},500:{title:"Server error",description:"We hit a snag. Try again shortly."},503:{title:"Service unavailable",description:"Service is temporarily unavailable. Try again later."}};function Pw(t){const s=t,n=s==null?void 0:s.code;return typeof n=="string"&&n.trim().length?n:void 0}function Aw(t){const s=t,n=s==null?void 0:s.status;return typeof n=="number"&&Number.isFinite(n)?n:void 0}function ls(t,s){const{fallback:n=Uc,includeCodeInDev:r=!0,logError:a=!0}=s??{};a&&t&&console.error(t);const i=Pw(t),o=Aw(t),c=typeof(t==null?void 0:t.message)=="string"?t.message:void 0,h=(i?Cw[i]:void 0)||(typeof o=="number"?_w[o]:void 0)||(c?{title:n.title,description:c,variant:n.variant??Uc.variant}:void 0)||n;return{title:h.title||n.title,description:h.description,variant:h.variant??n.variant??"destructive"}}var Rd;const Iw=((Rd=import.meta)==null?void 0:Rd.env)??{},hs=t=>{const s=Iw[t];return typeof s=="string"?s.trim():""};function ss(t){const s=hs("VITE_FUNCTIONS_URL"),n=hs("VITE_FUNCTIONS_ORIGIN")||hs("VITE_FUNCTIONS_BASE_URL"),r=hs("VITE_FIREBASE_PROJECT_ID")||hs("FIREBASE_PROJECT_ID"),a=hs("VITE_SCAN_START_URL"),i=t==null?void 0:t.scanEngineConfigured,o=hs("VITE_STRIPE_PUBLISHABLE_KEY")||hs("VITE_STRIPE_PK"),c=hs("VITE_HEALTH_CONNECT"),h=Bs.length===0,m=!!(s||n||r),u=typeof(t==null?void 0:t.openaiConfigured)=="boolean"?t.openaiConfigured:typeof(t==null?void 0:t.openaiKeyPresent)=="boolean"?t.openaiKeyPresent:void 0,d=typeof i=="boolean"?i&&(typeof(t==null?void 0:t.scanConfigured)=="boolean"?t.scanConfigured:!0):typeof(t==null?void 0:t.scanConfigured)=="boolean"?t.scanConfigured:!!(u||m||a),f=yh(),p=f!=="missing"||(t==null?void 0:t.stripeSecretPresent)===!0||!!o,x=typeof(t==null?void 0:t.coachConfigured)=="boolean"?t.coachConfigured:typeof u=="boolean"?u:m,g=typeof(t==null?void 0:t.workoutsConfigured)=="boolean"?t.workoutsConfigured:m,v=typeof(t==null?void 0:t.workoutAdjustConfigured)=="boolean"?t.workoutAdjustConfigured:!!(g&&((t==null?void 0:t.openaiConfigured)??(t==null?void 0:t.openaiKeyPresent)??u??!1)),j=(t==null?void 0:t.nutritionConfigured)??(t==null?void 0:t.usdaKeyPresent)??(t==null?void 0:t.nutritionRpmPresent)??!!m,y=!!c,N=t==null?void 0:t.scanServicesHealthy,b=t==null?void 0:t.usdaKeyPresent,w=t==null?void 0:t.nutritionRpmPresent;t==null||t.coachRpmPresent;const I=h?"Using baked-in Firebase web config.":`Missing: ${Bs.join(", ")}. Add the Firebase web keys to .env.production.local.`,F=u===!1?"OpenAI missing":"Needs config",E=d?N===!1?"Function reachable but reported unhealthy; check Cloud Functions logs.":void 0:u===!1?"Add OPENAI_API_KEY via firebase functions:secrets:set before running scans.":i===!1&&Array.isArray(t==null?void 0:t.scanEngineMissing)?`Scan engine missing: ${t.scanEngineMissing.join(", ")}`:m?"Deploy scan handlers and confirm /api/system/health responds.":"Set VITE_FUNCTIONS_URL or dedicated scan endpoints.";return{statuses:[{id:"firebase",label:"Firebase auth & config",configured:h,okLabel:"Ready",warnLabel:"Missing keys",detail:I},{id:"scans",label:"Body scans",configured:d,okLabel:"Configured",warnLabel:F,detail:E},{id:"workouts",label:"Workouts",configured:g,okLabel:"Functions ready",warnLabel:"Functions URL missing",detail:g?v?void 0:"AI adjustments disabled until OPENAI_API_KEY secret is configured.":"Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to enable workout APIs."},{id:"coach",label:"Coach chat",configured:x,okLabel:"Enabled",warnLabel:u===!1?"OpenAI missing":"Needs config",detail:x?void 0:u===!1?"Add OPENAI_API_KEY via firebase functions:secrets:set.":"Deploy coachChat Function and confirm /api/system/health passes."},{id:"nutrition",label:"Meals search",configured:j,okLabel:"Enabled",warnLabel:"Keys missing",detail:j?void 0:b===!1?"Add USDA_FDC_API_KEY via firebase functions:secrets:set.":w===!1?"Set NUTRITION_RPM secret to control USDA usage.":"Provide USDA/OpenFoodFacts keys or enable the nutrition proxy in Functions."},{id:"stripe",label:"Plans & billing",configured:p,okLabel:f==="live"?"Stripe live":f==="test"?"Stripe test":f==="custom"?"Custom key":"Stripe ready",warnLabel:"Stripe key missing",detail:p?void 0:"Set VITE_STRIPE_PUBLISHABLE_KEY and functions secrets STRIPE_SECRET/STRIPE_SECRET_KEY/STRIPE_WEBHOOK_SECRET."},{id:"health",label:"Health sync",configured:y,okLabel:"Configured",warnLabel:"Coming soon",detail:y?"Connector flag detected.":"Leave disabled until VITE_HEALTH_CONNECT is intentionally enabled."}],stripeMode:f,stripeConfigured:p,functionsConfigured:m,scanConfigured:d,coachConfigured:x,workoutsConfigured:g,workoutAdjustConfigured:v,nutritionConfigured:j,healthConfigured:y}}let mn=null,Ur=null;async function $c(){Ur=Ur??kw().catch(t=>{throw t instanceof Error?t:new Error(String(t))});try{const t=await Ur;return mn=t,t}finally{Ur=null}}function ns(){const[t,s]=l.useState(()=>({health:mn,loading:!mn,error:null})),n=l.useCallback(async()=>{try{s(a=>({...a,loading:!0,error:null}));const r=await $c();s({health:r,loading:!1,error:null})}catch(r){const a=r instanceof Error?r.message:String(r);s({health:mn,loading:!1,error:a})}},[]);return l.useEffect(()=>{if(mn){s({health:mn,loading:!1,error:null});return}let r=!0;return(async()=>{try{const a=await $c();if(!r)return;s({health:a,loading:!1,error:null})}catch(a){if(!r)return;const i=a instanceof Error?a.message:String(a);s({health:null,loading:!1,error:i})}})(),()=>{r=!1}},[]),{...t,refresh:n}}let $r=null;const Rs={started:!1,completed:!1,persistence:"unknown",redirectError:null};function Tw(){return{...Rs}}async function Rw(){return $r||(Rs.started=!0,$r=(async()=>{Ye({kind:"auth.init",message:"auth.init",extra:{phase:"start"}}),Rs.persistence=await em().catch(()=>"unknown");try{await Ty(),Rs.redirectError=null}catch(t){Rs.redirectError=typeof(t==null?void 0:t.message)=="string"?t.message:String(t)}await Bx().catch(()=>{}),Rs.completed=!0,Ye({kind:"auth.init",message:"auth.init",extra:{phase:"done",persistence:Rs.persistence,redirectError:!!Rs.redirectError}})})(),$r)}const Mw=()=>{const[t,s]=l.useState({scanReminder:!0,workoutReminder:!0,checkinReminder:!0,renewalReminder:!0}),[n,r]=l.useState(0),[a,i]=l.useState(""),{t:o,language:c,changeLanguage:h,availableLanguages:m}=La(),u=ze(),{profile:d}=Zs(),[f,p]=l.useState(),[x,g]=l.useState(""),[v,j]=l.useState("unspecified"),[y,N]=l.useState(""),[b,w]=l.useState(!1),[I,F]=l.useState(!1),[E,P]=l.useState(!1),[k,C]=l.useState(!1),[T,L]=l.useState(!1),{credits:M,unlimited:X,loading:ce}=Ra(),{refresh:re}=ll(),{user:ge}=He(),z=ft(),[fe,pe]=l.useState("checking"),{units:Ee}=Os(),{health:Ie}=ns(),{statuses:be,stripeMode:me,stripeConfigured:xe}=ss(Ie??void 0),S=tr(),K=n>0,A=a.trim().toUpperCase()==="DELETE",O=rw||"dev",J=Bc?new Date(Bc).toLocaleString():"",G=me==="live"?"LIVE":me==="test"?"TEST":me==="custom"?"CUSTOM":"MISSING",$=me==="live"?"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400":me==="test"?"bg-amber-500/10 text-amber-700 dark:text-amber-300":me==="custom"?"bg-sky-500/10 text-sky-600 dark:text-sky-300":"bg-destructive/10 text-destructive",R=ce?"…":X?"∞":M,W=fr(),ie=typeof window<"u"?window.location.hostname:"",le=typeof window<"u"?window.location.origin:"",q=String((W==null?void 0:W.authDomain)||"").trim(),ee=!!ie&&!!q&&ie.toLowerCase()!==q.toLowerCase(),H=Wg(),ye=Mx(),Ne=tr(),Re=Tw();l.useEffect(()=>{if((d==null?void 0:d.weight_kg)!=null){const te=Ee==="metric"?d.weight_kg:Pt(d.weight_kg);g(Math.round(te).toString())}},[d==null?void 0:d.weight_kg,Ee]),l.useEffect(()=>{const te=typeof(d==null?void 0:d.heightCm)=="number"&&Number.isFinite(d.heightCm)?d.heightCm:typeof(d==null?void 0:d.height_cm)=="number"&&Number.isFinite(d.height_cm)?d.height_cm:void 0;p(te)},[d==null?void 0:d.heightCm,d==null?void 0:d.height_cm]),l.useEffect(()=>{(d==null?void 0:d.sex)==="male"||(d==null?void 0:d.sex)==="female"||(d==null?void 0:d.sex)==="other"||(d==null?void 0:d.sex)==="unspecified"?j(d.sex):j("unspecified"),typeof(d==null?void 0:d.age)=="number"&&Number.isFinite(d.age)?N(String(Math.round(d.age))):N("")},[d==null?void 0:d.age,d==null?void 0:d.sex]),l.useEffect(()=>{let te=!0;return ge?((async()=>{try{await ts();const Me=await _n();te&&pe(Object.keys(Me).length>0?"present":"absent")}catch{te&&pe("absent")}})(),()=>{te=!1}):(pe("checking"),()=>{te=!1})},[ge]);const Qe=async()=>{if(!U.currentUser){V({title:"Sign in required",description:"Sign in to update your profile.",variant:"destructive"}),u("/auth");return}const te=parseFloat(x);if(!Number.isFinite(te)||te<=0){V({title:"Enter your weight",description:`Weight must be a positive number in ${Ee==="metric"?"kilograms":"pounds"}.`,variant:"destructive"});return}const Me=typeof f=="number"&&Number.isFinite(f)&&f>0?Math.round(f):void 0,Ze=y.trim(),De=Ze.length>0?Number(Ze):void 0;if(De!=null&&(!Number.isFinite(De)||De<13||De>100)){V({title:"Enter a valid age",description:"Age must be between 13 and 100.",variant:"destructive"});return}w(!0);try{const Je=Number((Ee==="metric"?te:gt(te)).toFixed(2)),zt=Se(de,"users",U.currentUser.uid,"coach","profile"),as={weightKg:Je,weight_kg:Je,unit:Ee==="metric"?"kg":"lb"};Me&&(as.height_cm=Me,as.heightCm=Me);const Ut=v==="male"||v==="female"||v==="other"?v:"unspecified";as.sex=Ut,De!=null&&(as.age=Math.round(De)),await mt(zt,as,{merge:!0}),V({title:"Metrics updated"})}catch(Je){V(ls(Je,{fallback:{title:"Unable to save weight",description:"Try again later.",variant:"destructive"}}))}finally{w(!1)}},nt=te=>new Promise(Me=>{try{const Ze=window.indexedDB.deleteDatabase(te);Ze.onsuccess=Ze.onerror=Ze.onblocked=()=>Me()}catch{Me()}}),ke=async()=>{if(!(typeof window>"u"))try{window.localStorage.clear();try{window.sessionStorage.clear()}catch{}if(window.indexedDB){const te=window.indexedDB,Me=te.databases?await te.databases():[];if(Array.isArray(Me))for(const De of Me)De!=null&&De.name&&await nt(De.name);const Ze=["firebaseLocalStorageDb","firebase-heartbeat-database","firebase-installations-database"];for(const De of Ze)await nt(De)}V({title:"Local data cleared"})}catch(te){V(ls(te,{fallback:{title:"Unable to clear data",description:"Try again later.",variant:"destructive"}}))}},At=async()=>{if(S){V({title:"Available on web",description:"Billing is disabled in the iOS build. Use the web app."});return}try{L(!0);const te=await kh({navigate:!1}),Me=te==null?void 0:te.url;if(Me){Nw(Me);return}V({title:"Portal unavailable",description:"Try again shortly.",variant:"destructive"})}catch(te){const Me=typeof(te==null?void 0:te.code)=="string"?te.code:void 0,De={title:"Unable to open billing portal",description:Nh(Me),variant:"destructive"};V(ls(te,{fallback:De,includeCodeInDev:!1}))}finally{L(!1)}},Fe=async()=>{if(Ct()){V({title:"Create a free account to save settings."}),u("/auth");return}await ga(),u("/auth")},Ve=async()=>{if(Ct()){V({title:"Create a free account to export data."}),u("/auth");return}try{F(!0);const te=await Hj(),Me=new Blob([JSON.stringify(te,null,2)],{type:"application/json"}),Ze=window.URL.createObjectURL(Me),De=document.createElement("a");De.href=Ze,De.download=`mybodyscan-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(De),De.click(),document.body.removeChild(De),window.URL.revokeObjectURL(Ze),V({title:"Export ready",description:`Export generated at ${new Date().toLocaleTimeString()}.`})}catch(te){V(ls(te,{fallback:{title:"Export failed",description:"Try again in a moment.",variant:"destructive"}}))}finally{F(!1)}},wt=async()=>{if(Ct()){V({title:"Create a free account to manage account."}),u("/auth");return}try{P(!0),await Gj(),V({title:"Account deleted",description:"We signed you out."}),await ga(),u("/auth",{replace:!0})}catch(te){V(ls(te,{fallback:{title:"Delete failed",description:"Try again later.",variant:"destructive"}}))}finally{P(!1),r(0),i("")}},qe=()=>{i(""),r(1)},It=()=>{i(""),r(0)},rs=async()=>{var Me,Ze;const te=U.currentUser;if(!te){V({title:"Sign in required",description:"Sign in to refresh claims.",variant:"destructive"}),u("/auth");return}try{C(!0),await es("refreshClaims",{});const De=await re(!0);let Je;if((De==null?void 0:De.unlimited)===!0||(De==null?void 0:De.unlimitedCredits)===!0)Je="Unlimited credits active.";else if(typeof(De==null?void 0:De.credits)=="number"&&Number.isFinite(De.credits))Je=`Credits remaining: ${De.credits}`;else{const ct=(Ze=(Me=(await ot(Se(de,`users/${te.uid}/private/credits`))).data())==null?void 0:Me.creditsSummary)==null?void 0:Ze.totalAvailable;typeof ct=="number"&&Number.isFinite(ct)&&(Je=`Credits remaining: ${ct}`)}V({title:"Claims refreshed",description:Je})}catch(De){V(ls(De,{fallback:{title:"Refresh failed",description:"Try again later.",variant:"destructive"}}))}finally{C(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsxs("main",{className:"max-w-md mx-auto p-6 space-y-6",children:[e.jsx(Ce,{title:"Settings - MyBodyScan",description:"Manage your preferences and data."}),e.jsx(Xt,{}),Ct()&&e.jsx("div",{className:"rounded bg-muted p-2 text-center text-xs",children:"Demo settings — sign up to save changes."}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:o("settings.title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Securely manage your account, data, and preferences."})]}),e.jsx(jh,{})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Feature availability"})}),e.jsx(Q,{className:"space-y-2 text-sm",children:be.map(te=>e.jsxs("div",{className:"flex items-start justify-between gap-3 rounded border px-3 py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:te.label}),te.detail&&e.jsx("p",{className:"text-xs text-muted-foreground",children:te.detail})]}),e.jsx(Xe,{variant:te.configured?"default":"secondary",children:te.configured?te.okLabel:te.warnLabel})]},te.id))})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Body metrics"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"sex",children:"Sex"}),e.jsxs(Rt,{value:v,onValueChange:te=>j(te),children:[e.jsx(kt,{id:"sex",children:e.jsx(Mt,{placeholder:"Select sex"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"unspecified",children:"Unspecified"}),e.jsx(Ue,{value:"male",children:"Male"}),e.jsx(Ue,{value:"female",children:"Female"}),e.jsx(Ue,{value:"other",children:"Other"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used for BMR/TDEE and fat percent ranges. Defaults to unspecified."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"age",children:"Age"}),e.jsx(We,{id:"age",type:"number",inputMode:"numeric",min:13,max:100,placeholder:"Enter age in years",value:y,onChange:te=>N(te.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optional. Must be between 13 and 100."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(je,{htmlFor:"height",children:["Height (",Ee==="metric"?"cm":"ft/in",")"]}),Ee==="metric"?e.jsx(We,{id:"height",type:"number",inputMode:"decimal",placeholder:"Enter height in centimeters",value:f??"",onChange:te=>{const Me=parseFloat(te.target.value);p(Number.isFinite(Me)?Me:void 0)}}):e.jsx(rl,{valueCm:f,onChangeCm:te=>p(Number.isFinite(te)&&te>0?Number(te):void 0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Saved securely to improve scan estimates."}),no(f??(d==null?void 0:d.heightCm)??(d==null?void 0:d.height_cm))?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",no(f??(d==null?void 0:d.heightCm)??(d==null?void 0:d.height_cm))]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(je,{htmlFor:"weight",children:["Current weight (",Ee==="metric"?"kg":"lb",")"]}),e.jsx(We,{id:"weight",type:"number",inputMode:"decimal",placeholder:Ee==="metric"?"Enter weight in kilograms":"Enter weight in pounds",value:x,onChange:te=>g(te.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Saved securely in kilograms for calculations."})]}),e.jsx(qt,{onClick:Qe,disabled:b,className:"w-full",children:b?"Saving...":"Save metrics"})]})]}),ge?e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Diagnostics"})}),e.jsxs(Q,{className:"space-y-3 text-sm",children:[ee?e.jsxs("div",{className:"rounded border border-destructive/50 bg-destructive/10 px-3 py-2 text-xs text-destructive",children:[e.jsx("div",{className:"font-semibold",children:"Auth misconfiguration: authDomain must match this site"}),e.jsxs("div",{children:["Running on ",e.jsx("span",{className:"font-mono",children:ie})," ","but Firebase authDomain is"," ",e.jsx("span",{className:"font-mono",children:q}),"."]})]}):null,e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"App Check"}),e.jsx(Xe,{variant:fe==="present"?"default":"secondary",className:"uppercase tracking-wide",children:fe==="checking"?"Checking":fe==="present"?"Token present":"Token missing"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Demo mode"}),e.jsx(Xe,{variant:z?"secondary":"outline",className:"uppercase tracking-wide",children:z?"ON":"OFF"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Auth email"}),e.jsx("span",{className:"font-medium text-foreground",children:ge.email||"(none)"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Origin"}),e.jsx("span",{className:"font-mono text-[11px] text-foreground",children:le||"(unknown)"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Firebase authDomain"}),e.jsx("span",{className:"font-mono text-[11px] text-foreground",children:q||"(unknown)"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"iOS Safari"}),e.jsx(Xe,{variant:ye?"secondary":"outline",className:"uppercase tracking-wide",children:ye?"YES":"NO"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Capacitor native"}),e.jsx(Xe,{variant:Ne?"secondary":"outline",className:"uppercase tracking-wide",children:Ne?"YES":"NO"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Auth persistence"}),e.jsx(Xe,{className:"uppercase tracking-wide",variant:"outline",children:H})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Auth boot"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Re.completed?"ready":Re.started?"starting":"not-started",Re.redirectError?" • redirectError":""]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{children:"Stripe publishable key"}),e.jsx(Xe,{variant:xe?"default":"destructive",className:"uppercase tracking-wide",children:xe?"Present":"Missing"})]})]})]}):null,e.jsx(Tj,{title:o("settings.notifications"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fr,{label:o("notifications.scanReminder"),description:"Every 10 days since last scan",checked:t.scanReminder,onChange:te=>s(Me=>({...Me,scanReminder:te}))}),e.jsx(Fr,{label:o("notifications.workoutReminder"),description:"8am on planned workout days",checked:t.workoutReminder,onChange:te=>s(Me=>({...Me,workoutReminder:te}))}),e.jsx(Fr,{label:o("notifications.checkinReminder"),description:"Weekly check-in reminders",checked:t.checkinReminder,onChange:te=>s(Me=>({...Me,checkinReminder:te}))}),e.jsx(Fr,{label:o("notifications.renewalReminder"),description:"3 days before renewal",checked:t.renewalReminder,onChange:te=>s(Me=>({...Me,renewalReminder:te}))})]})}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:o("settings.language")})}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Interface language"}),e.jsxs(Rt,{value:c,onValueChange:h,children:[e.jsx(kt,{children:e.jsx(Mt,{})}),e.jsx(Et,{children:m.map(te=>e.jsx(Ue,{value:te,children:te==="en"?"English":te},te))})]})]})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Account & data"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download your history or permanently remove your account. These tools affect only your MyBodyScan data."}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("a",{href:"/settings/account",className:"inline-flex items-center justify-center rounded border px-3 py-2 text-sm",children:"Account & Privacy"}),e.jsxs(_,{variant:"outline",onClick:Ve,className:"w-full flex items-center gap-2",disabled:I,children:[I?e.jsx(Dt,{className:"w-4 h-4 animate-spin"}):e.jsx(Gp,{className:"w-4 h-4"}),I?"Preparing export…":o("settings.export_data")]}),e.jsxs(_,{variant:"outline",onClick:rs,className:"w-full flex items-center gap-2",disabled:k,children:[k?e.jsx(Dt,{className:"w-4 h-4 animate-spin"}):e.jsx(Ou,{className:"w-4 h-4"}),k?"Refreshing…":"Refresh claims"]}),e.jsxs("p",{className:"text-xs text-muted-foreground text-center",role:"status","aria-live":"polite",children:["Credits: ",X?"∞ (unlimited)":R]})]}),e.jsxs("div",{className:"rounded border border-destructive/40 bg-destructive/5 p-3 space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-destructive flex items-center gap-2",children:[e.jsx(Hp,{className:"h-4 w-4"})," Irreversible delete"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This will revoke access, remove scans, and delete uploaded photos. Sign back in to start fresh."}),e.jsxs(_,{variant:"destructive",className:"w-full",onClick:qe,disabled:E,children:[E?e.jsx(Dt,{className:"mr-2 h-4 w-4 animate-spin"}):null,E?"Deleting…":o("settings.delete_account")]})]}),e.jsx(_,{variant:"outline",onClick:Fe,className:"w-full",children:o("settings.sign_out")}),e.jsx(_,{variant:"outline",onClick:async()=>{await ph(),V({title:"Copied diagnostics"})},className:"w-full",children:"Copy diagnostics"}),e.jsx(_,{variant:"outline",onClick:ke,className:"w-full",children:"Reset local data"})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Support & legal"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-muted px-3 py-2 text-sm",children:[e.jsx("span",{children:"Environment"}),e.jsx(Xe,{className:`uppercase tracking-wide ${$}`,children:G})]}),e.jsxs(_,{variant:"outline",onClick:At,className:"w-full flex items-center justify-center gap-2",disabled:T||S,children:[T?e.jsx(Dt,{className:"h-4 w-4 animate-spin"}):e.jsx(Bu,{className:"h-4 w-4"}),S?"Billing available on web":T?"Opening portal…":"Open billing portal"]}),S&&e.jsx("p",{className:"mt-2 text-center text-xs text-muted-foreground",children:"Billing is available on web."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{variant:"outline",asChild:!0,className:"w-full flex items-center gap-2 justify-center",children:e.jsxs("a",{href:fh(),"aria-label":"Email support",children:[e.jsx(Yp,{className:"h-4 w-4"})," Email support"]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs("a",{href:"/help",className:"flex items-center gap-2",children:[e.jsx(Uu,{className:"h-4 w-4"})," Help Center",e.jsx(en,{className:"h-3 w-3"})]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs("a",{href:"/legal/privacy",className:"flex items-center gap-2",children:["Privacy Policy",e.jsx(en,{className:"h-3 w-3"})]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs("a",{href:"/legal/terms",className:"flex items-center gap-2",children:["Terms of Service",e.jsx(en,{className:"h-3 w-3"})]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs("a",{href:"/legal/refund",className:"flex items-center gap-2",children:["Refund Policy",e.jsx(en,{className:"h-3 w-3"})]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs(jt,{to:"/settings/system-check",className:"flex items-center gap-2",children:["System Check",e.jsx(en,{className:"h-3 w-3"})]})}),e.jsx(_,{variant:"ghost",asChild:!0,className:"justify-start gap-2 text-left text-sm",children:e.jsxs("a",{href:"/settings/system-check-pro",className:"flex items-center gap-2",children:["System Check Pro",e.jsx(en,{className:"h-3 w-3"})]})})]}),e.jsxs("div",{className:"rounded bg-muted p-3 text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Version: ",O,J?` • ${J}`:""]}),e.jsxs("div",{children:["Stripe mode:"," ",me==="live"?"Live":me==="test"?"Test":me==="custom"?"Custom key":"Missing"]}),e.jsxs("div",{children:["Publishable key suffix: ",nw||"n/a"]}),null]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"support@mybodyscanapp.com"})]})]}),e.jsx(Xs,{open:K,onOpenChange:te=>te?r(Me=>Me===0?1:Me):It(),children:e.jsx(Us,{children:n===1?e.jsxs(e.Fragment,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Confirm delete"}),e.jsxs(ar,{children:["Type ",e.jsx("span",{className:"font-semibold",children:"DELETE"})," to continue. This starts the permanent removal process."]})]}),e.jsx(We,{autoFocus:!0,value:a,onChange:te=>i(te.target.value),placeholder:"Type DELETE","aria-label":"Type DELETE to confirm"}),e.jsxs(ya,{children:[e.jsx(_,{variant:"outline",onClick:It,children:"Cancel"}),e.jsx(_,{variant:"destructive",onClick:()=>r(2),disabled:!A,children:"Continue"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Final confirmation"}),e.jsx(ar,{children:"This will revoke access, delete scans, and erase uploads immediately. You cannot undo this action."})]}),e.jsxs(ya,{children:[e.jsx(_,{variant:"outline",onClick:It,children:"Cancel"}),e.jsxs(qt,{variant:"destructive",onClick:wt,disabled:E,children:[E?e.jsx(Dt,{className:"mr-2 h-4 w-4 animate-spin"}):null,E?"Deleting…":"Delete forever"]})]})]})})})]}),e.jsx(xt,{})]})};function Dw(){const{user:t,loading:s}=He(),n=ze(),[r,a]=l.useState(null),[i,o]=l.useState(""),[c,h]=l.useState(""),[m,u]=l.useState(!1),[d,f]=l.useState(null),[p,x]=l.useState(null);l.useEffect(()=>{var j;!s&&!t&&n("/auth?next=/settings/account"),t&&a(((j=t.providerData[0])==null?void 0:j.providerId)||null)},[t,s,n]);async function g(j){const y=r||"";if(y.includes("password")){if(!i)throw new Error("Please enter your password");const N=Tu.credential(j.email||"",i);await Fp(j,N)}else if(y.includes("google")){const N=new Sa;if(Mm()){await Lp(j,N);return}await Bp(j,N)}}async function v(){if(x(null),f(null),!!t){if(c.trim().toUpperCase()!=="DELETE"){x("Type DELETE to confirm");return}u(!0);try{await g(t);const j=await Bb("deleteAccount",Rb("deleteAccount"),{method:"POST",body:{}});if((j==null?void 0:j.error)==="reauth_required")throw new Error("Please re-authenticate and try again.");if(!(j!=null&&j.ok))throw new Error((j==null?void 0:j.error)||"Could not delete account");f("Account deleted."),await Do(U),n("/auth")}catch(j){x((j==null?void 0:j.message)||"Could not delete account")}finally{u(!1)}}}return e.jsxs("div",{className:"mx-auto max-w-2xl p-4 space-y-4",children:[e.jsxs("header",{className:"sticky top-0 z-40 -mx-4 mb-1 bg-white/80 backdrop-blur border-b px-4 py-2 flex items-center gap-3",children:[e.jsx("a",{href:"/settings",className:"rounded border px-2 py-1 text-xs",children:"Back"}),e.jsx("h1",{className:"text-sm font-medium",children:"Account & Privacy"}),e.jsx("div",{className:"flex-1"})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Legal"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("a",{className:"underline",href:"/legal/privacy",children:"Privacy Policy"}),e.jsx("a",{className:"underline",href:"/legal/terms",children:"Terms of Service"}),e.jsx("a",{className:"underline",href:"/legal/refund",children:"Refund Policy"})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Delete my account"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Deleting your account will permanently remove your scans, notes, and settings. This cannot be undone."}),(r==null?void 0:r.includes("password"))&&e.jsxs("label",{className:"text-xs block",children:["Password (required to confirm)",e.jsx("input",{type:"password",value:i,onChange:j=>o(j.target.value),className:"mt-1 w-full rounded border px-2 py-1 text-sm",autoComplete:"current-password"})]}),e.jsxs("label",{className:"text-xs block",children:["Type ",e.jsx("span",{className:"font-mono",children:"DELETE"})," to confirm",e.jsx("input",{value:c,onChange:j=>h(j.target.value),className:"mt-1 w-full rounded border px-2 py-1 text-sm",placeholder:"DELETE"})]}),p&&e.jsx("p",{role:"alert",className:"text-xs text-red-700",children:p}),d&&e.jsx("p",{role:"status",className:"text-xs text-emerald-700",children:d}),e.jsx("button",{onClick:v,disabled:m,className:"rounded border px-3 py-2 text-sm bg-red-50 border-red-200 text-red-800",children:m?"Deleting…":"Delete my account"})]})]})}const on={},di={time:(on==null?void 0:on.VITE_BUILD_TIME)||"",sha:(on==null?void 0:on.VITE_BUILD_SHA)||"",mode:"production"};function cl(){const[t,s]=l.useState({status:"checking",tokenPresent:!1});return l.useEffect(()=>{let n=!0;return(async()=>{try{if(!hm()){n&&s({status:"disabled",tokenPresent:!1,message:"App Check is not configured (optional)."});return}await ts();const r=await _n();if(!n)return;const a=!!r["X-Firebase-AppCheck"];s(a?{status:"ready",tokenPresent:!0}:{status:"unavailable",tokenPresent:!1,message:"No App Check token was issued."})}catch(r){if(!n)return;const a=typeof(r==null?void 0:r.message)=="string"&&r.message.length?r.message:void 0;s({status:"unavailable",tokenPresent:!1,message:a})}})(),()=>{n=!1}},[]),t}function Wc(){var y,N;const{user:t,loading:s}=He(),[n,r]=l.useState(null),[a,i]=l.useState(null),[o,c]=l.useState(!1),[h,m]=l.useState([]),[u,d]=l.useState(!1),{health:f}=ns(),p=cl(),{statuses:x}=ss(f??void 0);async function g(){c(!0),i(null),r(null);try{const b=await ws("/api/system/health",{method:"GET"});r(b||{})}catch(b){i((b==null?void 0:b.message)||"Health check failed")}finally{c(!1)}}l.useEffect(()=>{s||g()},[s]);async function v(){d(!0);const b=[];try{if(!(t!=null&&t.uid)){b.push({name:"Auth",ok:!1,detail:"Signed out"}),m(b);return}b.push({name:"Auth",ok:!0,detail:`uid=${t.uid}`}),b.push({name:"App Check",ok:p.status==="ready"||p.status==="disabled",detail:`${p.status} · tokenPresent=${p.tokenPresent?"true":"false"}`});try{const w=Se(de,"users",t.uid,"settings","systemCheck");await oa(w,{lastRunAt:at(),platform:"web"},{merge:!0});const I=await ot(w);b.push({name:"Firestore read/write",ok:I.exists(),detail:I.exists()?"ok":"missing after write"})}catch(w){b.push({name:"Firestore read/write",ok:!1,detail:`${(w==null?void 0:w.code)??"error"} · ${(w==null?void 0:w.message)??String(w)}`})}try{const w=await ws("/api/system/health",{method:"GET"});b.push({name:"Functions health",ok:!!w,detail:"ok"})}catch(w){b.push({name:"Functions health",ok:!1,detail:`${(w==null?void 0:w.status)??""} ${(w==null?void 0:w.message)??String(w)}`.trim()})}}finally{m(b),d(!1)}}const j=[["User",t?t.uid:"(signed out)"],["Capacitor Native",String(tr())],["Secure Context / Localhost",String(Ju())],["getUserMedia()",String(Qu())],["Camera Ready",String(Rg())],["Build Time",di.time||"(unset)"],["Build SHA",di.sha||"(unset)"],["Mode",di.mode],["Google Sign-In Enabled",String("true".toLowerCase()!=="false")],["Apple Sign-In Enabled",String("true".toLowerCase()!=="false")],["Storage bucket (client)",String(((y=fr())==null?void 0:y.storageBucket)||((N=tm().app.options)==null?void 0:N.storageBucket)||"(unset)")],["Storage bucket (server)",f!=null&&f.storageBucket?`${f.storageBucket}${f.storageBucketSource?` (${f.storageBucketSource})`:""}`:"unknown"],["Scan engine configured",(f==null?void 0:f.scanEngineConfigured)===!1?"false":f!=null&&f.scanEngineConfigured?"true":"unknown"],["Missing (engine)",Array.isArray(f==null?void 0:f.scanEngineMissing)&&(f!=null&&f.scanEngineMissing.length)?f.scanEngineMissing.join(", "):"—"]];return e.jsxs("div",{className:"mx-auto max-w-2xl p-4 space-y-4","data-testid":"system-check-root",children:[e.jsxs("header",{className:"sticky top-0 z-40 -mx-4 mb-1 bg-white/80 backdrop-blur border-b px-4 py-2 flex items-center gap-3",children:[e.jsx("a",{href:"/settings",className:"rounded border px-2 py-1 text-xs",children:"Back"}),e.jsx("h1",{className:"text-sm font-medium",children:"System Check"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:g,disabled:o,className:"rounded border px-2 py-1 text-xs",children:o?"Running…":"Re-run"})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Environment"}),e.jsx("table",{className:"w-full text-xs",children:e.jsx("tbody",{children:j.map(([b,w])=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-1 pr-2 text-muted-foreground whitespace-nowrap",children:b}),e.jsx("td",{className:"py-1 break-all",children:w})]},b))})})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Feature availability"}),e.jsx("div",{className:"space-y-2 text-sm",children:x.map(b=>e.jsxs("div",{className:"flex items-start justify-between gap-3 rounded border px-3 py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:b.label}),b.detail&&e.jsx("p",{className:"text-xs text-muted-foreground",children:b.detail})]}),e.jsx(Xe,{variant:b.configured?"default":"secondary",children:b.configured?b.okLabel:b.warnLabel})]},b.id))})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Firebase checks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>void v(),disabled:u,className:"rounded border px-2 py-1 text-xs",children:u?"Running…":"Run Firebase checks"}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["Storage check writes to ",e.jsx("code",{children:"user_uploads/<uid>/debug/"}),"."]})]}),e.jsxs("table",{className:"w-full text-xs border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/5",children:[e.jsx("th",{className:"p-1 text-left",children:"Check"}),e.jsx("th",{className:"p-1",children:"OK"}),e.jsx("th",{className:"p-1 text-left",children:"Detail"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{className:"border-t",children:e.jsx("td",{className:"p-2 text-muted-foreground",colSpan:3,children:"Run the checks to validate auth, Firestore, Storage, and functions."})}):h.map(b=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1",children:b.name}),e.jsx("td",{className:"p-1 text-center",children:b.ok?"OK":"FAIL"}),e.jsx("td",{className:"p-1 break-all text-muted-foreground",children:b.detail??""})]},b.name))})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm font-medium",children:"/api/system/health"}),a&&e.jsx("p",{role:"alert",className:"text-xs text-red-700",children:a}),!a&&!n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for health response…"}),n&&e.jsx("pre",{className:"rounded border bg-black/5 p-2 text-[11px] overflow-auto",children:JSON.stringify(n,null,2)}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"This request includes your Firebase ID token and App Check token (if available). We expect JSON and no “app_check_required” errors during UAT (soft mode)."})]}),e.jsxs("section",{className:"space-y-1",children:[e.jsx("h2",{className:"text-sm font-medium",children:"Camera Readiness"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"For barcode scanning and camera previews, we require a secure context on web. In the native wrapper, file inputs will open Camera/Library."})]})]})}const ui=Jm("VITE_API_BASE_URL","api").replace(/\/$/,""),Fw=[{name:"System Health",path:`${ui}/system/health`,method:"GET"},{name:"Coach Chat",path:`${ui}/coach/chat`,method:"POST",body:{message:"hello"}},{name:"Nutrition",path:`${ui}/nutrition/search`,method:"POST",body:{q:"chicken"}}];function qc(){const t=U.currentUser,[s,n]=l.useState(""),[r,a]=l.useState([]),[i,o]=l.useState(!1);l.useEffect(()=>{Kn&&Mo(Kn,!1).then(h=>n((h==null?void 0:h.token)||"")).catch(()=>{})},[Kn]);async function c(){o(!0);const h=[];for(const m of Fw)try{await ws(m.path,{method:m.method||"GET",body:m.body}),h.push({name:m.name,ok:!0,status:200})}catch(u){h.push({name:m.name,ok:!1,status:typeof(u==null?void 0:u.status)=="number"?u.status:void 0,error:String((u==null?void 0:u.message)||u)})}a(h),o(!1)}return e.jsxs("div",{className:"mx-auto max-w-2xl p-4 space-y-4",children:[e.jsxs("header",{className:"sticky top-0 -mx-4 px-4 py-2 bg-white/80 backdrop-blur border-b flex items-center gap-2",children:[e.jsx("a",{href:"/settings",className:"rounded border px-2 py-1 text-xs",children:"Back"}),e.jsx("h1",{className:"text-sm font-medium",children:"System Check Pro"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:c,disabled:i,className:"rounded border px-2 py-1 text-xs",children:i?"Running…":"Run"})]}),e.jsxs("section",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:["User: ",(t==null?void 0:t.email)||"(signed out)"," · UID: ",(t==null?void 0:t.uid)||"-"]}),e.jsxs("div",{children:["Project ID: ","mybodyscan-f3daf"]}),e.jsxs("div",{children:["App Check token present: ",s?"yes":"no"]}),e.jsxs("div",{children:["Demo Active: ",String(Js())]})]}),e.jsx("section",{children:e.jsxs("table",{className:"w-full text-xs border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/5",children:[e.jsx("th",{className:"p-1 text-left",children:"Check"}),e.jsx("th",{className:"p-1",children:"OK"}),e.jsx("th",{className:"p-1",children:"Status"}),e.jsx("th",{className:"p-1",children:"Error"})]})}),e.jsx("tbody",{children:r.map(h=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1",children:h.name}),e.jsx("td",{className:"p-1",children:h.ok?"✅":"❌"}),e.jsx("td",{className:"p-1",children:h.status??"-"}),e.jsx("td",{className:"p-1 break-all",children:h.error||""})]},h.name))})]})})]})}function zc(){const t=Qt();return l.useEffect(()=>{console.warn("route_not_found",{path:t.pathname})},[t.pathname]),e.jsx("main",{className:"min-h-screen flex items-center justify-center p-6 bg-background",children:e.jsxs("div",{className:"max-w-md text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Page not found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The page you’re looking for doesn’t exist or was moved."}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(jt,{className:"underline",to:"/home",children:"Go home"})})]})})}function Lw({children:t}){const[s,n]=l.useState(!1);return l.useEffect(()=>{ts().finally(()=>n(!0))},[]),s?e.jsx(e.Fragment,{children:t}):null}const Bw={nutrition:{title:"We couldn't load your nutrition data",description:"It looks like your profile info isn't ready yet."},scan:{title:"We couldn't load your scan data",description:"Your recent scan details are still syncing."},coach:{title:"We couldn't load your coach",description:"We're waiting on your profile to finish loading."}};function Ow(t){const s=String((t==null?void 0:t.message)||"").toLowerCase();return t.name==="TypeError"?!0:s?s.includes("profile")||s.includes("user")||s.includes("undefined")||s.includes("missing"):!1}class mi extends l.Component{constructor(){super(...arguments);vt(this,"state",{hasError:!1});vt(this,"handleRetry",()=>{this.setState({hasError:!1,message:void 0})})}componentDidCatch(n){if(Ow(n)){console.warn("[data-boundary]",n),this.setState({hasError:!0,message:n==null?void 0:n.message});return}throw n}render(){if(this.state.hasError){const n=Bw[this.props.page];return e.jsxs("div",{className:"flex min-h-[280px] flex-col items-center justify-center gap-3 rounded-lg border border-border/60 bg-muted/30 p-6 text-center",children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description}),this.state.message&&e.jsx("p",{className:"text-xs text-muted-foreground/80",children:this.state.message}),e.jsx(_,{size:"sm",onClick:this.handleRetry,variant:"secondary",children:"Try again"})]})}return this.props.children}}const Uw="/assets/silhouette-front-C6BufFH5.png",$w=[{step:"1) Capture",text:"Choose a photo option: • 4 photos (front, left, right, back) for best accuracy • Quick 2-photo scan (front + side) for speed."},{step:"2) Process",text:"Our system estimates body fat %, weight, and BMI."},{step:"3) Track",text:"Build history and visualize progress over time."}],Ww={oneScan:{id:"one-scan",label:"1 Scan",priceText:"$9.99"},monthly:{id:"monthly",label:"Monthly",priceText:"$14.99",blurb:"First month, then $24.99/mo · 3 scans/month"},yearly:{id:"yearly",label:"Yearly",priceText:"$199.99",blurb:"3 scans/month"}},hi=Ww,fi={oneScan:hi.oneScan,monthly:hi.monthly,yearly:hi.yearly},Eh=()=>{const t=ze(),s="/demo",n=()=>{U!=null&&U.currentUser?t("/home"):t("/auth")};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Body scans from your phone – MyBodyScan",description:"Estimate body fat %, weight, and BMI from either a 4-photo scan or quick 2-photo scan. Track progress over time.",canonical:"https://mybodyscanapp.com/"}),e.jsx("section",{className:"py-8",children:e.jsxs("div",{className:"grid gap-8 md:grid-cols-2 md:items-center",children:[e.jsxs("article",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight md:text-4xl",children:"Body scans from your phone"}),e.jsx("p",{className:"mt-3 text-muted-foreground",children:"Estimate body fat %, weight, and BMI from 4 photos (front, left, right, back) or a quick 2-photo scan (front + side). Track progress over time."}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[e.jsx(_,{size:"lg",onClick:n,children:"Launch Web App"}),e.jsx(_,{size:"lg",variant:"outline",onClick:()=>t("/plans"),children:"Pricing"}),e.jsx(jt,{to:s,className:"btn-secondary",onClick:()=>Pn(),children:"Browse the demo"})]})]}),e.jsx("aside",{className:"justify-self-center md:justify-self-end",children:e.jsx("img",{src:Uw,alt:"MyBodyScan app illustration showing body scan silhouette",className:"w-64 h-auto rounded-lg border shadow-sm",loading:"lazy"})})]})}),e.jsxs("section",{className:"py-8",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"How it works"}),e.jsx("div",{className:"mt-4 grid gap-4 md:grid-cols-3",children:$w.map(r=>e.jsxs("article",{className:"rounded-lg border p-4",children:[e.jsx("h3",{className:"font-medium",children:r.step}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.text})]},r.step))})]}),e.jsxs("section",{className:"py-8",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pricing snapshot"}),e.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[fi.oneScan,fi.monthly,fi.yearly].map(r=>e.jsxs("article",{className:"rounded-xl border bg-card p-4",children:[e.jsx("h3",{className:"font-medium",children:r.label}),e.jsx("p",{className:"text-sm text-foreground mt-1",children:r.priceText}),r.blurb?e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.blurb}):null]},r.id))})]}),e.jsxs("section",{className:"py-8",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Privacy & Security"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"We take privacy seriously. Your account email and uploaded media are used only to provide estimates and stored securely. Data is never sold, and you can request deletion at any time."})]}),e.jsx("footer",{className:"py-8 border-t mt-8",children:e.jsxs("nav",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsx(jt,{to:"/privacy",className:"underline-offset-4 hover:underline",children:"Privacy"}),e.jsx(jt,{to:"/terms",className:"underline-offset-4 hover:underline",children:"Terms"}),e.jsx(jt,{to:"/support",className:"underline-offset-4 hover:underline",children:"Support"})]})})]})},qw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Privacy Policy – MyBodyScan",description:"We collect account email and user media to provide estimates; stored securely; never sold; delete on request.",canonical:"https://mybodyscanapp.com/privacy"}),e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none",children:[e.jsx("h1",{children:"Privacy Policy"}),e.jsx("p",{children:"We collect your account email and user media (photos/videos) solely to provide estimates such as body fat %, weight, and BMI. Your data is stored securely, never sold, and retained only as needed to operate the service."}),e.jsxs("p",{children:["You can request data deletion at any time by contacting"," ",e.jsx("a",{href:"mailto:support@mybodyscanapp.com",children:"support@mybodyscanapp.com"}),"."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Estimates only. Not a medical diagnosis."})]})]}),zw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Terms of Service – MyBodyScan",description:"General-wellness only; not medical advice. No refunds once a scan is processed except as required by law.",canonical:"https://mybodyscanapp.com/terms"}),e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none",children:[e.jsx("h1",{children:"Terms of Service"}),e.jsx("p",{children:"MyBodyScan provides general-wellness information and is not a medical device. Estimates only. Not a medical diagnosis. Always consult a qualified professional for medical advice."}),e.jsx("p",{children:"Purchases are non-refundable once a scan has been processed, except where required by applicable law."})]})]}),Vw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Support – MyBodyScan",description:"Get help with MyBodyScan. Contact support@mybodyscanapp.com or call our support line.",canonical:"https://mybodyscanapp.com/support"}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("article",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Support"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Email:"," ",e.jsx("a",{className:"underline",href:"mailto:support@mybodyscanapp.com",children:"support@mybodyscanapp.com"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone: (555) 555-1234"}),e.jsx(_,{className:"mt-4",onClick:async()=>{await ph(),V({title:"Copied diagnostics"})},children:"Copy diagnostics"})]}),e.jsxs("article",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"font-medium",children:"FAQ"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"How long does a scan take?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Most scans complete within a minute after upload."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"How do I delete my account?"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Email"," ",e.jsx("a",{className:"underline",href:"mailto:support@mybodyscanapp.com",children:"support@mybodyscanapp.com"})," ","from your account email and we’ll process the deletion."]})]})]})]})]})]}),Kw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Disclaimer – MyBodyScan",description:"Health information notice",canonical:"https://mybodyscanapp.com/legal/disclaimer"}),e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none",children:[e.jsx("h1",{children:"Health Disclaimer"}),e.jsx("p",{children:"Not medical advice; see a doctor if under 18, pregnant or breastfeeding, with eating disorder history, heart/kidney/liver disease, diabetes on medication, or recent surgery."}),e.jsx("p",{children:"Stop and seek emergency care if chest pain, fainting, or severe dizziness. Calorie bounds are enforced."})]})]});function Gw(t){const s=t.split(/\r?\n/),n=[],r=[],a=()=>{r.length!==0&&n.push(e.jsx("ul",{className:"list-disc pl-5",children:r.splice(0,r.length).map((i,o)=>e.jsx("li",{children:i},o))},`list-${n.length}`))};for(const i of s){const o=i.trim();if(!o){a();continue}if(o.startsWith("# ")){a(),n.push(e.jsx("h1",{className:"text-3xl font-bold",children:o.slice(2)},`h1-${n.length}`));continue}if(o.startsWith("## ")){a(),n.push(e.jsx("h2",{className:"text-xl font-semibold mt-6",children:o.slice(3)},`h2-${n.length}`));continue}if(o.startsWith("- ")){r.push(o.slice(2));continue}a(),n.push(e.jsx("p",{className:"leading-relaxed",children:o},`p-${n.length}`))}return a(),n}function Ch({title:t,markdown:s}){const n=Gw(s);return e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none space-y-4 p-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:t}),n]})}const Hw=`# Privacy Policy

This Privacy Policy explains how MyBodyScan collects, uses, and safeguards your information.

## Information We Collect

- Profile details you provide (name, email, demographics).
- Photos and measurement data used for scans.
- Usage diagnostics that help us improve reliability.

## How We Use Information

- Deliver personalized scan results and recommendations.
- Operate and secure the app, including fraud prevention.
- Communicate updates, billing notices, and customer support.

## Data Sharing

We do not sell personal data. We share information only with:

- Service providers who assist with hosting, processing, or payments.
- Authorities when required by law.

## Your Choices

- Update or delete data from Settings at any time.
- Export your history before deletion for your own records.
- Contact support@mybodyscanapp.com with privacy questions.

## Retention & Security

We retain data for as long as your account is active and use industry-standard safeguards to protect it.

## Changes

We will post updates on this page and revise the effective date when policies change.

Effective date: March 1, 2024.
`,Yw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Privacy Policy – MyBodyScan",description:"How MyBodyScan handles your account, credits and scan metadata.",canonical:"https://mybodyscanapp.com/legal/privacy"}),e.jsx(Ch,{title:"Privacy Policy",markdown:Hw})]}),Qw=`# Terms of Service

Welcome to MyBodyScan. These Terms of Service govern your access to and use of the MyBodyScan application and related services.

## Subscriptions & Billing

- Plans renew automatically until cancelled.
- You may cancel at any time from the Settings → Billing section or by contacting support.
- Refunds are only provided where required by applicable law.

## Acceptable Use

- Keep your login credentials secure and do not share your account.
- Upload only images that you have the right to share.
- Do not use MyBodyScan for unlawful, harmful, or abusive purposes.

## Results & Guidance

- Scan outputs are wellness estimates and are not a medical diagnosis.
- Consult a qualified professional before making major fitness or nutrition decisions.

## Suspension & Termination

We may suspend or terminate access for misuse, non-payment, or security risks. You may delete your account at any time from Settings.

## Changes

We may update these terms from time to time. Continued use after changes become effective constitutes acceptance.

For questions, contact support@mybodyscanapp.com.
`,Jw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Terms of Service – MyBodyScan",description:"License and subscription terms for using MyBodyScan.",canonical:"https://mybodyscanapp.com/legal/terms"}),e.jsx(Ch,{title:"Terms of Service",markdown:Qw})]}),Xw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Refund Policy – MyBodyScan",description:"Refund information for digital purchases on MyBodyScan.",canonical:"https://mybodyscanapp.com/legal/refund"}),e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none p-6",children:[e.jsx("h1",{children:"Refund Policy"}),e.jsx("p",{children:"All purchases of digital goods are final and non-refundable."}),e.jsxs("p",{children:["For billing issues, contact"," ",e.jsx("a",{href:"mailto:support@mybodyscanapp.com",children:"support@mybodyscanapp.com"}),"."]}),e.jsx("p",{children:"Consumer rights required by law are not affected."})]})]}),Zw=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Help Center – MyBodyScan",description:"Answers to common questions and support.",canonical:"https://mybodyscanapp.com/help"}),e.jsxs("article",{className:"prose prose-neutral dark:prose-invert max-w-none p-6",children:[e.jsx("h1",{children:"Help Center"}),e.jsx("h2",{children:"Why can’t I scan?"}),e.jsx("p",{children:"You need an available credit; buy one on the Plans page."}),e.jsx("h2",{children:"How many scans per plan?"}),e.jsx("p",{children:"Starter includes 1, Pro 3 per month, and Elite 36 per year. Credits roll over for 12 months."}),e.jsx("h2",{children:"What photos do I need?"}),e.jsx("p",{children:"Use good lighting, a plain background, and capture your full body."}),e.jsx("h2",{children:"Calories look different than I entered"}),e.jsx("p",{children:"Entries are reconciled to your macro targets so totals may shift slightly."}),e.jsx("h2",{children:"Delete my data"}),e.jsxs("p",{children:["Use Settings → Delete or email"," ",e.jsx("a",{href:"mailto:support@mybodyscanapp.com",children:"support@mybodyscanapp.com"}),"."]}),e.jsx(_,{className:"mt-4",onClick:()=>{window.location.href=fh()},children:"Report a problem"})]})]});function ev(){const t=ze();nl(()=>!0,{message:"Going back may cancel the current action. Continue?"}),l.useEffect(()=>{const n=setTimeout(()=>t("/scan/new"),4e3);return()=>clearTimeout(n)},[t]);const s=()=>{t(U!=null&&U.currentUser?"/scan/new":"/auth")};return e.jsxs("main",{className:"mx-auto max-w-2xl p-6",children:[e.jsx(Ce,{title:"Checkout Success – MyBodyScan",description:"Your payment succeeded. Redirecting you back to the app."}),e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Payment successful"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Thanks! You’ll be redirected shortly. You can also jump back now."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(_,{onClick:s,children:"Return to App"})})]})}function tv(){const t=ze();nl(()=>!0,{message:"Going back may cancel the current action. Continue?"}),l.useEffect(()=>{const n=setTimeout(()=>t("/scan/new"),4e3);return()=>clearTimeout(n)},[t]);const s=()=>{t(U!=null&&U.currentUser?"/scan/new":"/auth")};return e.jsxs("main",{className:"mx-auto max-w-2xl p-6",children:[e.jsx(Ce,{title:"Checkout Canceled – MyBodyScan",description:"Your payment was canceled. You can try again anytime."}),e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Payment canceled"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"No charge was made. You’ll be redirected shortly. You can also jump back now."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(_,{onClick:s,children:"Return to App"})})]})}function sv(){const t=ze(),s=Qt(),r=new URLSearchParams(s.search).get("error"),a=r?"We couldn't complete sign-in. Redirecting you back to the app.":"Finishing sign-in…";return l.useEffect(()=>{const i=window.setTimeout(()=>t("/",{replace:!0}),1200);return()=>window.clearTimeout(i)},[t]),e.jsxs("main",{className:"min-h-screen flex flex-col items-center justify-center gap-4 p-6 text-center",children:[e.jsx(Ce,{title:"Completing sign-in – MyBodyScan",description:"Finishing sign-in and returning you to the app."}),e.jsx("div",{className:"w-10 h-10 border-4 border-muted border-t-primary rounded-full animate-spin","aria-hidden":!0}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:a}),r?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Error: ",r]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"You will be redirected shortly."})]})}function nv(){var j;const t=Qt(),s=(j=t.state)==null?void 0:j.from,a=l.useMemo(()=>new URLSearchParams(t.search),[t.search]).get("next")||s||"/",[i,o]=l.useState(""),[c,h]=l.useState(""),[m,u]=l.useState(null),[d,f]=l.useState(!1),{user:p,authReady:x}=He(),g=()=>{const N=Dm()??a;An();let b=N;try{const w=new URL(N,window.location.origin);w.searchParams.delete("demo"),b=`${w.pathname}${w.search}${w.hash}`||"/"}catch{if(typeof N=="string"&&N.includes("demo=")){const[w]=N.split("?");b=w||"/"}}typeof b=="string"&&(b.startsWith("/login")||b.startsWith("/auth")||b.startsWith("/oauth"))&&(b="/home"),window.location.replace(b)};l.useEffect(()=>{if(!U){u("Authentication unavailable. Please reload or try again later.");return}x&&(p||U.currentUser)&&g()},[x,p]);async function v(y,N){const{autoFinish:b=!0}=N??{};f(!0),u(null),Ye({kind:"auth.login_start",message:"auth.login_start",extra:{target:a}});try{await y(),Ye({kind:"auth.login_success",message:"auth.login_success",extra:{target:a}}),b&&g()}catch(w){const I=rv(w),F=I.message||"Sign-in failed";u(F),Ye({kind:"auth.login_failed",message:"auth.login_failed",extra:{code:I.code??null,message:F}})}finally{f(!1)}}return e.jsxs("div",{className:"mx-auto max-w-sm p-6",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Sign in"}),Xr.google&&e.jsx("button",{className:"mb-3 w-full rounded border p-2",disabled:d,onClick:()=>v(()=>Bm(a),{autoFinish:!1}),children:"Continue with Google"}),Xr.apple&&e.jsx("button",{className:"mb-3 w-full rounded border p-2",disabled:d,onClick:()=>v(()=>Om(a),{autoFinish:!1}),children:"Continue with Apple"}),Xr.email&&e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{className:"mb-2 w-full rounded border p-2",placeholder:"Email",type:"email",autoComplete:"email",value:i,onChange:y=>o(y.target.value),disabled:d}),e.jsx("input",{className:"mb-2 w-full rounded border p-2",placeholder:"Password",type:"password",autoComplete:"current-password",value:c,onChange:y=>h(y.target.value),disabled:d}),e.jsx("button",{className:"w-full rounded border p-2",disabled:d,onClick:()=>v(()=>Hg(i,c)),children:"Continue with Email"})]}),e.jsx(jt,{className:"mb-3 block w-full rounded border p-2 text-center",to:"/demo",onClick:()=>{Pn()},children:"Browse demo"}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m}),e.jsx("p",{className:"mt-4 text-xs text-gray-500",children:"By continuing you agree to our Terms and Privacy Policy."})]})}function rv(t){if(!t)return{};if(typeof t=="string")return{message:t};if(typeof t=="object"){const s=t,n=typeof s.message=="string"?s.message:void 0,r=typeof s.code=="string"?s.code:void 0;if(n||r)return{message:n,code:r}}return{}}function av(){const t=ze(),[s,n]=l.useState("Finishing sign-in…");return l.useEffect(()=>{let r=!0;return(async()=>{if(await Dy(),!r)return;const a=Dm()??"/home";n("Signed in. Redirecting…"),setTimeout(()=>t(a),10)})(),()=>{r=!1}},[t]),e.jsxs("div",{className:"mx-auto max-w-sm p-6",children:[e.jsx("h1",{className:"text-base font-semibold",children:"MyBodyScan"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:s}),e.jsx("div",{className:"mt-3 h-2 w-1/2 bg-black/10 animate-pulse"})]})}function iv(){const t=ze();return l.useEffect(()=>{t("/scan",{replace:!0})},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Body Scan",description:"Redirecting to the Live Body Scan."}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Body Scan"}),e.jsx("p",{className:"text-muted-foreground",children:"Redirecting to the updated scanning workflow…"})]})}const _h="mbs_profile_state";function Ph(){return typeof window<"u"&&typeof window.localStorage<"u"}function dl(){if(!Ph())return{};try{const t=window.localStorage.getItem(_h);if(!t)return{};const s=JSON.parse(t);return s&&typeof s=="object"?s:{}}catch{return{}}}function ov(t){if(Ph())try{window.localStorage.setItem(_h,JSON.stringify(t))}catch{}}function lv(t){return!Number.isFinite(t)||t<=0?null:Math.round(t*10)/10}function Ah(t,s){if(t==null)return;const n=lv(t);if(n==null)return;const r={...dl(),[s]:n};ov(r)}function Ih(){const{lastWeightLb:t}=dl();return typeof t=="number"&&Number.isFinite(t)?t:null}function cv(){const{lastGoalWeightLb:t}=dl();return typeof t=="number"&&Number.isFinite(t)?t:null}function dv(t){Ah(t,"lastWeightLb")}function uv(t){Ah(t,"lastGoalWeightLb")}const mv={4:["Front","Back","Left","Right"]};function Th(){return{mode:"4",files:{},weights:{currentWeightKg:null,goalWeightKg:null},session:null}}let Ss=Th();const go=new Set;function hv(){for(const t of go)t()}function yr(t){Ss!==t&&(Ss=t,hv())}function fv(t,s){const n={...Ss.files};s?n[t]=s:delete n[t],yr({...Ss,files:n})}function Rh(){Object.keys(Ss.files).length&&yr({...Ss,files:{}})}function Vc(t){yr({...Ss,weights:{currentWeightKg:t.currentWeightKg,goalWeightKg:t.goalWeightKg},session:null})}function Qn(t){yr({...Ss,session:t})}function Mh(t){const s=Th(),n=s.weights;yr({...s,weights:n})}function pv(t){return go.add(t),()=>{go.delete(t)}}function Kc(){return Ss}function gv(){return l.useSyncExternalStore(pv,Kc,Kc)}function Gc(t){return Number.isInteger(t)?t.toFixed(0):t.toFixed(1)}function xv(){const t=ze(),n=l.useRef(Ih()).current,a=l.useRef(cv()).current,[i,o]=l.useState(n),[c,h]=l.useState(a),[m,u]=l.useState(n==null?"input":"confirm"),{units:d}=Os(),[f,p]=l.useState(()=>n==null?"":(d==="metric"?gt(n):n).toString()),[x,g]=l.useState(()=>a==null?"":(d==="metric"?gt(a):a).toString()),[v,j]=l.useState(null),y=ft(),{user:N}=He(),b=y&&!N,{health:w}=ns(),{scanConfigured:I}=ss(w??void 0),F=!I||(w==null?void 0:w.scanConfigured)===!1||(w==null?void 0:w.openaiConfigured)===!1||(w==null?void 0:w.openaiKeyPresent)===!1,E=F?(w==null?void 0:w.openaiConfigured)===!1||(w==null?void 0:w.openaiKeyPresent)===!1?"Scans require the OpenAI key (OPENAI_API_KEY) to be set on Cloud Functions.":"Scanning endpoints are offline until the Cloud Functions base URL is configured.":null;l.useEffect(()=>{Mh()},[]);const P=()=>{if(b){_t();return}if(F){j("Scans are offline for maintenance. Please try again later.");return}t("/scan/capture")},k=()=>{if(i==null||c==null){j("Update your current and goal weight before continuing.");return}const X=gt(i),ce=gt(c);Vc({currentWeightKg:X,goalWeightKg:ce}),P()},C=X=>{if(X==null||X.preventDefault(),j(null),b){_t();return}const ce=Number(f.trim());if(!Number.isFinite(ce)||ce<=0){j(`Enter a valid current weight in ${d==="metric"?"kilograms":"pounds"}.`);return}const re=Number(x.trim());if(!Number.isFinite(re)||re<=0){j(`Enter a valid goal weight in ${d==="metric"?"kilograms":"pounds"}.`);return}const ge=d==="metric"?Pt(ce):ce,z=d==="metric"?Pt(re):re;dv(ge),uv(z);const fe=Math.round(ge*10)/10,pe=Math.round(z*10)/10;o(fe),h(pe),u("confirm");const Ee=d==="metric"?ce:gt(ce),Ie=d==="metric"?re:gt(re);if(Rh(),Qn(null),Vc({currentWeightKg:Ee,goalWeightKg:Ie}),F){j("Scan services are unavailable right now. Please try again later.");return}P()},T=m==="input",L=i!=null?Gc(d==="metric"?gt(i):i):null,M=c!=null?Gc(d==="metric"?gt(c):c):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Start Scan – MyBodyScan",description:"Begin your next body scan."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Start a Scan"}),e.jsx("p",{className:"text-muted-foreground",children:"Get set to capture four clear progress photos."})]}),E?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Scan unavailable"}),e.jsx(st,{children:E})]}):null,T?e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(je,{htmlFor:"current-weight",children:["Current weight (",d==="metric"?"kg":"lb",")"]}),e.jsx(We,{id:"current-weight",type:"number",inputMode:"decimal",step:"0.1",min:"1",required:!0,value:f,onChange:X=>p(X.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(je,{htmlFor:"goal-weight",children:["Goal weight (",d==="metric"?"kg":"lb",")"]}),e.jsx(We,{id:"goal-weight",type:"number",inputMode:"decimal",step:"0.1",min:"1",required:!0,value:x,onChange:X=>g(X.target.value)})]})]}),v?e.jsx("p",{className:"text-sm text-destructive",children:v}):null,b?e.jsxs(ma,{children:[e.jsx(ha,{asChild:!0,children:e.jsx("span",{onClick:()=>_t(),children:e.jsx(_,{type:"button",size:"lg",disabled:!0,className:"pointer-events-none",children:"Save and continue"})})}),e.jsx(sr,{children:"Sign up to save progress"})]}):e.jsx(_,{type:"submit",size:"lg",disabled:F,children:"Save and continue"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-lg font-medium",children:["Is your current weight still ",L," ",d==="metric"?"kg":"lb","?"]}),M?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Goal weight: ",M," ",d==="metric"?"kg":"lb"]}):null]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[b?e.jsxs(ma,{children:[e.jsx(ha,{asChild:!0,children:e.jsx("span",{onClick:()=>_t(),children:e.jsx(_,{size:"lg",disabled:!0,className:"pointer-events-none",children:"Yes"})})}),e.jsx(sr,{children:"Sign up to save progress"})]}):e.jsx(_,{size:"lg",onClick:k,disabled:F,children:"Yes"}),e.jsx(_,{type:"button",size:"lg",variant:"outline",onClick:()=>{u("input"),p(i!=null?(d==="metric"?gt(i):i).toString():""),g(c!=null?(d==="metric"?gt(c):c).toString():""),j(null)},children:"Update"})]})]})]})}const Jn=["front","back","left","right"],Hc={front:"Front",back:"Back",left:"Left",right:"Right"};function yv({onReady:t}){const[s,n]=l.useState({}),[r,a]=l.useState(null),[i,o]=l.useState(!1),[c,h]=l.useState(null),m=l.useRef(s),u=l.useRef(null),d=l.useRef(null);function f(j,y){var b;a(j),h(null),(b=(y==="camera"?u:d).current)==null||b.click()}async function p(j){var N;const y=(N=j.target.files)==null?void 0:N[0];if(j.currentTarget.value="",!(!y||!r)){if(!y.type.startsWith("image/")){h("Please choose an image file.");return}o(!0);try{const b=await zb(y,1600,.9),w=URL.createObjectURL(b),I={file:y,blob:b,url:w};n(F=>{const E=F[r];return E!=null&&E.url&&URL.revokeObjectURL(E.url),{...F,[r]:I}}),a(null)}catch(b){h((b==null?void 0:b.message)||"Could not process image.")}finally{o(!1)}}}function x(j){n(y=>{const N={...y},b=N[j];return b!=null&&b.url&&URL.revokeObjectURL(b.url),delete N[j],N})}l.useEffect(()=>{m.current=s},[s]),l.useEffect(()=>()=>{Object.values(m.current).forEach(j=>{j!=null&&j.url&&URL.revokeObjectURL(j.url)})},[]);const g=Jn.every(j=>s[j]);async function v(){g&&t({front:s.front.blob,back:s.back.blob,left:s.left.blob,right:s.right.blob})}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add four photos: Front, Back, Left, Right. Tip: good lighting, full body in frame."}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Jn.map(j=>{const y=s[j];return e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:Hc[j]}),y?e.jsx("button",{onClick:()=>x(j),className:"text-[11px] underline",children:"Remove"}):null]}),e.jsx("div",{className:"aspect-[3/4] overflow-hidden rounded bg-black/5 flex items-center justify-center",children:y?e.jsx("img",{src:y.url,alt:`${Hc[j]} preview`,className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"No photo"})}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",className:"rounded border px-2 py-1 text-xs",onClick:()=>f(j,"camera"),children:"Camera"}),e.jsx("button",{type:"button",className:"rounded border px-2 py-1 text-xs",onClick:()=>f(j,"library"),children:"Photo Library"})]})]},j)})}),c&&e.jsx("p",{role:"alert",className:"text-sm text-red-700",children:c}),i&&e.jsx("p",{role:"status",className:"text-sm text-muted-foreground",children:"Processing image…"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"rounded-md border px-3 py-2 text-sm disabled:opacity-50",disabled:!g||i,onClick:v,"data-testid":"scan-continue",children:i?"Please wait…":"Continue"}),!g&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Add all four photos to continue"})]}),e.jsx("input",{ref:u,type:"file",accept:"image/*",capture:"environment",onChange:p,className:"hidden"}),e.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:p,className:"hidden","data-testid":"library-input"})]})}const Yc={front:"Front",back:"Back",left:"Left",right:"Right"};function bv(t,s){if(t instanceof File)return t;const n=t.type&&t.type.startsWith("image/")?t.type:"image/jpeg",r=n==="image/png"?"png":"jpg",a=Date.now();return new File([t],`scan-${s}-${a}.${r}`,{type:n})}function jv(){const[t,s]=l.useState(null),[n,r]=l.useState(!1),[a,i]=l.useState(null),o=cl(),{health:c}=ns(),{scanConfigured:h}=ss(c??void 0),m=ze(),u=!h||(c==null?void 0:c.scanConfigured)===!1||(c==null?void 0:c.openaiConfigured)===!1||(c==null?void 0:c.openaiKeyPresent)===!1,d=u,f=u?(c==null?void 0:c.openaiConfigured)===!1||(c==null?void 0:c.openaiKeyPresent)===!1?"Scans require the OpenAI key (OPENAI_API_KEY) to be configured before uploads are enabled.":"Scan endpoints are offline until the Cloud Functions base URL is set.":null;function p(g){s(g),i(null),console.log("ScanCapture ready:",g)}const x=()=>{if(t){r(!0),i(null);try{Rh(),Qn(null),Object.keys(Yc).forEach(g=>{const v=Yc[g],j=t[g];if(!j)throw new Error("missing_photo");const y=bv(j,g);fv(v,y)}),m("/scan/result")}catch(g){const v=typeof(g==null?void 0:g.message)=="string"&&g.message!=="missing_photo"?g.message:"Unable to prepare your photos. Please try again.";i(v)}finally{r(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Capture Photos – MyBodyScan",description:"Upload the four required angles for your scan."}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Capture Photos"})}),e.jsxs(Q,{className:"space-y-3",children:[o.status==="checking"?e.jsxs(tt,{className:"border-dashed",children:[e.jsx(rt,{children:"Preparing secure upload…"}),e.jsx(st,{children:"App Check is initializing (optional). You can continue capturing photos while this completes."})]}):null,f?e.jsxs(tt,{variant:"destructive",className:"mb-3",children:[e.jsx(rt,{children:"Scanning service unavailable"}),e.jsx(st,{children:f})]}):null,d?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan capture is disabled until the scan service is configured."}):e.jsx(yv,{onReady:p})]})]}),t?e.jsxs("div",{className:"space-y-3 rounded-lg border border-dashed p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"All poses ready. Continue to upload in the next step."}),a?e.jsx("p",{className:"text-sm text-destructive",children:a}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{type:"button",onClick:x,disabled:n,children:n?"Preparing…":"Continue to preview"}),e.jsx(_,{type:"button",variant:"outline",onClick:()=>{s(null),i(null)},disabled:n,children:"Retake photos"})]})]}):null]})}const _e=["bg-emerald-500","bg-green-500","bg-lime-500","bg-amber-500","bg-orange-500"],wv=[{band:"20-29",minAge:20,maxAge:29,ranges:[{label:"Athletic",min:3,max:11,color:_e[0]},{label:"Lean",min:11,max:17,color:_e[1]},{label:"Average",min:17,max:22,color:_e[2]},{label:"Above Average",min:22,max:27,color:_e[3]},{label:"High",min:27,max:40,color:_e[4]}]},{band:"30-39",minAge:30,maxAge:39,ranges:[{label:"Athletic",min:4,max:12,color:_e[0]},{label:"Lean",min:12,max:18,color:_e[1]},{label:"Average",min:18,max:23,color:_e[2]},{label:"Above Average",min:23,max:28,color:_e[3]},{label:"High",min:28,max:41,color:_e[4]}]},{band:"40-49",minAge:40,maxAge:49,ranges:[{label:"Athletic",min:5,max:13,color:_e[0]},{label:"Lean",min:13,max:19,color:_e[1]},{label:"Average",min:19,max:24,color:_e[2]},{label:"Above Average",min:24,max:29,color:_e[3]},{label:"High",min:29,max:42,color:_e[4]}]},{band:"50-59",minAge:50,maxAge:59,ranges:[{label:"Athletic",min:6,max:14,color:_e[0]},{label:"Lean",min:14,max:20,color:_e[1]},{label:"Average",min:20,max:25,color:_e[2]},{label:"Above Average",min:25,max:30,color:_e[3]},{label:"High",min:30,max:43,color:_e[4]}]},{band:"60+",minAge:60,ranges:[{label:"Athletic",min:7,max:15,color:_e[0]},{label:"Lean",min:15,max:21,color:_e[1]},{label:"Average",min:21,max:26,color:_e[2]},{label:"Above Average",min:26,max:31,color:_e[3]},{label:"High",min:31,max:44,color:_e[4]}]}],vv=[{band:"20-29",minAge:20,maxAge:29,ranges:[{label:"Athletic",min:12,max:22,color:_e[0]},{label:"Lean",min:22,max:28,color:_e[1]},{label:"Average",min:28,max:34,color:_e[2]},{label:"Above Average",min:34,max:40,color:_e[3]},{label:"High",min:40,max:52,color:_e[4]}]},{band:"30-39",minAge:30,maxAge:39,ranges:[{label:"Athletic",min:13,max:23,color:_e[0]},{label:"Lean",min:23,max:29,color:_e[1]},{label:"Average",min:29,max:35,color:_e[2]},{label:"Above Average",min:35,max:41,color:_e[3]},{label:"High",min:41,max:53,color:_e[4]}]},{band:"40-49",minAge:40,maxAge:49,ranges:[{label:"Athletic",min:14,max:24,color:_e[0]},{label:"Lean",min:24,max:30,color:_e[1]},{label:"Average",min:30,max:36,color:_e[2]},{label:"Above Average",min:36,max:42,color:_e[3]},{label:"High",min:42,max:54,color:_e[4]}]},{band:"50-59",minAge:50,maxAge:59,ranges:[{label:"Athletic",min:15,max:25,color:_e[0]},{label:"Lean",min:25,max:31,color:_e[1]},{label:"Average",min:31,max:37,color:_e[2]},{label:"Above Average",min:37,max:43,color:_e[3]},{label:"High",min:43,max:55,color:_e[4]}]},{band:"60+",minAge:60,ranges:[{label:"Athletic",min:16,max:26,color:_e[0]},{label:"Lean",min:26,max:32,color:_e[1]},{label:"Average",min:32,max:38,color:_e[2]},{label:"Above Average",min:38,max:44,color:_e[3]},{label:"High",min:44,max:56,color:_e[4]}]}],Nv={male:wv,female:vv};function Sv(t){return(t??"").toLowerCase()==="female"?"female":"male"}function kv(t,s){for(const n of t)if(!(s<n.minAge)&&(n.maxAge==null||s<=n.maxAge))return n;return t[t.length-1]}function Dh(t,s){if(!Number.isFinite(s))return[];const n=Sv(t),r=Nv[n],a=kv(r,s);return a.ranges.map(i=>({band:a.band,label:i.label,min:i.min,max:i.max,color:i.color}))}function Fh(t,s){if(!Number.isFinite(s))return null;const n=t.length-1;for(let r=0;r<t.length;r+=1){const a=t[r];if(!(s<a.min)&&(r===n||s<t[r+1].min||s<=a.max))return a}return null}const ul=l.forwardRef(({className:t,...s},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:ae("w-full caption-bottom text-sm",t),...s})}));ul.displayName="Table";const ml=l.forwardRef(({className:t,...s},n)=>e.jsx("thead",{ref:n,className:ae("[&_tr]:border-b",t),...s}));ml.displayName="TableHeader";const hl=l.forwardRef(({className:t,...s},n)=>e.jsx("tbody",{ref:n,className:ae("[&_tr:last-child]:border-0",t),...s}));hl.displayName="TableBody";const Ev=l.forwardRef(({className:t,...s},n)=>e.jsx("tfoot",{ref:n,className:ae("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));Ev.displayName="TableFooter";const lr=l.forwardRef(({className:t,...s},n)=>e.jsx("tr",{ref:n,className:ae("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));lr.displayName="TableRow";const cr=l.forwardRef(({className:t,...s},n)=>e.jsx("th",{ref:n,className:ae("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));cr.displayName="TableHead";const dr=l.forwardRef(({className:t,...s},n)=>e.jsx("td",{ref:n,className:ae("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));dr.displayName="TableCell";const Lh=l.forwardRef(({className:t,...s},n)=>e.jsx("caption",{ref:n,className:ae("mt-4 text-sm text-muted-foreground",t),...s}));Lh.displayName="TableCaption";function Cv({sex:t,age:s,bfPct:n}){const[r,a]=l.useState(!1),i=l.useMemo(()=>{if(!t||s==null)return[];const d=Number(s);return Number.isFinite(d)?Dh(String(t),d):[]},[s,t]),o=i.length?i[0].min:0,c=i.length?Math.max(...i.map(d=>d.max)):1,h=c>o?c:o+1,m=l.useMemo(()=>{if(!Number.isFinite(n??NaN))return null;const d=Math.min(Math.max(n,o),h),f=h-o;return f<=0?0:(d-o)/f*100},[n,o,h]),u=l.useMemo(()=>Number.isFinite(n??NaN)?Fh(i,n):null,[n,i]);return i.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative flex h-10 w-full flex-col items-stretch gap-1",children:[e.jsxs("div",{className:"relative h-8 w-full overflow-hidden rounded-md border bg-muted/40",children:[e.jsx("div",{className:"flex h-full w-full",children:i.map(d=>{const f=d.max-d.min,p=h-o>0?f/(h-o)*100:0;return e.jsx("div",{className:ae("flex items-center justify-center px-1 text-[10px] font-medium uppercase tracking-wide text-white",d.color),style:{width:`${p}%`},children:e.jsx("span",{className:"drop-shadow-sm",children:d.label})},`${d.band}-${d.label}`)})}),m!=null?e.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-y-1 flex flex-col items-center",style:{left:`calc(${m}% - 1px)`},children:[e.jsx("div",{className:"h-5 w-0.5 rounded-full bg-background"}),e.jsxs("div",{className:"mt-0.5 rounded-full bg-background px-1 text-[10px] font-semibold text-foreground",children:[Number(n).toFixed(1),"%"]})]}):null]}),u?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["Current range: ",u.label]}):null]}),e.jsx("button",{type:"button",onClick:()=>a(d=>!d),className:"w-fit text-sm font-medium text-primary underline-offset-4 hover:underline",children:r?"Hide full reference chart":"See full reference chart"})]}),r?e.jsxs(ul,{children:[e.jsx(ml,{children:e.jsxs(lr,{children:[e.jsx(cr,{className:"w-1/3",children:"Range"}),e.jsx(cr,{children:"Body fat %"})]})}),e.jsx(hl,{children:i.map(d=>e.jsxs(lr,{children:[e.jsx(dr,{className:"font-medium",children:d.label}),e.jsx(dr,{children:_v(d.min,d.max)})]},`${d.band}-${d.label}-row`))}),e.jsx(Lh,{children:"Reference ranges"})]}):null]}):null}function _v(t,s){const n=Math.round(t),r=Math.round(s);return n>=r?`${n}%`:`${n}–${r}%`}const Pv=Math.log(10);function ba(t){return Math.log(t)/Pv}function br(t,s,n){return Number.isFinite(t)?Math.min(Math.max(t,s),n):s}function jr(t){return Number(t.toFixed(1))}function Av({waistIn:t,neckIn:s,heightIn:n}){if(!t||!s||!n||t<=s)return NaN;const r=86.01*ba(t-s)-70.041*ba(n)+36.76;return br(jr(r),3,65)}function Iv({waistIn:t,neckIn:s,hipIn:n,heightIn:r}){if(!t||!s||!n||!r||t+n<=s)return NaN;const a=163.205*ba(t+n-s)-97.684*ba(r)-78.387;return br(jr(a),5,65)}function Tv({weightLb:t,heightIn:s,age:n,sex:r}){if(!t||!s||!n||!Number.isFinite(n))return NaN;const a=t/(s*s)*703;if(!Number.isFinite(a)||a<=0)return NaN;const i=r==="male"?1:0,o=1.2*a+.23*n-10.8*i-5.4;return br(jr(o),3,65)}function Rv({hipIn:t,heightIn:s}){if(!t||!s)return NaN;const n=t*2.54,r=s*.0254;if(r<=0)return NaN;const a=n/Math.pow(r,1.5)-18;return br(jr(a),3,65)}function Mv({waistIn:t,heightIn:s,sex:n}){if(!t||!s)return NaN;const r=t/s;if(!Number.isFinite(r)||r<=0)return NaN;const a=n==="female"?6:2.2,i=r*100*1.1+a;return br(jr(i),5,60)}function Dv(t){return!Number.isFinite(t??NaN)||t<0?0:t>1?1:t}function xo(t){if(Number.isFinite(t??NaN)&&!(!t||t<=0))return t}function pi(t,s){if(!(!Number.isFinite(t??NaN)||!Number.isFinite(s??NaN))&&!(!t||t<=0||!s||s<=0))return t*s}function gi(t,s){const n=xo(t);if(n!=null)return{value:n,source:"manual"};const r=xo(s);return r!=null?{value:r,source:"photo"}:{value:void 0,source:null}}function xi(t,s){return t==="manual"?1:t==="photo"?.4+.6*s:0}function Fv(t){return t.length?t.reduce((n,r)=>n+r,0)/t.length:0}function Lv(t){var i;const s=t.filter(o=>Number.isFinite(o.value)&&o.weight>0).sort((o,c)=>o.value-c.value);if(!s.length)return NaN;const n=s.reduce((o,c)=>o+c.weight,0);if(n<=0)return NaN;let r=0;const a=n/2;for(const o of s)if(r+=o.weight,r>=a)return o.value;return((i=s[s.length-1])==null?void 0:i.value)??NaN}function Bv(t){const{sex:s,age:n,heightIn:r,weightLb:a,photoFeatures:i,manualCircumferences:o}=t,c=Dv((i==null?void 0:i.poseScore)??0),h=i==null?void 0:i.averages,m=xo(h==null?void 0:h.heightPixels),u=m?r/m:void 0,d=pi(h==null?void 0:h.neckWidth,u),f=pi(h==null?void 0:h.waistWidth,u),p=pi(h==null?void 0:h.hipWidth,u),x=gi((o==null?void 0:o.neckIn)??void 0,d),g=gi((o==null?void 0:o.waistIn)??void 0,f),v=gi((o==null?void 0:o.hipIn)??void 0,p),j=[x.source,g.source,v.source],y=j.filter(z=>z==="manual").length,N=j.filter(z=>z==="photo").length,b=y+N,w=s==="female"?Iv({waistIn:g.value,neckIn:x.value,hipIn:v.value,heightIn:r}):Av({waistIn:g.value,neckIn:x.value,heightIn:r}),F=Fv((s==="female"?[g,x,v]:[g,x]).map(z=>xi(z.source,c))),E=Rv({hipIn:v.value,heightIn:r}),P=xi(v.source,c),k=Mv({waistIn:g.value,heightIn:r,sex:s}),C=xi(g.source,c),T=a?Number((a/(r*r)*703).toFixed(1)):NaN,L=Tv({weightLb:a,heightIn:r,age:n,sex:s}),M=a?.6:0,X=b>=2?.3:b===1?.15:0,ce=M+X,re=Lv([{value:w,weight:F},{value:L,weight:ce},{value:E,weight:P},{value:k,weight:C}]);return{bodyFatPct:Number.isFinite(re)?Number(re.toFixed(1)):NaN,bmi:Number.isFinite(T)?T:NaN,usedWeight:a?Number(a.toFixed(1)):null}}function On(t){if(t.length===0)return 0;const s=t.reduce((n,r)=>n+r,0);return Math.round(s/t.length*1e4)/1e4}function Ov(t){return t.filter(s=>s[1]!==void 0)}function Uv(t,s,n,r,a){const i=Ov([["front",t],["side",s],["left",n],["right",r],["back",a]]),o=i.length?On(i.map(([,p])=>p.quality.poseScore)):0,c=i.map(([,p])=>p.waistWidth),h=i.map(([,p])=>p.hipWidth),m=i.map(([,p])=>p.neckWidth),u=i.map(([,p])=>p.heightPixels),d=i.length?{waistWidth:On(c),hipWidth:On(h),neckWidth:On(m),heightPixels:On(u)}:null,f={};for(const[p,x]of i)f[p]=x;return{poseScore:o,views:f,averages:d}}const ln=512;async function $v(t){var r;if(typeof createImageBitmap=="function")try{const a=await createImageBitmap(t),i={width:a.width||ln,height:a.height||ln};return(r=a.close)==null||r.call(a),i}catch{}if(typeof Image<"u"&&typeof URL<"u"&&typeof URL.createObjectURL=="function")try{const a=URL.createObjectURL(t),i=await new Promise((o,c)=>{const h=new Image;h.onload=()=>{o({width:h.naturalWidth||h.width||ln,height:h.naturalHeight||h.height||ln})},h.onerror=m=>c(m),h.src=a});return URL.revokeObjectURL(a),i}catch{}const s=t.size||ln*ln,n=Math.max(1,Math.round(Math.sqrt(s)));return{width:n,height:n}}function Wv(t){return Number.isNaN(t)||!Number.isFinite(t)||t<0?0:t>1?1:t}function cn(t,s=4){const n=10**s;return Math.round(t*n)/n}async function qv(t,s){const{width:n,height:r}=await $v(t),a=r===0?1:n/r,i=Wv(1-Math.abs(a-.6)),o=cn(n*.45,2),c=cn(n*.55,2),h=cn(n*.22,2),m=cn(r*.95,2),u=cn(.5+i*.4),d=cn(.55+i*.35),f=i>.25;return{view:s,imageWidth:n,imageHeight:r,waistWidth:o,hipWidth:c,neckWidth:h,heightPixels:m,quality:{view:s,isBlurry:!1,isOccluded:!1,isCentered:f,lightingScore:u,poseScore:d}}}const zv={neck:"",waist:"",hip:""};let Nn={manualInputs:{...zv},photoCircumferences:null};const yo=new Set;function Vv(){for(const t of yo)t()}function Bh(t){Nn!==t&&(Nn=t,Vv())}function Kv(t){return yo.add(t),()=>{yo.delete(t)}}function Qc(){return Nn}function Oh(){return l.useSyncExternalStore(Kv,Qc,Qc)}function Xn(t){return Math.round(t*10)/10}function yi(t){if(Number.isFinite(t??NaN)&&!(!t||t<=0))return Xn(t)}function Gv(t,s){if(!s)return t;const n={...t};return!n.neck&&s.neckIn!=null&&(n.neck=Xn(s.neckIn).toString()),!n.waist&&s.waistIn!=null&&(n.waist=Xn(s.waistIn).toString()),!n.hip&&s.hipIn!=null&&(n.hip=Xn(s.hipIn).toString()),n}function bi(t){const s=t?{neckIn:yi(t.neckIn),waistIn:yi(t.waistIn),hipIn:yi(t.hipIn)}:null;Bh({manualInputs:Gv(Nn.manualInputs,s),photoCircumferences:s})}function aa(t,s){const n={...Nn.manualInputs,[t]:s};Bh({manualInputs:n,photoCircumferences:Nn.photoCircumferences})}function Hv(t,s){const n=s.trim();if(!n){aa(t,"");return}const r=Number(n);if(!Number.isFinite(r)||r<=0){aa(t,"");return}const a=Xn(r);aa(t,a.toString())}const Yv=[{key:"neck",label:"Neck",id:"refine-neck"},{key:"waist",label:"Waist",id:"refine-waist"},{key:"hip",label:"Hip",id:"refine-hip"}];function Uh({onSubmit:t,footer:s}){const{manualInputs:n}=Oh(),{units:r}=Os(),a=r==="metric"?"cm":"in",i=o=>{o.preventDefault(),t==null||t()};return e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[Yv.map(({key:o,label:c,id:h,help:m})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(je,{htmlFor:h,children:`${c} (${a})`}),m?e.jsx("span",{className:"text-xs text-muted-foreground",children:m}):null]}),e.jsx(We,{id:h,type:"number",inputMode:"decimal",min:"0",step:"0.1",value:n[o],onChange:u=>aa(o,u.target.value),onBlur:u=>Hv(o,u.target.value)})]},o)),s??null]})}function Qv(){const t=ze();return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Refine Estimate – MyBodyScan",description:"Fine-tune your scan results with manual inputs."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Refine measurements"}),e.jsx("p",{className:"text-muted-foreground",children:"Adjust the estimate with quick manual measurements."})]}),e.jsx(Uh,{onSubmit:()=>t("/scan/result"),footer:e.jsxs("div",{className:"flex flex-col-reverse items-stretch justify-end gap-2 sm:flex-row",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>t(-1),children:"Cancel"}),e.jsx(_,{type:"submit",children:"Save and return"})]})})]})}function Jc(t){if(!Number.isFinite(t??NaN))return 0;const s=t;return s<=0?0:Math.min(100,Math.max(1,Math.round(s*100)))}function Jv(t){if(!Number.isFinite(t??NaN))return 0;const s=Math.min(1,Math.max(0,t));return s<=0?0:Math.min(100,Math.max(1,s*100))}const Xc={Front:"front",Side:"side",Back:"back",Left:"left",Right:"right"},Zc={Front:"front",Back:"back",Left:"left",Right:"right"};function ji(t){return Number.isFinite(t??NaN)?t.toFixed(1):null}function Wr(t){const s=typeof t=="number"?t:0;if(!Number.isFinite(s)||s<=0)return"0 B";const n=["B","KB","MB","GB"],r=Math.min(n.length-1,Math.floor(Math.log(s)/Math.log(1024))),a=s/Math.pow(1024,r);return`${a.toFixed(a>=10||r===0?0:1)} ${n[r]}`}function ed(t){return"sdk"}async function Xv(t,s=128){return new Promise(n=>{const r=new FileReader;r.onerror=()=>n(null),r.onload=()=>{const a=new Image;a.onerror=()=>n(null),a.onload=()=>{const i=Math.min(s/a.width,s/a.height,1),o=Math.max(1,Math.round(a.width*i)),c=Math.max(1,Math.round(a.height*i)),h=document.createElement("canvas");h.width=o,h.height=c;const m=h.getContext("2d");if(!m){n(null);return}m.drawImage(a,0,0,o,c),n(h.toDataURL("image/jpeg",.6))},a.src=r.result},r.readAsDataURL(t)})}function wi(t,s){if(!(!Number.isFinite(t??NaN)||!Number.isFinite(s??NaN))&&!(!t||t<=0||!s||s<=0))return t*s}function vi(t,s){const n=t.trim();if(!n)return;const r=Number(n);if(!(!Number.isFinite(r)||r<=0))return s==="metric"?r/el:r}function Zv(){var Ml;const{user:t,authReady:s,loading:n}=He(),{mode:r,files:a,weights:i,session:o}=gv(),c=i.currentWeightKg,h=i.goalWeightKg,{profile:m}=Zs(),u=typeof(m==null?void 0:m.heightCm)=="number"&&Number.isFinite(m.heightCm)?m.heightCm:typeof(m==null?void 0:m.height_cm)=="number"&&Number.isFinite(m.height_cm)?m.height_cm:void 0,[d,f]=l.useState(!1),{manualInputs:p,photoCircumferences:x}=Oh(),[g,v]=l.useState(null),[j,y]=l.useState(!1),[N,b]=l.useState(null),[w]=l.useState(()=>Ih()),[I,F]=l.useState(null),[E,P]=l.useState("idle"),[k,C]=l.useState(null),[T,L]=l.useState(0),[M,X]=l.useState(null),[ce,re]=l.useState(!1),[ge,z]=l.useState(null),fe=ze(),pe=Qt(),Ee=l.useMemo(()=>{try{return new URLSearchParams(pe.search).get("debug")==="1"}catch{return!1}},[pe.search]),[Ie,be]=l.useState(()=>{try{return typeof navigator<"u"&&navigator.onLine===!1}catch{return!1}});l.useEffect(()=>{const D=()=>be(!0),ue=()=>be(!1);return window.addEventListener("offline",D),window.addEventListener("online",ue),()=>{window.removeEventListener("offline",D),window.removeEventListener("online",ue)}},[]);const me=l.useMemo(()=>Object.values(Ne).some(D=>D.status==="retrying"&&typeof D.nextRetryAt=="number"),[Ne]),[xe,S]=l.useState(()=>Date.now());l.useEffect(()=>{if(!me)return;const D=window.setInterval(()=>S(Date.now()),250);return()=>window.clearInterval(D)},[me]);const K=l.useRef(null),A=l.useRef(0),O=l.useRef(0),J=cl(),{units:G}=Os(),{health:$}=ns(),{scanConfigured:R}=ss($??void 0),W=!R||($==null?void 0:$.scanConfigured)===!1||($==null?void 0:$.openaiConfigured)===!1||($==null?void 0:$.openaiKeyPresent)===!1,ie=W?($==null?void 0:$.openaiConfigured)===!1||($==null?void 0:$.openaiKeyPresent)===!1?"Scans require the OpenAI key (OPENAI_API_KEY) to be configured before results can be finalized.":"Scan services are offline until the Cloud Functions base URL is configured.":null,le=l.useMemo(()=>mv[r],[r]),q=l.useMemo(()=>le.filter(D=>!!a[D]),[le,a]),ee=q.length===le.length,H=l.useMemo(()=>{const D={};for(const[ue,Te]of Object.entries(a)){const $e=Zc[ue];$e&&Te&&(D[$e]=Te)}return D},[a]),ye=Jn.every(D=>!!H[D]),[Ne,Re]=l.useState({front:{status:"preparing",percent:0,attempt:0},back:{status:"preparing",percent:0,attempt:0},left:{status:"preparing",percent:0,attempt:0},right:{status:"preparing",percent:0,attempt:0}}),Qe=l.useMemo(()=>Object.entries(Ne).filter(([,ue])=>ue.status==="failed").map(([ue])=>ue),[Ne]),nt=!!(o!=null&&o.scanId)&&Qe.length>0,[ke,At]=l.useState({front:{},back:{},left:{},right:{}}),[Fe,Ve]=l.useState(null),wt=l.useMemo(()=>le.map(D=>{const ue=a[D];return ue?{key:Xc[D],file:ue}:null}).filter(D=>!!D),[le,a]);l.useEffect(()=>{let D=!1;if(!wt.length||!ee){v(null),b(null),y(!1);return}return y(!0),b(null),(async()=>{try{const ue=await Promise.all(wt.map(async({key:Pe,file:Z})=>({key:Pe,data:await qv(Z,Pe)})));if(D)return;const Te={};for(const Pe of ue)Te[Pe.key]=Pe.data;const $e=Uv(Te.front,Te.side,Te.left,Te.right,Te.back);v($e),y(!1)}catch(ue){if(console.error("analyzePhoto",ue),D)return;b("Could not analyze photos."),v(null),y(!1)}})(),()=>{D=!0}},[wt,ee]);const qe=ye&&c!=null&&h!=null&&!W,It=ye?c==null||h==null?"Return to Start to confirm your current and goal weight.":W?"Scan services are offline until the backend is configured.":"We'll upload your photos securely and notify you when the result is ready.":"Capture all four required angles before continuing.",rs=!qe||E==="starting"||E==="uploading"||E==="queued"||E==="processing",te=async()=>{var $e;if(!ye||c==null||h==null){C("Add all photos and confirm your weights before continuing.");return}if(!Number.isFinite(c)||!Number.isFinite(h)){C("Please confirm valid weights before finalizing.");return}if(W){C("Scan services are offline. Try again later.");return}if(!t){P("error"),C("You must be signed in to upload scans.");return}P("starting"),C(null),L(0),X(null),re(!1),Ve(null),O.current=0,Re({front:{status:"preparing",percent:0,attempt:0},back:{status:"preparing",percent:0,attempt:0},left:{status:"preparing",percent:0,attempt:0},right:{status:"preparing",percent:0,attempt:0}});let D=o;const ue=(D==null?void 0:D.correlationId)??ah();let Te=(D==null?void 0:D.scanId)??null;try{if(!D){const B=await ej({currentWeightKg:c,goalWeightKg:h,heightCm:u,correlationId:ue});if(!B.ok){const Vt=B.error.debugId?` (ref ${B.error.debugId.slice(0,8)})`:"";throw new Error(B.error.message+Vt)}const Ae={front:bt(t.uid,B.data.scanId,"front"),back:bt(t.uid,B.data.scanId,"back"),left:bt(t.uid,B.data.scanId,"left"),right:bt(t.uid,B.data.scanId,"right")};Qn({...B.data,storagePaths:Ae,correlationId:ue}),D={...B.data,storagePaths:Ae,correlationId:ue}}if(D&&!D.correlationId&&(D={...D,correlationId:ue},Qn(D)),!D)throw new Error("Unable to start scan session.");Te=D.scanId;const Pe={front:H.front,back:H.back,left:H.left,right:H.right};P("uploading"),($e=K.current)==null||$e.abort();const Z=new AbortController;K.current=Z;const se={front:bt(t.uid,D.scanId,"front"),back:bt(t.uid,D.scanId,"back"),left:bt(t.uid,D.scanId,"left"),right:bt(t.uid,D.scanId,"right")},it=await si({scanId:D.scanId,storagePaths:se,photos:Pe,currentWeightKg:c,goalWeightKg:h,heightCm:u,scanCorrelationId:D.correlationId},{onUploadProgress:B=>{L(B.overallPercent),X(B.pose),B.hasBytesTransferred&&re(!0)},onPhotoState:B=>{Re(Ae=>{const Vt={...Ae},Be=Vt[B.pose];return Vt[B.pose]={status:B.status,attempt:B.attempt??(Be==null?void 0:Be.attempt)??0,percent:typeof B.percent=="number"?B.percent:(Be==null?void 0:Be.percent)??0,message:B.message??(Be==null?void 0:Be.message),nextRetryAt:typeof(B==null?void 0:B.nextRetryAt)=="number"?B.nextRetryAt:Be==null?void 0:Be.nextRetryAt,nextRetryDelayMs:typeof(B==null?void 0:B.nextRetryDelayMs)=="number"?B.nextRetryDelayMs:Be==null?void 0:Be.nextRetryDelayMs,offline:typeof(B==null?void 0:B.offline)=="boolean"?B.offline:Be==null?void 0:Be.offline,uploadMethod:(B==null?void 0:B.uploadMethod)??(Be==null?void 0:Be.uploadMethod)},Vt}),At(Ae=>{const Vt={...Ae},Be=Vt[B.pose]??{};return Vt[B.pose]={...Be,compressed:(B==null?void 0:B.compressed)??Be.compressed,preprocessDebug:(B==null?void 0:B.preprocessDebug)??Be.preprocessDebug,lastBytesTransferred:typeof(B==null?void 0:B.bytesTransferred)=="number"?B.bytesTransferred:Be.lastBytesTransferred,lastTotalBytes:typeof(B==null?void 0:B.totalBytes)=="number"?B.totalBytes:Be.lastTotalBytes,lastFirebaseError:(B==null?void 0:B.lastFirebaseError)??Be.lastFirebaseError,lastTaskState:(B==null?void 0:B.taskState)??Be.lastTaskState,lastProgressAt:typeof(B==null?void 0:B.lastProgressAt)=="number"?B.lastProgressAt:Be.lastProgressAt,fullPath:(B==null?void 0:B.fullPath)??Be.fullPath,bucket:(B==null?void 0:B.bucket)??Be.bucket,pathMismatch:(B==null?void 0:B.pathMismatch)??Be.pathMismatch,uploadMethod:(B==null?void 0:B.uploadMethod)??Be.uploadMethod,correlationId:(B==null?void 0:B.correlationId)??Be.correlationId,elapsedMs:typeof(B==null?void 0:B.elapsedMs)=="number"?B.elapsedMs:Be.elapsedMs,lastUploadError:(B==null?void 0:B.lastUploadError)??Be.lastUploadError,lastError:B.status==="failed"?{code:void 0,message:B.message}:Be.lastError},Vt})},signal:Z.signal,stallTimeoutMs:15e3});if(K.current=null,!it.ok){const B=it.error.debugId?` (ref ${it.error.debugId.slice(0,8)})`:"";throw Ve({code:it.error.code,message:it.error.message+B,pose:it.error.pose??void 0}),new Error(it.error.message+B)}P("queued"),X(null),re(!1),z(D.scanId),V({title:"Scan uploaded",description:"We’re queued for processing. This can take a couple of minutes."}),Mh(),fe(`/scan/${D.scanId}`)}catch(Pe){P("error"),L(0),X(null),re(!1);const Z=typeof(Pe==null?void 0:Pe.message)=="string"&&Pe.message.length?Pe.message:"Unable to submit your scan. Please try again.";C(Z),Ve({code:Pe==null?void 0:Pe.code,message:Z,pose:(Pe==null?void 0:Pe.pose)??void 0}),z(null),V({title:"Unable to submit scan",description:Z,variant:"destructive"})}},Me=l.useCallback(async()=>{var ue;(ue=K.current)==null||ue.abort();const D=(o==null?void 0:o.scanId)??null;D&&await ih(D).catch(()=>{}),Qn(null),P("idle"),C(null),L(0),X(null),re(!1),z(null),Ve(null),O.current=0},[o==null?void 0:o.scanId]),Ze=l.useCallback(async()=>{var Pe;if(!(o!=null&&o.scanId)||!nt||!ye||c==null||h==null||!t)return;P("uploading"),C(null),Ve(null),(Pe=K.current)==null||Pe.abort();const D=new AbortController;K.current=D;const ue={front:H.front,back:H.back,left:H.left,right:H.right},Te={front:bt(t.uid,o.scanId,"front"),back:bt(t.uid,o.scanId,"back"),left:bt(t.uid,o.scanId,"left"),right:bt(t.uid,o.scanId,"right")},$e=await si({scanId:o.scanId,storagePaths:Te,photos:ue,currentWeightKg:c,goalWeightKg:h,heightCm:u,scanCorrelationId:o.correlationId},{posesToUpload:Qe,onUploadProgress:Z=>{L(Z.overallPercent),X(Z.pose),Z.hasBytesTransferred&&re(!0)},onPhotoState:Z=>{Re(se=>{const it={...se},B=it[Z.pose];return it[Z.pose]={status:Z.status,attempt:Z.attempt??(B==null?void 0:B.attempt)??0,percent:typeof Z.percent=="number"?Z.percent:(B==null?void 0:B.percent)??0,message:Z.message??(B==null?void 0:B.message),nextRetryAt:typeof(Z==null?void 0:Z.nextRetryAt)=="number"?Z.nextRetryAt:B==null?void 0:B.nextRetryAt,nextRetryDelayMs:typeof(Z==null?void 0:Z.nextRetryDelayMs)=="number"?Z.nextRetryDelayMs:B==null?void 0:B.nextRetryDelayMs,offline:typeof(Z==null?void 0:Z.offline)=="boolean"?Z.offline:B==null?void 0:B.offline,uploadMethod:(Z==null?void 0:Z.uploadMethod)??(B==null?void 0:B.uploadMethod)},it}),At(se=>{const it={...se},B=it[Z.pose]??{};return it[Z.pose]={...B,compressed:(Z==null?void 0:Z.compressed)??B.compressed,preprocessDebug:(Z==null?void 0:Z.preprocessDebug)??B.preprocessDebug,lastBytesTransferred:typeof(Z==null?void 0:Z.bytesTransferred)=="number"?Z.bytesTransferred:B.lastBytesTransferred,lastTotalBytes:typeof(Z==null?void 0:Z.totalBytes)=="number"?Z.totalBytes:B.lastTotalBytes,lastFirebaseError:(Z==null?void 0:Z.lastFirebaseError)??B.lastFirebaseError,lastTaskState:(Z==null?void 0:Z.taskState)??B.lastTaskState,lastProgressAt:typeof(Z==null?void 0:Z.lastProgressAt)=="number"?Z.lastProgressAt:B.lastProgressAt,fullPath:(Z==null?void 0:Z.fullPath)??B.fullPath,bucket:(Z==null?void 0:Z.bucket)??B.bucket,pathMismatch:(Z==null?void 0:Z.pathMismatch)??B.pathMismatch,uploadMethod:(Z==null?void 0:Z.uploadMethod)??B.uploadMethod,correlationId:(Z==null?void 0:Z.correlationId)??B.correlationId,elapsedMs:typeof(Z==null?void 0:Z.elapsedMs)=="number"?Z.elapsedMs:B.elapsedMs,lastUploadError:(Z==null?void 0:Z.lastUploadError)??B.lastUploadError,lastError:Z.status==="failed"?{code:void 0,message:Z.message}:B.lastError},it})},signal:D.signal,stallTimeoutMs:15e3});if(K.current=null,!$e.ok){P("error"),C($e.error.message),Ve({code:$e.error.code,message:$e.error.message,pose:$e.error.pose??void 0});return}P("queued"),fe(`/scan/${o.scanId}`)},[nt,c,Qe,h,fe,H.back,H.front,H.left,H.right,ye,o==null?void 0:o.scanId,o==null?void 0:o.storagePaths]),De=l.useCallback(async D=>{var Z;if(!(o!=null&&o.scanId)||!ye||c==null||h==null||!t)return;P("uploading"),C(null),Ve(null),(Z=K.current)==null||Z.abort();const ue=new AbortController;K.current=ue;const Te={front:H.front,back:H.back,left:H.left,right:H.right},$e={front:bt(t.uid,o.scanId,"front"),back:bt(t.uid,o.scanId,"back"),left:bt(t.uid,o.scanId,"left"),right:bt(t.uid,o.scanId,"right")},Pe=await si({scanId:o.scanId,storagePaths:$e,photos:Te,currentWeightKg:c,goalWeightKg:h,heightCm:u,scanCorrelationId:o.correlationId},{posesToUpload:[D],onUploadProgress:se=>{L(se.overallPercent),X(se.pose),se.hasBytesTransferred&&re(!0)},onPhotoState:se=>{Re(it=>{const B={...it},Ae=B[se.pose];return B[se.pose]={status:se.status,attempt:se.attempt??(Ae==null?void 0:Ae.attempt)??0,percent:typeof se.percent=="number"?se.percent:(Ae==null?void 0:Ae.percent)??0,message:se.message??(Ae==null?void 0:Ae.message),nextRetryAt:typeof(se==null?void 0:se.nextRetryAt)=="number"?se.nextRetryAt:Ae==null?void 0:Ae.nextRetryAt,nextRetryDelayMs:typeof(se==null?void 0:se.nextRetryDelayMs)=="number"?se.nextRetryDelayMs:Ae==null?void 0:Ae.nextRetryDelayMs,offline:typeof(se==null?void 0:se.offline)=="boolean"?se.offline:Ae==null?void 0:Ae.offline,uploadMethod:(se==null?void 0:se.uploadMethod)??(Ae==null?void 0:Ae.uploadMethod)},B}),At(it=>{const B={...it},Ae=B[se.pose]??{};return B[se.pose]={...Ae,compressed:(se==null?void 0:se.compressed)??Ae.compressed,preprocessDebug:(se==null?void 0:se.preprocessDebug)??Ae.preprocessDebug,lastBytesTransferred:typeof(se==null?void 0:se.bytesTransferred)=="number"?se.bytesTransferred:Ae.lastBytesTransferred,lastTotalBytes:typeof(se==null?void 0:se.totalBytes)=="number"?se.totalBytes:Ae.lastTotalBytes,lastFirebaseError:(se==null?void 0:se.lastFirebaseError)??Ae.lastFirebaseError,lastTaskState:(se==null?void 0:se.taskState)??Ae.lastTaskState,lastProgressAt:typeof(se==null?void 0:se.lastProgressAt)=="number"?se.lastProgressAt:Ae.lastProgressAt,fullPath:(se==null?void 0:se.fullPath)??Ae.fullPath,bucket:(se==null?void 0:se.bucket)??Ae.bucket,pathMismatch:(se==null?void 0:se.pathMismatch)??Ae.pathMismatch,uploadMethod:(se==null?void 0:se.uploadMethod)??Ae.uploadMethod,correlationId:(se==null?void 0:se.correlationId)??Ae.correlationId,elapsedMs:typeof(se==null?void 0:se.elapsedMs)=="number"?se.elapsedMs:Ae.elapsedMs,lastUploadError:(se==null?void 0:se.lastUploadError)??Ae.lastUploadError,lastError:se.status==="failed"?{code:void 0,message:se.message}:Ae.lastError},B})},signal:ue.signal,stallTimeoutMs:15e3});if(K.current=null,!Pe.ok){P("error"),C(Pe.error.message),Ve({code:Pe.error.code,message:Pe.error.message,pose:Pe.error.pose??void 0});return}P("queued"),fe(`/scan/${o.scanId}`)},[c,h,fe,H.back,H.front,H.left,H.right,ye,o==null?void 0:o.scanId,o==null?void 0:o.storagePaths]);l.useEffect(()=>{const D=()=>{if(!nt||E!=="error"||typeof navigator<"u"&&navigator.onLine===!1||typeof document<"u"&&document.visibilityState==="hidden")return;const $e=Date.now();$e-A.current<15e3||O.current>=2||(A.current=$e,O.current+=1,Ze())},ue=()=>{document.visibilityState==="visible"&&D()},Te=()=>D();return document.addEventListener("visibilitychange",ue),window.addEventListener("online",Te),()=>{document.removeEventListener("visibilitychange",ue),window.removeEventListener("online",Te)}},[nt,E,Ze]);const Je=(m==null?void 0:m.sex)==="male"||(m==null?void 0:m.sex)==="female"?m.sex:void 0,zt=m!=null&&m.age&&Number.isFinite(m.age)?m.age:void 0,ct=m!=null&&m.height_cm?Da(m.height_cm):void 0,as=m!=null&&m.weight_kg?Pt(m.weight_kg):void 0,Ut=w??as??void 0;l.useEffect(()=>{if(!g||!ct){bi(null);return}const D=g.averages,ue=D==null?void 0:D.heightPixels;if(!Number.isFinite(ue??NaN)||ue<=0){bi(null);return}const Te=ct/ue,$e=wi(D==null?void 0:D.neckWidth,Te),Pe=wi(D==null?void 0:D.waistWidth,Te),Z=wi(D==null?void 0:D.hipWidth,Te);bi({neckIn:$e,waistIn:Pe,hipIn:Z})},[g,ct]);const Nt=l.useMemo(()=>{const D=vi(p.neck,G),ue=vi(p.waist,G),Te=vi(p.hip,G);return D==null&&ue==null&&Te==null?null:{neckIn:D,waistIn:ue,hipIn:Te}},[p,G]),Cs=l.useMemo(()=>{const D=q[0];return D?a[D]??null:null},[q,a]);l.useEffect(()=>{let D=!1;if(!Cs){F(null);return}return Xv(Cs).then(ue=>{D||F(ue)}),()=>{D=!0}},[Cs]);const vr=l.useMemo(()=>{const D={};for(const ue of q){const Te=a[ue];if(!Te)continue;const $e=Xc[ue],Pe={name:Te.name,size:Te.size,type:Te.type||"image/jpeg"};typeof Te.lastModified=="number"&&(Pe.lastModified=Te.lastModified),D[$e]=Pe}return D},[q,a]),et=l.useMemo(()=>!g||!ct||!Je?null:Bv({sex:Je,age:zt,heightIn:ct,weightLb:Ut??void 0,photoFeatures:g,manualCircumferences:Nt??void 0}),[zt,ct,Nt,g,Je,Ut]),Nr=ji((et==null?void 0:et.bodyFatPct)??null),Rn=Number.isFinite((et==null?void 0:et.bodyFatPct)??NaN)?et==null?void 0:et.bodyFatPct:null,Cl=l.useMemo(()=>!Je||zt==null?[]:Dh(Je,zt),[zt,Je]),_l=((Ml=Cl[0])==null?void 0:Ml.band)??null,$a=Rn!=null?Fh(Cl,Rn):null,Pl=Je?`${Je.charAt(0).toUpperCase()}${Je.slice(1)}`:null,Al=($a==null?void 0:$a.label)??null,Il=Rn!=null?Rn.toFixed(1):null,Tl=Pl&&_l&&Il&&Al?`For ${Pl} age ${_l}, ${Il}% places you in the ${Al} range.`:null,Sf=ji((et==null?void 0:et.bmi)??null),Rl=l.useMemo(()=>{const D=(et==null?void 0:et.usedWeight)??Ut??null;return Number.isFinite(D??NaN)?G==="metric"?`${gt(D).toFixed(1)}`:`${ji(D)}`:null},[et==null?void 0:et.usedWeight,Ut,G]);l.useMemo(()=>({neck:(x==null?void 0:x.neckIn)??null,waist:(x==null?void 0:x.waistIn)??null,hip:(x==null?void 0:x.hipIn)??null}),[x]),l.useMemo(()=>({neck:(Nt==null?void 0:Nt.neckIn)??null,waist:(Nt==null?void 0:Nt.waistIn)??null,hip:(Nt==null?void 0:Nt.hipIn)??null}),[Nt]),l.useMemo(()=>{const D=et==null?void 0:et.bmi;return Number.isFinite(D??NaN)?Number(D.toFixed(1)):null},[et]),l.useMemo(()=>{const D=(et==null?void 0:et.usedWeight)??Ut??null;return Number.isFinite(D??NaN)?Number(D.toFixed(1)):null},[et,Ut]),l.useMemo(()=>Number.isFinite(ct??NaN)?Number(ct):null,[ct]);const kf=l.useMemo(()=>{if(N)return N;if(j)return"Analyzing photos…";if(E==="starting")return"Preparing secure upload…";if(E==="uploading"){const D=Jc(T);return M?`Uploading ${M} photo (${D}% complete)…`:"Uploading encrypted photos…"}return E==="queued"?"Photos uploaded. Queued for processing…":E==="processing"?"Photos uploaded. Processing your scan…":k||(ge?"Scan uploaded. Opening your result…":ee?!ct||!Je?"Add your height and sex in Settings to unlock the preview.":Nr?"Scan preview based on your latest photos.":"Add your weight to see the full estimate.":"Capture every required angle to analyze the scan.")},[N,j,ee,ct,Je,Nr,E,k,T,M,ge]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Scan Result Preview – MyBodyScan",description:"Review the draft estimate before finalizing."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Preview Result"}),e.jsx("p",{className:"text-muted-foreground",children:kf})]}),J.status==="checking"?e.jsxs(tt,{className:"border-dashed",children:[e.jsx(rt,{children:"Checking secure access…"}),e.jsx(st,{children:"App Check is initializing (optional). You can still finalize your scan if everything else is ready."})]}):null,ie?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Scan services offline"}),e.jsx(st,{children:ie})]}):null,e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Estimated body metrics"})}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Estimated Body Fat"}),e.jsx("p",{className:"text-3xl font-semibold",children:Nr?`${Nr}%`:"—"})]}),e.jsxs("p",{className:"text-sm",children:["Estimated BMI: ",Sf??"—"," · Weight:"," ",Rl?`${Rl} ${G==="metric"?"kg":"lb"}`:"—"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Estimates only. Not a medical diagnosis."}),Tl?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:Tl}),e.jsx(Cv,{sex:Je,age:zt,bfPct:Rn})]}):null,e.jsxs(Xs,{open:d,onOpenChange:f,children:[e.jsx(al,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-sm font-medium text-primary underline-offset-4 hover:underline",children:"Refine measurements"})}),e.jsxs(Us,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Refine estimate"}),e.jsx(ar,{children:"Enter manual measurements to update the result preview."})]}),e.jsx(Uh,{onSubmit:()=>f(!1),footer:e.jsx(ya,{children:e.jsx(_,{type:"submit",children:"Close"})})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Captured photos"}),e.jsx("ul",{className:"space-y-2",children:le.map(D=>{var Pe;const ue=a[D],Te=Zc[D],$e=Te?(Pe=ke[Te])==null?void 0:Pe.compressed:void 0;return e.jsxs("li",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsx("span",{className:"font-medium",children:D}),ue?e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"block text-right",children:["Original: ",ue.name," · ",Wr(ue.size)," ·"," ",(ue.type||"image/*").toUpperCase()]}),$e?e.jsxs("span",{className:"block text-right",children:["Prepared: ",$e.name," ·"," ",Wr($e.size)," ·"," ",$e.type.toUpperCase()]}):null]}):e.jsx("span",{className:"text-sm text-destructive",children:"Missing"})]},D)})})]})]})]}),e.jsxs(Y,{className:"border border-dashed bg-muted/40",children:[e.jsx(oe,{children:e.jsx(he,{children:"Finalize scan"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:It}),k?e.jsx("p",{className:"text-sm text-destructive",children:k}):null,Ie&&E==="uploading"?e.jsx("p",{className:"text-xs text-amber-700","aria-live":"polite",children:"Connection lost — we’ll retry automatically when you’re back online."}):null,E==="uploading"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-secondary",children:e.jsx("div",{className:ce?"h-2 rounded-full bg-primary transition-all":"h-2 rounded-full bg-primary/60 animate-pulse",style:{width:ce?`${Jv(T)}%`:"30%"}})}),M?e.jsx("p",{className:"text-xs text-muted-foreground",children:ce?`Uploading ${M} (${Jc(T)}%)`:`Uploading ${M} (progress pending)`}):null]}):null,E==="uploading"||E==="queued"||E==="error"?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Me,children:"Cancel scan"}),nt?e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Ze,children:"Retry failed photo(s)"}):null,Qe.length?e.jsx(e.Fragment,{children:Qe.map(D=>e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>void De(D),children:["Retry ",D," upload"]},D))}):null]}):null,E==="uploading"||E==="error"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Photo upload status"}),e.jsx("div",{className:"space-y-2",children:Jn.map(D=>{const ue=Ne[D],Te=Math.max(0,Math.min(100,Math.round(((ue==null?void 0:ue.percent)??0)*100))),$e=D.charAt(0).toUpperCase()+D.slice(1),Pe=ue.status==="retrying"&&typeof ue.nextRetryAt=="number"?Math.max(0,ue.nextRetryAt-xe):null;return e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-medium",children:$e}),e.jsxs("span",{className:"text-muted-foreground",children:[ue.status,ue.attempt?` (attempt ${ue.attempt})`:"",ue.status==="uploading"||ue.status==="retrying"?` · ${Te}%`:"",Pe!=null&&Pe>0&&!Ie?` · retry in ${Math.ceil(Pe/1e3)}s`:""]})]}),e.jsx("div",{className:"mt-1 h-2 w-full rounded-full bg-secondary",children:e.jsx("div",{className:ue.status==="failed"?"h-2 rounded-full bg-destructive":ue.status==="done"?"h-2 rounded-full bg-primary":"h-2 rounded-full bg-primary/70",style:{width:`${ue.status==="done"?100:Te}%`}})}),ue.message?e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:ue.message}):null]},D)})})]}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{type:"button",onClick:te,disabled:rs,children:E==="uploading"?"Uploading…":E==="queued"?"Queued…":E==="processing"?"Processing…":E==="starting"?"Preparing…":"Finalize with AI"}),e.jsx(_,{type:"button",variant:"outline",onClick:()=>fe("/scan/capture"),children:"Retake photos"})]})]})]}),Ee?e.jsxs("details",{className:"rounded border p-3 text-xs",children:[e.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Debug details"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"firebase:"}),e.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-[11px] text-muted-foreground",children:(()=>{var $e,Pe,Z;const D=fr(),ue=String((($e=Kg().options)==null?void 0:$e.storageBucket)||""),Te=String(((Z=(Pe=tm().app)==null?void 0:Pe.options)==null?void 0:Z.storageBucket)||"");return JSON.stringify({projectId:D==null?void 0:D.projectId,authDomain:D==null?void 0:D.authDomain,storageBucket:D==null?void 0:D.storageBucket,storageBucketApp:ue||null,storageBucketResolved:Te||null},null,2)})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"device:"})," ",e.jsx("span",{className:"text-muted-foreground",children:(()=>{var $e,Pe,Z,se;const D=(($e=ke.front.preprocessDebug)==null?void 0:$e.device)??((Pe=ke.back.preprocessDebug)==null?void 0:Pe.device)??((Z=ke.left.preprocessDebug)==null?void 0:Z.device)??((se=ke.right.preprocessDebug)==null?void 0:se.device)??null;if(!D)return"—";const ue=D.isMobileUploadDevice?"mobile":"desktop",Te=D.isProbablyMobileSafari?" (iOS Safari)":"";return`${ue}${Te}`})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"auth:"})," ",e.jsxs("span",{className:"text-muted-foreground",children:["authReady=",s?"true":"false"," · loading=",n?"true":"false"," · uid=",(t==null?void 0:t.uid)??"—"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"app check:"})," ",e.jsxs("span",{className:"text-muted-foreground",children:[J.status," · tokenPresent=",J.tokenPresent?"true":"false",J.message?` · ${J.message}`:""]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"scanId:"})," ",e.jsx("span",{className:"text-muted-foreground",children:(o==null?void 0:o.scanId)??"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"storage path(s):"}),e.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-[11px] text-muted-foreground",children:o!=null&&o.storagePaths?JSON.stringify(o.storagePaths,null,2):"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"last error:"})," ",e.jsx("span",{className:"text-muted-foreground",children:Fe?`${Fe.code??"unknown"} · ${Fe.message??""}${Fe.pose?` · pose=${Fe.pose}`:""}`:"—"})]}),e.jsx("div",{className:"space-y-2",children:Jn.map(D=>{var Pe,Z,se,it,B,Ae,Vt,Be,Dl,Fl,Ll,Bl,Ol,Ul;const ue=Ne[D],Te=vr[D],$e=(Pe=ke[D])==null?void 0:Pe.compressed;return e.jsxs("div",{className:"rounded border p-2",children:[e.jsx("div",{className:"font-medium",children:D}),e.jsxs("div",{className:"text-muted-foreground",children:["state: ",ue.status," · attempt ",ue.attempt||0," · method"," ",ed(ue.uploadMethod)]}),e.jsxs("div",{className:"text-muted-foreground",children:["original:"," ",Te?`${Wr(Te.size)} · ${Te.type} · ${Te.name}`:"—"]}),e.jsxs("div",{className:"text-muted-foreground",children:["prepared:"," ",$e?`${Wr($e.size)} · ${$e.type} · ${$e.name}`:"—"]}),e.jsxs("div",{className:"text-muted-foreground",children:["object path:"," ",((Z=ke[D])==null?void 0:Z.fullPath)??((se=o==null?void 0:o.storagePaths)==null?void 0:se[D])??"—"]}),(it=ke[D])!=null&&it.uploadMethod?e.jsxs("div",{className:"text-muted-foreground",children:["methodUsed: ",ed(ke[D].uploadMethod)]}):null,(B=ke[D])!=null&&B.bucket?e.jsxs("div",{className:"text-muted-foreground",children:["bucket: ",ke[D].bucket]}):null,(Ae=ke[D])!=null&&Ae.pathMismatch?e.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-[11px] text-muted-foreground",children:JSON.stringify(ke[D].pathMismatch,null,2)}):null,e.jsxs("div",{className:"text-muted-foreground",children:["lastBytesTransferred:"," ",typeof((Vt=ke[D])==null?void 0:Vt.lastBytesTransferred)=="number"?`${ke[D].lastBytesTransferred} / ${ke[D].lastTotalBytes??"?"}`:"—"]}),(Be=ke[D])!=null&&Be.lastTaskState?e.jsxs("div",{className:"text-muted-foreground",children:["taskState: ",ke[D].lastTaskState," · lastProgressAt:"," ",ke[D].lastProgressAt?new Date(ke[D].lastProgressAt).toLocaleTimeString():"—"]}):null,(Fl=(Dl=ke[D])==null?void 0:Dl.lastFirebaseError)!=null&&Fl.message?e.jsxs("div",{className:"text-muted-foreground",children:["lastFirebaseError: ",ke[D].lastFirebaseError.code??"unknown"," ·"," ",ke[D].lastFirebaseError.message]}):null,(Bl=(Ll=ke[D])==null?void 0:Ll.lastUploadError)!=null&&Bl.message?e.jsxs("div",{className:"text-muted-foreground",children:["lastUploadError: ",ke[D].lastUploadError.code??"unknown"," ·"," ",ke[D].lastUploadError.message]}):null,(Ul=(Ol=ke[D])==null?void 0:Ol.lastFirebaseError)!=null&&Ul.serverResponse?e.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-[11px] text-muted-foreground",children:ke[D].lastFirebaseError.serverResponse}):null,ue.message?e.jsxs("div",{className:"text-muted-foreground",children:["lastPoseMessage: ",ue.message]}):null]},D)})})]})]}):null,ge?e.jsx(Y,{className:"border border-dashed",children:e.jsxs(Q,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Scan submitted"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"We’re queued for processing now. You can review it in your history at any time."})]}),e.jsx(_,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(jt,{to:"/scan/history",children:"View history"})})]})}):null]})}function eN(){const[t,s]=l.useState([]),[n,r]=l.useState(null),{user:a}=He(),i=ft(),o=ze();return l.useEffect(()=>{const c=a??U.currentUser;if(i&&!c){const d=Hm.map(f=>{const p=typeof(f==null?void 0:f.createdAt)=="number"?f.createdAt:Date.now(),x=typeof(f==null?void 0:f.updatedAt)=="number"?f.updatedAt:typeof(f==null?void 0:f.completedAt)=="number"?f.completedAt:p,g=typeof(f==null?void 0:f.completedAt)=="number"?f.completedAt:x,v=f!=null&&f.metrics?{bodyFatPercent:typeof f.metrics.bodyFatPct=="number"?f.metrics.bodyFatPct:void 0,bmi:typeof f.metrics.bmi=="number"?f.metrics.bmi:null,notes:"",leanMassKg:null,fatMassKg:null}:null;return{id:String((f==null?void 0:f.id)??""),uid:"demo",createdAt:new Date(p),updatedAt:new Date(x),completedAt:new Date(g),status:(f==null?void 0:f.status)??"complete",photoPaths:{front:"",back:"",left:"",right:""},input:{currentWeightKg:0,goalWeightKg:0,heightCm:null},estimate:v,workoutPlan:null,nutritionPlan:null}});s(d),r(null);return}if(!c){s([]);return}r(null);const h=Ot(de,"users",c.uid,"scans"),m=Ft(h,Lt("createdAt","desc"),Ht(10)),u=dt(m,d=>{const f=d.docs.map(p=>Zb(p.id,c.uid,p.data()));s(f)},d=>{console.error("scan history snapshot error",d),r("Unable to load scans right now.")});return()=>u()},[a]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Recent scans"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View your latest analyses."})]}),n&&e.jsx("p",{className:"text-sm text-red-700",children:n}),e.jsxs("div",{className:"space-y-3",children:[t.map(c=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:c.createdAt.toLocaleString()}),e.jsxs("p",{className:"text-muted-foreground",children:["Status: ",c.status]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{variant:"ghost",className:"text-sm",onClick:()=>{if(i&&!a){_t();return}o(`/scans/${c.id}`)},children:"View"}),["uploaded","pending","processing","error","failed"].includes(c.status)?e.jsx(_,{variant:"outline",className:"text-xs",onClick:async()=>{if(i&&!a){_t();return}const h=await lo(c.id);if(!h.ok){V({title:"Could not resume scan",description:h.error.message,variant:"destructive"});return}V({title:"Processing restarted",description:"We’ll keep updating this scan."}),o(`/scans/${c.id}`)},children:"Resume"}):null]})]}),c.estimate&&e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Body fat:"," ",typeof c.estimate.bodyFatPercent=="number"?`${c.estimate.bodyFatPercent.toFixed(1)}%`:"—"," ","· BMI ",c.estimate.bmi??"—"]})]},c.id)),t.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i&&!a?"Demo scans unavailable.":"No scans yet."})]})]})}function tN(){const t=ze();return l.useEffect(()=>{t("/scan",{replace:!0})},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{title:"Scan Flow",description:"Redirecting to the Live Body Scan."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Scan Flow"}),e.jsx("p",{className:"text-muted-foreground",children:"Redirecting to the latest Live Body Scan experience…"})]})]})}const sN=Yf,$h=l.forwardRef(({className:t,...s},n)=>e.jsx(xu,{ref:n,className:ae("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));$h.displayName=xu.displayName;const ia=l.forwardRef(({className:t,...s},n)=>e.jsx(yu,{ref:n,className:ae("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));ia.displayName=yu.displayName;const Wh=l.forwardRef(({className:t,...s},n)=>e.jsx(bu,{ref:n,className:ae("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Wh.displayName=bu.displayName;function nN({weightLbs:t,heightIn:s,age:n,gender:r}){return 66+6.23*t+12.7*s-6.8*n}function rN({lbmLbs:t}){return 370+21.6*(t/2.205)}function aN(t,s=1.4){return t*s}function iN({weightLbs:t,bodyFatPct:s}){const n=t*(s/100);return{leanMassLbs:t-n,fatMassLbs:n}}function Ni({calories:t,lbmLbs:s,weightLbs:n}){const r=Math.round(s),a=r*4,i=Math.round(.35*n),o=i*9,c=t-a-o,h=Math.round(Math.max(0,c/4)),m=h*4;return{proteinG:r,proteinKcal:a,fatG:i,fatKcal:o,carbsG:h,carbsKcal:m,totalKcal:a+o+m}}function oN(t,s){const n=t/s;let r;return n<.5?r="Low":n<=.6?r="Moderate":r="High",{ratio:n,riskLevel:r}}function lN(t,s){const n=s?rN({lbmLbs:s}):nN(t),r=aN(n,t.activityFactor);return{bmr:Math.round(n),tdee:Math.round(r),cutCalories:Math.round(r-500),maintainCalories:Math.round(r),gainCalories:Math.round(r+300)}}function Un(t,s="in"){return t?`${t.toFixed(1)} ${s}`:"—"}function td(){const{scanId:t}=Io(),s=ze(),{user:n}=He(),[r,a]=l.useState(null),[i,o]=l.useState(!0),[c,h]=l.useState(null);if(l.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{o(!0),h(null);const f=Ot(de,"users",n.uid,"scans"),p=async()=>{const ce=await mr(Ft(f,Lt("completedAt","desc"),Ht(5)));for(const re of ce.docs){const ge=re.data(),z=rr(ge),fe=(ge==null?void 0:ge.status)||null;if(z.bodyFatPercent!=null&&(ge!=null&&ge.charged)&&(fe==="completed"||fe==="complete"||fe==="done"))return{id:re.id,data:ge}}return null},x=ce=>{V(ce),s("/history",{replace:!0})},g=t??null;if(!g){const ce=await p();ce?(V({title:"Showing latest scan",description:"We loaded your most recent completed scan report."}),s(`/report/${ce.id}`,{replace:!0})):x({title:"No completed scans",description:"Complete a scan to generate a report."});return}const v=Se(de,"users",n.uid,"reports",g);let j;try{j=await ot(v)}catch(ce){console.warn("report.loadReportDoc",ce),h("Unable to load report"),o(!1);return}if(j.exists()){a(j.data());return}const y=Se(de,"users",n.uid,"scans",g);let N;try{N=await ot(y)}catch(ce){console.warn("report.loadScanDoc",ce),N=null}if(!(N!=null&&N.exists())){const ce=await p();ce?(V({title:"Scan not found",description:"Showing your most recent completed scan instead."}),s(`/report/${ce.id}`,{replace:!0})):x({title:"Scan not found",description:"Complete a scan to view reports."});return}const b=N.data(),w=rr(b),I=w.bodyFatPercent,F=w.weightLb;if(I==null||F==null){h("Insufficient scan data for report generation");return}const E={weightLbs:F,heightIn:70,age:30,gender:"male",activityFactor:1.4},{leanMassLbs:P,fatMassLbs:k}=iN({weightLbs:F,bodyFatPct:I}),C=lN(E,P),T={cut:Ni({calories:C.cutCalories,lbmLbs:P,weightLbs:F}),maintain:Ni({calories:C.maintainCalories,lbmLbs:P,weightLbs:F}),gain:Ni({calories:C.gainCalories,lbmLbs:P,weightLbs:F})},L={waistIn:32,hipIn:38,chestIn:42,thighIn:24,armIn:14};let M;L.waistIn&&(M=oN(L.waistIn,E.heightIn));const X={scanId:g,weightLbs:F,bodyFatPct:I,leanMassLbs:P,fatMassLbs:k,energy:C,macros:T,measurements:L,waistHeightRatio:M,changes:null,generatedAt:new Date};Dg||await mt(v,X),a(X)}catch(f){console.error("Error loading report:",f),h(f.message||"Failed to load report")}finally{o(!1)}})()},[n==null?void 0:n.uid,t,s]),i)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsx(St,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[...Array(4)].map((d,f)=>e.jsx(St,{className:"h-32"},f))})]});if(c||!r)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(Y,{children:e.jsx(Q,{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-600",children:c||"Report not available"})})})});const{energy:m,macros:u}=r;return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Pro Report"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Generated ",r.generatedAt.toLocaleDateString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Y,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[r.weightLbs," lbs"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Weight"})]})}),e.jsx(Y,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:Number.isFinite(r.bodyFatPct)?`${r.bodyFatPct.toFixed(1)}%`:"—"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Body Fat"})]})}),e.jsx(Y,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:Number.isFinite(r.leanMassLbs)?`${r.leanMassLbs.toFixed(1)} lbs`:"—"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Lean Mass"})]})}),e.jsx(Y,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:Number.isFinite(r.fatMassLbs)?`${r.fatMassLbs.toFixed(1)} lbs`:"—"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fat Mass"})]})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Energy & Calories"})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold",children:[m.bmr," kcal/day"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"BMR (Basal Metabolic Rate)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold",children:[m.tdee," kcal/day"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"TDEE (Total Daily Energy)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Y,{className:"bg-red-50",children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-red-700",children:m.cutCalories}),e.jsx("p",{className:"text-sm text-red-600",children:"Cut (kcal/day)"})]})}),e.jsx(Y,{className:"bg-blue-50",children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-blue-700",children:m.maintainCalories}),e.jsx("p",{className:"text-sm text-blue-600",children:"Maintain (kcal/day)"})]})}),e.jsx(Y,{className:"bg-green-50",children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold text-green-700",children:m.gainCalories}),e.jsx("p",{className:"text-sm text-green-600",children:"Gain (kcal/day)"})]})})]})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Macro Breakdown"})}),e.jsx(Q,{children:e.jsxs(sN,{defaultValue:"maintain",className:"w-full",children:[e.jsxs($h,{className:"grid w-full grid-cols-3",children:[e.jsx(ia,{value:"cut",children:"Cut"}),e.jsx(ia,{value:"maintain",children:"Maintain"}),e.jsx(ia,{value:"gain",children:"Gain"})]}),["cut","maintain","gain"].map(d=>e.jsx(Wh,{value:d,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[u[d].proteinG,"g"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",u[d].proteinKcal," kcal)"]})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[u[d].fatG,"g"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",u[d].fatKcal," kcal)"]})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[u[d].carbsG,"g"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",u[d].carbsKcal," kcal)"]})]})]})},d))]})})]}),r.measurements&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Measurements"})}),e.jsx(Q,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Waist"}),e.jsx("p",{className:"text-muted-foreground",children:Un(r.measurements.waistIn)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Hip"}),e.jsx("p",{className:"text-muted-foreground",children:Un(r.measurements.hipIn)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Chest"}),e.jsx("p",{className:"text-muted-foreground",children:Un(r.measurements.chestIn)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Thigh"}),e.jsx("p",{className:"text-muted-foreground",children:Un(r.measurements.thighIn)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Arm"}),e.jsx("p",{className:"text-muted-foreground",children:Un(r.measurements.armIn)})]})]})})]}),r.waistHeightRatio&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Waist-to-Height Ratio"})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Number.isFinite(r.waistHeightRatio.ratio)?r.waistHeightRatio.ratio.toFixed(3):"—"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ratio"})]}),e.jsxs(Xe,{variant:r.waistHeightRatio.riskLevel==="Low"?"default":r.waistHeightRatio.riskLevel==="Moderate"?"secondary":"destructive",children:[r.waistHeightRatio.riskLevel," Risk"]})]})})]}),e.jsx("div",{className:"text-center text-sm text-muted-foreground pt-4 border-t",children:e.jsx("p",{children:"Image-based estimates are approximations, not medical diagnostics."})})]})}function cN(){const{credits:t,uid:s,projectId:n}=Ra(),r=s?`users/${s}`:null;return e.jsxs("main",{className:"p-6 space-y-2",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Credits Debug"}),e.jsxs("div",{children:["projectId: ",n]}),e.jsxs("div",{children:["uid: ",s??"(none)"]}),e.jsxs("div",{children:["doc path: ",r??"users/{uid}"]}),e.jsxs("div",{children:["credits: ",t]}),!s&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Log in to watch live credits."})]})}function dN(){const[t,s]=l.useState(null);l.useEffect(()=>{let r=!1;return fetch("/build.txt",{cache:"no-store"}).then(a=>a.ok?a.json():null).then(a=>{!r&&(a!=null&&a.sha)&&(a!=null&&a.builtAtISO)&&s(a)}).catch(()=>{}),()=>{r=!0}},[]);const n=t?`${t.sha} · ${new Date(t.builtAtISO).toLocaleDateString()} ${new Date(t.builtAtISO).toLocaleTimeString()}`:null;return e.jsx("footer",{className:"border-t bg-background",children:e.jsx("div",{className:"mx-auto max-w-3xl px-4 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"© 2024 MyBodyScan"}),n?e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• Build ",n]}):null]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(jt,{to:"/privacy",className:"hover:text-foreground transition-colors",children:"Privacy"}),e.jsx(jt,{to:"/terms",className:"hover:text-foreground transition-colors",children:"Terms"}),e.jsx(jt,{to:"/system/check",className:"hover:text-foreground transition-colors",children:"System check"}),e.jsx(jt,{to:"/legal/disclaimer",className:"hover:text-foreground transition-colors",children:"Health & Safety"}),e.jsx("a",{href:"mailto:support@mybodyscan.com",className:"hover:text-foreground transition-colors",children:"Support"})]})]})})})}function uN(){return Bt()?!1:!!rm}function mN({className:t}){const[s,n]=l.useState(null),r=uN(),a=Bt(),[i,o]=l.useState(!1);l.useEffect(()=>{if(a){o(!1);return}let u=!1;return(async()=>{const d=gw(),f=[{url:pw("createCustomerPortal"),kind:"function"}];for(const p of f)try{const x=await fetch(p.url,{method:"OPTIONS"});u||o(x.ok);return}catch{p.kind,u||o(!1);return}u||o(!1)})(),()=>{u=!0}},[]);const c=!!s;async function h(){if(r){n("checkout");try{await vw({plan:"one",priceId:Gt.ONE_TIME_STARTER})}catch(u){const d=typeof(u==null?void 0:u.code)=="string"?u.code:void 0,p=jw(d);V({title:"Unable to start checkout",description:p,variant:"destructive"})}finally{n(null)}}}async function m(){if(r){n("portal");try{if(!i){V({title:"Portal not available yet."});return}await kh()}catch(u){const d=typeof(u==null?void 0:u.code)=="string"?u.code:void 0,p=Nh(d);V({title:"Unable to open billing portal",description:p,variant:"destructive"})}finally{n(null)}}}return e.jsxs("div",{className:t,children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a?e.jsx(_,{type:"button",variant:"secondary",size:"sm",onClick:()=>window.location.assign("/paywall"),"aria-label":"Upgrade",children:"Upgrade"}):e.jsxs(e.Fragment,{children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:h,disabled:!r||c,"aria-label":"Buy credits",children:s==="checkout"?"Loading…":"Buy Credits"}),e.jsx(_,{type:"button",variant:"secondary",size:"sm",onClick:m,disabled:!r||c||!i,"aria-label":"Manage billing",children:s==="portal"?"Loading…":i?"Manage Billing":"Portal unavailable"})]})}),!r&&!a&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Billing disabled (no Stripe key)."})]})}function qh(){const{user:t}=He(),s=ft(),[n,r]=l.useState(null),[a,i]=l.useState(!0),[o,c]=l.useState(null);l.useEffect(()=>{if(s){r(null),i(!1);return}if(!t||!de){r(null),i(!1);return}i(!0);const u=Se(de,"users",t.uid),d=dt(u,f=>{var x;const p=((x=f.data())==null?void 0:x.subscription)||null;r(p?{status:p.status||"none",product:p.product??null,price:p.price??null,updatedAt:p.updatedAt??null}:null),c(null),i(!1)},f=>{c(f.message||"Failed to load subscription"),r(null),i(!1)});return()=>d()},[t==null?void 0:t.uid,s]);const h=(n==null?void 0:n.status)??"none";return{subscription:n,status:h,isActive:h==="active",loading:a,error:o}}let zh=null;function hN(t){const s=(t==null?void 0:t.code)??(t==null?void 0:t.status)??"";if(s===403)return!0;const n=String(s||"");return n==="permission-denied"||n==="permission_denied"||n.includes("permission-denied")}function pn(t,s){hN(t)&&(zh={atMs:Date.now(),code:typeof(t==null?void 0:t.code)=="string"?t.code:String((t==null?void 0:t.status)??"permission-denied"),message:typeof(t==null?void 0:t.message)=="string"?t.message:String(t),path:s==null?void 0:s.path,op:s==null?void 0:s.op})}function fN(){return zh}const pN={display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,padding:"10px 12px",borderBottom:"1px solid #eee",background:"white",position:"sticky",top:0,zIndex:100},gN={display:"flex",alignItems:"center",gap:8},xN={display:"flex",alignItems:"center",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},yN={fontSize:16,fontWeight:700,color:"inherit",textDecoration:"none"},bN={fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid #facc15",background:"#fef3c7",color:"#92400e"},jN={fontSize:12,color:"#555"},wN={fontSize:12,color:"#333",textDecoration:"underline"},sd={padding:"8px 10px",border:"1px solid #ddd",borderRadius:8,background:"white",cursor:"pointer",fontSize:12},vN={padding:"8px 10px",border:"1px solid #d0d7e2",borderRadius:8,background:"#f8fafc",cursor:"pointer",fontSize:12,color:"#1f2937"},NN={position:"fixed",top:72,right:16,width:320,maxHeight:"80vh",overflowY:"auto",padding:16,borderRadius:12,border:"1px solid rgba(15,23,42,0.08)",background:"#fff",boxShadow:"0 18px 45px rgba(15,23,42,0.18)",zIndex:400},SN={display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},kN={fontSize:14,fontWeight:600,color:"#111827"},EN={border:"1px solid #d0d7e2",background:"transparent",borderRadius:6,padding:"2px 6px",fontSize:11,cursor:"pointer"},$n={marginBottom:16,display:"grid",gap:6},Wn={fontSize:12,fontWeight:600,color:"#1f2937",textTransform:"uppercase",letterSpacing:.4},dn={fontSize:12,color:"#374151"},Si={fontSize:11,background:"#f8fafc",border:"1px solid #d0d7e2",borderRadius:8,padding:8,margin:0,maxHeight:160,overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"},CN={border:"1px solid #d0d7e2",background:"#f1f5f9",borderRadius:6,padding:"4px 8px",fontSize:11,cursor:"pointer",width:"fit-content"},ki={fontSize:12,color:"#2563eb",textDecoration:"none",display:"block"};function nd(t){return t&&t.trim().length>0?t:"Signed in"}const _N="Demo preview failed. Please try again.";function PN({className:t}){const{user:s,claims:n,refresh:r}=ll(),{credits:a,unlimited:i}=Ra();qh();const{entitlements:o}=xr(),c=ft(),h=ze(),[m,u]=l.useState(!1),[d,f]=l.useState(!1),[p,x]=l.useState({status:"idle"}),g=(n==null?void 0:n.dev)===!0;l.useEffect(()=>{!g&&d&&f(!1)},[g,d]),l.useEffect(()=>{if(!d)return;if(!hm()){x({status:"unavailable",error:"App Check disabled"});return}let E=!1;return(async()=>{x({status:"loading"});try{await ts();const k=(await fm(!0))["X-Firebase-AppCheck"];E||x(typeof k=="string"&&k?{status:"available",suffix:k.slice(-8)}:{status:"unavailable",error:"No token issued"})}catch(P){E||x({status:"error",error:(P==null?void 0:P.message)??String(P)})}})(),()=>{E=!0}},[d]);async function v(){if(!m){u(!0);try{Pn(),h("/demo",{replace:!0})}catch(E){V(ls(E,{fallback:{title:"Demo preview unavailable",description:_N,variant:"destructive"},includeCodeInDev:!1}))}finally{u(!1)}}}const j=i?"∞ (unlimited)":Number.isFinite(a)?`${Math.max(0,Math.floor(Number(a)))} available`:"—",y=JSON.stringify(n??{},null,2),N=(s==null?void 0:s.uid)??null,b=s?c?"demo":Ta(o)?"pro":"free":"signed-out",w=N?{coachThreads:Mj(N),coachMessagesExample:Dj(N,"THREAD_ID"),coachLegacyChat:co(N)}:null,I=fN(),F=(()=>{switch(p.status){case"loading":return"Loading token…";case"available":return p.suffix?`Token available (…${p.suffix})`:"Token available";case"unavailable":return p.error??"Not available";case"error":return`Error: ${p.error??"unknown"}`;default:return"Idle"}})();return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:t,style:pN,role:"banner",children:[e.jsxs("div",{style:gN,children:[e.jsx("a",{href:"/",style:yN,"aria-label":"MyBodyScan Home",children:"MyBodyScan"}),e.jsx(jh,{}),c&&e.jsx("span",{style:bN,"aria-label":"Demo mode active",children:"Demo"})]}),e.jsxs("div",{style:xN,children:[s?e.jsx("span",{style:jN,title:nd(s.email),children:nd(s.email)}):e.jsx("a",{href:"/login",style:wN,"aria-label":"Go to login",children:"Sign in"}),e.jsx(Tm,{}),e.jsx(mN,{}),g&&e.jsx("button",{type:"button",style:vN,onClick:()=>f(E=>!E),"aria-expanded":d,"aria-controls":"dev-tools-drawer",children:d?"Close Dev Tools":"Dev Tools"}),!s&&!c&&e.jsx("button",{type:"button",onClick:v,style:{...sd,opacity:m?.7:1,pointerEvents:m?"none":"auto"},"aria-label":"Explore Demo",disabled:m,children:m?"Loading…":"Explore Demo"}),c&&e.jsx("button",{type:"button",onClick:()=>{An(),h("/auth",{replace:!0})},style:sd,"aria-label":"Leave demo",children:"Leave demo"})]})]}),g&&d&&e.jsxs("div",{id:"dev-tools-drawer",style:NN,role:"dialog","aria-label":"Dev Tools",children:[e.jsxs("div",{style:SN,children:[e.jsx("strong",{style:kN,children:"Dev Tools"}),e.jsx("button",{type:"button",style:EN,onClick:()=>f(!1),children:"Close"})]}),e.jsxs("div",{style:$n,children:[e.jsx("div",{style:Wn,children:"Claims"}),e.jsx("pre",{style:Si,children:y}),e.jsx("button",{type:"button",style:CN,onClick:()=>void r(!0),children:"Refresh claims"})]}),e.jsxs("div",{style:$n,children:[e.jsx("div",{style:Wn,children:"System check"}),e.jsxs("div",{style:dn,children:["uid: ",N??"—"]}),e.jsxs("div",{style:dn,children:["entitlement: ",b]}),e.jsxs("div",{style:dn,children:["coach paths:",e.jsx("pre",{style:Si,children:JSON.stringify(w??{},null,2)})]}),e.jsxs("div",{style:dn,children:["last permission-denied:",e.jsx("pre",{style:Si,children:JSON.stringify(I??{},null,2)})]})]}),e.jsxs("div",{style:$n,children:[e.jsx("div",{style:Wn,children:"Credits"}),e.jsx("div",{style:dn,children:j})]}),e.jsxs("div",{style:$n,children:[e.jsx("div",{style:Wn,children:"App Check"}),e.jsx("div",{style:dn,children:F})]}),e.jsxs("div",{style:$n,children:[e.jsx("div",{style:Wn,children:"UAT"}),e.jsx("a",{href:"/__uat#seed-unlimited",style:ki,children:"Seed ∞ credits"}),e.jsx("a",{href:"/__uat#checkout-starter",style:ki,children:"Stripe Checkout (Starter)"}),e.jsx("a",{href:"/__uat#portal",style:ki,children:"Customer Portal"})]})]})]})}function Vh({children:t}){return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(PN,{}),e.jsxs("main",{className:"flex-1 mx-auto w-full max-w-3xl px-4 py-8",children:[e.jsx(Xt,{}),t]}),e.jsx(dN,{})]})}const AN=Object.freeze(Object.defineProperty({__proto__:null,default:Vh},Symbol.toStringTag,{value:"Module"})),IN=()=>Ho.ENABLE_PUBLIC_MARKETING_PAGE?e.jsx(Vh,{children:e.jsx(Eh,{})}):e.jsx(Rm,{}),fl=l.forwardRef(({className:t,value:s,...n},r)=>e.jsx(ju,{ref:r,className:ae("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:e.jsx(Qf,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));fl.displayName=ju.displayName;const TN=()=>{const[t,s]=l.useState(1),[n,r]=l.useState({goal:"lose_fat",style:"ease_in",timeframe_weeks:12,sex:"male",age:30,height_cm:170,weight_kg:70,activity_level:"light",medical_flags:{},ack:{disclaimer:!1}}),[a,i]=l.useState(null),o=ze(),c=(u,d)=>r(f=>({...f,[u]:d}));async function h(){const u={...n},d=n.height_cm??0,f=n.weight_kg??0,{ft:p,inches:x}=tl(Da(d));u.units="us",u.height_ft=p,u.height_in=x,u.weight_lb=Pt(f),await es("saveOnboarding",u);const{data:g}=await es("computePlan",{});i(g),s(4)}const m=t/4*100;return e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Step ",t," of 4"]}),e.jsxs("span",{children:[Math.round(m),"%"]})]}),e.jsx(fl,{value:m,className:"h-2"})]}),t===1&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx($u,{className:"h-5 w-5 text-primary"}),"What's your main goal?"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Let's start with what you want to achieve. We'll create a personalized plan just for you."}),e.jsx("div",{className:"space-y-3",children:[{value:"lose_fat",label:"Lose body fat",desc:"Reduce fat while maintaining muscle"},{value:"gain_muscle",label:"Build muscle",desc:"Increase lean mass and strength"},{value:"improve_heart",label:"Improve cardiovascular health",desc:"Focus on heart health and endurance"}].map(u=>e.jsxs("label",{className:`block p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors ${n.goal===u.value?"border-primary bg-primary/5":""}`,children:[e.jsx("input",{type:"radio",name:"goal",value:u.value,checked:n.goal===u.value,onChange:d=>c("goal",d.target.value),className:"sr-only"}),e.jsx("div",{className:"font-medium",children:u.label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u.desc})]},u.value))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"How intense do you want to go?"}),e.jsxs("select",{className:"mt-1 w-full p-2 border rounded-md",value:n.style,onChange:u=>c("style",u.target.value),children:[e.jsx("option",{value:"ease_in",children:"Take it easy - gradual changes"}),e.jsx("option",{value:"all_in",children:"Go all in - aggressive approach"})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Timeframe (weeks)"}),e.jsx(We,{type:"number",min:"4",max:"52",value:n.timeframe_weeks,onChange:u=>c("timeframe_weeks",Number(u.target.value)),className:"mt-1"})]})]}),e.jsxs(_,{onClick:()=>s(2),className:"w-full",children:["Continue ",e.jsx(Hs,{className:"ml-2 h-4 w-4"})]})]})]}),t===2&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Fu,{className:"h-5 w-5 text-primary"}),"Tell us about yourself"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"These details help us calculate your personalized calorie and macro targets."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sex"}),e.jsxs("select",{className:"mt-1 w-full p-2 border rounded-md",value:n.sex,onChange:u=>c("sex",u.target.value),children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Age"}),e.jsx(We,{type:"number",min:"18",max:"100",value:n.age,onChange:u=>c("age",Number(u.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Height"}),e.jsx("div",{className:"mt-1",children:e.jsx(rl,{valueCm:n.height_cm,onChangeCm:u=>c("height_cm",u)})})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"Weight (lb)"}),e.jsx(We,{type:"number",min:"70",max:"600",value:n.weight_kg?Math.round(Pt(n.weight_kg)):"",onChange:u=>{if(u.target.value===""){c("weight_kg",void 0);return}const d=Number(u.target.value);Number.isNaN(d)||c("weight_kg",gt(d))},className:"mt-1"})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:"How active are you?"}),e.jsxs("select",{className:"mt-1 w-full p-2 border rounded-md",value:n.activity_level,onChange:u=>c("activity_level",u.target.value),children:[e.jsx("option",{value:"sedentary",children:"Sedentary (desk job, no exercise)"}),e.jsx("option",{value:"light",children:"Light (1-3 days/week light exercise)"}),e.jsx("option",{value:"moderate",children:"Moderate (3-5 days/week exercise)"}),e.jsx("option",{value:"very",children:"Very active (6-7 days/week exercise)"}),e.jsx("option",{value:"extra",children:"Extremely active (2x/day or physical job)"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{variant:"secondary",onClick:()=>s(1),className:"flex-1",children:"Back"}),e.jsxs(_,{onClick:()=>s(3),className:"flex-1",children:["Continue ",e.jsx(Hs,{className:"ml-2 h-4 w-4"})]})]})]})]}),t===3&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Health & Safety"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your safety is our priority. Please let us know about any conditions that might affect your nutrition plan."})}),e.jsx("div",{className:"space-y-3",children:[{key:"pregnant",label:"Currently pregnant or breastfeeding"},{key:"under18",label:"Under 18 years old"},{key:"eating_disorder_history",label:"History of eating disorders"},{key:"heart_condition",label:"Heart condition or cardiac issues"}].map(u=>e.jsxs("label",{className:"flex items-start gap-3 p-2 hover:bg-muted/30 rounded-md cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.medical_flags[u.key]||!1,onChange:d=>c("medical_flags",{...n.medical_flags,[u.key]:d.target.checked}),className:"mt-1"}),e.jsx("span",{className:"text-sm",children:u.label})]},u.key))}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("label",{className:"flex items-start gap-3 p-2 hover:bg-muted/30 rounded-md cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.ack.disclaimer,onChange:u=>c("ack",{...n.ack,disclaimer:u.target.checked}),className:"mt-1"}),e.jsxs("span",{className:"text-sm",children:["I understand this is not medical advice and I accept the"," ",e.jsx(jt,{to:"/legal/disclaimer",className:"text-primary hover:underline",children:"full disclaimer"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{variant:"secondary",onClick:()=>s(2),className:"flex-1",children:"Back"}),e.jsxs(_,{onClick:h,disabled:!n.ack.disclaimer,className:"flex-1",children:["Create My Plan ",e.jsx(Hs,{className:"ml-2 h-4 w-4"})]})]})]})]}),t===4&&a&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Qp,{className:"h-5 w-5 text-accent"}),"Your Personalized Plan"]})}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:a.target_kcal}),e.jsx("div",{className:"text-muted-foreground",children:"calories per day"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-primary/5 rounded-lg",children:[e.jsx(Xe,{variant:"secondary",className:"mb-2",children:"Protein"}),e.jsxs("div",{className:"font-semibold",children:[a.protein_g,"g"]})]}),e.jsxs("div",{className:"text-center p-3 bg-accent/5 rounded-lg",children:[e.jsx(Xe,{variant:"secondary",className:"mb-2",children:"Fat"}),e.jsxs("div",{className:"font-semibold",children:[a.fat_g,"g"]})]}),e.jsxs("div",{className:"text-center p-3 bg-warning/5 rounded-lg",children:[e.jsx(Xe,{variant:"secondary",className:"mb-2",children:"Carbs"}),e.jsxs("div",{className:"font-semibold",children:[a.carbs_g,"g"]})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Weight: ",Math.round(a.weight_lb)," lb"]}),e.jsxs("div",{children:["Height: ",a.height_ft,"ft ",a.height_in,"in"]})]}),a.needs_clearance&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:[e.jsx("div",{className:"font-medium text-destructive text-sm",children:"Important"}),e.jsx("div",{className:"text-destructive text-sm",children:a.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_,{onClick:()=>o("/coach/tracker"),className:"w-full",size:"lg",children:"Start Tracking"}),e.jsx(_,{variant:"secondary",onClick:()=>s(1),className:"w-full",children:"Edit My Answers"})]})]})]})]})},RN=["serving","g","oz","cups","slices","pieces"],pl=28.3495;function $t(t,s=2){if(t==null)return null;const n=10**s;return Math.round(t*n)/n}function rd(t){return t?$t(t/pl,2):null}function MN(t){const s=Number(t.protein||0),n=Number(t.carbs||0),r=Number(t.fat||0),a=Number(t.alcohol||0);return Math.round(s*4+n*4+r*9+a*7)}function DN(t){if(!t)return null;const s=t.toLowerCase();return s.includes("gram")||s==="g"?"g":s.includes("ounce")||s==="oz"?"oz":s.includes("cup")?"cups":s.includes("slice")?"slices":s.includes("piece")?"pieces":s.includes("serv")?"serving":s}function FN(t){return Array.isArray(t.servings)&&t.servings.length?t.servings.find(s=>s.isDefault)??t.servings[0]:null}function Kh(t){var h,m,u;const s=FN(t);if(s!=null&&s.grams)return $t(s.grams,2);const n=DN(((h=t.serving)==null?void 0:h.unit)||((m=t.serving)==null?void 0:m.text)||null),r=typeof((u=t.serving)==null?void 0:u.qty)=="number"?t.serving.qty:null;if(r&&n==="g")return r;if(r&&n==="oz")return r*pl;const a=(t==null?void 0:t.per_serving)??null,i=(t==null?void 0:t.per_100g)??null;if(!i)return null;const o=[];if(a!=null&&a.protein_g&&i.protein_g&&o.push(a.protein_g/i.protein_g*100),a!=null&&a.carbs_g&&i.carbs_g&&o.push(a.carbs_g/i.carbs_g*100),a!=null&&a.fat_g&&i.fat_g&&o.push(a.fat_g/i.fat_g*100),a!=null&&a.kcal&&i.kcal&&o.push(a.kcal/i.kcal*100),!o.length)return null;const c=o.reduce((d,f)=>d+f,0)/o.length;return $t(c,2)}function LN(t,s,n){switch(n){case"g":return s;case"oz":return s*pl;case"serving":case"cups":case"slices":case"pieces":{const r=Kh(t);return r?r*s:null}default:return null}}function BN(t,s,n){const r=LN(t,s,n),a=(t==null?void 0:t.per_serving)??null,i=(t==null?void 0:t.per_100g)??null,o=s;if(r!=null&&i){const c=r/100;return{grams:$t(r,2),calories:i.kcal!=null?$t(i.kcal*c,0):null,protein:i.protein_g!=null?$t(i.protein_g*c,2):null,carbs:i.carbs_g!=null?$t(i.carbs_g*c,2):null,fat:i.fat_g!=null?$t(i.fat_g*c,2):null}}return{grams:r!=null?$t(r,2):null,calories:(a==null?void 0:a.kcal)!=null?$t(a.kcal*o,0):null,protein:(a==null?void 0:a.protein_g)!=null?$t(a.protein_g*o,2):null,carbs:(a==null?void 0:a.carbs_g)!=null?$t(a.carbs_g*o,2):null,fat:(a==null?void 0:a.fat_g)!=null?$t(a.fat_g*o,2):null}}function ON(t){return{id:t.id,name:t.name,brand:t.brand,source:t.source,serving:{qty:t.serving.qty,unit:t.serving.unit,text:t.serving.text},per_serving:{...t.per_serving},per_100g:t.per_100g?{...t.per_100g}:null,fdcId:t.fdcId??null,gtin:t.gtin??null}}function v_(t){var s,n,r,a,i,o,c;return{id:t.id||`snapshot-${Math.random().toString(36).slice(2,8)}`,name:t.name,brand:t.brand??null,source:t.source==="Open Food Facts"||t.source==="OFF"?"Open Food Facts":"USDA",basePer100g:t.per_100g?{kcal:t.per_100g.kcal??0,protein:t.per_100g.protein_g??0,carbs:t.per_100g.carbs_g??0,fat:t.per_100g.fat_g??0}:{kcal:0,protein:0,carbs:0,fat:0},servings:[{id:"100g",label:"100 g",grams:100,isDefault:!0}],serving:{qty:((s=t.serving)==null?void 0:s.qty)??null,unit:((n=t.serving)==null?void 0:n.unit)??null,text:((r=t.serving)==null?void 0:r.text)??void 0},per_serving:{kcal:((a=t.per_serving)==null?void 0:a.kcal)??null,protein_g:((i=t.per_serving)==null?void 0:i.protein_g)??null,carbs_g:((o=t.per_serving)==null?void 0:o.carbs_g)??null,fat_g:((c=t.per_serving)==null?void 0:c.fat_g)??null},per_100g:t.per_100g?{kcal:t.per_100g.kcal??null,protein_g:t.per_100g.protein_g??null,carbs_g:t.per_100g.carbs_g??null,fat_g:t.per_100g.fat_g??null}:void 0,gtin:t.gtin??void 0,fdcId:t.fdcId??void 0}}function UN(t,s,n,r,a="search"){return{name:t.name,protein:r.protein??void 0,carbs:r.carbs??void 0,fat:r.fat??void 0,calories:r.calories??void 0,serving:{qty:s,unit:n,grams:r.grams,originalQty:t.serving.qty??null,originalUnit:t.serving.unit??null},item:ON(t),entrySource:a}}function cs(t){return Number.isFinite(t)?Math.round(t*10)/10:0}function bo(t){return Number.isFinite(t)?Math.round(t):0}function qr(t){return t.reduce((s,n)=>{const r=Number(n);return s+(Number.isFinite(r)?r:0)},0)}function $N(t){if(t===null||typeof t!="object")return!1;const s=Object.getPrototypeOf(t);return s===Object.prototype||s===null}function jo(t){if(t==null)return t;if(Array.isArray(t))return t.map(s=>jo(s)).filter(s=>s!==void 0);if($N(t)){const s={};for(const[n,r]of Object.entries(t)){const a=jo(r);a!==void 0&&(s[n]=a)}return s}return t}function WN(t){return jo(t)}async function qN(t){const s=await t.text().catch(()=>"");if(!s)return{};try{return JSON.parse(s)}catch{return s}}function zN(t,s){var n;if(typeof t=="string"){const r=t.trim();return r.length?r:`fn_error_${s}`}if(t&&typeof t=="object"){const r=t,a=typeof r.error=="string"&&r.error||typeof((n=r.error)==null?void 0:n.message)=="string"&&r.error.message||typeof r.message=="string"&&r.message||"";return a.trim().length?a.trim():`fn_error_${s}`}return`fn_error_${s}`}function VN(t){var r;if(!t||typeof t!="object")return;const s=t;return typeof s.code=="string"&&s.code||typeof((r=s.error)==null?void 0:r.code)=="string"&&s.error.code||void 0||void 0}async function Gh(t,s={}){const n=U.currentUser;if(!n){const m=new Error("auth_required");throw m.status=401,m}const r=bh(t),a=await n.getIdToken();await ts();const i=await _n(),o={Accept:"application/json",...s.method==="POST"?{"Content-Type":"application/json"}:{},Authorization:`Bearer ${a}`,...s.headers??{}};Object.entries(i).forEach(([m,u])=>{o[m]=u});let c;try{c=await fetch(r,{method:s.method??"POST",headers:o,body:(s.method??"POST")==="POST"?JSON.stringify(s.body??{}):void 0,signal:s.signal,credentials:"omit"})}catch(m){const u=new Error(typeof(m==null?void 0:m.message)=="string"&&m.message.length?m.message:"network_error");throw u.endpoint=r,u.payload={cause:(m==null?void 0:m.message)??String(m)},u}const h=await qN(c);if(!c.ok){const m=new Error(zN(h,c.status));throw m.status=c.status,m.endpoint=r,m.payload=h,m.code=VN(h),m}return h}function KN(t,s=0){const n=10**s;return Math.round(t*n)/n}function GN({protein:t=0,carbs:s=0,fat:n=0,alcohol:r=0,calories:a}){const i=KN(MN({protein:t,carbs:s,fat:n,alcohol:r}),0),o=Number(t||0)*4+Number(s||0)*4+Number(n||0)*9+Number(r||0)*7;return typeof a=="number"&&o<=.1&&a>0?{calories:a,reconciled:!1,caloriesFromMacros:i,caloriesInput:a}:typeof a=="number"&&Math.abs(a-i)<=5?{calories:a,reconciled:!1,caloriesFromMacros:i,caloriesInput:a}:{calories:i,reconciled:a!==void 0,caloriesFromMacros:i,caloriesInput:a}}async function Hh(t,s,n="POST"){const r=typeof Intl<"u"?new Date().getTimezoneOffset():0;return Gh(t,{method:n,body:n==="POST"?s||{}:void 0,headers:{"x-tz-offset-mins":String(r)}})}async function gl(t,s){if(js())throw new Error("demo-blocked");const n=WN({...s,...GN(s)});return await Hh("/addMeal",{dateISO:t,meal:n})}async function N_(t,s){if(js())throw new Error("demo-blocked");return Hh("/deleteMeal",{dateISO:t,mealId:s})}async function Yh(t){if(js())return uo;const s=new URLSearchParams;t&&s.set("date",t);const n=s.toString()?`?${s.toString()}`:"";return Tn(`/nutrition/daily-log${n}`,{method:"GET"})}async function Qh(t,s){if(js())return Uj.slice(0,t);const n=new URLSearchParams;n.set("days",String(t)),s&&n.set("anchorDate",s);const r=n.toString()?`?${n.toString()}`:"",a=await Tn(`/nutrition/history${r}`,{method:"GET"});return(Array.isArray(a==null?void 0:a.days)?a.days:[]).map(o=>{var c,h,m,u,d;return{date:o.date,totals:{calories:Number((c=o==null?void 0:o.totals)==null?void 0:c.calories)||0,protein:Number((h=o==null?void 0:o.totals)==null?void 0:h.protein)||0,carbs:Number((m=o==null?void 0:o.totals)==null?void 0:m.carbs)||0,fat:Number((u=o==null?void 0:o.totals)==null?void 0:u.fat)||0,alcohol:Number((d=o==null?void 0:o.totals)==null?void 0:d.alcohol)||0}}})}const ad={calories:0,protein_g:0,carbs_g:0,fat_g:0},HN=()=>{const{plan:t}=Zs(),{user:s}=He(),n=s==null?void 0:s.uid,[r,a]=l.useState(new Date),i=Tt(r,"yyyy-MM-dd"),[o,c]=l.useState({calories:0,protein_g:0,carbs_g:0,fat_g:0}),[h,m]=l.useState({calories:"",protein_g:"",carbs_g:"",fat_g:""}),[u,d]=l.useState([]),[f,p]=l.useState(null),[x,g]=l.useState(!1),[v,j]=l.useState(!1),y=l.useCallback(async()=>{if(!n)return ad;try{const T=await Yh(i),L=(T==null?void 0:T.totals)??{};return{calories:Number(L.calories)||0,protein_g:Number(L.protein??L.protein_g)||0,carbs_g:Number(L.carbs??L.carbs_g)||0,fat_g:Number(L.fat??L.fat_g)||0}}catch(T){return console.warn("coachTracker.loadLog",T),ad}},[n,i]),N=l.useCallback(async()=>{const T=await y();c(T)},[y]);l.useEffect(()=>{let T=!1;return(async()=>{const L=await y();T||c(L)})(),()=>{T=!0}},[y]);const b=l.useCallback(async()=>{if(!n)return[];try{return(await Qh(7,i)).map(L=>({date:L.date,calories:L.totals.calories||0}))}catch(T){return console.warn("coachTracker.history",T),[]}},[n,i]),w=l.useCallback(async()=>{const T=await b();d(T)},[b]);l.useEffect(()=>{let T=!1;return(async()=>{const L=await b();T||d(L)})(),()=>{T=!0}},[b]),l.useEffect(()=>{if(!n){p(null);return}let T=!1;const L=Tt($l(new Date),"yyyy-MM-dd");return ot(Se(de,"users",n,"healthDaily",L)).then(M=>{T||p(M.exists()?M.data():null)}).catch(M=>{console.warn("coachTracker.yesterday",M),T||p(null)}),()=>{T=!0}},[n]);async function I(){if(!n){V({title:"Sign in required",description:"Sign in to log meals.",variant:"destructive"});return}const T=Number(h.calories)||0,L=Number(h.protein_g)||0,M=Number(h.carbs_g)||0,X=Number(h.fat_g)||0;if(!T&&!L&&!M&&!X){V({title:"Add meal details",description:"Enter at least one macro value before saving.",variant:"destructive"});return}const re={name:C?"Manual meal":`Manual meal (${Tt(r,"MMM dd")})`,calories:T,protein:L,carbs:M,fat:X,entrySource:"coach-tracker"};try{await gl(i,re),V({title:"Meal logged",description:C?"Added to today’s totals.":`Added to ${Tt(r,"MMM dd")}.`}),m({calories:"",protein_g:"",carbs_g:"",fat_g:""}),j(!1),await N(),await w()}catch(ge){console.error("coachTracker.addMeal",ge),V({title:"Unable to log meal",description:(ge==null?void 0:ge.message)||"Please try again.",variant:"destructive"})}}const F=o.calories||0,E=(t==null?void 0:t.calorieTarget)||0,P=x?E+((f==null?void 0:f.activeEnergyKcal)||0):E,k=E>0?Math.min(F/P*100,100):0,C=Tt(r,"yyyy-MM-dd")===Tt(new Date,"yyyy-MM-dd");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Nutrition Tracker"}),(f==null?void 0:f.activeEnergyKcal)&&e.jsxs(Xe,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(Jp,{className:"h-3 w-3"}),"Yesterday: ",f.activeEnergyKcal," kcal burned"]})]}),e.jsx(Y,{children:e.jsx(Q,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>a($l(r)),children:e.jsx(Wu,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:C?"Today":Tt(r,"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Tt(r,"EEEE")})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>a(Jf(r,1)),disabled:Tt(r,"yyyy-MM-dd")>=Tt(new Date,"yyyy-MM-dd"),children:e.jsx(Hs,{className:"h-4 w-4"})})]})})}),e.jsxs(Y,{children:[e.jsx(oe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx($u,{className:"h-5 w-5 text-primary"}),"Daily Progress"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(il,{checked:x,onCheckedChange:g}),"Activity offset"]})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[F," / ",P," calories"]}),e.jsxs("span",{children:[Math.round(k),"%"]})]}),e.jsx(fl,{value:k})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-primary",children:[o.protein_g,"g"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Protein"}),t&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Goal: ",t.proteinFloor,"g"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-accent",children:[o.fat_g,"g"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Fat"}),t&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Goal: —g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-warning",children:[o.carbs_g,"g"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Carbs"}),t&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Goal: —g"})]})]}),e.jsxs(Xs,{open:v,onOpenChange:j,children:[e.jsx(al,{asChild:!0,children:e.jsxs(_,{className:"w-full",children:[e.jsx($o,{className:"mr-2 h-4 w-4"}),"Add Meal"]})}),e.jsxs(Us,{children:[e.jsx(vs,{children:e.jsx(Ns,{children:"Add a meal"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Calories"}),e.jsx(We,{type:"number",value:h.calories,onChange:T=>m({...h,calories:T.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Protein (g)"}),e.jsx(We,{type:"number",value:h.protein_g,onChange:T=>m({...h,protein_g:T.target.value}),placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Carbs (g)"}),e.jsx(We,{type:"number",value:h.carbs_g,onChange:T=>m({...h,carbs_g:T.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fat (g)"}),e.jsx(We,{type:"number",value:h.fat_g,onChange:T=>m({...h,fat_g:T.target.value}),placeholder:"0"})]})]}),e.jsxs(qt,{onClick:I,className:"w-full",children:["Add to ",C?"Today":Tt(r,"MMM dd")]})]})]})]})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"7-Day Overview"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-64",children:e.jsx(Wo,{width:"100%",height:"100%",children:e.jsxs(vg,{data:u,children:[e.jsx(qo,{dataKey:"date",tickFormatter:T=>Tt(new Date(T),"MMM dd"),fontSize:12}),e.jsx(ca,{fontSize:12}),e.jsx(zo,{labelFormatter:T=>Tt(new Date(T),"MMM dd, yyyy"),formatter:(T,L)=>[`${T} kcal`,"Calories"]}),e.jsx(da,{type:"monotone",dataKey:"calories",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))",strokeWidth:2,r:4}}),E>0&&e.jsx(da,{type:"monotone",dataKey:()=>E,stroke:"hsl(var(--muted-foreground))",strokeDasharray:"5 5",dot:!1})]})})})})]})]})},YN=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Health data"}),e.jsx("p",{className:"text-muted-foreground",children:"Health sync is coming soon. Until native connectors ship, we do not read or write any data from Apple Health or Google Fit."})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(qu,{className:"h-5 w-5"}),"Health integrations are disabled"]})}),e.jsxs(Q,{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:"We are intentionally holding back health imports until the native connectors are ready and privacy reviews are complete. You may see banners elsewhere noting that health data is unavailable—this is expected."}),e.jsxs("div",{className:"flex items-start gap-2 rounded-lg bg-muted/50 p-3",children:[e.jsx(Uu,{className:"mt-0.5 h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Privacy-first stance"}),e.jsx("p",{children:"We will only request health permissions once the connectors are live and audited. No data is pulled from your device today."})]})]}),e.jsx("div",{className:"rounded-md border border-dashed p-3 text-xs",children:"Coming soon: step counts, active energy, and resting heart rate summaries routed into your Today dashboard."})]})]})]}),ds=l.forwardRef(({className:t,...s},n)=>e.jsx(wu,{className:ae("grid gap-2",t),...s,ref:n}));ds.displayName=wu.displayName;const us=l.forwardRef(({className:t,...s},n)=>e.jsx(vu,{ref:n,className:ae("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Xf,{className:"flex items-center justify-center",children:e.jsx(Du,{className:"h-2.5 w-2.5 fill-current text-current"})})}));us.displayName=vu.displayName;const QN=()=>{const{units:t,loading:s,saving:n,error:r,setUnits:a}=Os(),{toast:i}=Cn(),o=l.useMemo(()=>[{value:"us",label:"US (lb, ft/in)",description:"Default for most users"},{value:"metric",label:"Metric (kg, cm)",description:"Use SI units for measurements"}],[]),c=async h=>{const m=h==="metric"?"metric":"us";try{await a(m),i({title:"Units updated",description:`Now showing ${m==="metric"?"metric":"US"} units.`})}catch(u){i({title:"Unable to save units",description:(u==null?void 0:u.message)||r||"Try again",variant:"destructive"})}};return e.jsx("main",{className:"p-6 max-w-md mx-auto space-y-4",children:e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Units"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx(ds,{value:t,onValueChange:c,className:"space-y-3",disabled:s||n,children:o.map(h=>e.jsxs(je,{className:"flex cursor-pointer items-start gap-3 rounded-md border p-3 hover:bg-muted/50",htmlFor:`units-${h.value}`,children:[e.jsx(us,{value:h.value,id:`units-${h.value}`,className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:h.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:h.description})]})]},h.value))}),r&&e.jsx("div",{className:"text-xs text-destructive",children:r}),e.jsx(_,{variant:"outline",size:"sm",disabled:!0,className:"w-full justify-center",children:s||n?"Saving…":"Changes save automatically"})]})]})})},JN=()=>{const{profile:t,plan:s}=Zs();return e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:JSON.stringify({profile:t,plan:s},null,2)})};class XN{constructor(){vt(this,"platform","web")}async canImport(){return!1}async requestPermissions(){return!1}async getDailySummary(s){return{source:"web"}}}var Md,Dd;const zr=(Dd=(Md=window==null?void 0:window.Capacitor)==null?void 0:Md.Plugins)==null?void 0:Dd.HealthKit;class ZN{constructor(){vt(this,"platform","ios")}async canImport(){return er.getPlatform()==="ios"}async requestPermissions(){if(er.getPlatform()!=="ios"||!zr)return!1;try{return await zr.requestAuthorization({read:["HKQuantityTypeIdentifierActiveEnergyBurned","HKQuantityTypeIdentifierStepCount","HKQuantityTypeIdentifierRestingHeartRate"],write:[]}),!0}catch{return!1}}async getDailySummary(s){if(!zr)return{source:"healthkit"};try{const n=await zr.queryStatistics({date:s});return{source:"healthkit",activeEnergyKcal:n.activeEnergyBurned??void 0,steps:n.stepCount??void 0,restingHeartRate:n.restingHeartRate??void 0}}catch{return{source:"healthkit"}}}}var Fd,Ld;const Vr=(Ld=(Fd=window==null?void 0:window.Capacitor)==null?void 0:Fd.Plugins)==null?void 0:Ld.HealthConnect;class eS{constructor(){vt(this,"platform","android")}async canImport(){return er.getPlatform()==="android"}async requestPermissions(){if(er.getPlatform()!=="android"||!Vr)return!1;try{return await Vr.requestPermission({read:["activeEnergyBurned","steps","restingHeartRate"]}),!0}catch{return!1}}async getDailySummary(s){if(!Vr)return{source:"healthconnect"};try{const n=await Vr.readDailyTotals({date:s});return{source:"healthconnect",activeEnergyKcal:n.activeEnergyBurned??void 0,steps:n.steps??void 0,restingHeartRate:n.restingHeartRate??void 0}}catch{return{source:"healthconnect"}}}}function tS(){const t=er.getPlatform(),s=l.useMemo(()=>t==="ios"?new ZN:t==="android"?new eS:new XN,[t]);async function n(){return s.requestPermissions()}async function r(a){var c;const i=await s.getDailySummary(a),o=(c=U==null?void 0:U.currentUser)==null?void 0:c.uid;if(o&&de){const h=Se(de,"users",o,"healthDaily",a);await mt(h,{...i,syncedAt:at()},{merge:!0})}return i}return{platform:t,connect:n,syncDay:r}}const sS=()=>{const{platform:t,connect:s}=tS(),[n,r]=l.useState(null),[a,i]=l.useState(null),{user:o}=He(),c=o==null?void 0:o.uid;return l.useEffect(()=>{s().then(h=>r(h))},[]),l.useEffect(()=>{if(!c)return;const h=Tt(new Date,"yyyy-MM-dd");ot(Se(de,"users",c,"healthDaily",h)).then(m=>{m.exists()&&i(m.data())})},[c]),e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:JSON.stringify({platform:t,permission:n,last:a},null,2)})};function Wt(t,s){try{const{getAnalytics:n,logEvent:r}=(window==null?void 0:window.firebaseAnalytics)||{};n&&r&&r(n(),t,s||{})}catch{}}function id(t){return new Promise(s=>setTimeout(s,t))}function nS(t){const s=t,n=typeof(s==null?void 0:s.message)=="string"?s.message:"",r=typeof(s==null?void 0:s.status)=="number"?s.status:0;if(n.includes("Load failed")||n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("ECONN")||n.includes("timeout")||[429,502,503,504].includes(r))return!0;if(n.startsWith("fn_error_")){const a=Number(n.replace("fn_error_",""));if([429,502,503,504].includes(a))return!0}return!1}async function Es(t,s){return Gh(t,{method:"POST",body:s||{}})}async function Jh(){var s,n;const t=(s=U==null?void 0:U.currentUser)==null?void 0:s.uid;if(!t)throw new Error("auth");try{const r=await ot(Se(de,"users",t,"workoutPlans_meta","current")),a=r.exists()?(n=r.data())==null?void 0:n.activePlanId:void 0;if(!a)return null;const i=await ot(Se(de,`users/${t}/workoutPlans/${a}`));if(!i.exists())return null;const o=i.data();return{id:a,...o}}catch(r){return console.warn("workouts.plan_fallback_failed",r),null}}async function rS(t){var n;const s=(n=U==null?void 0:U.currentUser)==null?void 0:n.uid;if(!s)throw new Error("auth");try{const r=Ot(de,`users/${s}/workoutPlans/${t}/progress`),a=Ft(r,Lt("updatedAt","desc"),Ht(14)),i=await mr(a),o={};return i.docs.forEach(c=>{const h=c.data();o[c.id]=Array.isArray(h==null?void 0:h.completed)?h.completed:[]}),o}catch(r){return console.warn("workouts.progress_fallback_failed",r),{}}}async function aS(t){if(Ct())throw Wt("demo_block",{action:"workout_generate"}),new Error("demo-blocked");try{return await Es("/generateWorkoutPlan",{prefs:t})}catch(s){throw typeof(s==null?void 0:s.message)=="string"&&s.message.startsWith("fn_not_found")?new Error("workouts_disabled_missing_fn"):s}}async function wr(){if(Ct())return Wt("demo_block",{action:"workout_plan"}),mo;try{return await Es("/getPlan",{})}catch(t){if(console.warn("workouts.getPlan",t),t instanceof Error&&t.message.startsWith("fn_not_found")){const s=await Jh();if(s)return s;throw new Error("workouts_disabled_missing_fn")}return null}}async function iS(t){if(Ct())throw Wt("demo_block",{action:"workout_apply_plan"}),new Error("demo-blocked");return Es("/applyCatalogPlan",t)}async function oS(t){if(Ct())throw Wt("demo_block",{action:"workout_preview_custom_plan"}),new Error("demo-blocked");const s=await Es("/previewCustomPlan",t);return{title:typeof(s==null?void 0:s.title)=="string"?s.title:"Custom plan",prefs:(s==null?void 0:s.prefs)??t.prefs,days:Array.isArray(s==null?void 0:s.days)?s.days:[]}}async function lS(t){if(Ct())throw Wt("demo_block",{action:"workout_activate_custom_plan"}),new Error("demo-blocked");const s=await Es("/applyCustomPlan",t),n=typeof(s==null?void 0:s.planId)=="string"?s.planId:"";if(!n)throw new Error("workouts_apply_invalid_response");return{planId:n}}async function cS(t){if(Ct())throw Wt("demo_block",{action:"workout_update_plan"}),new Error("demo-blocked");const s=await Es("/updateWorkoutPlan",t);return{ok:!!(s!=null&&s.ok)}}async function Xh(t){if(Ct())throw Wt("demo_block",{action:"workout_plan_status"}),new Error("demo-blocked");const s=await Es("/setWorkoutPlanStatus",t);return{ok:!!(s!=null&&s.ok)}}async function Zh(t,s){var c,h;const n=Math.max(1,Math.min(5,(s==null?void 0:s.attempts)??4)),r=Math.max(1,Math.min(8,(s==null?void 0:s.confirmPolls)??5)),a=Math.max(150,Math.min(3e3,(s==null?void 0:s.backoffMs)??500)),i=(c=U==null?void 0:U.currentUser)==null?void 0:c.uid;if(!i)throw new Error("auth");let o=null;for(let m=0;m<n;m++)try{const u=await iS(t),d=typeof(u==null?void 0:u.planId)=="string"?u.planId:"";if(!d)throw new Error("workouts_apply_invalid_response");for(let p=0;p<r;p++){const[x,g]=await Promise.all([ot(Se(de,"users",i,"workoutPlans_meta","current")),ot(Se(de,`users/${i}/workoutPlans/${d}`))]),v=x.exists()?(h=x.data())==null?void 0:h.activePlanId:void 0;if(g.exists()&&v===d)return{planId:d};await id(a*(p+1))}if((await ot(Se(de,`users/${i}/workoutPlans/${d}`))).exists())return{planId:d};throw new Error("workouts_apply_pending")}catch(u){if(o=u,m<n-1&&nS(u)){await id(a*Math.pow(2,m));continue}throw u}throw o instanceof Error?o:new Error("workouts_apply_failed")}async function xl(){if(Ct())return{planId:mo.id??"demo-plan",days:mo.days,progress:{}};try{const t=await Es("/getWorkouts",{}),s=(t==null?void 0:t.planId)??null,n=Array.isArray(t==null?void 0:t.days)?t.days:[],r=(t==null?void 0:t.progress)??{};return{planId:s,days:n,progress:r}}catch(t){if(console.warn("workouts.getWorkouts",t),t instanceof Error&&t.message.startsWith("fn_not_found")){const s=await Jh();if(!s)throw new Error("workouts_disabled_missing_fn");const n=await rS(s.id);return{planId:s.id??null,days:Array.isArray(s.days)?s.days:[],progress:n}}return null}}async function dS(t,s,n,r){if(Ct())throw Wt("demo_block",{action:"workout_done"}),new Error("demo-blocked");return Es("/markExerciseDone",{planId:t,dayIndex:s,exerciseId:n,done:r})}async function uS(t){var d,f,p;if(Ct())return Wt("demo_block",{action:"workout_weekly"}),0;const s=(d=U==null?void 0:U.currentUser)==null?void 0:d.uid;if(!s)throw new Error("auth");const n=Ot(de,`users/${s}/workoutPlans/${t}/progress`),r=await mr(n);let a=0,i=0;const o=new Date,c=o.getDay(),h=new Date(o);h.setDate(o.getDate()-(c+6)%7);const m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=await wr();for(let x=0;x<7;x++){const g=new Date(h);g.setDate(h.getDate()+x);const v=g.toISOString().slice(0,10),j=r.docs.find(b=>b.id===v),y=(f=u==null?void 0:u.days)==null?void 0:f.find(b=>b.day===m[g.getDay()]),N=Array.isArray(y==null?void 0:y.exercises)?y.exercises:[];N.length&&(a+=N.length,j&&(i+=(((p=j.data())==null?void 0:p.completed)||[]).length))}return a?i/a:0}function mS(){const t=ze(),{t:s}=La(),n=ft(),{plan:r}=Zs(),a=new Date().toISOString().slice(0,10),[i,o]=l.useState(()=>n?uo.totals:{calories:0,protein:0,carbs:0,fat:0}),[c,h]=l.useState(()=>n?Fc:{done:0,total:0});l.useEffect(()=>{if(n){o(uo.totals),h(Fc);return}let v=!1;return(async()=>{var y,N,b;try{const w=await Yh(a);v||o((w==null?void 0:w.totals)??{calories:0})}catch(w){console.warn("today.loadDailyLog",w),v||o({calories:0})}try{const w=await wr(),I=Array.isArray(w==null?void 0:w.days)?w.days:[];if(!w||I.length===0){v||h({done:0,total:0});return}const F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date().getDay()],E=I.findIndex(k=>k.day===F);if(E<0){v||h({done:0,total:0});return}const P=(y=U.currentUser)==null?void 0:y.uid;if(!P){v||h({done:0,total:I[E].exercises.length});return}try{const k=await ot(Se(de,`users/${P}/workoutPlans/${w.id}/progress/${a}`)),C=k.exists()?((b=(N=k.data())==null?void 0:N.completed)==null?void 0:b.length)??0:0;v||h({done:C,total:I[E].exercises.length})}catch(k){console.warn("today.loadWorkout",k),v||h({done:0,total:I[E].exercises.length})}}catch(w){console.warn("today.loadPlan",w),v||h({done:0,total:0})}})(),()=>{v=!0}},[n,a]);const m=()=>{Wt("start_scan_click"),t("/scan")},u=()=>{Wt("log_meal_click"),t("/meals")},d=()=>{Wt("log_workout_click"),t("/workouts")},f=(r==null?void 0:r.calorieTarget)??null,p=f&&Number.isFinite(f)?`${f.toLocaleString()} calories`:s("today.noCalorieTarget"),x=f&&f>0?Math.min((i.calories||0)/f*100,100):0,g=f&&f>0?Math.max(0,Math.round(f-(i.calories||0))):null;return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Today - MyBodyScan",description:"Your daily health and fitness plan"}),e.jsxs("main",{className:"max-w-md mx-auto p-6 space-y-6","data-testid":"today-dashboard",children:[e.jsx(Xt,{}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:s("today.title")}),e.jsx(Y,{children:e.jsxs(Q,{className:"space-y-2 py-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Health data unavailable"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Health connectors are coming soon. For now, steps and vitals won’t appear here."})]})}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{className:"text-lg",children:s("today.workout")})}),e.jsx(Q,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c.done," of ",c.total," exercises completed today"]})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{className:"text-lg",children:s("today.meals")})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Target: ",p]}),e.jsxs("span",{className:"text-sm font-medium",children:[i.calories,f&&f>0?` / ${f.toLocaleString()}`:""]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${x}%`}})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g!=null?`${g.toLocaleString()} calories remaining`:s("today.caloriesNoTarget")}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Consumed • P ",i.protein??0,"g · C"," ",i.carbs??0,"g · F ",i.fat??0,"g"]})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{className:"text-lg",children:s("today.coachingTip")})}),e.jsx(Q,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Consistency beats perfection. Small daily actions compound into significant results over time."})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(qt,{onClick:m,className:"w-full",children:s("today.scan")}),e.jsx(_,{variant:"secondary",onClick:u,className:"w-full",children:s("today.logMeal")}),e.jsx(_,{variant:"secondary",onClick:d,className:"w-full",children:s("today.logWorkout")})]})]}),e.jsx(xt,{})]})}const Qs=l.forwardRef(({className:t,...s},n)=>e.jsx(Nu,{ref:n,className:ae("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(Zf,{className:ae("flex items-center justify-center text-current"),children:e.jsx(Oo,{className:"h-4 w-4"})})}));Qs.displayName=Nu.displayName;function qn({title:t,description:s,className:n,children:r,...a}){return e.jsxs("section",{className:ae("space-y-4",n),...a,children:[(t||s)&&e.jsxs("div",{className:"space-y-1",children:[t&&e.jsx("h2",{className:"text-lg font-semibold leading-none tracking-tight",children:t}),s&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s})]}),e.jsx("div",{children:r})]})}const Fs=["About You","Your Goals","Equipment & Injuries","Activity Preferences","Diet & Notifications"],hS="/home",Ei=1,od=JSON.stringify({step:0,data:{}}),ef=["male","female","other"],fS=["lose-fat","gain-muscle","maintain","recomp"],pS=["gym","home-basic","bodyweight","none"],gS=["beginner","intermediate","advanced"],xS=["balanced","low-carb","vegetarian","vegan","keto"],hn={},yS=new Set(["unavailable","deadline-exceeded","cancelled"]),bS=new Set(["permission-denied","unauthenticated"]),jS=t=>{const s=t==null?void 0:t.code,n=typeof s=="string"?s:null,r=t==null?void 0:t.message,a=typeof r=="string"&&r.trim().length?r:null;return n&&bS.has(n)?{title:"Permission required",description:"Sign out and back in.",kind:"permission"}:n&&yS.has(n)?{title:"Offline?",description:"We’ll retry automatically.",kind:"network"}:{title:"Save failed",description:a??"Can't save progress right now. Please try again.",kind:"unknown"}},fn=t=>Math.min(Math.max(t,0),Fs.length-1),yl=t=>ef.includes(t),bl=t=>fS.includes(t),jl=t=>pS.includes(t),wl=t=>gS.includes(t),vl=t=>xS.includes(t),Ci=(t,s,n)=>{if(!(typeof t!="number"||Number.isNaN(t))&&!(s!=null&&t<s)&&!(n!=null&&t>n))return t},xn=(t,s,n)=>{if(typeof t!="number"||Number.isNaN(t))return;const r=Math.round(t);if(!(r<s||r>n))return r},yn=(t,s=280)=>{if(typeof t!="string")return;const n=t.trim();if(n)return n.slice(0,s)},_i=t=>{if(!t||typeof t!="object")return hn;const s=t;return{age:Ci(s.age,13,100),sex:yl(s.sex)?s.sex:void 0,heightCm:Ci(s.height,90,260),goal:bl(s.goal)?s.goal:void 0,timeline:Ci(s.timeline,1,36),equipment:jl(s.equipment)?s.equipment:void 0,injuries:yn(s.injuries),activities:yn(s.activities),experience:wl(s.experience)?s.experience:void 0,diet:vl(s.diet)?s.diet:void 0,likes:yn(s.likes),notifications:typeof s.notifications=="boolean"?s.notifications:void 0}},wS=(...t)=>t.reduce((s,n)=>{const r={...s};return Object.entries(n).forEach(([a,i])=>{i!==void 0&&(r[a]=i)}),r},{}),Pi=t=>{const s={},n=xn(t.age,13,100);n!=null&&(s.age=n),yl(t.sex)&&(s.sex=t.sex);const r=xn(t.heightCm,90,260);r!=null&&(s.height=r);const a=t.goal&&bl(t.goal)?t.goal:void 0;a&&(s.goal=a);const i=xn(t.timeline,1,36);i!=null&&(s.timeline=i);const o=t.equipment&&jl(t.equipment)?t.equipment:void 0;o&&(s.equipment=o);const c=t.experience&&wl(t.experience)?t.experience:void 0;c&&(s.experience=c);const h=t.diet&&vl(t.diet)?t.diet:void 0;h&&(s.diet=h);const m=yn(t.injuries);m&&(s.injuries=m);const u=yn(t.activities);u&&(s.activities=u);const d=yn(t.likes);return d&&(s.likes=d),typeof t.notifications=="boolean"&&(s.notifications=t.notifications),s},Ai=(t,s)=>JSON.stringify({step:fn(t),data:s}),tf=(t,s)=>{switch(t){case 0:return xn(s.age,13,100)==null?"Add your age.":yl(s.sex)?xn(s.heightCm,90,260)==null?"Enter your height.":null:"Select your sex.";case 1:return bl(s.goal)?null:"Pick your primary goal.";case 2:return jl(s.equipment)?null:"Tell us about your equipment access.";case 3:return wl(s.experience)?null:"Select your experience level.";default:return null}},vS=t=>{for(let s=0;s<Fs.length-1;s+=1){const n=tf(s,t);if(n)return n}return xn(t.timeline,1,36)==null?"Share a target timeline (1-36 months).":vl(t.diet)?null:"Select a diet preference."};function NS(){const t=ze(),[s]=To(),{user:n}=He(),[r,a]=l.useState(0),[i,o]=l.useState(hn),[c,h]=l.useState(!0),[m,u]=l.useState(null),[d,f]=l.useState(null),[p,x]=l.useState(null),[g,v]=l.useState(null),[j,y]=l.useState(!1),[N,b]=l.useState(0),w=l.useRef(od),I=l.useRef(!1),F=l.useRef(!1),P=l.useMemo(()=>Em(s.get("returnTo")),[s])??hS,k=l.useMemo(()=>n!=null&&n.uid&&de?Se(de,"users",n.uid):null,[n==null?void 0:n.uid,de]),C=l.useMemo(()=>n!=null&&n.uid&&de?Se(de,"users",n.uid,"meta","onboarding"):null,[n==null?void 0:n.uid,de]);l.useEffect(()=>{let z=!1;return!n||!de||!k?(h(!1),()=>{z=!0}):((async()=>{h(!0),u(null);try{const pe=C,[Ee,Ie]=await Promise.all([ot(k),pe?ot(pe):Promise.resolve(null)]);if(z)return;if(Ie!=null&&Ie.exists()){F.current=!0;const be=Ie.data();if(be.completed===!0){I.current=!0,t(P,{replace:!0});return}const me=typeof be.step=="number"?fn(be.step):fn(r),xe=Ee.exists()?_i(Ee.data().onboarding):hn,S=_i(be.draft),K=wS(hn,xe,S);o(K),a(me);const A=Pi(K);w.current=Ai(me,A);const O=be.updatedAt&&typeof be.updatedAt=="object"?be.updatedAt:null;O!=null&&O.toDate&&x(O.toDate())}else{F.current=!1;const be=Ee.exists()?_i(Ee.data().onboarding):hn;o(be),a(0),w.current=od}}catch(pe){if(z)return;u((pe==null?void 0:pe.message)||"Unable to load onboarding data."),o(hn)}finally{z||h(!1)}})(),()=>{z=!0})},[n==null?void 0:n.uid,k,C,t,N,de,P]);const T=l.useCallback(async(z,fe={})=>{if(!C)throw new Error("Missing onboarding reference.");try{const pe={updatedAt:at(),version:Ei};z.step!==void 0&&(pe.step=fn(z.step)),z.draft!==void 0&&(pe.draft=z.draft,pe.draftVersion=Ei),z.completed!==void 0&&(pe.completed=z.completed),z.completedAt!==void 0&&(pe.completedAt=z.completedAt),F.current||(pe.startedAt=at()),await mt(C,pe,{merge:!0}),F.current=!0,f(null),x(new Date)}catch(pe){throw fe.silent&&f(jS(pe)),pe}},[C]);l.useEffect(()=>{if(!C||c||!n||I.current||!de)return;const z=Pi(i),fe=Ai(r,z);if(fe===w.current)return;const pe=setTimeout(()=>{T({step:r,draft:z},{silent:!0}).then(()=>{w.current=fe}).catch(()=>{})},600);return()=>clearTimeout(pe)},[i,r,C,n,c,T,de]);const L=l.useCallback(z=>{o(fe=>({...fe,...z})),v(null)},[]),M=()=>{const z=tf(r,i);if(z){v(z),V({title:"Almost there",description:z,variant:"destructive"});return}v(null),a(fe=>fn(fe+1))},X=()=>{v(null),a(z=>fn(z-1))},ce=async()=>{const z=vS(i);if(z){v(z),V({title:"Missing details",description:z,variant:"destructive"});return}if(!k||!C){V({title:"Missing user",description:"Please sign in again to finish onboarding.",variant:"destructive"});return}const fe=Pi(i);if(Object.keys(fe).length===0){V({title:"Add your details",description:"Share at least one preference before completing onboarding.",variant:"destructive"});return}y(!0);try{const pe=at();await Promise.all([mt(k,{onboarding:{...fe,version:Ei,completedAt:pe}},{merge:!0}),T({step:Fs.length-1,completed:!0,completedAt:pe,draft:fe},{silent:!1})]),w.current=Ai(Fs.length-1,fe),I.current=!0,V({title:"Profile complete!",description:"Welcome to MyBodyScan"}),t(P,{replace:!0})}catch(pe){const Ee=typeof(pe==null?void 0:pe.code)=="string"?pe.code:null;let Ie=(pe==null?void 0:pe.message)||"Please try again.";Ee==="permission-denied"?Ie="Your account can’t save onboarding yet. This is usually a permissions issue – please refresh or contact support.":Ee==="unauthenticated"&&(Ie="Please sign in again to finish onboarding."),V({title:"Error saving profile",description:Ie,variant:"destructive"})}finally{y(!1)}};if(c)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("main",{className:"mx-auto max-w-md p-6",children:e.jsx(Jo,{label:"Loading your onboarding progress…"})})});const re=p?`Last saved at ${p.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}`:"Progress auto-saves as you go.",ge=()=>{switch(r){case 0:return e.jsx(qn,{title:"Tell us about yourself",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"age",children:"Age"}),e.jsx(We,{id:"age",type:"number",inputMode:"numeric",min:13,max:100,placeholder:"25",value:i.age??"",onChange:z=>L({age:z.target.value===""?void 0:Number(z.target.value)})})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"sex",children:"Sex"}),e.jsxs(Rt,{value:i.sex??"",onValueChange:z=>L({sex:z}),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select sex"})}),e.jsx(Et,{children:ef.map(z=>e.jsx(Ue,{value:z,children:z==="other"?"Other":z.charAt(0).toUpperCase()+z.slice(1)},z))})]})]}),e.jsxs("div",{children:[e.jsx(je,{children:"Height"}),e.jsx("div",{className:"mt-1",children:e.jsx(rl,{valueCm:i.heightCm,onChangeCm:z=>L({heightCm:z&&z>0?z:void 0})})})]})]})});case 1:return e.jsx(qn,{title:"What are your goals?",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"goal",children:"Primary goal"}),e.jsxs(Rt,{value:i.goal??"",onValueChange:z=>L({goal:z}),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select your goal"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"lose-fat",children:"Lose body fat"}),e.jsx(Ue,{value:"gain-muscle",children:"Build muscle"}),e.jsx(Ue,{value:"maintain",children:"Maintain fitness"}),e.jsx(Ue,{value:"recomp",children:"Body recomposition"})]})]})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"timeline",children:"Timeline (months)"}),e.jsx(We,{id:"timeline",type:"number",inputMode:"numeric",min:1,max:36,placeholder:"6",value:i.timeline??"",onChange:z=>L({timeline:z.target.value===""?void 0:Number(z.target.value)})})]})]})});case 2:return e.jsx(qn,{title:"Equipment & health",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"equipment",children:"Available equipment"}),e.jsxs(Rt,{value:i.equipment??"",onValueChange:z=>L({equipment:z}),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select equipment access"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"gym",children:"Full gym"}),e.jsx(Ue,{value:"home-basic",children:"Basic home gear"}),e.jsx(Ue,{value:"bodyweight",children:"Bodyweight only"}),e.jsx(Ue,{value:"none",children:"No equipment"})]})]})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"injuries",children:"Injuries or limitations"}),e.jsx(We,{id:"injuries",placeholder:"e.g., Lower back, knee issues (optional)",value:i.injuries??"",onChange:z=>L({injuries:z.target.value})})]})]})});case 3:return e.jsx(qn,{title:"Activity preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"activities",children:"Preferred activities"}),e.jsx(We,{id:"activities",placeholder:"e.g., Running, weight training, yoga",value:i.activities??"",onChange:z=>L({activities:z.target.value})})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"experience",children:"Experience level"}),e.jsxs(Rt,{value:i.experience??"",onValueChange:z=>L({experience:z}),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select experience level"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"beginner",children:"Beginner (0-6 months)"}),e.jsx(Ue,{value:"intermediate",children:"Intermediate (6 months - 2 years)"}),e.jsx(Ue,{value:"advanced",children:"Advanced (2+ years)"})]})]})]})]})});default:return e.jsx(qn,{title:"Diet & preferences",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"diet",children:"Diet type"}),e.jsxs(Rt,{value:i.diet??"",onValueChange:z=>L({diet:z}),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select diet preference"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"balanced",children:"Balanced"}),e.jsx(Ue,{value:"low-carb",children:"Low carb"}),e.jsx(Ue,{value:"vegetarian",children:"Vegetarian"}),e.jsx(Ue,{value:"vegan",children:"Vegan"}),e.jsx(Ue,{value:"keto",children:"Ketogenic"})]})]})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"likes",children:"Foods you enjoy"}),e.jsx(We,{id:"likes",placeholder:"e.g., Chicken, fish, vegetables",value:i.likes??"",onChange:z=>L({likes:z.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qs,{id:"notifications",checked:!!i.notifications,onCheckedChange:z=>L({notifications:z===!0})}),e.jsx(je,{htmlFor:"notifications",children:"Enable scan reminders and coaching tips"})]})]})})}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"mx-auto max-w-md space-y-6 p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Setup Your Profile"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["Step ",r+1," of ",Fs.length,": ",Fs[r]]})]}),m&&e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"We couldn't load everything"}),e.jsxs(st,{className:"mt-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:m}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>b(z=>z+1),children:"Retry"})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:Fs[r]})}),e.jsxs(Q,{className:"space-y-4",children:[ge(),g&&e.jsx("p",{className:"text-sm text-destructive",children:g}),e.jsx("p",{className:"text-xs text-muted-foreground",children:re}),d&&e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:d.title}),e.jsx(st,{children:d.description})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[r>0&&e.jsx(_,{variant:"outline",className:"flex-1",onClick:X,children:"Back"}),r<Fs.length-1?e.jsx(_,{className:"flex-1",onClick:M,children:"Next"}):e.jsx(qt,{className:"flex-1",disabled:j,onClick:ce,children:j?"Saving…":"Complete Setup"})]})]})})}function sf(t){if(!t)return null;const s=String(t.name||t.description||t.product_name||"").trim(),n=String(t.brand||t.brandOwner||t.brands||"").split(",")[0].trim(),r=Number(t.calories??t.energy_kcal??t.nf_calories??t.kcal)||0,a=Number(t.protein_g??t.protein??t.proteins_100g)||0,i=Number(t.carbs_g??t.carbohydrates??t.carbohydrates_100g)||0,o=Number(t.fat_g??t.fat??t.fat_100g)||0;return{name:s,brand:n,kcal:r,protein_g:a,carbs_g:i,fat_g:o}}const zn=t=>{const s=Number(t);return Number.isFinite(s)?s:null};function nf(t){var u,d,f,p,x,g,v,j,y,N,b,w,I,F,E,P,k,C;const s=String((t==null?void 0:t.id)||(t==null?void 0:t.fdcId)||(t==null?void 0:t._id)||(t==null?void 0:t.code)||Math.random().toString(36).slice(2)),n=String((t==null?void 0:t.name)||(t==null?void 0:t.description)||(t==null?void 0:t.product_name)||"Unknown").trim(),r=(t==null?void 0:t.brandName)||(t==null?void 0:t.brand)||(t==null?void 0:t.brands)||(t==null?void 0:t.brand_owner)||null,a=zn((t==null?void 0:t.calories)??(t==null?void 0:t.energyKcal)??((u=t==null?void 0:t.nutrients)==null?void 0:u.energyKcal)??((d=t==null?void 0:t.nutrients)==null?void 0:d.energy)??((f=t==null?void 0:t.nutriments)==null?void 0:f["energy-kcal_100g"])??((p=t==null?void 0:t.nutriments)==null?void 0:p.energy_kcal)??((x=t==null?void 0:t.nutriments)==null?void 0:x["energy-kcal"])??((g=t==null?void 0:t.nutriments)==null?void 0:g.energyKcal)??(t==null?void 0:t.nf_calories)),i=zn((t==null?void 0:t.protein)??((v=t==null?void 0:t.nutrients)==null?void 0:v.protein)??((j=t==null?void 0:t.nutriments)==null?void 0:j.protein_100g)??((y=t==null?void 0:t.nutriments)==null?void 0:y.proteins_100g)??((N=t==null?void 0:t.nutriments)==null?void 0:N.proteins)??((b=t==null?void 0:t.nutriments)==null?void 0:b.protein)??(t==null?void 0:t.nf_protein)),o=zn((t==null?void 0:t.carbs)??((w=t==null?void 0:t.nutrients)==null?void 0:w.carbohydrates)??((I=t==null?void 0:t.nutriments)==null?void 0:I.carbohydrates_100g)??((F=t==null?void 0:t.nutriments)==null?void 0:F.carbohydrates)??((E=t==null?void 0:t.nutriments)==null?void 0:E.carbs)??(t==null?void 0:t.nf_total_carbohydrate)),c=zn((t==null?void 0:t.fat)??((P=t==null?void 0:t.nutrients)==null?void 0:P.fat)??((k=t==null?void 0:t.nutriments)==null?void 0:k.fat_100g)??((C=t==null?void 0:t.nutriments)==null?void 0:C.fat)??(t==null?void 0:t.nf_total_fat)),h=zn((t==null?void 0:t.serving)??(t==null?void 0:t.servingSize)??(t==null?void 0:t.serving_size)),m=(t==null?void 0:t.unit)||(t==null?void 0:t.servingUnit)||(t==null?void 0:t.serving_unit)||null;return{id:s,name:n,brand:r?String(r):null,calories:a,protein:i,carbs:o,fat:c,serving:h,unit:m}}const SS=ur(hr,"nutritionSearch");function kS(t){var r,a;const s=(r=t.customData)==null?void 0:r.serverResponse,n=s==null?void 0:s.details;if(n&&typeof n=="object")return n.debugId||((a=n==null?void 0:n.details)==null?void 0:a.debugId)}function ES(t){if(t instanceof Lo){const s=t.code??"";let n="Unable to load nutrition results right now.";s.includes("invalid-argument")?n="Search query must not be empty.":s.includes("resource-exhausted")?n="You’re searching too quickly. Please slow down.":(s.includes("unavailable")||s.includes("internal"))&&(n="Food database temporarily unavailable; please try again later.");const r=new Error(n);return r.code=s||t.name,r.debugId=kS(t),r}return t instanceof Error?t:new Error("Unable to load nutrition results right now.")}async function rf(t,s){const n=t.trim();if(!n)return{status:"ok",results:[]};const r={query:n};(s==null?void 0:s.page)!=null&&(r.page=s.page),(s==null?void 0:s.pageSize)!=null&&(r.pageSize=s.pageSize),s!=null&&s.sourcePreference&&(r.sourcePreference=s.sourcePreference),await ts();try{const a=await SS(r),i=(a==null?void 0:a.data)??a,o=Array.isArray(i==null?void 0:i.results)?i.results.map(nf).filter(Boolean):[];return!i||i.status==="upstream_error"?{status:"upstream_error",results:o,message:(i==null?void 0:i.message)??"Food database temporarily unavailable; please try again later.",debugId:(i==null?void 0:i.debugId)??null}:{status:"ok",results:o,source:i.source??null,message:i.message??null,debugId:i.debugId??null}}catch(a){throw ES(a)}}function CS(t){const s=t.trim()||"000000";return{results:[{id:`demo-barcode-${s}`,name:"Demo Protein Bar",brand:"MyBodyScan Labs",basePer100g:{kcal:350,protein:33,carbs:32,fat:12},servings:[{id:"1bar",label:"1 bar",grams:60,isDefault:!0}],serving:{text:"1 bar"},source:"demo",raw:{source:"demo",barcode:s}}],source:"demo"}}function af(t){V({title:"Demo preview — sign up to use this feature.",description:t})}async function _S(){return{auth:U,user:(U==null?void 0:U.currentUser)??null}}async function PS(){const{auth:t,user:s}=await _S();if(!t){const n=new Error("auth_unavailable");throw n.code="auth_unavailable",n}if(!s){const n=new Error("auth_required");throw n.code="auth_required",n}return{auth:t,user:s}}const AS=[{id:"demo-grilled-chicken",name:"Grilled Chicken Breast (sample)",brand:"Demo meal",calories:165,protein:31,carbs:0,fat:4,source:"demo"},{id:"demo-chicken-salad",name:"Chicken Salad (sample)",brand:"Demo meal",calories:240,protein:20,carbs:8,fat:14,source:"demo"}];async function S_(t){const s=t.trim();return s?vm()?(af("Sample nutrition results are shown in demo mode."),{results:AS.map(n=>({...n})),source:"demo",message:"demo_results"}):rf(s):{results:[]}}async function k_(t,s){const n=t.trim();if(!n)return{results:[]};if(vm())return af("Sample barcode matches are shown in demo mode."),CS(n);const r=new Headers((s==null?void 0:s.headers)??void 0);r.set("Accept","application/json");const a=new URLSearchParams({code:n}).toString();let i=null;try{i=await Tn(`/nutrition/barcode?${a}`,{...s,headers:r,method:"GET"})}catch(o){throw console.error("nutrition_barcode_http_error",o),o}return i!=null&&i.items&&!i.results&&(i.results=i.items),Array.isArray(i==null?void 0:i.results)&&(i.results=i.results.map(o=>{const c=sf(o);return c?{...o,...c}:null}).filter(o=>!!o)),i??{}}async function IS(t,s){const n=bh(t);if(!n)return V({title:"Server not configured"}),new Response(null,{status:503});const{user:r}=await PS(),a=await r.getIdToken(),i=new Headers((s==null?void 0:s.headers)??void 0);i.set("Content-Type",i.get("Content-Type")||"application/json"),i.set("Authorization",`Bearer ${a}`),await ts();const o=await _n();return Object.entries(o).forEach(([c,h])=>{i.set(c,h)}),fetch(n,{...s,headers:i,credentials:"omit"})}const TS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function RS(){var xe;const{t}=La(),s=Qt(),n=ze(),r=new URLSearchParams(s.search),a=r.get("plan"),i=r.get("started")==="1",[o,c]=l.useState(null),[h,m]=l.useState([]),[u,d]=l.useState(0),[f,p]=l.useState(0),[x,g]=l.useState(""),[v,j]=l.useState(""),[y,N]=l.useState(!1),[b,w]=l.useState(null),[I,F]=l.useState(!1),{health:E,error:P}=ns(),{workoutsConfigured:k,workoutAdjustConfigured:C}=ss(E??void 0),T=k?null:"Workout APIs are offline. Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to enable plan generation.",L=C?null:"AI workout adjustments require the OpenAI key (OPENAI_API_KEY) on Cloud Functions.",M=!C||!k,X=TS[new Date().getDay()],ce=new Date().toISOString().slice(0,10),re=o==null?void 0:o.days.find(S=>S.day===X),ge=Array.isArray(re==null?void 0:re.exercises)?re.exercises:[],z=h.length,fe=ge.length,pe=l.useCallback(async(S,K)=>{var J,G;if(!k||!S||!Array.isArray(S.days))return;const A=S.days.findIndex($=>$.day===X);if(A<0)return;const O=(J=U.currentUser)==null?void 0:J.uid;if(O)try{const $=await ot(Se(de,`users/${O}/workoutPlans/${S.id}/progress/${ce}`));if(K!=null&&K())return;const R=$.exists()?((G=$.data())==null?void 0:G.completed)??[]:[];K!=null&&K()||(m(R),d(S.days[A].exercises.length?R.length/S.days[A].exercises.length:0))}catch($){console.warn("workouts.progress",$),K!=null&&K()||(m([]),d(0))}},[ce,X,k]);l.useEffect(()=>{let S=!1,K=null;const A=()=>{S=!0,K&&clearTimeout(K)};if(!k)return c(null),m([]),d(0),p(0),F(!1),w("Workouts are disabled because the Cloud Functions base URL isn't configured. Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to enable workouts."),A;const O=async(J=0)=>{try{const G=await wr();if(!G){if(a&&J<3){S||(F(!0),w(null)),K=setTimeout(()=>O(J+1),800*(J+1));return}S||(F(!1),c(null),m([]),d(0),p(0),w("Workouts are unavailable right now. Check your connection or try again later."));return}if(a&&G.id!==a){if(J<3){S||(F(!0),w(null)),K=setTimeout(()=>O(J+1),800*(J+1));return}S||(F(!1),w("We’re still preparing your new program. Pull down to refresh or try again."));return}S||(F(!1),c(G),w(null)),await pe(G,()=>S);try{const $=await uS(G.id);S||p($)}catch($){console.warn("workouts.weekly",$),S||p(0)}}catch(G){console.warn("workouts.plan",G);const $=G instanceof Error&&G.message.includes("workouts_disabled")?"Workouts are disabled because the backend URL isn't configured. Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to enable workouts.":"Workouts are unavailable right now. Check your connection or try again later.";S||(F(!1),c(null),m([]),d(0),p(0),w($))}};return O(),A},[pe,a,k]);const Ee=async S=>{if(!o||!Array.isArray(o.days))return;const K=o.days.findIndex(O=>O.day===X);if(K<0){V({title:"Workout day unavailable",description:"We couldn’t find today in your plan. Try refreshing or starting a new program.",variant:"destructive"});return}const A=!h.includes(S);try{const O=await dS(o.id,K,S,A);m(A?[...h,S]:h.filter(J=>J!==S)),d(O.ratio),A&&Wt("workout_mark_done",{exerciseId:S}),Ct()&&V({title:"Sign up to save your progress."})}catch(O){if((O instanceof Error?O.message:"")==="demo-blocked"){V({title:"Create an account",description:"Demo mode cannot save workouts.",variant:"destructive"});return}V({title:"Update failed",description:"Please try again.",variant:"destructive"})}},Ie=async()=>{if(!k){const S=T??"Workout APIs are offline. Set the Cloud Functions base URL before generating a plan.";w(S),V({title:"Workouts offline",description:S,variant:"destructive"});return}try{const S=await aS({focus:"back"});if(!S)return;const K={id:S.planId,days:S.days};c(K),m([]),d(0),p(0),w(null)}catch(S){const K=S instanceof Error?S.message:"";if(K==="demo-blocked"){V({title:"Create an account",description:"Demo mode cannot generate plans.",variant:"destructive"});return}if(typeof K=="string"&&K.includes("workouts_disabled")){const A=T??"Workouts are turned off because the Cloud Functions base URL is missing. Add it to enable workout generation.";w(A),V({title:"Workouts offline",description:A,variant:"destructive"});return}V({title:"Unable to generate",description:"Please try again later.",variant:"destructive"})}};l.useEffect(()=>{if(i&&o&&(!a||o.id===a)){V({title:"Plan ready",description:"Your new workout program is active."});const S=new URLSearchParams(r);S.delete("started"),S.delete("plan");const K=S.toString(),A=`${s.pathname}${K?`?${K}`:""}`;window.history.replaceState({},"",A)}},[s.pathname,o,a,r,i]);const be=S=>S>=0?`+${S}`:`${S}`,me=async()=>{if(o){if(!x){V({title:"Select how your body feels"});return}if(!k){V({title:"Workouts offline",description:T??"Workout APIs are offline. Configure the Cloud Functions URL before adjusting.",variant:"destructive"});return}if(M){V({title:"Adjustments unavailable",description:L??T??"AI workout adjustments are offline. Configure OPENAI_API_KEY to re-enable.",variant:"destructive"});return}try{N(!0);const S=await IS("/workouts/adjust",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dayId:X,bodyFeel:x,notes:v})}),K=await S.text();let A={};if(K)try{const W=JSON.parse(K);W&&typeof W=="object"&&(A=W)}catch{A={}}if(!S.ok){const W=(A==null?void 0:A.error)||(A==null?void 0:A.message)||`adjust_failed_${S.status}`;throw new Error(W)}const O=typeof A.mods=="object"&&A.mods!==null?A.mods??{}:{},J=Number(O.intensity??0),G=Number(O.volume??0);if(re){const W=Number.isFinite(G)?G:0,ie={...o},le=ie.days.findIndex(q=>q.day===X);le>=0&&(ie.days=ie.days.map((q,ee)=>ee===le?{...q,exercises:q.exercises.map(H=>({...H,sets:Math.max(1,(Number(H.sets)||0)+W)}))}:q),c(ie))}const $=A.summary,R=typeof $=="string"&&$.trim().length?$.trim():null;V({title:"Plan adjusted",description:R??`Intensity ${be(J)} · Volume ${be(G)}`}),g(""),j("")}catch(S){V({title:"Unable to adjust",description:S instanceof Error?S.message:"Try again",variant:"destructive"})}finally{N(!1)}}};return o?e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Workouts - MyBodyScan",description:"Track your daily workout routine"}),e.jsxs("main",{className:"max-w-md mx-auto p-6 space-y-6",children:[e.jsx(Xt,{}),P?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"System health unavailable"}),e.jsx(st,{children:P})]}):null,T?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Workouts offline"}),e.jsx(st,{children:T})]}):null,e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-lg",children:"Your plan"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o!=null&&o.title?o.title:"Active plan"," · ",((xe=o==null?void 0:o.days)==null?void 0:xe.length)??0," days/week"]})]}),e.jsxs(Q,{className:"flex flex-col gap-2",children:[e.jsx(_,{onClick:()=>n("/programs"),variant:"outline",className:"w-full",children:"Change plan / Programs"}),e.jsx(_,{onClick:()=>n("/programs/customize?fromActive=1"),variant:"outline",className:"w-full",children:"Customize plan"}),cameFromPlanStart?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your new program is active. If today looks wrong, pull down to refresh."}):null]})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(Hr,{className:"w-8 h-8 text-primary mx-auto"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:t("workouts.title")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z," of ",fe," exercises completed"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(f*100),"% this week"]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${u*100}%`}})}),ge.length>0?e.jsxs("div",{className:"space-y-4",children:[ge.map(S=>e.jsx(Y,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qs,{id:S.id,checked:h.includes(S.id),onCheckedChange:()=>Ee(S.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-foreground",children:S.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Number.isFinite(Number(S.sets))?Number(S.sets):"—"," ","sets × ",S.reps??"—"," reps"]})]})]})})},S.id)),e.jsx(Y,{children:e.jsxs(Q,{className:"p-4 space-y-3",children:[e.jsx("div",{className:"font-medium text-foreground",children:"How did your body feel today?"}),L&&e.jsxs(tt,{variant:"default",className:"border-dashed",children:[e.jsx(rt,{children:"Adjustments paused"}),e.jsx(st,{children:L})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["great","ok","tired","sore"].map(S=>e.jsx(_,{type:"button",variant:x===S?"default":"outline",size:"sm",onClick:()=>g(S),disabled:M,children:S==="great"?"Great":S==="ok"?"OK":S==="tired"?"Tired":"Sore"},S))}),e.jsx("textarea",{className:"w-full rounded-md border bg-background p-2 text-sm",rows:2,placeholder:"Notes (optional)",value:v,onChange:S=>j(S.target.value),disabled:M}),e.jsx("div",{className:"flex justify-end",children:e.jsx(_,{onClick:me,disabled:!x||y||M,children:y?"Saving…":"Save adjustment"})})]})})]}):e.jsx(Y,{children:e.jsxs(Q,{className:"p-8 text-center",children:[e.jsx(Hr,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Rest day"})]})})]}),e.jsx(xt,{})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Workouts - MyBodyScan",description:"Track your daily workout routine"}),e.jsx("main",{className:"max-w-md mx-auto p-6 space-y-6",children:e.jsx(Y,{children:e.jsxs(Q,{className:"p-8 text-center",children:[e.jsx(Hr,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-4",children:"No workout plan yet"}),b&&e.jsx("p",{className:"mb-4 text-sm text-destructive",children:b}),I&&e.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:"Activating your new program… this usually takes a few seconds."}),T&&e.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:T}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(_,{onClick:()=>n("/programs/customize"),className:"w-full",disabled:!k,children:[e.jsx($o,{className:"w-4 h-4 mr-2"}),"Customize my plan"]}),e.jsx(_,{variant:"outline",onClick:()=>n("/programs"),className:"w-full",children:"Browse programs"}),e.jsx(_,{variant:"outline",onClick:Ie,className:"w-full",disabled:!k,children:"Quick start (auto)"}),b&&k&&e.jsx(_,{variant:"outline",className:"w-full",onClick:()=>window.location.reload(),children:"Retry loading"})]})]})})}),e.jsx(xt,{})]})}function Zn(){const{t}=La();return e.jsxs(tt,{className:"mb-4",children:[e.jsx(Xp,{className:"h-4 w-4"}),e.jsx(st,{className:"text-xs",children:t("legal.notMedicalAdvice")})]})}const MS=ur(hr,"coachChat");function DS(t){var r,a;const s=(r=t.customData)==null?void 0:r.serverResponse,n=s==null?void 0:s.details;if(n&&typeof n=="object")return n.debugId||((a=n==null?void 0:n.details)==null?void 0:a.debugId)}function FS(t){if(t instanceof Lo){const s=t.code??"";let n=t.message||"Coach is unavailable right now; please try again shortly.";s.includes("invalid-argument")?n="Please enter a question for the coach.":s.includes("unauthenticated")?n="Please sign in again to use coach chat.":s.includes("permission-denied")?n="Coach is available on an active plan or Unlimited. Visit Plans to activate your account.":s.includes("resource-exhausted")?n="You’ve hit the coach limit. Wait a moment before asking again.":s.includes("failed-precondition")?n="Coach is not fully configured. Please try again later.":(s.includes("unavailable")||s.includes("internal"))&&(n="Coach is unavailable right now; please try again shortly.");const r=new Error(n);return r.code=s||t.name,r.debugId=DS(t),r}return t instanceof Error?t:new Error("Coach is unavailable right now; please try again shortly.")}function LS(t){if(!Array.isArray(t))return;const s=t.map(n=>typeof n=="string"?n.trim():"").filter(n=>n.length>0);return s.length?s:void 0}async function BS(t){var s,n;await ts();try{const r=await MS(t),a=(r==null?void 0:r.data)??r,i=typeof(a==null?void 0:a.reply)=="string"&&a.reply.trim().length?a.reply.trim():"";if(!i)throw new Error("Coach did not send a reply. Please try again.");const o=(s=a==null?void 0:a.meta)==null?void 0:s.metadata,c=(o==null?void 0:o.recommendedSplit)??null,h=LS(a==null?void 0:a.suggestions),m=(n=a==null?void 0:a.meta)==null?void 0:n.debugId;return{replyText:i,planSummary:c,metadata:o,suggestions:h,debugId:m,threadId:typeof(a==null?void 0:a.threadId)=="string"?a.threadId:void 0,assistantMessageId:typeof(a==null?void 0:a.assistantMessageId)=="string"?a.assistantMessageId:void 0}}catch(r){throw FS(r)}}let OS=class extends l.Component{constructor(){super(...arguments);vt(this,"state",{hasError:!1});vt(this,"handleRetry",()=>{var n,r;this.setState({hasError:!1,errorMessage:void 0}),(r=(n=this.props).onRetry)==null||r.call(n)})}static getDerivedStateFromError(n){return{hasError:!0,errorMessage:n==null?void 0:n.message}}componentDidCatch(n,r){}render(){return this.state.hasError?e.jsxs("div",{className:"min-h-[240px] flex flex-col items-center justify-center gap-4 rounded-lg border border-border/60 bg-muted/40 p-6 text-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:this.props.title??"Something went wrong"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:this.props.description??"We hit a snag loading this page. Try again in a moment."}),this.state.errorMessage?e.jsx("p",{className:"text-xs text-muted-foreground/80",children:this.state.errorMessage}):null]}),e.jsx(_,{size:"sm",variant:"secondary",onClick:this.handleRetry,children:"Retry"})]}):this.props.children}};function US(t){return[...t].sort((s,n)=>{const r=s.createdAt.getTime(),a=n.createdAt.getTime();return r!==a?r-a:s.id.localeCompare(n.id)})}const Ii={calories:0,proteinGrams:0,carbGrams:0,fatGrams:0};function $S(t){const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${r}`}function Ps(t){const s=Number(t);return Number.isFinite(s)?s:0}function WS(){const{user:t,authReady:s}=He(),n=s?(t==null?void 0:t.uid)??null:null,[r,a]=l.useState(Ii),[i,o]=l.useState(!1),[c,h]=l.useState(null),[m,u]=l.useState(null),[d,f]=l.useState(!1),[p,x]=l.useState(null),g=l.useMemo(()=>$S(new Date),[]);return l.useEffect(()=>{if(!n){a(Ii),o(!1),h(null);return}o(!0),h(null);const v=Se(de,"users",n,"nutritionLogs",g),j=dt(v,y=>{const N=y.exists()?y.data():null,b=(N==null?void 0:N.totals)||{};a({calories:Ps(b.calories??(N==null?void 0:N.calories)),proteinGrams:Ps(b.protein??b.protein_g??(N==null?void 0:N.protein_g)),carbGrams:Ps(b.carbs??b.carbs_g??(N==null?void 0:N.carbs_g)),fatGrams:Ps(b.fat??b.fat_g??(N==null?void 0:N.fat_g))}),o(!1)},y=>{o(!1),h((y==null?void 0:y.code)||(y==null?void 0:y.message)||"nutrition_unavailable"),a(Ii)});return()=>j()},[n,g]),l.useEffect(()=>{if(!n){u(null),f(!1),x(null);return}f(!0),x(null);const v=Ft(Ot(de,"users",n,"scans"),Lt("createdAt","desc"),Ht(1)),j=dt(v,y=>{if(y.empty){u(null),f(!1);return}const b=y.docs[0].data(),w=Jt(b==null?void 0:b.createdAt)??Jt(b==null?void 0:b.completedAt);if(!w){u(null),f(!1);return}const I=(()=>{var E;const F=Ps((E=b==null?void 0:b.estimate)==null?void 0:E.bodyFatPercent)||Ps(b==null?void 0:b.bodyFatPercentage)||Ps(b==null?void 0:b.body_fat)||Ps(b==null?void 0:b.bodyfat);return F>0?F:void 0})();u({createdAt:w,bodyFatPercent:I}),f(!1)},y=>{f(!1),x((y==null?void 0:y.code)||(y==null?void 0:y.message)||"scan_unavailable"),u(null)});return()=>j()},[n]),{uid:n,todayKey:g,totals:r,nutritionLoading:i,nutritionError:c,latestScan:m,scanLoading:d,scanError:p}}function qS(t){return t.demo?!1:Ta(t.entitlements)}function Nl(t){return t.demo?!1:Ta(t.entitlements)}const Kr="demo-thread",Ti=ro.messages.flatMap((t,s)=>{const n=new Date(Date.now()-(ro.messages.length-s)*60*60*1e3);return[{id:`${t.id}-u`,role:"user",content:t.message,createdAt:n},{id:`${t.id}-a`,role:"assistant",content:t.reply,createdAt:new Date(n.getTime()+1e3),usedLLM:!0}]}),Ri=US;function os(t){return(t==null?void 0:t.code)==="permission-denied"||(t==null?void 0:t.code)==="permission_denied"||String((t==null?void 0:t.code)||"").includes("permission-denied")}function zS({session:t}){return e.jsxs("div",{className:"rounded-lg border border-dashed border-muted-foreground/30 p-3",children:[e.jsx("p",{className:"font-medium text-foreground",children:t.day}),t.blocks.map((s,n)=>e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsx("p",{className:"font-semibold text-primary/80",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.focus}),e.jsx("ul",{className:"list-disc pl-4 text-muted-foreground/90",children:s.work.map((r,a)=>e.jsx("li",{children:r},a))})]},n))]})}function VS(){const{toast:t}=Cn(),s=ft(),{plan:n}=Zs(),r=Qt(),{entitlements:a,loading:i}=xr(),o=l.useRef(new Set),c=l.useRef(new Set),[h,m]=l.useState(()=>s?[{id:Kr,createdAt:new Date(Date.now()-7*24*60*60*1e3),updatedAt:new Date,lastMessagePreview:"Demo conversation"}]:[]),[u,d]=l.useState(()=>s?Kr:null),[f,p]=l.useState(()=>s?Ti:[]),[x,g]=l.useState(!1),[v,j]=l.useState(""),[y,N]=l.useState(!1),[b,w]=l.useState(null),[I,F]=l.useState(!1),[E,P]=l.useState(!1),[k,C]=l.useState(null),T=()=>typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,L=!!T(),{health:M}=ns(),{coachConfigured:X}=ss(M??void 0),ce=(M==null?void 0:M.openaiConfigured)===!1||(M==null?void 0:M.openaiKeyPresent)===!1?"Coach chat requires the OpenAI key (OPENAI_API_KEY). Ask an admin to add it.":X===!1?"Coach chat is offline until the backend configuration is completed.":null,re=X&&!ce,ge=qS({demo:s,entitlements:a}),{totals:z,latestScan:fe}=WS(),pe=()=>{if(!L||E)return;const q=T(),ee=new q;ee.lang="en-US",ee.interimResults=!0,ee.continuous=!0,ee.onresult=H=>{let ye="";for(let Ne=H.resultIndex;Ne<H.results.length;Ne++)ye+=H.results[Ne][0].transcript;j(Ne=>(Ne?Ne+" ":"")+ye.trim())},ee.onend=()=>P(!1),ee.onerror=()=>P(!1),ee.start(),C(ee),P(!0)},Ee=()=>{var q;try{(q=k==null?void 0:k.stop)==null||q.call(k)}catch{}P(!1)};l.useEffect(()=>()=>{var q;try{(q=k==null?void 0:k.stop)==null||q.call(k)}catch{}},[k]);const{user:Ie,authReady:be}=He(),me=!0,xe=`/auth?next=${encodeURIComponent(`${r.pathname}${r.search}`)}`,S=be?(Ie==null?void 0:Ie.uid)??null:null,K=!be,A=S?`mbs_coach_active_thread_v1:${S}`:null,O=l.useCallback(async()=>{try{Ie&&typeof Ie.getIdToken=="function"&&await Ie.getIdToken(!0)}catch{}},[Ie]);l.useEffect(()=>{if(s){m([{id:Kr,createdAt:new Date(Date.now()-7*24*60*60*1e3),updatedAt:new Date,lastMessagePreview:"Demo conversation"}]),d(Kr),p(Ti),F(!1);return}if(!be||!me||!S){m([]),d(null),p([]),F(!1);return}if(i){F(!0);return}if(!ge){m([]),d(null),p([]),F(!1),w(Bt()?"Coach is a Pro feature. Upgrade to Pro to unlock Coach.":"Coach is a Pro feature. Visit Plans to upgrade and unlock Coach.");return}F(!0);let q=!1,ee=!1;const H=Ft(Bj(S),Lt("updatedAt","desc"),Ht(20)),ye=()=>dt(H,Re=>{const Qe=new Date,nt=Re.docs.map(Fe=>{var te;const Ve=((te=Fe.data)==null?void 0:te.call(Fe))??null;if(!Ve)return null;const wt=Ve==null?void 0:Ve.createdAt,qe=Ve==null?void 0:Ve.updatedAt,It=Jt(wt)??Qe,rs=Jt(qe)??It;if(!Jt(qe)){const Me=Fe.id;o.current.has(Me)||(o.current.add(Me),Ye({kind:"data_missing",message:"coachThread missing updatedAt",extra:{threadId:Fe.id}}))}return{id:Fe.id,createdAt:It,updatedAt:rs,lastMessagePreview:typeof(Ve==null?void 0:Ve.lastMessagePreview)=="string"?Ve.lastMessagePreview:null}}).filter(Fe=>!!Fe).sort((Fe,Ve)=>{var te,Me,Ze,De,Je,zt,ct,as,Ut,Nt,Cs,vr;const wt=((Me=(te=Fe.updatedAt)==null?void 0:te.getTime)==null?void 0:Me.call(te))??((De=(Ze=Fe.createdAt)==null?void 0:Ze.getTime)==null?void 0:De.call(Ze))??0,qe=((zt=(Je=Ve.updatedAt)==null?void 0:Je.getTime)==null?void 0:zt.call(Je))??((as=(ct=Ve.createdAt)==null?void 0:ct.getTime)==null?void 0:as.call(ct))??0;if(wt!==qe)return qe-wt;const It=((Nt=(Ut=Fe.createdAt)==null?void 0:Ut.getTime)==null?void 0:Nt.call(Ut))??0,rs=((vr=(Cs=Ve.createdAt)==null?void 0:Cs.getTime)==null?void 0:vr.call(Cs))??0;return It!==rs?rs-It:Fe.id.localeCompare(Ve.id)});if(!nt.length){m([{id:"__legacy",createdAt:new Date(Date.now()-365*24*60*60*1e3),updatedAt:new Date,lastMessagePreview:"Previous chats"}]),d(Fe=>Fe??"__legacy"),F(!1);return}m(nt),F(!1);const ke=A&&typeof window<"u"?window.localStorage.getItem(A):null,At=ke&&nt.some(Fe=>Fe.id===ke);d(Fe=>Fe&&nt.some(Ve=>Ve.id===Fe)?Fe:At?ke:nt[0].id)},async Re=>{if(console.warn("coachThreads.snapshot_failed",Re),pn(Re,{op:"coachThreads.onSnapshot",path:S?`users/${S}/coachThreads`:void 0}),Ye({kind:"coach_threads_snapshot_failed",message:(Re==null?void 0:Re.message)||"coachThreads snapshot failed",code:(Re==null?void 0:Re.code)||"snapshot_failed",extra:{uid:S,entitled:ge}}),F(!1),os(Re)&&!ee){ee=!0,await O(),Ne(),Ne=ye();return}q||(q=!0,w(os(Re)?"Coach is temporarily unavailable. Please try again later or contact support.":"Unable to load coach chats. Please try again in a moment."))});let Ne=ye();return()=>Ne()},[be,S,s,A,t,O,ge]),l.useEffect(()=>{if(s){p(Ti);return}if(!be||!S||!u){p([]);return}if(u==="__legacy"){let Re=!1,Qe=!1;const nt=Ft(Lj(S),Lt("createdAt","desc"),Ht(10)),ke=()=>dt(nt,Fe=>{const Ve=Fe.docs.flatMap(wt=>{const qe=wt.data(),It=Jt(qe==null?void 0:qe.createdAt)??new Date,rs=Array.isArray(qe==null?void 0:qe.suggestions)?qe.suggestions.map(De=>typeof De=="string"?De.trim():"").filter(De=>De.length>0):void 0,te=typeof(qe==null?void 0:qe.text)=="string"?qe.text:"",Me=typeof(qe==null?void 0:qe.response)=="string"?qe.response:"",Ze=!!(qe!=null&&qe.usedLLM);return[{id:`${wt.id}-u`,role:"user",content:te,createdAt:It},{id:`${wt.id}-a`,role:"assistant",content:Me,createdAt:new Date(It.getTime()+1e3),usedLLM:Ze,suggestions:rs??null}]});p(Ri(Ve))},async Fe=>{if(console.warn("coachChat.snapshot_failed",Fe),pn(Fe,{op:"coachChatLegacy.onSnapshot",path:S?co(S):void 0}),Ye({kind:"coach_legacy_snapshot_failed",message:(Fe==null?void 0:Fe.message)||"coachChat legacy snapshot failed",code:(Fe==null?void 0:Fe.code)||"snapshot_failed",extra:{uid:S,entitled:ge}}),os(Fe)&&!Qe){Qe=!0,await O(),At(),At=ke();return}Re||(Re=!0,w(os(Fe)?"Coach is temporarily unavailable. Please try again later or contact support.":"Unable to load recent coach messages."))});let At=ke();return()=>At()}A&&typeof window<"u"&&window.localStorage.setItem(A,u);const q=Ft(ri(S,u),Lt("createdAt","asc"),Ht(80));let ee=!1,H=!1;const ye=()=>dt(q,Re=>{const Qe=Re.docs.map(nt=>{const ke=nt.data(),At=ke==null?void 0:ke.createdAt,Fe=Jt(At)??new Date;if(!Jt(At)){const qe=`${u}:${nt.id}`;c.current.has(qe)||(c.current.add(qe),Ye({kind:"data_missing",message:"coachThread message missing createdAt",extra:{threadId:u,messageId:nt.id}}))}const Ve=(ke==null?void 0:ke.role)==="assistant"?"assistant":"user",wt=Array.isArray(ke==null?void 0:ke.suggestions)?ke.suggestions.map(qe=>typeof qe=="string"?qe.trim():"").filter(qe=>qe.length>0):null;return{id:nt.id,role:Ve,content:typeof(ke==null?void 0:ke.content)=="string"?ke.content:"",createdAt:Fe,usedLLM:Ve==="assistant",suggestions:wt}});p(Qe)},async Re=>{if(console.warn("coachThread.messages.snapshot_failed",Re),pn(Re,{op:"coachThreadMessages.onSnapshot",path:S&&u?`users/${S}/coachThreads/${u}/messages`:void 0}),Ye({kind:"coach_thread_messages_snapshot_failed",message:(Re==null?void 0:Re.message)||"coachThread messages snapshot failed",code:(Re==null?void 0:Re.code)||"snapshot_failed",extra:{uid:S,threadId:u,entitled:ge}}),os(Re)&&!H){H=!0,await O(),Ne(),Ne=ye();return}ee||(ee=!0,w(os(Re)?"Coach is temporarily unavailable. Please try again later or contact support.":"Unable to load coach thread."))});let Ne=ye();return()=>Ne()},[be,S,s,u,A,O,ge]);const J=f.length>0,G=s&&!Ie,$=!s&&!n,R=async()=>{if(s){_t();return}if(!be||!S){t({title:"Sign in required",description:"Sign in to start a new coach chat.",variant:"destructive"});return}const q=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`thread-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;try{const ee={uid:S,createdAt:at(),updatedAt:at(),status:"active"};try{await mt(ni(S,q),ee,{merge:!0})}catch(H){if(os(H))await O(),await mt(ni(S,q),ee,{merge:!0});else throw H}}catch(ee){console.warn("coachChat.new_thread_failed",ee),t({title:"Unable to start a new chat",description:os(ee)?"We couldn’t start a new coach chat. Please try again, and contact support if this continues.":"Please try again in a moment.",variant:"destructive"}),w(os(ee)?"We couldn’t start a new coach chat. Please try again, and contact support if this continues.":"Unable to start a new coach chat.");return}m(ee=>[{id:q,createdAt:new Date,updatedAt:new Date,lastMessagePreview:null},...ee.filter(H=>H.id!=="__legacy"&&H.id!==q)]),d(q),j(""),w(null)},W=async()=>{var ee;if(x)return;if(s){_t();return}if(!re){w(ce??"Coach chat is disabled until it is fully configured.");return}if(!lj("coach chat"))return;const q=v.split("").map(H=>{const ye=H.codePointAt(0)??0;return ye<32||ye===127?" ":H}).join("").replace(/\s+/g," ").trim();if(!q){j("");return}if(K){t({title:"Still connecting",description:"Secure chat is initializing. Try again shortly."});return}g(!0),w(null);try{if(!S)throw new Error("auth_required");const H=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;let ye=u&&u!=="__legacy"?u:null;ye||(ye=H(),await mt(ni(S,ye),{uid:S,createdAt:at(),updatedAt:at(),status:"active"}),m(Qe=>[{id:ye,createdAt:new Date,updatedAt:new Date,lastMessagePreview:null},...Qe.filter(ke=>ke.id!=="__legacy")]),d(ye));const Ne=H();p(Qe=>Ri([...Qe,{id:Ne,role:"user",content:q,createdAt:new Date}])),await mt(Se(ri(S,ye),Ne),{role:"user",content:q,createdAt:at()},{merge:!0}).catch(async Qe=>{if(os(Qe))return await O(),mt(Se(ri(S,ye),Ne),{role:"user",content:q,createdAt:at()},{merge:!0});throw Qe});const Re={threadId:ye,messageId:Ne,message:q,context:s?void 0:{todayCalories:z.calories,todayCaloriesGoal:n==null?void 0:n.calorieTarget,todayProteinGrams:z.proteinGrams,todayCarbGrams:z.carbGrams,todayFatGrams:z.fatGrams,todayProteinGoalGrams:n==null?void 0:n.proteinFloor,lastScanDate:(ee=fe==null?void 0:fe.createdAt)==null?void 0:ee.toISOString(),lastScanBodyFatPercent:fe==null?void 0:fe.bodyFatPercent}};await BS(Re),j("")}catch(H){console.error("coachChat error",H),pn(H,{op:"coachChat.callable"});const ye=H==null?void 0:H.code,Ne=typeof(H==null?void 0:H.message)=="string"&&H.message!=="Bad Request"?H.message:"",Re=ye==="invalid_message"?"Please enter a question for the coach.":"Coach is unavailable right now; please try again shortly.",Qe=H==null?void 0:H.debugId,nt=Qe?`${Ne||Re} (ref ${Qe.slice(0,8)})`:Ne||Re;w(nt),Ye({kind:"client_error",message:Ne||"coachChat failed",code:(H==null?void 0:H.code)||"client_error",extra:{fn:"coachChat"}})}finally{g(!1)}},ie=async()=>{if(s){_t();return}if(!be){t({title:"Initializing",description:"Secure services are almost ready. Try again in a moment."});return}N(!0);try{await es("generatePlan",{}),t({title:"Weekly plan updated",description:"Your coach plan was regenerated."})}catch(q){t(ls(q,{fallback:{title:"Unable to regenerate",description:"Please try again in a moment.",variant:"destructive"}}))}finally{N(!1)}},le=l.useMemo(()=>Ri(f),[f]);return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0","data-testid":"route-coach",children:[e.jsx(Ce,{title:"Coach Chat ? MyBodyScan",description:"Talk to your AI coach and refresh your weekly plan."}),e.jsxs(OS,{title:"Coach chat crashed",description:"Retry to reload your recent messages.",children:[e.jsxs("main",{className:"mx-auto flex w-full max-w-5xl flex-col gap-6 p-6",children:[e.jsx(Zn,{}),G?e.jsxs(tt,{variant:"default","data-testid":"coach-demo-intro",children:[e.jsx(rt,{children:"Demo preview"}),e.jsxs(st,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{children:ro.intro}),e.jsx(_,{asChild:!0,size:"sm",variant:"outline",children:e.jsx("a",{href:xe,children:"Sign up to use this feature"})})]})]}):null,$?e.jsxs(tt,{variant:"default","data-testid":"coach-plan-missing",children:[e.jsx(rt,{children:"No plan yet ? create one"}),e.jsx(st,{children:"Start a conversation or regenerate the weekly plan below to get your first program."})]}):null,K&&e.jsx(Y,{className:"border border-dashed border-primary/40 bg-primary/5",children:e.jsx(Q,{className:"text-sm text-primary",children:"Preparing secure chat? replies will appear once verification completes."})}),!s&&be&&me&&!J&&I?e.jsx(Y,{className:"border border-dashed",children:e.jsx(Q,{className:"text-sm text-muted-foreground",children:"Loading your recent coach messages…"})}):null,e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.75fr,1fr]",children:[e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(he,{className:"text-xl",children:"Coach chat"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:u??"",onChange:q=>{const ee=q.target.value||null;d(ee),w(null)},disabled:!h.length||G,"aria-label":"Select chat thread",children:h.map(q=>e.jsx("option",{value:q.id,children:q.id==="__legacy"?"Previous chats":q.lastMessagePreview?q.lastMessagePreview.slice(0,28):`Chat ${q.id.slice(0,8)}`},q.id))}),e.jsx(_,{size:"sm",variant:"outline",onClick:R,disabled:G||K||!re,title:G?"Demo preview":re?void 0:ce??"Coach unavailable",children:"New chat"})]})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border bg-background/60 p-4","data-testid":"coach-chat-path","data-path":S?co(S):"",children:J?e.jsx("div",{className:"space-y-4",children:le.map(q=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:[q.role==="user"?"You":"Coach"," ?"," ",ep(q.createdAt,{addSuffix:!0})]}),e.jsx("div",{className:q.role==="user"?"rounded-lg bg-primary/5 p-3 text-sm text-foreground shadow-sm":"rounded-lg border border-primary/20 bg-background p-3 text-sm leading-relaxed text-foreground",children:q.content}),q.role==="assistant"?e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Coach"}),e.jsx(Xe,{variant:q.usedLLM?"default":"secondary",className:"uppercase tracking-wide",children:q.usedLLM?"LLM":"Rules"})]}):null,q.role==="assistant"&&q.suggestions&&q.suggestions.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:q.suggestions.map((ee,H)=>e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:ee},`${q.id}-suggestion-${H}`))}):null]},q.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No messages yet. Ask a question to get personalized training and nutrition tips."})}),e.jsxs("div",{className:"space-y-3",children:[!re&&e.jsxs(tt,{variant:"default",children:[e.jsx(rt,{children:"Coach setup incomplete"}),e.jsx(st,{children:ce??"Coach chat is unavailable right now."})]}),b?e.jsx("div",{className:"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-sm text-destructive",children:b}):null,e.jsx(vn,{value:v,onChange:q=>{j(q.target.value),b&&w(null)},placeholder:G?"Demo preview — chat is read-only.":"Share wins or ask for tweaks...",rows:4,disabled:x||G||K||!re,"data-testid":"coach-message-input"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{variant:"secondary",onClick:E?Ee:pe,disabled:!L||x||G||K||!re,"data-testid":"coach-mic",children:L?E?"? Stop":"?? Speak":"?? N/A"}),x?e.jsx(_,{disabled:!0,"data-testid":"coach-send-button",children:"Sending..."}):G?e.jsx(_,{asChild:!0,"data-testid":"coach-send-button",children:e.jsx("a",{href:xe,children:"Sign up to chat"})}):e.jsx(_,{onClick:W,disabled:x||!v.trim()||K||!re,"data-testid":"coach-send-button",children:"Send"})]})})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-2",children:[e.jsx(he,{className:"text-xl",children:"Weekly plan"}),n?e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.days," days ? ",n.split," ? Protein ?"," ",n.proteinFloor," g ? Calories ? ",n.calorieTarget]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate a plan to see your structured week."})]}),e.jsxs(Q,{className:"space-y-4",children:[G?e.jsx(_,{asChild:!0,className:"w-full",variant:"outline",children:e.jsx("a",{href:xe,children:"Sign up to use this feature"})}):e.jsx(_,{onClick:ie,disabled:y||K,className:"w-full",children:y?n?"Regenerating...":"Creating...":n?"Regenerate weekly plan":"Create plan"}),n?e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:n.disclaimer??"Training guidance for educational use only. Estimates only ? not medical advice."}),e.jsx("div",{className:"space-y-3",children:n.sessions.slice(0,n.days).map(q=>e.jsx(zS,{session:q},q.day))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tap regenerate after onboarding to receive a day-by-day split with sets ? reps and RPE."})]})]})})]})]}),e.jsx(xt,{})]})]})}function ld(t,s){const n=[];let r=0;return t.blocks.forEach(a=>{a.exercises.forEach(i=>{for(let o=1;o<=i.sets;o+=1)n.push({exIdx:r,set:o,name:(s==null?void 0:s[r])??i.name,planName:i.name,targetReps:i.reps,restSec:i.restSec});r+=1})}),n}function KS(t){const{reps:s,rir:n,restSec:r,tempo:a}=t,i=typeof n=="number"?` Aim to finish around ${n} RIR.`:"",o=typeof r=="number"?` Keep rest about ${Math.round(r/30)*30} sec.`:"",c=a?` Control tempo (${a}).`:"";return`Add 2.5–5 lb next week if all sets hit ${s}.${i}${o}${c}`.trim()}function of(t){const s=t.trim().toLowerCase();if(!s||s.includes("amrap")||s.includes("min"))return null;const n=s.match(/(\d+)\s*-\s*(\d+)/);if(n)return{lower:Number.parseInt(n[1],10),upper:Number.parseInt(n[2],10)};const r=s.match(/(\d+(?:\.\d+)?)/);if(r){const a=Number.parseFloat(r[1]);return{lower:a,upper:a}}return null}function GS(t){const s=t.toLowerCase();return["squat","deadlift","press","bench","row","pull-up","chin-up","lunge","clean","snatch","thruster","hip thrust"].some(r=>s.includes(r))}function Mi(t){return Number.isNaN(t)?"":Number.isInteger(t)?`${t}`:t.toFixed(1).replace(/\.0$/,"")}function lf(t,s){return!Array.isArray(s)||!s.length?!1:s.some(n=>typeof n!="number"||Number.isNaN(n)?!1:Math.max(0,Math.trunc(n)-1)===t)}function HS(t){return{...t,blocks:t.blocks.map(s=>({...s,exercises:s.exercises.map(n=>{const r=Math.max(1,Math.round(n.sets*.7)),a=of(n.reps);let i=n.reps;if(a&&a.lower!==null&&a.upper!==null){const o=Math.max(1,a.lower-1),c=Math.max(o,a.upper-1);o===c?i=Mi(o):i=`${Mi(o)}-${Mi(c)}`}return{...n,sets:r,reps:i}})}))}}function YS(t){const{exerciseName:s,lastSets:n,planTarget:r}=t;if(!n.length)return{suggestion:"maintain"};const a=of(r.reps);if(!a)return{suggestion:"maintain"};const{lower:i,upper:o}=a,c=n.reduce((u,d)=>u+d.reps,0)/n.length;if(typeof o=="number"&&n.every(u=>u.reps>=o))return GS(s)?{suggestion:"+5 lb if all sets completed"}:{suggestion:"+1 rep if all sets completed"};const m=i??o;return typeof m=="number"&&c<=m-2?{suggestion:"hold or drop 5%"}:{suggestion:"maintain"}}const QS="beginner-full-body",JS="Beginner Full Body",XS="hypertrophy",ZS="beginner",e0=["barbell","dumbbells","machines"],t0=55,s0=["Full body","3-day split","Strength foundations"],n0="Three focused full-body sessions each week to build strength and muscle with classic compound lifts.",r0="Alternating full-body days distributes volume across big movement patterns so beginners get frequent practice without overwhelming soreness. Progressive overload is baked in through moderate jumps in sets and rep ranges while RIR targets ensure technique stays crisp as load increases.",a0=[4],i0=[{q:"How many days a week will I train?",a:"You will train three days each week with at least one rest day between sessions to lock in recovery."},{q:"Is this friendly for beginners?",a:"Yes. The plan layers in compound lifts with accessory support so you can groove form, add weight gradually, and still have energy for life outside the gym."}],o0=[{days:[{name:"Day 1 – Full Body A",blocks:[{title:"Main Lifts",exercises:[{name:"Back Squat",sets:3,reps:"8",restSec:120,rir:2},{name:"Bench Press",sets:3,reps:"8",restSec:120,rir:2}]},{title:"Accessories",exercises:[{name:"Lat Pulldown",sets:3,reps:"10-12",restSec:90,rir:2},{name:"Dumbbell Romanian Deadlift",sets:3,reps:"10",restSec:90,rir:2},{name:"Plank",sets:3,reps:"45s",restSec:60}]}]},{name:"Day 2 – Full Body B",blocks:[{title:"Main Lifts",exercises:[{name:"Deadlift",sets:3,reps:"5",restSec:150,rir:2},{name:"Overhead Press",sets:3,reps:"8",restSec:120,rir:2}]},{title:"Accessories",exercises:[{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:90},{name:"Seated Row",sets:3,reps:"10-12",restSec:90},{name:"Hanging Knee Raise",sets:3,reps:"12-15",restSec:60}]}]},{name:"Day 3 – Full Body C",blocks:[{title:"Main Lifts",exercises:[{name:"Front Squat",sets:3,reps:"6-8",restSec:120,rir:2},{name:"Incline Dumbbell Press",sets:3,reps:"8-10",restSec:120,rir:2}]},{title:"Accessories",exercises:[{name:"Single-Arm Dumbbell Row",sets:3,reps:"10/side",restSec:90},{name:"Leg Curl",sets:3,reps:"12",restSec:90},{name:"Side Plank",sets:3,reps:"30s/side",restSec:60}]}]}]},{days:[{name:"Day 1 – Full Body A",blocks:[{title:"Main Lifts",exercises:[{name:"Back Squat",sets:4,reps:"6",restSec:150,rir:2},{name:"Bench Press",sets:4,reps:"6",restSec:150,rir:2}]},{title:"Accessories",exercises:[{name:"Lat Pulldown",sets:3,reps:"10",restSec:90},{name:"Bulgarian Split Squat",sets:3,reps:"10/leg",restSec:90},{name:"Cable Woodchop",sets:3,reps:"12/side",restSec:60}]}]},{name:"Day 2 – Full Body B",blocks:[{title:"Main Lifts",exercises:[{name:"Romanian Deadlift",sets:4,reps:"8",restSec:150,rir:2},{name:"Overhead Press",sets:3,reps:"8",restSec:120,rir:2}]},{title:"Accessories",exercises:[{name:"Leg Press",sets:3,reps:"12",restSec:90},{name:"Chest Supported Row",sets:3,reps:"10",restSec:90},{name:"Hanging Knee Raise",sets:3,reps:"15",restSec:60}]}]},{name:"Day 3 – Full Body C",blocks:[{title:"Main Lifts",exercises:[{name:"Front Squat",sets:3,reps:"6",restSec:150,rir:2},{name:"Incline Dumbbell Press",sets:3,reps:"8",restSec:120,rir:2}]},{title:"Accessories",exercises:[{name:"Single-Leg Romanian Deadlift",sets:3,reps:"12/leg",restSec:90},{name:"Face Pull",sets:3,reps:"15",restSec:60},{name:"Dead Bug",sets:3,reps:"12",restSec:60}]}]}]},{days:[{name:"Day 1 – Full Body A",blocks:[{title:"Main Lifts",exercises:[{name:"Back Squat",sets:4,reps:"8",restSec:150,rir:1},{name:"Bench Press",sets:4,reps:"8",restSec:150,rir:1}]},{title:"Accessories",exercises:[{name:"Lat Pulldown",sets:4,reps:"10",restSec:90},{name:"Walking Lunge",sets:3,reps:"14/leg",restSec:90},{name:"Ab Wheel",sets:3,reps:"10",restSec:60}]}]},{name:"Day 2 – Full Body B",blocks:[{title:"Main Lifts",exercises:[{name:"Deadlift",sets:4,reps:"5",restSec:180,rir:1},{name:"Overhead Press",sets:4,reps:"8",restSec:150,rir:1}]},{title:"Accessories",exercises:[{name:"Leg Extension",sets:3,reps:"15",restSec:90},{name:"Seated Row",sets:4,reps:"10",restSec:90},{name:"Cable Crunch",sets:3,reps:"15",restSec:60}]}]},{name:"Day 3 – Full Body C",blocks:[{title:"Main Lifts",exercises:[{name:"Front Squat",sets:4,reps:"6",restSec:150,rir:1},{name:"Incline Dumbbell Press",sets:4,reps:"8",restSec:120,rir:1}]},{title:"Accessories",exercises:[{name:"Single-Arm Dumbbell Row",sets:4,reps:"12/side",restSec:90},{name:"Leg Curl",sets:4,reps:"12",restSec:90},{name:"Hollow Hold",sets:3,reps:"40s",restSec:60}]}]}]},{days:[{name:"Day 1 – Full Body A",blocks:[{title:"Main Lifts",exercises:[{name:"Back Squat",sets:5,reps:"5",restSec:180,rir:1},{name:"Bench Press",sets:5,reps:"5",restSec:180,rir:1}]},{title:"Accessories",exercises:[{name:"Pull-Up",sets:4,reps:"AMRAP",restSec:120},{name:"Dumbbell Romanian Deadlift",sets:4,reps:"10",restSec:120},{name:"Plank",sets:3,reps:"60s",restSec:60}]}]},{name:"Day 2 – Full Body B",blocks:[{title:"Main Lifts",exercises:[{name:"Deadlift",sets:4,reps:"4",restSec:180,rir:1},{name:"Overhead Press",sets:4,reps:"6",restSec:150,rir:1}]},{title:"Accessories",exercises:[{name:"Walking Lunge",sets:4,reps:"12/leg",restSec:120},{name:"Chest Supported Row",sets:4,reps:"12",restSec:90},{name:"Hanging Knee Raise",sets:3,reps:"15",restSec:60}]}]},{name:"Day 3 – Full Body C",blocks:[{title:"Main Lifts",exercises:[{name:"Front Squat",sets:4,reps:"5",restSec:150,rir:1},{name:"Incline Dumbbell Press",sets:4,reps:"6-8",restSec:150,rir:1}]},{title:"Accessories",exercises:[{name:"Single-Leg Romanian Deadlift",sets:4,reps:"12/leg",restSec:90},{name:"Face Pull",sets:4,reps:"15",restSec:60},{name:"Farmer Carry",sets:3,reps:"40m",restSec:90}]}]}]}],l0={id:QS,title:JS,goal:XS,level:ZS,equipment:e0,durationPerSessionMin:t0,tags:s0,summary:n0,rationale:r0,deloadWeeks:a0,faqs:i0,weeks:o0},c0="dumbbell-cut",d0="Dumbbell Cut (3-4 Day)",u0="cut",m0="intermediate",h0=["dumbbells"],f0=45,p0=["Fat loss","Dumbbell only","Metabolic"],g0="Higher-rep dumbbell circuits with optional fourth conditioning day to support a cut.",x0="Alternating strength moves with metabolic finishers keeps total work high enough to drive calorie expenditure while maintaining lean tissue. Sessions stay dumbbell-only so you can push close to failure with minimal setup, and RIR targets help manage fatigue during a caloric deficit.",y0=[{q:"How should I progress weights while cutting?",a:"Aim to maintain or slightly increase loads week to week; if energy dips, keep weight steady but try to match previous rep counts."},{q:"Can I add extra cardio?",a:"Yes—slot easy zone-2 cardio on rest days or after the optional day as long as it does not interfere with recovery."}],b0=[{days:[{name:"Day 1 – Full Body Strength",blocks:[{title:"Compound Sets",exercises:[{name:"Dumbbell Goblet Squat",sets:4,reps:"10",restSec:75,substitutions:[{name:"Bodyweight Tempo Squat",reason:"Use when dumbbells are limited"}]},{name:"Dumbbell Bench Press",sets:4,reps:"10",restSec:75,substitutions:[{name:"Floor Press",reason:"Great when you don't have a bench"}]},{name:"Single-Arm Row",sets:3,reps:"12/side",restSec:60}]}]},{name:"Day 2 – Conditioning Mix",blocks:[{title:"AMRAP Circuit (20 min)",exercises:[{name:"Dumbbell Thruster",sets:3,reps:"12",restSec:0},{name:"Renegade Row",sets:3,reps:"10",restSec:0},{name:"Mountain Climber",sets:3,reps:"40",restSec:0}]}]},{name:"Day 3 – Upper/Lower Split",blocks:[{title:"Lower Body",exercises:[{name:"Dumbbell Romanian Deadlift",sets:4,reps:"12",restSec:90},{name:"Reverse Lunge",sets:3,reps:"12/leg",restSec:90,substitutions:[{name:"Step-Back Lunge",reason:"Bodyweight swap to keep moving"}]}]},{title:"Upper Body",exercises:[{name:"Dumbbell Push Press",sets:3,reps:"12",restSec:75},{name:"Hammer Curl",sets:3,reps:"15",restSec:60}]}]},{name:"Day 4 – Optional Sweat",blocks:[{title:"Intervals",exercises:[{name:"Alternating Snatch",sets:4,reps:"12/side",restSec:45},{name:"Dumbbell Swing",sets:4,reps:"20",restSec:45},{name:"Plank",sets:3,reps:"60s",restSec:30}]}]}]}],j0={id:c0,title:d0,goal:u0,level:m0,equipment:h0,durationPerSessionMin:f0,tags:p0,summary:g0,rationale:x0,faqs:y0,weeks:b0},w0="kettlebell-3day",v0="Kettlebell Power 3-Day",N0="general",S0="intermediate",k0=["kettlebells"],E0=45,C0=["Kettlebell","Power endurance","3 day"],_0="Three efficient kettlebell sessions combining strength, power, and conditioning.",P0="Each day layers grinds with ballistic work so you develop strength, power, and aerobic capacity together. Density blocks control work-to-rest ratios, keeping heart rate in a productive range while repeated exposure to swings and cleans sharpens technique.",A0=[{q:"How heavy should my kettlebells be?",a:"Choose a bell that challenges the final reps while maintaining crisp technique—usually 16–24 kg for swings and 8–16 kg for presses, adjusting to your strength."},{q:"Can I run this alongside other training?",a:"Yes, pair it with low-intensity cardio or bodyweight mobility work on off days; avoid stacking heavy barbell sessions on back-to-back days."}],I0=[{days:[{name:"Day 1 – Strength & Swing",blocks:[{title:"Strength",exercises:[{name:"Double Kettlebell Front Squat",sets:4,reps:"6",restSec:90,substitutions:[{name:"Goblet Squat",reason:"Use when you only have one bell"}]},{name:"Kettlebell Row",sets:4,reps:"8/side",restSec:75}]},{title:"Swing Finisher",exercises:[{name:"Two-Hand Swing",sets:5,reps:"20",restSec:45,substitutions:[{name:"Single-Arm Swing",reason:"Adds anti-rotation challenge"}]}]}]},{name:"Day 2 – Press & Carry",blocks:[{title:"Press Ladder",exercises:[{name:"Single-Arm Clean and Press",sets:4,reps:"5/side",restSec:75,substitutions:[{name:"Push Press",reason:"Add leg drive for heavier bells"}]},{name:"Half Kneeling Windmill",sets:3,reps:"6/side",restSec:60}]},{title:"Carry",exercises:[{name:"Farmer Carry",sets:4,reps:"40m",restSec:60},{name:"Front Rack Carry",sets:3,reps:"30m",restSec:60,substitutions:[{name:"Suitcase Carry",reason:"Focuses on obliques with lighter bells"}]}]}]},{name:"Day 3 – Conditioning Complex",blocks:[{title:"Complex x4",exercises:[{name:"Kettlebell Snatch",sets:4,reps:"10/side",restSec:30},{name:"Kettlebell Lunge Press",sets:4,reps:"8/side",restSec:30},{name:"Russian Twist",sets:4,reps:"20",restSec:30,substitutions:[{name:"Dead Bug",reason:"Great when twisting bothers the back"}]}]}]}]}],T0={id:w0,title:v0,goal:N0,level:S0,equipment:k0,durationPerSessionMin:E0,tags:C0,summary:_0,rationale:P0,faqs:A0,weeks:I0},R0="lift-plus-zone2",M0="Lift + Zone 2 (3 Day)",D0="general",F0="intermediate",L0=["barbell","dumbbells","machines"],B0=60,O0=["Strength + cardio","Zone 2","3 day"],U0="Two strength-focused sessions plus one mixed conditioning day with dedicated zone 2 cardio.",$0="Strength sessions focus on compound lifts to preserve muscle while the dedicated zone 2 block builds an aerobic base that supports recovery and fat oxidation. The week balances higher-intensity intervals with easy steady-state cardio to improve work capacity without compromising lifting performance.",W0=[{q:"What heart rate should I target for zone 2?",a:"Aim for roughly 60–70% of max heart rate—breathing should be controlled enough to speak in full sentences."},{q:"Can I rearrange the days?",a:"Yes, keep at least one rest day between the lifting sessions and place the cardio day where it best fits your schedule."}],q0=[{days:[{name:"Day 1 – Full Body + Zone 2",blocks:[{title:"Strength",exercises:[{name:"Back Squat",sets:3,reps:"6",restSec:150,substitutions:[{name:"Leg Press",reason:"Use if you need a machine-guided squat",equipment:["machines"]}]},{name:"Bench Press",sets:3,reps:"6",restSec:150,substitutions:[{name:"Dumbbell Bench Press",reason:"Works for limited barbell access",equipment:["dumbbells"]}]}]},{title:"Zone 2",exercises:[{name:"Treadmill Zone 2 Walk",sets:1,reps:"20 min",substitutions:[{name:"Stationary Bike Zone 2",reason:"Low impact cardio alternative",equipment:["machines"]},{name:"Outdoor Brisk Walk",reason:"No gym access needed",equipment:["none"]}]}]}]},{name:"Day 2 – Upper + Conditioning",blocks:[{title:"Strength",exercises:[{name:"Overhead Press",sets:3,reps:"6-8",restSec:120,substitutions:[{name:"Seated Dumbbell Press",reason:"Joint friendly overhead option",equipment:["dumbbells"]}]},{name:"Single-Arm Row",sets:3,reps:"10/side",restSec:90}]},{title:"Cardio Finisher",exercises:[{name:"Row Erg Zone 2",sets:1,reps:"15 min",substitutions:[{name:"Battle Rope Intervals",reason:"Higher heart rate if you want variety",equipment:["none"]}]}]}]},{name:"Day 3 – Posterior + Long Zone 2",blocks:[{title:"Strength",exercises:[{name:"Romanian Deadlift",sets:3,reps:"8",restSec:150,substitutions:[{name:"Good Morning",reason:"Keep hinge stimulus if you prefer",equipment:["barbell"]}]},{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:90}]},{title:"Zone 2",exercises:[{name:"Bike Zone 2 Ride",sets:1,reps:"30 min",substitutions:[{name:"Elliptical Zone 2",reason:"Lower impact for knees",equipment:["machines"]},{name:"Outdoor Jog",reason:"Simple endurance option",equipment:["none"]}]}]}]}]}],z0={id:R0,title:M0,goal:D0,level:F0,equipment:L0,durationPerSessionMin:B0,tags:O0,summary:U0,rationale:$0,faqs:W0,weeks:q0},V0="linear-strength-3day",K0="Linear Strength 3-Day",G0="strength",H0="beginner",Y0=["barbell","dumbbells","machines"],Q0=55,J0=["Linear progression","3 day","Full body"],X0="Three focused strength sessions each week with small linear jumps and optional accessory swaps.",Z0="Main lifts stay in low-to-moderate rep ranges so you can add small amounts of weight weekly while maintaining technical quality. Accessories use higher reps and controlled RIR to build muscle that supports the big lifts without overwhelming CNS fatigue.",ek=[{q:"How quickly should I add weight?",a:"Add 2.5–5 lb when you hit all prescribed reps with the listed RIR; if you miss, keep the load the same next week."},{q:"Can I swap accessories?",a:"Yes—use the suggested substitutions or choose movements that hit the same muscle group for similar reps and tempo."}],tk=[{days:[{name:"Day 1 – Squat Push",blocks:[{title:"Main Lifts",exercises:[{name:"Back Squat",sets:4,reps:"6",restSec:150,substitutions:[{name:"Goblet Squat",reason:"Works if you only have dumbbells",equipment:["dumbbells"]}]},{name:"Bench Press",sets:4,reps:"6",restSec:150,substitutions:[{name:"Machine Chest Press",reason:"Great if you need more control",equipment:["machines"]}]}]},{title:"Assistance",exercises:[{name:"Split Squat",sets:3,reps:"10/leg",restSec:90},{name:"Incline Dumbbell Press",sets:3,reps:"10",restSec:90}]}]},{name:"Day 2 – Pull and Posterior",blocks:[{title:"Main Lifts",exercises:[{name:"Deadlift",sets:3,reps:"5",restSec:180,substitutions:[{name:"Romanian Deadlift",reason:"Keeps posterior-chain emphasis with less fatigue",equipment:["barbell"]}]},{name:"Bent-Over Row",sets:4,reps:"6",restSec:120,substitutions:[{name:"Lat Pulldown",reason:"Simpler pulling pattern",equipment:["machines"]}]}]},{title:"Assistance",exercises:[{name:"Hip Thrust",sets:3,reps:"8",restSec:120},{name:"Face Pull",sets:3,reps:"15",restSec:60}]}]},{name:"Day 3 – Press and Volume",blocks:[{title:"Main Lifts",exercises:[{name:"Front Squat",sets:3,reps:"6",restSec:150,substitutions:[{name:"Leg Press",reason:"Use when you need a machine-supported squat pattern",equipment:["machines"]}]},{name:"Overhead Press",sets:4,reps:"6",restSec:120,substitutions:[{name:"Dumbbell Shoulder Press",reason:"Joint friendly overhead work",equipment:["dumbbells"]}]}]},{title:"Assistance",exercises:[{name:"Seated Row",sets:3,reps:"10",restSec:90},{name:"Farmer Carry",sets:3,reps:"40m",restSec:90}]}]}]}],sk={id:V0,title:K0,goal:G0,level:H0,equipment:Y0,durationPerSessionMin:Q0,tags:J0,summary:X0,rationale:Z0,faqs:ek,weeks:tk},nk="mobility-core-2day",rk="Mobility + Core 2-Day",ak="general",ik="beginner",ok=["none","bands"],lk=30,ck=["Mobility","Core","Active recovery"],dk="Two refreshing sessions that mix mobility flows with focused core work—ideal alongside heavier training.",uk="Sequences cycle from mobility drills into trunk stability work so you open up key joints before reinforcing new ranges. Low-load isometrics and anti-rotation moves build resilience without adding much systemic fatigue, making the plan perfect for active recovery.",mk=[{days:[{name:"Day 1 – Flow & Stability",blocks:[{title:"Mobility Flow",exercises:[{name:"World's Greatest Stretch",sets:3,reps:"6/side",restSec:30,substitutions:[{name:"Couch Stretch",reason:"Focus on hip flexors if knees bother you"}]},{name:"Cat Cow",sets:3,reps:"10",restSec:30}]},{title:"Core Stability",exercises:[{name:"Dead Bug",sets:3,reps:"12",restSec:30,substitutions:[{name:"Bird Dog",reason:"Great when lying on your back is uncomfortable"}]},{name:"Side Plank",sets:3,reps:"30s/side",restSec:30}]}]}]},{days:[{name:"Day 2 – Hips & Antirotation",blocks:[{title:"Mobility",exercises:[{name:"90/90 Hip Switch",sets:3,reps:"10/side",restSec:30,substitutions:[{name:"Seated Hip Internal Rotation",reason:"Simplify when knees feel tight"}]},{name:"Thoracic Rotation on All Fours",sets:3,reps:"12/side",restSec:30}]},{title:"Core",exercises:[{name:"Pallof Press",sets:3,reps:"12/side",restSec:45,substitutions:[{name:"Band Hold Out",reason:"Static version if you prefer to brace",equipment:["bands"]}]},{name:"Hollow Body Hold",sets:3,reps:"30s",restSec:45}]}]}]}],hk={id:nk,title:rk,goal:ak,level:ik,equipment:ok,durationPerSessionMin:lk,tags:ck,summary:dk,rationale:uk,weeks:mk},fk="no-equipment-3day",pk="No Equipment 3-Day",gk="general",xk="beginner",yk=["none"],bk=35,jk=["Bodyweight","Home friendly","3 day"],wk="Minimalist three day plan using only bodyweight, perfect for travel or at-home training.",vk="Supersets pair pushing, pulling, and single-leg drills so you keep heart rate elevated and stimulate muscle without equipment. Tempo work and unilateral loading challenge stability, driving strength gains with progressive variations instead of added weight.",Nk=[{q:"How do I make sessions harder over time?",a:"Add reps to the higher end of each range, slow the lowering phase, or reduce rest between circuits before introducing weighted backpacks."},{q:"Can I split the workouts across the day?",a:"Yes—perform one or two circuits in the morning and finish the rest later if that helps you stay consistent."}],Sk=[{days:[{name:"Day 1 – Push + Core",blocks:[{title:"Circuit x3",exercises:[{name:"Push-Up",sets:3,reps:"AMRAP",restSec:30,substitutions:[{name:"Knee Push-Up",reason:"Reduce the difficulty to keep form"}]},{name:"Dip on Bench",sets:3,reps:"12",restSec:30},{name:"Plank",sets:3,reps:"45s",restSec:30,substitutions:[{name:"High Plank Shoulder Tap",reason:"Add anti-rotation challenge"}]}]}]},{name:"Day 2 – Lower Body",blocks:[{title:"Interval Sets",exercises:[{name:"Reverse Lunge",sets:4,reps:"15/leg",restSec:30,substitutions:[{name:"Split Squat Hold",reason:"Static version when space is tight"}]},{name:"Bodyweight Squat",sets:4,reps:"20",restSec:30},{name:"Glute Bridge",sets:3,reps:"20",restSec:30}]}]},{name:"Day 3 – Conditioning",blocks:[{title:"EMOM 20",exercises:[{name:"Burpee",sets:5,reps:"12",restSec:0,substitutions:[{name:"Step-Back Burpee",reason:"Lower impact version"}]},{name:"Jumping Jack",sets:5,reps:"40",restSec:0},{name:"V-Sit Hold",sets:5,reps:"30s",restSec:0}]}]}]}],kk={id:fk,title:pk,goal:gk,level:xk,equipment:yk,durationPerSessionMin:bk,tags:jk,summary:wk,rationale:vk,faqs:Nk,weeks:Sk},Ek="phul",Ck="PHUL (Power Hypertrophy Upper Lower)",_k="hypertrophy",Pk="intermediate",Ak=["barbell","dumbbells","machines"],Ik=70,Tk=["4 day","Power + hypertrophy","Upper lower"],Rk="Alternating power and hypertrophy focused days to build strength and size together.",Mk="Heavy compound work at the start of the week reinforces neural drive so you can express strength, while higher-rep hypertrophy days accumulate volume for muscle growth. The split repeats twice weekly for each muscle group, giving optimal frequency with built-in intensity variation.",Dk=[{q:"How should I pace the power sets?",a:"Rest 2–3 minutes between heavy compound sets so you can produce maximal force without technique breakdown."},{q:"Do I need to train six days?",a:"No, four dedicated lifting sessions cover the plan; add optional light cardio or mobility on off days if desired."}],Fk=[{days:[{name:"Day 1 – Upper Power",blocks:[{title:"Power Moves",exercises:[{name:"Bench Press",sets:4,reps:"3-5",restSec:180,substitutions:[{name:"Close Grip Bench Press",reason:"Keeps heavy pressing with tricep focus",equipment:["barbell"]}]},{name:"Bent-Over Row",sets:4,reps:"3-5",restSec:150,substitutions:[{name:"Pendlay Row",reason:"Explosive alternative for the upper back",equipment:["barbell"]}]},{name:"Overhead Press",sets:3,reps:"5",restSec:150,substitutions:[{name:"Push Press",reason:"Use legs to drive heavier loads",equipment:["barbell"]},{name:"Seated Dumbbell Press",reason:"Joint friendly option",equipment:["dumbbells"]}]}]},{title:"Assistance",exercises:[{name:"Weighted Chin-Up",sets:3,reps:"6-8",restSec:120},{name:"Dumbbell Incline Press",sets:3,reps:"8-10",restSec:90}]}]},{name:"Day 2 – Lower Power",blocks:[{title:"Power Moves",exercises:[{name:"Back Squat",sets:4,reps:"3-5",restSec:210,substitutions:[{name:"Safety Bar Squat",reason:"Friendly for long torsos",equipment:["barbell"]}]},{name:"Deadlift",sets:3,reps:"3-5",restSec:210,substitutions:[{name:"Trap Bar Deadlift",reason:"More upright pull with similar stimulus",equipment:["barbell"]}]}]},{title:"Assistance",exercises:[{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:90},{name:"Hanging Leg Raise",sets:3,reps:"12-15",restSec:60}]}]},{name:"Day 3 – Upper Hypertrophy",blocks:[{title:"Volume Work",exercises:[{name:"Incline Dumbbell Press",sets:4,reps:"8-10",restSec:90,substitutions:[{name:"Machine Chest Press",reason:"Controlled pressing without spotter",equipment:["machines"]}]},{name:"Seated Cable Row",sets:4,reps:"10-12",restSec:90,substitutions:[{name:"Single-Arm Dumbbell Row",reason:"Keeps focus on lats with minimal equipment",equipment:["dumbbells"]}]},{name:"Lateral Raise",sets:3,reps:"12-15",restSec:60},{name:"Cable Triceps Pressdown",sets:3,reps:"12",restSec:60}]}]},{name:"Day 4 – Lower Hypertrophy",blocks:[{title:"Volume Work",exercises:[{name:"Front Squat",sets:3,reps:"8",restSec:150,substitutions:[{name:"Leg Press",reason:"When knees need a more guided track",equipment:["machines"]}]},{name:"Romanian Deadlift",sets:3,reps:"8-10",restSec:150,substitutions:[{name:"Good Morning",reason:"Keeps hinge stimulus with lighter load",equipment:["barbell"]}]},{name:"Leg Curl",sets:3,reps:"12",restSec:60},{name:"Calf Raise",sets:4,reps:"15",restSec:45}]}]}]}],Lk={id:Ek,title:Ck,goal:_k,level:Pk,equipment:Ak,durationPerSessionMin:Ik,tags:Tk,summary:Rk,rationale:Mk,faqs:Dk,weeks:Fk},Bk="push-pull-legs",Ok="Push / Pull / Legs",Uk="hypertrophy",$k="intermediate",Wk=["barbell","dumbbells","machines"],qk=65,zk=["Push/pull/legs","High volume","Bodybuilding"],Vk="A classic push, pull, legs split that stacks volume across six weekly sessions for experienced lifters.",Kk="Each muscle group gets a heavy day and a pump-focused day, allowing you to accumulate 10–20 quality sets per week without burning out. Rotating rep targets and RIR guidelines keep progressive overload structured while still leaving room to chase a pump on accessory work.",Gk=[2],Hk=[{q:"Can I reduce to five days?",a:"You can drop one accessory-focused day when life gets busy and resume the full split the following week."},{q:"What if I am short on equipment?",a:"Swap cable or machine accessories for dumbbell variations when needed and keep the compound lifts consistent."}],Yk=[{days:[{name:"Day 1 – Push",blocks:[{title:"Primary",exercises:[{name:"Bench Press",sets:4,reps:"6",restSec:150,rir:2},{name:"Overhead Press",sets:3,reps:"8",restSec:120,rir:2}]},{title:"Assistance",exercises:[{name:"Incline Dumbbell Press",sets:3,reps:"10",restSec:120},{name:"Lateral Raise",sets:3,reps:"15",restSec:60},{name:"Cable Triceps Pushdown",sets:3,reps:"12",restSec:60}]}]},{name:"Day 2 – Pull",blocks:[{title:"Primary",exercises:[{name:"Deadlift",sets:3,reps:"5",restSec:180,rir:2},{name:"Bent-Over Row",sets:4,reps:"8",restSec:150,rir:2}]},{title:"Assistance",exercises:[{name:"Lat Pulldown",sets:3,reps:"12",restSec:90},{name:"Face Pull",sets:3,reps:"15",restSec:60},{name:"Hammer Curl",sets:3,reps:"12",restSec:60}]}]},{name:"Day 3 – Legs",blocks:[{title:"Primary",exercises:[{name:"Back Squat",sets:4,reps:"6",restSec:150,rir:2},{name:"Leg Press",sets:3,reps:"12",restSec:120}]},{title:"Assistance",exercises:[{name:"Romanian Deadlift",sets:3,reps:"10",restSec:120},{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:120},{name:"Standing Calf Raise",sets:3,reps:"15",restSec:60}]}]}]},{days:[{name:"Day 1 – Push",blocks:[{title:"Primary",exercises:[{name:"Bench Press",sets:5,reps:"5",restSec:150,rir:1},{name:"Overhead Press",sets:4,reps:"8",restSec:120,rir:1}]},{title:"Assistance",exercises:[{name:"Incline Dumbbell Press",sets:4,reps:"10",restSec:120},{name:"Lateral Raise",sets:4,reps:"15",restSec:60},{name:"Cable Triceps Pushdown",sets:4,reps:"12",restSec:60}]}]},{name:"Day 2 – Pull",blocks:[{title:"Primary",exercises:[{name:"Deadlift",sets:4,reps:"4",restSec:180,rir:1},{name:"Bent-Over Row",sets:4,reps:"8",restSec:150,rir:1}]},{title:"Assistance",exercises:[{name:"Lat Pulldown",sets:4,reps:"12",restSec:90},{name:"Face Pull",sets:4,reps:"15",restSec:60},{name:"Hammer Curl",sets:4,reps:"12",restSec:60}]}]},{name:"Day 3 – Legs",blocks:[{title:"Primary",exercises:[{name:"Back Squat",sets:5,reps:"5",restSec:150,rir:1},{name:"Leg Press",sets:4,reps:"12",restSec:120}]},{title:"Assistance",exercises:[{name:"Romanian Deadlift",sets:4,reps:"10",restSec:120},{name:"Walking Lunge",sets:4,reps:"12/leg",restSec:120},{name:"Standing Calf Raise",sets:4,reps:"15",restSec:60}]}]}]}],Qk={id:Bk,title:Ok,goal:Uk,level:$k,equipment:Wk,durationPerSessionMin:qk,tags:zk,summary:Vk,rationale:Kk,deloadWeeks:Gk,faqs:Hk,weeks:Yk},Jk="strength-5x5",Xk="Strength 5x5",Zk="strength",e1="intermediate",t1=["barbell","dumbbells"],s1=65,n1=["5x5","Strength focus","Simple progression"],r1="A classic three day 5x5 strength split built around the squat, press, and pull.",a1="Heavy 5x5 work delivers enough volume in the 70–85% 1RM range to drive strength without overshooting recovery. Small accessory supersets shore up weak links while the repeated exposure to core lifts ensures you can track progress clearly.",i1=[{q:"What if I stall on a lift?",a:"Repeat the same weight the following week; if you miss twice, drop 5–7% and build back up."},{q:"Can I add conditioning?",a:"Keep conditioning to short low-intensity sessions after lifting or on rest days so leg strength is not compromised."}],o1=[{days:[{name:"Day 1 – Heavy Squat",blocks:[{title:"Main Work",exercises:[{name:"Back Squat",sets:5,reps:"5",restSec:180,substitutions:[{name:"Front Squat",reason:"Keeps the upright squat pattern when you need a change",equipment:["barbell"]},{name:"Safety Bar Squat",reason:"Friendlier on shoulders and elbows",equipment:["barbell"]}]},{name:"Bench Press",sets:5,reps:"5",restSec:150,substitutions:[{name:"Incline Bench Press",reason:"Add more upper chest while keeping a heavy press",equipment:["barbell"]},{name:"Dumbbell Bench Press",reason:"Great when racks are busy and for shoulder balance",equipment:["dumbbells"]}]},{name:"Barbell Row",sets:5,reps:"5",restSec:120,substitutions:[{name:"Chest Supported Row",reason:"Reduces lower-back fatigue",equipment:["machines"]},{name:"Single-Arm Dumbbell Row",reason:"Still heavy pulling with less spinal load",equipment:["dumbbells"]}]}]},{title:"Assistance",exercises:[{name:"Hanging Leg Raise",sets:3,reps:"12",restSec:60},{name:"Face Pull",sets:3,reps:"15",restSec:60}]}]},{name:"Day 2 – Heavy Pull",blocks:[{title:"Main Work",exercises:[{name:"Deadlift",sets:3,reps:"5",restSec:210,substitutions:[{name:"Trap Bar Deadlift",reason:"More quad friendly pull",equipment:["barbell"]},{name:"Romanian Deadlift",reason:"Keeps posterior chain focus with less fatigue",equipment:["barbell"]}]},{name:"Overhead Press",sets:5,reps:"5",restSec:150,substitutions:[{name:"Push Press",reason:"Adds a little leg drive for heavier weights",equipment:["barbell"]},{name:"Seated Dumbbell Press",reason:"Shoulder friendly pressing",equipment:["dumbbells"]}]}]},{title:"Assistance",exercises:[{name:"Pull-Up",sets:3,reps:"AMRAP",restSec:120},{name:"Barbell Hip Thrust",sets:3,reps:"8",restSec:120}]}]},{name:"Day 3 – Volume Bench",blocks:[{title:"Main Work",exercises:[{name:"Front Squat",sets:5,reps:"3",restSec:150},{name:"Bench Press",sets:5,reps:"5",restSec:120,substitutions:[{name:"Paused Bench Press",reason:"Builds control off the chest",equipment:["barbell"]}]},{name:"Barbell Row",sets:5,reps:"5",restSec:120}]},{title:"Assistance",exercises:[{name:"Dumbbell Romanian Deadlift",sets:3,reps:"10",restSec:90},{name:"Cable Chop",sets:3,reps:"12/side",restSec:60}]}]}]}],l1={id:Jk,title:Xk,goal:Zk,level:e1,equipment:t1,durationPerSessionMin:s1,tags:n1,summary:r1,rationale:a1,faqs:i1,weeks:o1},c1="upper-lower",d1="Upper / Lower Split",u1="strength",m1="intermediate",h1=["barbell","dumbbells","machines"],f1=60,p1=["Upper/lower","Strength focus","4-day split"],g1="Alternating upper and lower body strength sessions with accessory finishers to drive progressive overload.",x1="Heavy compound lifts anchor each day so you can track progressive overload, while higher-rep accessory work fills in weak links and drives hypertrophy. Splitting upper and lower sessions balances fatigue across the week, and the built-in deload week pulls volume back so you come into the next block fresh.",y1=[2],b1=[{q:"Who is this program best for?",a:"Intermediate lifters who want a balanced mix of heavy compounds and hypertrophy accessories across four days."},{q:"Can I add cardio?",a:"Yes, add light cardio on rest days or after lifts as long as it does not interfere with recovery."}],j1=[{days:[{name:"Day 1 – Upper Strength",blocks:[{title:"Primary",exercises:[{name:"Bench Press",sets:4,reps:"5",restSec:180,rir:2},{name:"Barbell Row",sets:4,reps:"6",restSec:150,rir:2}]},{title:"Assistance",exercises:[{name:"Overhead Press",sets:3,reps:"8",restSec:120},{name:"Pull-Up",sets:3,reps:"AMRAP",restSec:120},{name:"Cable Fly",sets:3,reps:"12",restSec:60}]}]},{name:"Day 2 – Lower Strength",blocks:[{title:"Primary",exercises:[{name:"Back Squat",sets:4,reps:"5",restSec:180,rir:2},{name:"Romanian Deadlift",sets:3,reps:"6",restSec:150,rir:2}]},{title:"Assistance",exercises:[{name:"Leg Press",sets:3,reps:"10",restSec:120},{name:"Leg Curl",sets:3,reps:"12",restSec:90},{name:"Standing Calf Raise",sets:3,reps:"15",restSec:60}]}]},{name:"Day 3 – Upper Hypertrophy",blocks:[{title:"Primary",exercises:[{name:"Incline Bench Press",sets:3,reps:"8",restSec:150,rir:2},{name:"Single-Arm Dumbbell Row",sets:3,reps:"10/side",restSec:120}]},{title:"Assistance",exercises:[{name:"Lateral Raise",sets:3,reps:"15",restSec:60},{name:"Cable Triceps Pushdown",sets:3,reps:"12",restSec:60},{name:"Ez-Bar Curl",sets:3,reps:"12",restSec:60}]}]},{name:"Day 4 – Lower Hypertrophy",blocks:[{title:"Primary",exercises:[{name:"Front Squat",sets:3,reps:"6",restSec:150,rir:2},{name:"Romanian Deadlift",sets:3,reps:"10",restSec:150}]},{title:"Assistance",exercises:[{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:120},{name:"Leg Extension",sets:3,reps:"15",restSec:90},{name:"Hanging Knee Raise",sets:3,reps:"15",restSec:60}]}]}]},{days:[{name:"Day 1 – Upper Strength",blocks:[{title:"Primary",exercises:[{name:"Bench Press",sets:5,reps:"4",restSec:180,rir:1},{name:"Barbell Row",sets:4,reps:"5",restSec:150,rir:1}]},{title:"Assistance",exercises:[{name:"Overhead Press",sets:3,reps:"8",restSec:120},{name:"Weighted Pull-Up",sets:3,reps:"6",restSec:150},{name:"Cable Fly",sets:3,reps:"15",restSec:60}]}]},{name:"Day 2 – Lower Strength",blocks:[{title:"Primary",exercises:[{name:"Back Squat",sets:5,reps:"4",restSec:180,rir:1},{name:"Deadlift",sets:3,reps:"4",restSec:180,rir:1}]},{title:"Assistance",exercises:[{name:"Leg Press",sets:3,reps:"12",restSec:120},{name:"Leg Curl",sets:3,reps:"12",restSec:90},{name:"Standing Calf Raise",sets:4,reps:"15",restSec:60}]}]},{name:"Day 3 – Upper Hypertrophy",blocks:[{title:"Primary",exercises:[{name:"Incline Bench Press",sets:4,reps:"8",restSec:150,rir:1},{name:"Single-Arm Dumbbell Row",sets:4,reps:"10/side",restSec:120}]},{title:"Assistance",exercises:[{name:"Lateral Raise",sets:4,reps:"15",restSec:60},{name:"Cable Triceps Pushdown",sets:3,reps:"12",restSec:60},{name:"Ez-Bar Curl",sets:3,reps:"12",restSec:60}]}]},{name:"Day 4 – Lower Hypertrophy",blocks:[{title:"Primary",exercises:[{name:"Front Squat",sets:4,reps:"6",restSec:150,rir:1},{name:"Romanian Deadlift",sets:4,reps:"10",restSec:150}]},{title:"Assistance",exercises:[{name:"Walking Lunge",sets:4,reps:"12/leg",restSec:120},{name:"Leg Extension",sets:3,reps:"15",restSec:90},{name:"Hanging Knee Raise",sets:3,reps:"15",restSec:60}]}]}]}],w1={id:c1,title:d1,goal:u1,level:m1,equipment:h1,durationPerSessionMin:f1,tags:p1,summary:g1,rationale:x1,deloadWeeks:y1,faqs:b1,weeks:j1},v1="womens-glute-focus",N1="Women's Glute & Lower Body Focus",S1="hypertrophy",k1="intermediate",E1=["barbell","dumbbells","bands","machines"],C1=60,_1=["Glute focus","3-4 day","Lower body"],P1="Targeted glute and leg training with one optional pump day for extra volume.",A1="Heavy hip hinge and squat variations provide the mechanical tension needed for glute growth, while pump sessions layer on metabolite work for extra stimulus. The optional day lets you auto-regulate volume based on recovery so you can stay consistent during busy weeks.",I1=[{q:"Do I need to perform the optional day?",a:"Use it when you feel fresh—skip it during stressful weeks so core sessions stay high quality."},{q:"What if a machine isn't available?",a:"Swap to dumbbell or banded alternatives that mimic the same direction of resistance and rep range."}],T1=[{days:[{name:"Day 1 – Glute Strength",blocks:[{title:"Primary Lifts",exercises:[{name:"Barbell Hip Thrust",sets:4,reps:"6-8",restSec:150,substitutions:[{name:"Smith Machine Hip Thrust",reason:"Keeps load heavy with more stability",equipment:["machines"]},{name:"Dumbbell Hip Thrust",reason:"For home setups",equipment:["dumbbells"]}]},{name:"Romanian Deadlift",sets:4,reps:"8",restSec:150,substitutions:[{name:"Single-Leg Romanian Deadlift",reason:"Great when loads are lighter",equipment:["dumbbells"]}]}]},{title:"Accessory Volume",exercises:[{name:"Cable Kickback",sets:3,reps:"12",restSec:60},{name:"Walking Lunge",sets:3,reps:"12/leg",restSec:90}]}]},{name:"Day 2 – Upper Body Balance",blocks:[{title:"Upper Push/Pull",exercises:[{name:"Incline Dumbbell Press",sets:3,reps:"8-10",restSec:90,substitutions:[{name:"Push-Up",reason:"Bodyweight option when equipment is limited",equipment:["none"]}]},{name:"Lat Pulldown",sets:3,reps:"10-12",restSec:90,substitutions:[{name:"Assisted Pull-Up",reason:"Keeps vertical pulling stimulus",equipment:["machines"]}]}]},{title:"Arm & Shoulder Finish",exercises:[{name:"Cable Lateral Raise",sets:3,reps:"15",restSec:45},{name:"Rope Triceps Pressdown",sets:3,reps:"12",restSec:60}]}]},{name:"Day 3 – Glute Volume",blocks:[{title:"Glute Giant Set",exercises:[{name:"Bulgarian Split Squat",sets:3,reps:"10/leg",restSec:90,substitutions:[{name:"Leg Press",reason:"Still hits quads and glutes if balance is limiting",equipment:["machines"]}]},{name:"Cable Abduction",sets:3,reps:"15",restSec:45},{name:"Back Extension",sets:3,reps:"12",restSec:60}]}]},{name:"Day 4 – Optional Pump",blocks:[{title:"Band & Bodyweight",exercises:[{name:"Banded Glute Bridge",sets:4,reps:"20",restSec:45,substitutions:[{name:"Hip Circle Walk",reason:"Quick travel-friendly option",equipment:["bands"]}]},{name:"Step-Up",sets:3,reps:"15/leg",restSec:60},{name:"Side Plank",sets:3,reps:"45s/side",restSec:45}]}]}]}],R1={id:v1,title:N1,goal:S1,level:k1,equipment:E1,durationPerSessionMin:C1,tags:_1,summary:P1,rationale:A1,faqs:I1,weeks:T1},cf="beginner",M1=45,D1=["none"],F1=Object.assign({"/src/content/programs/beginner-full-body.json":l0,"/src/content/programs/dumbbell-cut.json":j0,"/src/content/programs/kettlebell-3day.json":T0,"/src/content/programs/lift-plus-zone2.json":z0,"/src/content/programs/linear-strength-3day.json":sk,"/src/content/programs/mobility-core-2day.json":hk,"/src/content/programs/no-equipment-3day.json":kk,"/src/content/programs/phul.json":Lk,"/src/content/programs/push-pull-legs.json":Qk,"/src/content/programs/strength-5x5.json":l1,"/src/content/programs/upper-lower.json":w1,"/src/content/programs/womens-glute-focus.json":R1});let Di=null;function L1(t){const s=t.weeks.length;if(!s)return 0;const n=t.weeks.reduce((r,a)=>{var i;return r+(((i=a.days)==null?void 0:i.length)??0)},0);return n?Math.max(1,Math.round(n/s)):0}function B1(t){return t.level??cf}function O1(t){var s;return(s=t.equipment)!=null&&s.length?[...new Set(t.equipment)]:D1}function U1(t){return t.durationPerSessionMin??M1}function $1(t){return t.tags??[]}function W1(t){return{id:t.id,title:t.title,goal:t.goal,level:B1(t),daysPerWeek:L1(t),weeks:t.weeks.length,equipment:O1(t),durationPerSessionMin:U1(t),tags:$1(t),heroImg:t.heroImg}}async function Ba(){if(Di)return Di;const t=Object.values(F1).map(s=>({meta:W1(s),program:s}));return Di=t,t}const Fi={beginner:0,intermediate:1,advanced:2},ut={goal:35,level:20,days:15,equipment:20,time:10,focus:10},q1={full_body:["full body"],upper_lower:["upper","lower"],push_pull_legs:["push","pull","legs","ppl"],conditioning:["conditioning","zone 2","cardio","hiit","endurance"],mobility:["mobility","core","recovery","flexibility"]};function wo(t,s){let n=0,r=0;if(s.goal&&(r+=ut.goal,t.goal===s.goal?n+=ut.goal:s.goal==="general"&&t.goal!=="general"&&(n+=ut.goal*.5)),s.level){r+=ut.level;const a=Fi[s.level],i=Fi[t.level]??Fi[cf],o=Math.abs(a-i);o===0?n+=ut.level:o===1?n+=ut.level*.6:o===2&&(n+=ut.level*.25)}if(typeof s.days=="number"&&!Number.isNaN(s.days)){r+=ut.days;const a=Math.abs(t.daysPerWeek-s.days);a===0?n+=ut.days:a===1?n+=ut.days*.7:a===2&&(n+=ut.days*.35)}if(s.equipment&&s.equipment.length){r+=ut.equipment;const a=t.equipment.filter(i=>i!=="none");if(!a.length)n+=ut.equipment;else{const i=new Set(s.equipment),o=a.filter(c=>!i.has(c));o.length===0?n+=ut.equipment:o.length<a.length&&(n+=ut.equipment*.5)}}if(typeof s.time=="number"&&s.time>0&&(r+=ut.time,t.durationPerSessionMin<=s.time?n+=ut.time:t.durationPerSessionMin<=s.time+10&&(n+=ut.time*.5)),s.focus){r+=ut.focus;const a=(t.tags??[]).map(h=>h.toLowerCase()),i=String(s.focus);(q1[i]??[i]).some(h=>a.some(m=>m.includes(h)))&&(n+=ut.focus)}return r===0?50:Math.round(n/r*100)}const cd="beginner-full-body";function z1(t){const s=Math.max(0,Math.floor(t)),n=Math.floor(s/60),r=s%60;return`${n}:${r.toString().padStart(2,"0")}`}function dd(t,s,n){return Number.isNaN(t)?s:Math.min(Math.max(t,s),n)}function ud(t){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"){const n=t.replace(",",".").match(/-?\d+(?:\.\d+)?/);if(!n)return null;const r=Number.parseFloat(n[0]);return Number.isFinite(r)?r:null}return null}function V1(t,s){if(!t)return[];let n=0;return t.blocks.map(r=>({title:r.title,exercises:r.exercises.map(a=>{const i=n,o=s==null?void 0:s[i];return n+=1,{exercise:a,displayName:(o==null?void 0:o.name)??a.name,globalIndex:i,substitution:o}})}))}function K1(){var be,me,xe,S,K,A;const[t]=To(),s=ze(),[n,r]=l.useState({}),[a,i]=l.useState({}),[o,c]=l.useState(!1),[h]=l.useState(()=>Date.now()),[m,u]=l.useState([]),[d,f]=l.useState(!0),[p,x]=l.useState({}),[g,v]=l.useState(null),[j,y]=l.useState(null);l.useEffect(()=>{let O=!0;return f(!0),Ba().then(J=>{O&&u(J)}).finally(()=>{O&&f(!1)}),()=>{O=!1}},[]);const N=l.useMemo(()=>m.reduce((O,J)=>(O[J.meta.id]=J,O),{}),[m]),b=t.get("programId")??cd,w=((be=N[cd])==null?void 0:be.program)??((me=m[0])==null?void 0:me.program)??null,I=((xe=N[b])==null?void 0:xe.program)??w,F=Number.parseInt(t.get("week")??"0",10),E=I!=null&&I.weeks.length?dd(F,0,I.weeks.length-1):0,P=(S=I==null?void 0:I.weeks)==null?void 0:S[E],k=Number.parseInt(t.get("day")??"0",10),C=(K=P==null?void 0:P.days)!=null&&K.length?dd(k,0,P.days.length-1):0,T=(A=P==null?void 0:P.days)==null?void 0:A[C],L=I?lf(E,I.deloadWeeks):!1,M=l.useMemo(()=>{if(T)return L?HS(T):T},[T,L]),X=l.useMemo(()=>{const O=Object.entries(p);return O.length?O.reduce((J,[G,$])=>($!=null&&$.name&&(J[Number.parseInt(G,10)]=$.name),J),{}):{}},[p]),ce=l.useMemo(()=>V1(M,p),[M,p]),re=l.useMemo(()=>M?ld(M):[],[M]),ge=l.useMemo(()=>M?ld(M,X):[],[M,X]),z=Object.keys(a).length>0;l.useEffect(()=>{x({})},[M]),l.useEffect(()=>{if(!M)return;const O={};re.forEach(J=>{const G=`${J.exIdx}-${J.set}`;O[G]={done:!1,reps:J.targetReps,weight:""}}),r(O),i({})},[M,re]),l.useEffect(()=>{if(!z)return;const O=window.setInterval(()=>{i(J=>{const G={};return Object.entries(J).forEach(([$,R])=>{const W=Math.max(0,R-1);W>0&&(G[$]=W)}),G})},1e3);return()=>window.clearInterval(O)},[z]),l.useEffect(()=>{let O=!1;async function J(){const G=U.currentUser;if(!M||!I||!G){O||y([]);return}try{const $=Dc(G.uid),R=Ft($,Lt("completedAt","desc"),Ht(20)),le=(await mr(R)).docs.map(H=>H.data()).find(H=>(H==null?void 0:H.programId)===I.id&&(H==null?void 0:H.dayIdx)===C);if(!le||!Array.isArray(le.sets)){O||y([]);return}const q=new Map;if(le.sets.forEach(H=>{const ye=typeof(H==null?void 0:H.exercise)=="string"?H.exercise:"";if(!ye)return;const Ne=ud(H==null?void 0:H.reps);if(Ne===null)return;const Re=ud(H==null?void 0:H.weight),Qe=q.get(ye)??[];Qe.push({reps:Ne,weight:Re??void 0}),q.set(ye,Qe)}),q.size===0){O||y([]);return}const ee=[];M.blocks.forEach(H=>{H.exercises.forEach(ye=>{const Ne=q.get(ye.name)??[];if(!Ne.length){ee.push(`${ye.name} maintain`);return}const{suggestion:Re}=YS({exerciseName:ye.name,lastSets:Ne,planTarget:{sets:ye.sets,reps:ye.reps,rir:ye.rir}});ee.push(`${ye.name} ${Re}`)})}),O||y(ee)}catch{O||y([])}}return y(null),J(),()=>{O=!0}},[M,I==null?void 0:I.id,C]);const fe=(O,J)=>{r(G=>{const $=G[O]??{done:!1,reps:"",weight:""};return{...G,[O]:{...$,...J}}})},pe=(O,J)=>{J&&i(G=>({...G,[O]:J}))},Ee=O=>{g&&(x(J=>{const G={...J};return O?G[g.index]=O:delete G[g.index],G}),v(null))},Ie=async()=>{if(!T||!I)return;const O=U.currentUser;if(!O){V({title:"Please sign in",description:"You need an account to log workouts."});return}const J=ge.map($=>{const R=`${$.exIdx}-${$.set}`,W=n[R],ie={exercise:$.planName,set:$.set,reps:(W==null?void 0:W.reps)??$.targetReps,done:(W==null?void 0:W.done)??!1};W!=null&&W.weight&&(ie.weight=W.weight);const le=p[$.exIdx];return le?(ie.performedExercise=$.name,ie.substitutionName=le.name):$.name!==$.planName&&(ie.performedExercise=$.name),ie});if(!(!J.every($=>$.done===!0)&&!window.confirm("Some sets are still unchecked. Mark the day complete anyway?"))){c(!0);try{const $=Dc(O.uid);await ij($,{programId:I.id,weekIdx:E,dayIdx:C,completedAt:at(),durationSec:Math.round((Date.now()-h)/1e3),sets:J}),await mt(Se(de,"users",O.uid,"coach","profile"),{currentProgramId:I.id,activeProgramId:I.id,lastCompletedWeekIdx:E,lastCompletedDayIdx:C,currentWeekIdx:E,currentDayIdx:C},{merge:!0}),V({title:"Workout logged",description:"Great job completing your session."}),s("/coach",{replace:!0})}catch{V({title:"Unable to save workout",description:"Please try again.",variant:"destructive"})}finally{c(!1)}}};return d||!I?e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Coach Day",description:"Workout details"}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-4 p-6",children:[e.jsx(Zn,{}),e.jsx("div",{className:"h-48 animate-pulse rounded-lg bg-muted/40"}),e.jsx("div",{className:"h-6 w-1/2 animate-pulse rounded bg-muted/40"}),e.jsx("div",{className:"h-6 w-2/3 animate-pulse rounded bg-muted/40"})]}),e.jsx(xt,{})]}):T?e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:`${T.name} – ${I.title}`,description:"Log your sets and reps."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-5 p-6",children:[e.jsx(Zn,{}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>s(-1),children:[e.jsx(Wu,{className:"mr-1 h-4 w-4"})," Back"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:I.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:T.name}),L&&e.jsx(Xe,{variant:"secondary",className:"text-[10px] uppercase tracking-wide",children:"Deload week"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Week ",E+1," • Day ",C+1]})]}),e.jsx("div",{className:"text-right text-xs text-muted-foreground",children:e.jsxs("p",{children:[ge.length," total sets"]})})]}),j!==null&&e.jsxs("div",{className:"rounded-lg border border-primary/30 bg-primary/5 p-4 text-sm leading-relaxed",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Next session targets:"})," ",j.length?j.join("; "):"Complete this day once to generate personalized targets."]}),ce.map((O,J)=>e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:O.title}),O.exercises.map(({exercise:G,displayName:$,globalIndex:R,substitution:W})=>e.jsxs(Y,{children:[e.jsxs(oe,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(he,{className:"text-xl",children:$}),W?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Swapped from ",G.name]}):null]}),e.jsx(_,{type:"button",variant:"link",size:"sm",className:"h-auto px-0 text-xs",onClick:()=>v({index:R,options:G.substitutions??[],originalName:G.name}),children:"Swap"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[G.sets," sets • ",G.reps," target reps"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:KS(G)})]}),e.jsx(Q,{className:"space-y-2",children:Array.from({length:G.sets}).map((ie,le)=>{const q=le+1,ee=`${R}-${q}`,H=n[ee],ye=a[ee];return e.jsxs("div",{className:"flex flex-col gap-3 rounded-md border bg-muted/30 p-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qs,{id:`${ee}-checkbox`,checked:(H==null?void 0:H.done)??!1,onCheckedChange:Ne=>fe(ee,{done:Ne===!0})}),e.jsxs("label",{htmlFor:`${ee}-checkbox`,className:"text-sm font-medium",children:["Set ",q]})]}),e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-3 sm:justify-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{value:(H==null?void 0:H.reps)??"",onChange:Ne=>fe(ee,{reps:Ne.target.value}),className:"h-9 w-20"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"reps"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{value:(H==null?void 0:H.weight)??"",onChange:Ne=>fe(ee,{weight:Ne.target.value}),placeholder:"Weight",className:"h-9 w-24"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"lb / kg"})]}),G.restSec?e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>pe(ee,G.restSec),children:[e.jsx(Zp,{className:"mr-1 h-4 w-4"}),ye?z1(ye):`Rest ${G.restSec}s`]}):null]})]},ee)})})]},R))]},J)),e.jsx("div",{className:"flex justify-end",children:e.jsx(qt,{size:"lg",onClick:Ie,disabled:o,children:o?"Saving...":"Mark Day Complete"})}),e.jsx(Xs,{open:!!g,onOpenChange:O=>!O&&v(null),children:e.jsxs(Us,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Swap exercise"}),e.jsxs(ar,{children:["Choose an alternative for ",g==null?void 0:g.originalName,"."]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(_,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>Ee(),children:["Keep ",g==null?void 0:g.originalName]}),g!=null&&g.options.length?e.jsx("div",{className:"space-y-2",children:g.options.map(O=>{var $;const J=g?p[g.index]:void 0,G=(J==null?void 0:J.name)===O.name;return e.jsxs(_,{type:"button",variant:G?"default":"outline",className:"flex h-auto w-full flex-col items-start gap-1 p-3 text-left",onClick:()=>Ee(O),children:[e.jsx("span",{className:"font-medium",children:O.name}),O.reason?e.jsx("span",{className:"text-xs text-muted-foreground",children:O.reason}):null,($=O.equipment)!=null&&$.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:O.equipment.map(R=>e.jsx(Xe,{variant:"secondary",className:"text-[10px] uppercase tracking-wide",children:R},R))}):null]},O.name)})}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No substitutions available yet. Check back soon!"})]})]})})]}),e.jsx(xt,{})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Coach Day",description:"Workout details"}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-4 p-6",children:[e.jsx(Zn,{}),e.jsx(Y,{children:e.jsx(Q,{className:"p-6 text-sm text-muted-foreground",children:"This workout day could not be found."})}),e.jsx(_,{variant:"outline",onClick:()=>s("/coach"),children:"Back to Coach"})]}),e.jsx(xt,{})]})}const df=tp,md={1:["Mon"],2:["Mon","Thu"],3:["Mon","Wed","Fri"],4:["Mon","Tue","Thu","Fri"],5:["Mon","Tue","Wed","Thu","Fri"],6:["Mon","Tue","Wed","Thu","Fri","Sat"],7:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]};function G1(t){const s=Math.max(1,Math.min(Number.isFinite(t)?t:3,7));return md[s]??md[3]}function H1(t){var n,r;const s=((r=(n=t==null?void 0:t.blocks)==null?void 0:n.flatMap(a=>(a==null?void 0:a.exercises)||[]))==null?void 0:r.filter(Boolean))??[];return s.length?s.slice(0,12).map((a,i)=>({name:(a==null?void 0:a.name)||`Exercise ${i+1}`,sets:Number.isFinite(a==null?void 0:a.sets)&&Number(a.sets)>0?Number(a.sets):3,reps:(a==null?void 0:a.reps)??"10"})):[{name:"Session",sets:3,reps:"10"}]}function uf(t,s){var d;const n=(t==null?void 0:t.id)||(s==null?void 0:s.id)||"unknown-program",r=(t==null?void 0:t.title)||(s==null?void 0:s.title)||"Workout program",a=(t==null?void 0:t.goal)||(s==null?void 0:s.goal)||void 0,i=(s==null?void 0:s.level)||(t==null?void 0:t.level)||void 0,o=(d=t==null?void 0:t.weeks)==null?void 0:d[0],c=(o==null?void 0:o.days)??[],h=typeof(s==null?void 0:s.daysPerWeek)=="number"&&s.daysPerWeek>0?s.daysPerWeek:c.length||3,m=G1(h),u=c.length>0?m.map((f,p)=>({day:f,exercises:H1(c[p])})):m.map(f=>({day:f,exercises:[{name:"Session",sets:3,reps:"10"}]}));return{programId:n,title:r,goal:a,level:i,days:u}}function Y1(t){const s=[];return typeof t.sets=="number"&&t.sets>0&&s.push(`${t.sets} sets`),t.reps&&s.push(`${t.reps}`),typeof t.restSec=="number"&&t.restSec>0&&s.push(`${t.restSec}s rest`),s.length?`${t.name} — ${s.join(" · ")}`:t.name}async function vo(t){const{entry:s,demo:n,entitlements:r,navigate:a}=t,i=s.program,o=s.meta;if(n){V({title:"Demo mode",description:"Sign in to start and save workout programs.",variant:"destructive"});return}const c=U.currentUser;if(!c){V({title:"Sign in required",description:"Log in to save your training program."});return}if(!Nl({demo:n,entitlements:r??void 0})){V({title:"Programs locked",description:Bt()?"Upgrade to Pro to start programs.":"Upgrade to Pro to start programs. Visit Plans to activate your account.",variant:"destructive"}),Bt()?a("/paywall",{replace:!1}):a("/plans",{replace:!1});return}try{const m=Se(de,"users",c.uid,"coachPlans","current"),u=Se(de,"users",c.uid,"coach","profile"),d=await ot(m),f=d.exists()?d.data():null,p=i.weeks.flatMap((w,I)=>(w.days??[]).map(F=>({day:`Week ${I+1} • ${F.name}`,blocks:F.blocks.map(E=>({title:E.title,focus:E.title,work:E.exercises.map(P=>Y1(P))}))}))),x=uf(i,o),g=await Zh(x,{attempts:4,confirmPolls:5,backoffMs:500}),v=typeof(g==null?void 0:g.planId)=="string"?g.planId:null;if(!v)throw new Error("Unable to activate workout plan.");const j=typeof(f==null?void 0:f.calorieTarget)=="number"?f.calorieTarget:2200,y=typeof(f==null?void 0:f.proteinFloor)=="number"?f.proteinFloor:140,N=(f==null?void 0:f.progression)??{deloadEvery:Array.isArray(i.deloadWeeks)&&i.deloadWeeks.length?i.deloadWeeks[0]:4},b={days:o.daysPerWeek,weeks:o.weeks,split:i.title,sessions:p,progression:N,calorieTarget:j,proteinFloor:y,disclaimer:i.summary??(f==null?void 0:f.disclaimer)??"Training guidance only – not medical advice.",source:"catalog",programId:i.id,programTitle:i.title,programGoal:o.goal,programLevel:o.level,workoutPlanId:v,updatedAt:at()};await Promise.allSettled([mt(m,b,{merge:!0}),mt(u,{currentProgramId:i.id,activeProgramId:i.id,startedAt:at(),currentWeekIdx:0,currentDayIdx:0,lastCompletedWeekIdx:-1,lastCompletedDayIdx:-1},{merge:!0})]),V({title:"Program started",description:`${i.title} is now your active plan.`}),a(`/workouts?plan=${v}&started=1`,{replace:!0})}catch(m){pn(m,{op:"programs.startProgram"});const u=m,d=typeof(u==null?void 0:u.status)=="number"?u.status:0,f=typeof(u==null?void 0:u.code)=="string"?u.code:d===401?"unauthenticated":d===403?"permission-denied":d===503?"unavailable":null;let p;f==="unauthenticated"?p="Please sign in again, then retry starting the program.":f==="permission-denied"?p="Your account can't start programs yet. Visit Plans to activate your account.":f==="unavailable"?p="Programs are temporarily offline. Please try again shortly.":typeof(m==null?void 0:m.message)=="string"&&m.message.length?p=m.message:p="Please try again.",V({title:"Could not start program",description:p,variant:"destructive"})}}const Ms={daysPerWeek:4,goal:"hypertrophy",equipment:"full_gym",experience:"beginner",timePerWorkout:45,focus:"full_body"};function No(t){if(!t||typeof t!="object")return Ms;const s=[3,4,5,6].includes(Number(t.daysPerWeek))?Number(t.daysPerWeek):Ms.daysPerWeek,n=t.goal==="strength"||t.goal==="hypertrophy"||t.goal==="fat_loss"||t.goal==="athletic"?t.goal:Ms.goal,r=t.equipment==="full_gym"||t.equipment==="dumbbells"||t.equipment==="bodyweight"?t.equipment:Ms.equipment,a=t.experience==="beginner"||t.experience==="intermediate"||t.experience==="advanced"?t.experience:Ms.experience,i=[30,45,60,75].includes(Number(t.timePerWorkout))?Number(t.timePerWorkout):Ms.timePerWorkout,o=t.focus==="full_body"||t.focus==="upper_lower"||t.focus==="push_pull_legs"||t.focus==="conditioning"||t.focus==="mobility"?t.focus:Ms.focus;return{daysPerWeek:s,goal:n,equipment:r,experience:a,timePerWorkout:i,focus:o}}const mf="mbs.programPrefs";function Q1(){try{const t=window.localStorage.getItem(mf);if(!t)throw new Error("missing");const s=JSON.parse(t);return No(s)}catch{return Ms}}function J1(t){try{window.localStorage.setItem(mf,JSON.stringify(t))}catch{}}const X1={hypertrophy:"Build muscle",strength:"Strength",cut:"Lose fat / Recomp",general:"Performance"},Z1={beginner:"Beginner",intermediate:"Intermediate",advanced:"Advanced"},eE={none:"Bodyweight",dumbbells:"Dumbbells",kettlebells:"Kettlebells",barbell:"Barbell",machines:"Machines",bands:"Bands"},hf=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function ff(t){return t.toISOString().slice(0,10)}function tE(){const t=new Date;return Array.from({length:7}).map((s,n)=>{const r=new Date(t);return r.setDate(t.getDate()+n),{iso:ff(r),day:hf[r.getDay()]}})}function sE(t){return(Array.isArray(t==null?void 0:t.days)?t.days:[]).filter(r=>Array.isArray(r==null?void 0:r.exercises)&&r.exercises.length>0).length}function hd(t,s){const n=Array.isArray(t==null?void 0:t.days)?t.days.find(r=>(r==null?void 0:r.day)===s):null;return Array.isArray(n==null?void 0:n.exercises)?n.exercises.length:0}function nE(){var pe,Ee,Ie,be,me,xe;const t=ze(),s=Gu(),n=ft(),{entitlements:r,loading:a}=xr(),{profile:i}=Zs(),{user:o,authReady:c}=He(),[h,m]=l.useState(null),[u,d]=l.useState(null),[f,p]=l.useState(()=>Q1()),x=l.useRef(!1),g=l.useRef(null);l.useEffect(()=>{J1(f)},[f]),l.useEffect(()=>{if(!x.current){if(i!=null&&i.programPreferences){p(No(i.programPreferences)),x.current=!0;return}c&&(x.current=!0)}},[c,i==null?void 0:i.programPreferences]),l.useEffect(()=>{if(g.current&&window.clearTimeout(g.current),!c||n||!o)return;const S=i!=null&&i.programPreferences?No(i.programPreferences):null,K=S?JSON.stringify(S):null,A=JSON.stringify(f);if(K!==A)return g.current=window.setTimeout(()=>{mt(Se(de,"users",o.uid,"coach","profile"),{programPreferences:f,programPreferencesUpdatedAt:at()},{merge:!0}).catch(O=>{console.warn("programPreferences.save_failed",O)})},400),()=>{g.current&&window.clearTimeout(g.current)}},[c,n,f,i==null?void 0:i.programPreferences,o]);const v=Yr({queryKey:["workouts","plan"],queryFn:()=>wr(),staleTime:1e4}),j=Yr({queryKey:["workouts","workouts"],queryFn:()=>xl(),staleTime:1e4}),y=Yr({queryKey:["programs","catalog"],queryFn:()=>Ba(),staleTime:6e4}),N=v.data,b=sE(N),w=hf[new Date().getDay()],I=ff(new Date),F=N?hd(N,w):0,E=((Ie=(Ee=(pe=j.data)==null?void 0:pe.progress)==null?void 0:Ee[I])==null?void 0:Ie.length)??0,P=l.useMemo(()=>{const S=i==null?void 0:i.goal;if(S==="lose_fat")return"cut";if(S==="gain_muscle")return"hypertrophy";if(S==="improve_heart")return"general"},[i==null?void 0:i.goal]),k=l.useMemo(()=>{const S=y.data??[];return S.length?S.map(K=>({entry:K,score:wo(K.meta,{goal:P})})).sort((K,A)=>A.score-K.score).slice(0,3).map(K=>K.entry):[]},[y.data,P]),C=l.useMemo(()=>(y.data??[]).slice().sort((K,A)=>{const O=(K.meta.daysPerWeek===4?2:K.meta.daysPerWeek===3?1:0)+(K.meta.level==="beginner"?1:0);return(A.meta.daysPerWeek===4?2:A.meta.daysPerWeek===3?1:0)+(A.meta.level==="beginner"?1:0)-O}).slice(0,3),[y.data]),T=l.useMemo(()=>{const S=y.data??[],K=new Set([...k.map(A=>A.meta.id),...C.map(A=>A.meta.id)]);return S.filter(A=>!K.has(A.meta.id))},[y.data,C,k]),L=!a,M=Nl({demo:n,entitlements:r}),X=l.useMemo(()=>{const S=y.data??[];if(!S.length)return null;const K={strength:"strength",hypertrophy:"hypertrophy",fat_loss:"cut",athletic:"general"},A={full_gym:["machines","barbell","dumbbells"],dumbbells:["dumbbells"],bodyweight:["none"]},O={goal:K[f.goal],level:f.experience,days:f.daysPerWeek,equipment:A[f.equipment],time:f.timePerWorkout,focus:f.focus};return S.map(G=>({entry:G,score:wo(G.meta,O)})).sort((G,$)=>$.score-G.score)[0]??null},[y.data,f]),ce=()=>{Promise.all([y.refetch(),v.refetch(),j.refetch()])},re=async S=>{if(N!=null&&N.id){d(S);try{await Xh({planId:N.id,status:S}),V({title:S==="paused"?"Plan paused":"Plan ended"}),await s.invalidateQueries({queryKey:["workouts","plan"]}),await s.invalidateQueries({queryKey:["workouts","workouts"]})}catch(K){V({title:"Could not update plan",description:(K==null?void 0:K.message)||"Please try again.",variant:"destructive"})}finally{d(null)}}},ge=(S,K)=>{var ie;const A=S.meta,O=S.program,J=A.daysPerWeek,G=A.durationPerSessionMin?`${A.durationPerSessionMin} min`:"~45 min",$=((ie=A.equipment)!=null&&ie.length?A.equipment:["none"]).map(le=>eE[le]??le).join(" • "),R=Z1[A.level],W=K==="recommended"?"Recommended":K==="popular"?"Popular":null;return e.jsxs(Y,{className:"overflow-hidden border bg-card/70",children:[e.jsxs("div",{className:"relative",children:[e.jsx(df,{ratio:16/8,children:A.heroImg?e.jsx("img",{src:A.heroImg,alt:O.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/25 via-primary/10 to-background"})}),e.jsx("div",{className:"absolute left-3 top-3 flex flex-wrap gap-2",children:W?e.jsx(Xe,{className:"bg-primary text-primary-foreground",children:W}):null})]}),e.jsxs(Q,{className:"space-y-3 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:O.title}),e.jsx(Xe,{variant:"secondary",className:"shrink-0",children:X1[A.goal]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[J," days/week • ",G," • ",$]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Difficulty: ",R]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>t(`/programs/${A.id}`),children:"Preview"}),e.jsx(_,{type:"button",onClick:async()=>{if(!L){V({title:"Checking access…",description:"We’ll enable start once your account is synced."});return}m(A.id);try{await vo({entry:S,demo:n,entitlements:r,navigate:t})}finally{m(null)}},disabled:h===A.id||!L,children:h===A.id?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Starting…"]}):"Start"})]})]})]},A.id)},z=y.isLoading||v.isLoading||j.isLoading,fe=((be=y.error)==null?void 0:be.message)||((me=v.error)==null?void 0:me.message)||((xe=j.error)==null?void 0:xe.message)||null;return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Plans – MyBodyScan",description:"Choose and manage your workout plan."}),e.jsx("main",{className:"mx-auto flex w-full max-w-5xl flex-col gap-6 p-6",children:z?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-1/2 animate-pulse rounded bg-muted/40"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"h-40 animate-pulse rounded-lg bg-muted/30"}),e.jsx("div",{className:"h-40 animate-pulse rounded-lg bg-muted/30"})]})]}):fe?e.jsx(Y,{className:"border bg-card/60",children:e.jsxs(Q,{className:"flex flex-col gap-3 p-6",children:[e.jsx("div",{className:"text-lg font-semibold",children:"We couldn’t load Plans"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please check your connection and try again."}),e.jsx(_,{onClick:ce,className:"w-fit",children:"Retry"})]})}):N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Your plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Keep your schedule simple. We’ll take you straight to Today when you’re ready."})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-2",children:[e.jsx(he,{className:"text-2xl",children:N.title||"Active plan"}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[b||0," days/week"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Next workout:"," ",F>0?`${w} (${F} exercises)`:"Rest day"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Today progress: ",E," / ",F]})]})]}),e.jsxs(Q,{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:()=>t("/workouts"),className:"gap-2",children:[e.jsx(zu,{className:"h-4 w-4"})," Open today’s workout"]}),e.jsxs(_,{variant:"outline",onClick:()=>t("/programs/active/edit"),className:"gap-2",children:[e.jsx(eg,{className:"h-4 w-4"})," Edit plan"]}),e.jsxs(_,{variant:"outline",onClick:()=>t("/programs/customize?fromActive=1"),className:"gap-2",children:[e.jsx(Ou,{className:"h-4 w-4"})," Regenerate plan"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{variant:"outline",onClick:()=>void re("paused"),disabled:u==="paused"||u==="ended",className:"gap-2",children:[e.jsx(tg,{className:"h-4 w-4"}),u==="paused"?"Pausing…":"Pause"]}),e.jsx(_,{variant:"destructive",onClick:()=>void re("ended"),disabled:u==="paused"||u==="ended",children:u==="ended"?"Ending…":"End plan"})]})]})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-xl",children:"Upcoming week"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"What’s next, with completion status."})]}),e.jsx(Q,{className:"space-y-2",children:tE().map(({iso:S,day:K})=>{var G,$,R;const A=hd(N,K),O=((R=($=(G=j.data)==null?void 0:G.progress)==null?void 0:$[S])==null?void 0:R.length)??0,J=A>0&&O>=A;return e.jsxs("div",{className:"flex items-center justify-between rounded-md border bg-background/60 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(sg,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-foreground",children:[K," ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",new Date(S).toLocaleDateString(),")"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:A>0?`${A} exercises`:"Rest day"})]})]}),e.jsx("div",{className:"text-xs",children:A>0?e.jsxs(Xe,{variant:J?"default":"secondary",children:[O,"/",A]}):e.jsx(Xe,{variant:"outline",children:"Rest"})})]},S)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Choose your plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set a few preferences and we’ll match you to the right program."})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-xl",children:"Plan preferences"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose what matters most — you can edit this anytime."})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Days per week"}),e.jsxs(Rt,{value:String(f.daysPerWeek),onValueChange:S=>p(K=>({...K,daysPerWeek:Number(S)})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsx(Et,{children:[3,4,5,6].map(S=>e.jsxs(Ue,{value:String(S),children:[S," days"]},S))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Goal"}),e.jsxs(Rt,{value:f.goal,onValueChange:S=>p(K=>({...K,goal:S})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"strength",children:"Strength"}),e.jsx(Ue,{value:"hypertrophy",children:"Hypertrophy"}),e.jsx(Ue,{value:"fat_loss",children:"Fat loss"}),e.jsx(Ue,{value:"athletic",children:"Athletic"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Equipment"}),e.jsxs(Rt,{value:f.equipment,onValueChange:S=>p(K=>({...K,equipment:S})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"full_gym",children:"Full gym"}),e.jsx(Ue,{value:"dumbbells",children:"Dumbbells"}),e.jsx(Ue,{value:"bodyweight",children:"Bodyweight"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Focus"}),e.jsxs(Rt,{value:f.focus,onValueChange:S=>p(K=>({...K,focus:S})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"full_body",children:"Full body"}),e.jsx(Ue,{value:"upper_lower",children:"Upper / Lower"}),e.jsx(Ue,{value:"push_pull_legs",children:"Push / Pull / Legs"}),e.jsx(Ue,{value:"conditioning",children:"Conditioning"}),e.jsx(Ue,{value:"mobility",children:"Mobility & Core"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Experience"}),e.jsxs(Rt,{value:f.experience,onValueChange:S=>p(K=>({...K,experience:S})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsxs(Et,{children:[e.jsx(Ue,{value:"beginner",children:"Beginner"}),e.jsx(Ue,{value:"intermediate",children:"Intermediate"}),e.jsx(Ue,{value:"advanced",children:"Advanced"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Time per workout"}),e.jsxs(Rt,{value:String(f.timePerWorkout),onValueChange:S=>p(K=>({...K,timePerWorkout:Number(S)})),children:[e.jsx(kt,{children:e.jsx(Mt,{placeholder:"Select"})}),e.jsx(Et,{children:[30,45,60,75].map(S=>e.jsxs(Ue,{value:String(S),children:[S," min"]},S))})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx(_,{onClick:async()=>{if(X!=null&&X.entry){if(!L){V({title:"Checking access…",description:"We’ll enable start once your account is synced."});return}m(X.entry.meta.id);try{await vo({entry:X.entry,demo:n,entitlements:r,navigate:t})}finally{m(null)}}},disabled:!(X!=null&&X.entry)||h===(X==null?void 0:X.entry.meta.id)||!L||!M,className:"gap-2",children:h===(X==null?void 0:X.entry.meta.id)?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Starting…"]}):"Start program"}),e.jsxs(_,{variant:"outline",onClick:()=>t("/programs/customize"),className:"gap-2",children:["Build my plan ",e.jsx(Hs,{className:"h-4 w-4"})]}),e.jsx(_,{variant:"outline",onClick:()=>t("/programs/quiz"),children:"Take the quick quiz"})]}),L&&!M?e.jsxs("div",{className:"rounded-lg border border-dashed bg-muted/30 p-3 text-sm text-muted-foreground",children:[e.jsx("div",{className:"font-medium text-foreground",children:"Programs locked"}),e.jsx("p",{className:"mt-1",children:"Activate your plan to start programs. We’ll bring you back here once you’re unlocked."}),e.jsx(_,{variant:"secondary",size:"sm",className:"mt-3",onClick:()=>t(Bt()?"/paywall":"/plans"),children:"Upgrade"})]}):null]})]}),X!=null&&X.entry?e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-xl",children:"Best match"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Match score: ",X.score,"%"]})]}),e.jsx(Q,{className:"grid gap-4 md:grid-cols-3",children:ge(X.entry,"recommended")})]}):null,e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{className:"space-y-1",children:e.jsx(he,{className:"text-xl",children:"Popular"})}),e.jsx(Q,{className:"grid gap-4 md:grid-cols-3",children:C.map(S=>ge(S,"popular"))})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{className:"space-y-1",children:e.jsx(he,{className:"text-xl",children:"Templates"})}),e.jsx(Q,{className:"grid gap-4 md:grid-cols-3",children:T.map(S=>ge(S))})]})]})}),e.jsx(xt,{})]})}const pf=l.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...r},a)=>e.jsx(Su,{ref:a,decorative:n,orientation:s,className:ae("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));pf.displayName=Su.displayName;const fd=rp,So=l.forwardRef(({className:t,...s},n)=>e.jsx(sp,{ref:n,className:ae("border-b",t),...s}));So.displayName="AccordionItem";const ko=l.forwardRef(({className:t,children:s,...n},r)=>e.jsx(np,{className:"flex",children:e.jsxs(ku,{ref:r,className:ae("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...n,children:[s,e.jsx(Uo,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));ko.displayName=ku.displayName;const Eo=l.forwardRef(({className:t,children:s,...n},r)=>e.jsx(Eu,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:ae("pb-4 pt-0",t),children:s})}));Eo.displayName=Eu.displayName;const pd={none:"Bodyweight",dumbbells:"Dumbbells",kettlebells:"Kettlebells",barbell:"Barbell",machines:"Machines",bands:"Bands"},gd={hypertrophy:"Hypertrophy",strength:"Strength",cut:"Cut / Recomp",general:"General Fitness"},Li={beginner:"Beginner",intermediate:"Intermediate",advanced:"Advanced"};function rE(t){return t?t%15===0?`${t} min sessions`:`~${t} min sessions`:"~45 min"}function aE(t){var s,n,r;for(const a of t.weeks){const i=(s=a.days)==null?void 0:s[0];if(i)return i}return(r=(n=t.weeks[0])==null?void 0:n.days)==null?void 0:r[0]}function iE(t){const s=[];return typeof t.sets=="number"&&t.sets>0&&s.push(`${t.sets} sets`),t.reps&&s.push(`${t.reps}`),typeof t.restSec=="number"&&t.restSec>0&&s.push(`${t.restSec}s rest`),s.length?`${t.name} — ${s.join(" · ")}`:t.name}function oE(){const{id:t}=Io(),s=ze(),[n,r]=l.useState(!0),[a,i]=l.useState(null),[o,c]=l.useState(!1),[h,m]=l.useState(null),u=ft(),{entitlements:d,loading:f}=xr(),p=Nl({demo:u,entitlements:d});l.useEffect(()=>{let k=!0;return Ba().then(C=>{if(!k)return;const T=C.find(L=>L.meta.id===t);i(T??null)}).finally(()=>{k&&r(!1)}),()=>{k=!1}},[t]);const x=a==null?void 0:a.program,g=a==null?void 0:a.meta,v=l.useMemo(()=>x?aE(x):null,[x]),j=async()=>{if(!x||!g)return;if(u){_t();return}const k=U.currentUser;if(!k){V({title:"Sign in required",description:"Log in to save your training program."});return}if(f){V({title:"Checking access…",description:"We’ll enable start once your account is synced."});return}if(!p){V({title:"Programs locked",description:Bt()?"Upgrade to Pro to start programs.":"Upgrade to Pro to start programs. Visit Plans to activate your account.",variant:"destructive"}),window.location.assign(Bt()?"/paywall":"/plans");return}try{c(!0),m("Activating program…");const C=Se(de,"users",k.uid,"coach","profile"),T=Se(de,"users",k.uid,"coachPlans","current"),L=await ot(T),M=L.exists()?L.data():null,X=x.weeks.flatMap((Ie,be)=>(Ie.days??[]).map(me=>({day:`Week ${be+1} • ${me.name}`,blocks:me.blocks.map(xe=>({title:xe.title,focus:xe.title,work:xe.exercises.map(S=>iE(S))}))}))),ce=uf(x,g);let re=null;m("Contacting the server…");const ge=await Zh(ce,{attempts:4,confirmPolls:5,backoffMs:500});if(re=typeof(ge==null?void 0:ge.planId)=="string"?ge.planId:null,!re)throw new Error("Unable to activate workout plan.");m("Finalizing…");const z=typeof(M==null?void 0:M.calorieTarget)=="number"?M.calorieTarget:2200,fe=typeof(M==null?void 0:M.proteinFloor)=="number"?M.proteinFloor:140,pe=(M==null?void 0:M.progression)??{deloadEvery:Array.isArray(x.deloadWeeks)&&x.deloadWeeks.length?x.deloadWeeks[0]:4},Ee={days:g.daysPerWeek,weeks:g.weeks,split:x.title,sessions:X,progression:pe,calorieTarget:z,proteinFloor:fe,disclaimer:x.summary??(M==null?void 0:M.disclaimer)??"Training guidance only – not medical advice.",source:"catalog",programId:x.id,programTitle:x.title,programGoal:g.goal,programLevel:g.level,workoutPlanId:re,updatedAt:at()};await Promise.allSettled([mt(T,Ee,{merge:!0}),mt(C,{currentProgramId:x.id,activeProgramId:x.id,startedAt:at(),currentWeekIdx:0,currentDayIdx:0,lastCompletedWeekIdx:-1,lastCompletedDayIdx:-1},{merge:!0})]),V({title:"Program started",description:`${x.title} is now your active plan.`}),s(`/workouts?plan=${re}&started=1`,{replace:!0})}catch(C){pn(C,{op:"programs.startProgram"});const T=C,L=typeof(T==null?void 0:T.status)=="number"?T.status:0,M=typeof(T==null?void 0:T.code)=="string"?T.code:L===401?"unauthenticated":L===403?"permission-denied":L===503?"unavailable":null;let X;M==="unauthenticated"?X="Please sign in again, then retry starting the program.":M==="permission-denied"?X="Your account can't start programs yet. Visit Plans to activate your account.":M==="unavailable"?X="Programs are temporarily offline. Please try again shortly.":typeof(C==null?void 0:C.message)=="string"&&C.message.length?X=C.message:X="Please try again.",V({title:"Could not start program",description:X,variant:"destructive"})}finally{c(!1),m(null)}},y=()=>{x&&s(`/coach/day?programId=${x.id}&week=0&day=0`)};if(n)return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Programs – MyBodyScan",description:"Browse structured training programs."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-4xl flex-col gap-6 p-6",children:[e.jsx("div",{className:"h-64 animate-pulse rounded-lg bg-muted/50"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-1/2 animate-pulse rounded bg-muted/40"}),e.jsx("div",{className:"h-32 animate-pulse rounded bg-muted/40"})]})]}),e.jsx(xt,{})]});if(!a||!x||!g)return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Program not found – MyBodyScan",description:"Program details."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-6 p-6",children:[e.jsxs(_,{variant:"ghost",className:"w-fit",onClick:()=>s(-1),children:[e.jsx(la,{className:"mr-2 h-4 w-4"}),"Back to programs"]}),e.jsx(Y,{children:e.jsx(Q,{className:"p-8 text-center text-sm text-muted-foreground",children:"We couldn't find that program. Browse the catalog to pick another option."})})]}),e.jsx(xt,{})]});const N=g.equipment.length?g.equipment:["none"],b=N.map(k=>pd[k]??k),w=x.deloadWeeks??[],I=w.length>0,F=w.map(k=>Number.isFinite(k)?`Week ${k}`:null).filter(Boolean).join(", "),E=g.durationPerSessionMin?`${g.durationPerSessionMin} min`:"~45 min",P=`${g.daysPerWeek} d/wk • ${g.weeks} week${g.weeks===1?"":"s"} • ${E}`;return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:`${x.title} – MyBodyScan`,description:x.summary??"Training program details"}),e.jsxs("main",{className:"mx-auto flex w-full max-w-4xl flex-col gap-6 p-6",children:[e.jsxs(_,{variant:"ghost",className:"w-fit",onClick:()=>s(-1),children:[e.jsx(la,{className:"mr-2 h-4 w-4"})," Back to programs"]}),e.jsxs(Y,{className:"overflow-hidden border bg-card/60",children:[e.jsx("div",{className:"relative",children:e.jsx(df,{ratio:16/7,children:e.jsxs("div",{className:"relative h-full w-full",children:[g.heroImg?e.jsx("img",{src:g.heroImg,alt:x.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/30 via-primary/10 to-background"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-4 left-4 flex flex-wrap gap-2 text-xs font-semibold text-foreground",children:[e.jsx("span",{className:"rounded-full bg-background/80 px-3 py-1 shadow-sm backdrop-blur-sm",children:gd[x.goal]}),e.jsx("span",{className:"rounded-full bg-background/70 px-3 py-1 shadow-sm backdrop-blur-sm",children:Li[g.level]})]})]})})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{className:"text-3xl font-semibold",children:x.title}),e.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:x.summary??`A ${g.daysPerWeek}-day plan for ${Li[g.level]}.`})]}),e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:P}),x.tags&&x.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.tags.map(k=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-medium text-muted-foreground",children:k},k))})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"What you’ll do"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:x.description??x.summary??`Follow ${g.daysPerWeek} structured sessions each week focused on ${gd[g.goal].toLowerCase()}.`}),x.rationale&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-primary/30 bg-primary/5 p-4",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-primary",children:"Why this plan works"}),e.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:x.rationale})]})]})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"At a glance"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("dl",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Level"}),e.jsx("dd",{className:"font-medium text-foreground",children:Li[g.level]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Days / week"}),e.jsx("dd",{className:"font-medium text-foreground",children:g.daysPerWeek})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Total weeks"}),e.jsx("dd",{className:"font-medium text-foreground",children:g.weeks})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Session length"}),e.jsx("dd",{className:"font-medium text-foreground",children:rE(g.durationPerSessionMin)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Equipment"}),e.jsx("dd",{className:"font-medium text-foreground",children:b.join(" • ")})]})]}),I&&F&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Includes deload week(s): ",F]})]})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"Weekly schedule overview"})}),e.jsxs(Q,{children:[I&&e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:"Deload weeks automatically dial back volume so you can recover before the next block."}),e.jsxs(ul,{children:[e.jsx(ml,{children:e.jsxs(lr,{children:[e.jsx(cr,{className:"w-28",children:"Week"}),e.jsx(cr,{children:"Training Days"})]})}),e.jsx(hl,{children:x.weeks.map((k,C)=>e.jsxs(lr,{children:[e.jsx(dr,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Week ",C+1]}),lf(C,x.deloadWeeks)&&e.jsx(Xe,{variant:"outline",className:"border-primary/40 text-primary",children:"Deload"})]})}),e.jsx(dr,{className:"text-sm text-muted-foreground",children:k.days.map(T=>T.name).join(" • ")})]},C))})]})]})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"Required equipment"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"You’ll primarily need:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(k=>e.jsx(Xe,{variant:"outline",className:"capitalize",children:pd[k]??k},k))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Swap accessories as needed to match your gym setup."})]})]})]}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"Sample training day"})}),e.jsx(Q,{children:v?e.jsx(fd,{type:"single",collapsible:!0,defaultValue:"day-1",children:e.jsxs(So,{value:"day-1",children:[e.jsx(ko,{className:"text-left text-base font-medium",children:v.name}),e.jsx(Eo,{className:"space-y-4 pt-4",children:v.blocks.map((k,C)=>e.jsxs("div",{className:"rounded-md border bg-muted/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:k.title}),e.jsx(pf,{className:"my-2"}),e.jsx("ul",{className:"space-y-2 text-sm text-muted-foreground",children:k.exercises.map((T,L)=>e.jsxs("li",{className:"flex items-start justify-between gap-4",children:[e.jsx("span",{children:T.name}),e.jsxs("span",{className:"text-xs uppercase tracking-wide",children:[T.sets," × ",T.reps]})]},L))})]},C))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No training days provided."})})]}),x.faqs&&x.faqs.length>0&&e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"FAQs"})}),e.jsx(Q,{children:e.jsx(fd,{type:"single",collapsible:!0,children:x.faqs.map((k,C)=>e.jsxs(So,{value:`faq-${C}`,children:[e.jsx(ko,{className:"text-left text-sm font-medium",children:k.q}),e.jsx(Eo,{className:"text-sm text-muted-foreground",children:k.a})]},C))})})]}),e.jsx(Y,{className:"border bg-card/60",children:e.jsxs(Q,{className:"flex flex-col gap-4 p-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ng,{className:"mt-1 h-5 w-5 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Starting this program keeps your past logs intact and resets your weekly schedule to week 1."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(_,{size:"sm",variant:"outline",onClick:y,children:"Preview week 1"}),e.jsxs(qt,{size:"sm",onClick:j,disabled:o||u||!p,title:u?"Demo mode: sign in to save":p?void 0:"Visit Plans to activate programs",children:[o?e.jsx(Dt,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Vu,{className:"mr-2 h-4 w-4"})," ",u?"Demo only":o?"Activating…":"Start program"]})]})]})}),h&&e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:h})]}),e.jsx(xt,{})]})}const Co=l.forwardRef(({className:t,...s},n)=>e.jsxs(Cu,{ref:n,className:ae("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(ap,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ip,{className:"absolute h-full bg-primary"})}),e.jsx(op,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Co.displayName=Cu.displayName;const lE=[{value:"hypertrophy",label:"Build muscle",description:"Hypertrophy-focused growth"},{value:"strength",label:"Get stronger",description:"Prioritize heavier compounds"},{value:"cut",label:"Lean out",description:"Maintain muscle while cutting"},{value:"general",label:"Stay balanced",description:"General fitness and training"}],xd=[{value:"beginner",label:"New lifter",description:"Under 1 year of training"},{value:"intermediate",label:"Intermediate",description:"1-3 years under the bar"},{value:"advanced",label:"Advanced",description:"3+ years with structured training"}],cE=[{value:"none",label:"Bodyweight"},{value:"dumbbells",label:"Dumbbells"},{value:"kettlebells",label:"Kettlebells"},{value:"barbell",label:"Barbell"},{value:"machines",label:"Machines"},{value:"bands",label:"Bands"}];function dE(){const t=ze(),[s,n]=l.useState(!0),[r,a]=l.useState([]),[i,o]=l.useState("hypertrophy"),[c,h]=l.useState("beginner"),[m,u]=l.useState(4),[d,f]=l.useState([]),[p,x]=l.useState(45),[g,v]=l.useState(null),[j,y]=l.useState(!1),N=ft(),{claims:b}=ll(),{subscription:w}=qh();l.useEffect(()=>{let C=!0;return Ba().then(T=>{C&&a(T)}).finally(()=>{C&&n(!1)}),()=>{C=!1}},[]);const I=C=>{f(T=>T.includes(C)?T.filter(L=>L!==C):[...T,C])},F=(C,T)=>{var ce;const L=[],{meta:M}=C;M.goal===i&&L.push("Matches your goal"),Math.abs(M.daysPerWeek-m)<=1&&L.push(`Fits your ${m}-day routine`),M.level===c&&L.push(`${(ce=xd.find(re=>re.value===c))==null?void 0:ce.label} friendly`);const X=M.equipment.filter(re=>re!=="none");return X.length?X.every(re=>d.includes(re))&&L.push("Uses equipment you already own"):L.push("No equipment required"),M.durationPerSessionMin<=p&&L.push("Stays within your time limit"),T>=85&&!L.includes("High match score")&&L.push("High match score"),L.slice(0,3)},E=C=>{if(C.preventDefault(),!r.length)return;const T=r.map(L=>{const M=wo(L.meta,{goal:i,level:c,days:m,equipment:d.length?d:void 0,time:p});return{entry:L,score:M}}).sort((L,M)=>M.score-L.score).slice(0,3).map(L=>({...L,reasons:F(L.entry,L.score)}));v(T)},P=(g==null?void 0:g[0])??null,k=async()=>{if(P)try{y(!0),await vo({entry:P.entry,demo:N,claims:b??null,subscription:w??null,navigate:t})}catch(C){V({title:"Unable to start program",description:C instanceof Error&&C.message?C.message:"Please try again.",variant:"destructive"})}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Program quiz – MyBodyScan",description:"Find the right training plan in under a minute."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-6 p-6",children:[e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-primary",children:[e.jsx(Ku,{className:"h-4 w-4"})," Quick quiz"]}),e.jsx(he,{className:"text-3xl font-semibold",children:"Find your next program"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Answer five questions and we’ll recommend the top three blocks for your goals."})]}),e.jsx(Q,{children:e.jsxs("form",{className:"space-y-6",onSubmit:E,children:[e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Goal"}),e.jsx(ds,{value:i,onValueChange:C=>o(C),className:"grid gap-2 md:grid-cols-2",children:lE.map(C=>e.jsxs(je,{htmlFor:`goal-${C.value}`,className:"flex cursor-pointer flex-col gap-1 rounded-md border bg-card px-4 py-3 text-sm transition hover:border-primary",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"font-medium text-foreground",children:C.label}),e.jsx(us,{value:C.value,id:`goal-${C.value}`})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.description})]},C.value))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Experience level"}),e.jsx(ds,{value:c,onValueChange:C=>h(C),className:"grid gap-2 md:grid-cols-3",children:xd.map(C=>e.jsxs(je,{htmlFor:`level-${C.value}`,className:"flex cursor-pointer flex-col gap-1 rounded-md border bg-card px-4 py-3 text-sm transition hover:border-primary",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"font-medium text-foreground",children:C.label}),e.jsx(us,{value:C.value,id:`level-${C.value}`})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.description})]},C.value))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Days per week"}),e.jsxs("div",{className:"space-y-3 rounded-md border bg-muted/40 px-4 py-5",children:[e.jsx(Co,{min:2,max:6,step:1,value:[m],onValueChange:C=>u(C[0]??4)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m," training days (±1 wiggle room)"]})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Equipment you have"}),e.jsx("div",{className:"grid gap-2 md:grid-cols-3",children:cE.map(C=>e.jsxs(je,{htmlFor:`equipment-${C.value}`,className:"flex cursor-pointer items-center gap-2 rounded-md border bg-card px-3 py-2 text-sm transition hover:border-primary",children:[e.jsx(Qs,{id:`equipment-${C.value}`,checked:d.includes(C.value),onCheckedChange:()=>I(C.value)}),e.jsx("span",{children:C.label})]},C.value))}),d.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select anything you can access, or leave blank for bodyweight only."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Time per session"}),e.jsxs("div",{className:"space-y-3 rounded-md border bg-muted/40 px-4 py-5",children:[e.jsx(Co,{min:20,max:75,step:5,value:[p],onValueChange:C=>x(C[0]??45)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Up to ",p," minutes each workout"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{type:"button",variant:"ghost",onClick:()=>v(null),disabled:!g,children:"Reset results"}),e.jsxs(_,{type:"submit",disabled:s,children:["See my matches ",e.jsx(Hs,{className:"ml-2 h-4 w-4"})]})]})]})})]}),g&&e.jsxs(Y,{className:"border bg-card/60",children:[e.jsx(oe,{children:e.jsx(he,{className:"text-xl",children:"Your top programs"})}),e.jsxs(Q,{className:"space-y-4",children:[g.map((C,T)=>e.jsxs("div",{className:"rounded-lg border bg-background/60 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:C.entry.program.title}),T===0&&e.jsx(Xe,{variant:"secondary",children:"Top pick"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Match score: ",C.score,"%"]})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>t(`/programs/${C.entry.meta.id}`),children:"View details"})]}),C.reasons.length>0&&e.jsx("ul",{className:"mt-3 flex flex-wrap gap-2 text-xs text-muted-foreground",children:C.reasons.map(L=>e.jsxs("li",{className:"flex items-center gap-1 rounded-full bg-muted px-2 py-1",children:[e.jsx(Vu,{className:"h-3 w-3 text-primary"}),e.jsx("span",{children:L})]},L))})]},C.entry.meta.id)),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start your top pick now or keep browsing the full catalog."}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>t("/programs"),children:"View catalog"}),e.jsx(qt,{size:"sm",onClick:k,disabled:!P||j,children:"Start recommended"})]})]})]})]})]}),e.jsx(xt,{})]})}const uE=new Set(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]);function mE(t){if(!Array.isArray(t)||!t.length)return"At least one workout day is required.";const s=t.map(r=>r==null?void 0:r.day).filter(Boolean);return s.some(r=>!uE.has(r))?"Workout days must be Mon–Sun.":new Set(s).size!==s.length?"Each workout day must be unique (Mon–Sun).":t.some(r=>!Array.isArray(r==null?void 0:r.exercises)||r.exercises.length===0)?"Each workout day needs at least one exercise.":null}const _o=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],yd=["Back squat","Front squat","Romanian deadlift","Deadlift","Hip thrust","Lunge","Leg press","Leg curl","Calf raise","Bench press","Incline bench press","Dumbbell bench press","Push-up","Overhead press","Lateral raise","Pull-up","Lat pulldown","Barbell row","Dumbbell row","Seated cable row","Face pull","Biceps curl","Triceps pressdown","Plank","Hanging knee raise"].sort((t,s)=>t.localeCompare(s));function Po(t,s,n){return Math.max(s,Math.min(n,t))}function Bi(t,s){const n=[];for(const r of t)n.includes(r)||n.push(r);if(n.length>=s)return n.slice(0,s);for(const r of _o)if(n.includes(r)||n.push(r),n.length>=s)break;return n.slice(0,s)}function Oi(t){return Po(Math.round(t),2,6)}function hE(){const t=ze(),[s]=To(),n=s.get("fromActive")==="1",[r,a]=l.useState("build_muscle"),[i,o]=l.useState("beginner"),[c,h]=l.useState("balanced"),[m,u]=l.useState("full_body"),[d,f]=l.useState(4),[p,x]=l.useState(["Mon","Tue","Thu","Fri"]),[g,v]=l.useState("45"),[j,y]=l.useState(["bodyweight"]),[N,b]=l.useState([]),[w,I]=l.useState(""),[F,E]=l.useState(""),[P,k]=l.useState("none"),[C,T]=l.useState("My custom plan"),[L,M]=l.useState(null),[X,ce]=l.useState(!1),[re,ge]=l.useState(!1),[z,fe]=l.useState(null),[pe,Ee]=l.useState(""),Ie=l.useMemo(()=>({goal:r,experience:i,trainingStyle:c,focus:m,daysPerWeek:d,preferredDays:p.slice(0,d),timePerWorkout:g,equipment:j,emphasis:N,injuries:w.trim()?w.trim():null,avoidExercises:F.trim()?F.trim():null,cardioPreference:P.trim()?P.trim():null}),[r,i,c,m,d,p,g,j,N,w,F,P]),be=l.useMemo(()=>new Set(p),[p]),me=R=>{x(W=>{const ie=W.includes(R)?W.filter(le=>le!==R):[...W,R];return Bi(ie,Oi(d))})},xe=R=>{y(W=>W.includes(R)?W.filter(ie=>ie!==R):[...W,R])},S=R=>{b(W=>W.includes(R)?W.filter(ie=>ie!==R):[...W,R])},K=async()=>{ce(!0);try{const R=Oi(d),W=Bi(p,R),ie=await oS({prefs:{...Ie,daysPerWeek:R,preferredDays:W},title:C.trim()?C.trim():void 0});T(ie.title);const le=Array.isArray(ie.days)?ie.days:[];M(le),V({title:"Plan generated",description:"Review and customize before starting."})}catch(R){V({title:"Unable to generate",description:(R==null?void 0:R.message)||"Please try again.",variant:"destructive"})}finally{ce(!1)}},A=(R,W,ie)=>{M(le=>{if(!le)return le;const q=le.map(ye=>({...ye,exercises:[...ye.exercises]})),ee=q[R];if(!ee)return le;const H=ee.exercises[W];return H?(ee.exercises[W]={...H,...ie,sets:ie.sets===void 0?H.sets:Po(ie.sets,1,10)},q):le})},O=(R,W,ie)=>{M(le=>{if(!le)return le;const q=le.map(Ne=>({...Ne,exercises:[...Ne.exercises]})),ee=q[R];if(!ee||W<0||W>=ee.exercises.length)return le;const H=Po(ie,0,ee.exercises.length-1),[ye]=ee.exercises.splice(W,1);return ee.exercises.splice(H,0,ye),q})},J=(R,W,ie)=>{M(le=>{if(!le)return le;const q=le.map(Ne=>({...Ne,exercises:[...Ne.exercises]})),ee=q[R],H=q[ie];if(!ee||!H)return le;const[ye]=ee.exercises.splice(W,1);return ye?(H.exercises.push(ye),q):le})},G=(R,W)=>{M(ie=>{var H;if(!ie)return ie;const le=new Set(ie.map(ye=>ye.day)),q=(H=ie[R])==null?void 0:H.day;if(q&&le.delete(q),le.has(W))return V({title:"Day already used",description:"Pick a different day."}),ie;const ee=ie.map(ye=>({...ye,exercises:[...ye.exercises]}));return ee[R]?(ee[R]={...ee[R],day:W},ee):ie})},$=async()=>{if(!L){V({title:"Generate a plan first"});return}const R=mE(L);if(R){V({title:"Fix plan issues",description:R,variant:"destructive"});return}ge(!0);try{const W=await lS({prefs:Ie,title:C.trim()?C.trim():void 0,goal:r.replace(/_/g," "),level:i,days:L});t(`/workouts?plan=${W.planId}&started=1`,{replace:!0})}catch(W){V({title:"Could not start plan",description:(W==null?void 0:W.message)||"Please try again.",variant:"destructive"})}finally{ge(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Customize plan – MyBodyScan",description:"Build a workout plan that fits you."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsxs(_,{variant:"ghost",className:"w-fit",onClick:()=>t(n?"/programs":-1),children:[e.jsx(la,{className:"mr-2 h-4 w-4"}),"Back"]})}),e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-primary",children:[e.jsx(Ku,{className:"h-4 w-4"})," Customize plan"]}),e.jsx(he,{className:"text-3xl font-semibold",children:"Build your plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"A few choices, then a plan you can tweak before starting."})]}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"plan-title",children:"Plan name"}),e.jsx(We,{id:"plan-title",value:C,onChange:R=>T(R.target.value),placeholder:"My custom plan"})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Goal"}),e.jsx(ds,{value:r,onValueChange:R=>a(R),className:"grid gap-2",children:[["lose_fat","Lose fat"],["build_muscle","Build muscle"],["recomp","Recomposition"],["performance","Performance"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-4 py-3 text-sm hover:border-primary",children:[e.jsx("span",{className:"font-medium",children:W}),e.jsx(us,{value:R})]},R))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Experience"}),e.jsx(ds,{value:i,onValueChange:R=>o(R),className:"grid gap-2",children:[["beginner","Beginner"],["intermediate","Intermediate"],["advanced","Advanced"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-4 py-3 text-sm hover:border-primary",children:[e.jsx("span",{className:"font-medium",children:W}),e.jsx(us,{value:R})]},R))})]})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Training style"}),e.jsx(ds,{value:c,onValueChange:R=>h(R),className:"grid gap-2",children:[["balanced","Balanced"],["strength","Strength"],["hypertrophy","Hypertrophy"],["athletic","Athletic"],["minimal_equipment","Minimal equipment"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-4 py-3 text-sm hover:border-primary",children:[e.jsx("span",{className:"font-medium",children:W}),e.jsx(us,{value:R})]},R))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{children:"Focus"}),e.jsx(ds,{value:m,onValueChange:R=>u(R),className:"grid gap-2",children:[["full_body","Full body"],["upper_lower","Upper / Lower"],["push_pull_legs","Push / Pull / Legs"],["bro_split","Bro split"],["custom_emphasis","Custom emphasis"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-4 py-3 text-sm hover:border-primary",children:[e.jsx("span",{className:"font-medium",children:W}),e.jsx(us,{value:R})]},R))})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(je,{children:"Schedule"}),e.jsxs("div",{className:"grid gap-3 rounded-md border bg-muted/40 p-4 md:grid-cols-3",children:[e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Days / week (2–6)"}),e.jsx(We,{type:"number",min:2,max:6,step:1,value:d,onChange:R=>{const W=Oi(Number(R.target.value));f(W),x(ie=>Bi(ie,W))}})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Time / workout"}),e.jsx(ds,{value:g??"45",onValueChange:R=>v(R),className:"grid grid-cols-2 gap-2",children:["30","45","60","75+"].map(R=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-3 py-2 text-sm hover:border-primary",children:[e.jsx("span",{children:R==="75+"?"75+":`${R} min`}),e.jsx(us,{value:R})]},R))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Preferred days"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:_o.map(R=>e.jsxs(je,{className:"flex cursor-pointer items-center gap-2 rounded-md border bg-card px-2 py-2 text-xs hover:border-primary",children:[e.jsx(Qs,{checked:be.has(R),onCheckedChange:()=>me(R)}),e.jsx("span",{children:R})]},R))}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["We’ll pick ",d," unique days."]})]})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(je,{children:"Equipment"}),e.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:[["bodyweight","Bodyweight"],["dumbbells","Dumbbells"],["bands","Bands"],["gym","Full gym"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center gap-2 rounded-md border bg-card px-3 py-2 text-sm hover:border-primary",children:[e.jsx(Qs,{checked:j.includes(R),onCheckedChange:()=>xe(R)}),e.jsx("span",{children:W})]},R))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select anything you have access to."})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(je,{children:"Focus areas (optional)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["chest","back","legs","glutes","shoulders","arms","core"].map(R=>e.jsx(_,{type:"button",size:"sm",variant:N.includes(R)?"default":"outline",onClick:()=>S(R),children:R},R))})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"injuries",children:"Injuries / limitations"}),e.jsx(vn,{id:"injuries",value:w,onChange:R=>I(R.target.value),placeholder:"Knee pain, shoulder limitations…",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"avoid",children:"Avoid exercises (optional)"}),e.jsx(vn,{id:"avoid",value:F,onChange:R=>E(R.target.value),placeholder:"No running, no overhead press…",rows:3})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(je,{children:"Cardio frequency"}),e.jsx(ds,{value:P,onValueChange:R=>k(R),className:"grid gap-2 sm:grid-cols-2",children:[["none","None"],["1x","1x / week"],["2x","2x / week"],["3x","3x / week"]].map(([R,W])=>e.jsxs(je,{className:"flex cursor-pointer items-center justify-between rounded-md border bg-card px-3 py-2 text-sm hover:border-primary",children:[e.jsx("span",{children:W}),e.jsx(us,{value:R})]},R))})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>M(null),disabled:!L,children:"Reset preview"}),e.jsx(_,{type:"button",onClick:K,disabled:X,children:X?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Generating…"]}):"Generate plan"})]})]})]}),L&&e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-xl",children:"Preview & edit"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Swap movements, change sets/reps, and reorder before you start."})]}),e.jsxs(Q,{className:"space-y-4",children:[L.map((R,W)=>e.jsxs(Y,{className:"border bg-background/60",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between gap-3 space-y-0",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Workout day"}),e.jsx("div",{className:"text-lg font-semibold text-foreground",children:R.day})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_o.map(ie=>e.jsx(_,{type:"button",size:"sm",variant:R.day===ie?"default":"outline",onClick:()=>G(W,ie),children:ie},ie))})]}),e.jsx(Q,{className:"space-y-3",children:R.exercises.map((ie,le)=>e.jsx("div",{className:"rounded-md border p-3",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr_90px_120px_auto] md:items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Exercise"}),e.jsx(We,{value:ie.name,onChange:q=>A(W,le,{name:q.target.value})}),e.jsx("div",{className:"pt-2",children:e.jsxs(Xs,{open:(z==null?void 0:z.dayIndex)===W&&(z==null?void 0:z.exerciseIndex)===le,onOpenChange:q=>{q?fe({dayIndex:W,exerciseIndex:le}):(fe(null),Ee(""))},children:[e.jsx(al,{asChild:!0,children:e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>{fe({dayIndex:W,exerciseIndex:le}),Ee("")},children:"Swap (search)"})}),e.jsxs(Us,{className:"max-w-lg",children:[e.jsx(vs,{children:e.jsx(Ns,{children:"Swap exercise"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(We,{value:pe,onChange:q=>Ee(q.target.value),placeholder:"Search (e.g. bench, row, squat)…",autoFocus:!0}),e.jsxs("div",{className:"max-h-72 overflow-auto rounded-md border",children:[yd.filter(q=>{const ee=pe.trim().toLowerCase();return ee?q.toLowerCase().includes(ee):!0}).slice(0,30).map(q=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between border-b px-3 py-2 text-left text-sm hover:bg-muted",onClick:()=>{A(W,le,{name:q}),fe(null),Ee(""),V({title:"Exercise updated"})},children:[e.jsx("span",{className:"font-medium",children:q}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Select"})]},q)),yd.length?null:e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"No exercises available."})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: you can always type a custom name directly in the exercise field."})]})]})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Sets"}),e.jsx(We,{type:"number",min:1,max:10,value:Number(ie.sets??3),onChange:q=>A(W,le,{sets:Number(q.target.value)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Reps"}),e.jsx(We,{value:String(ie.reps??"10"),onChange:q=>A(W,le,{reps:q.target.value})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:justify-end",children:[e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>O(W,le,le-1),disabled:le===0,children:"Up"}),e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>O(W,le,le+1),disabled:le===R.exercises.length-1,children:"Down"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Move to"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((q,ee)=>e.jsx(_,{type:"button",size:"sm",variant:"ghost",onClick:()=>J(W,le,ee),disabled:ee===W,children:q.day},`${q.day}-${ee}`))})]})]})]})},`${ie.name}-${le}`))})]},`${R.day}-${W}`)),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"When you start, we’ll send you straight to Today with the workout ready."}),e.jsx(qt,{onClick:$,disabled:re,children:re?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Starting…"]}):"Start plan"})]})]})]})]})]})}const fE=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function bd(t,s,n){return Math.max(s,Math.min(n,t))}function pE(){const t=ze(),s=Gu(),n=Yr({queryKey:["workouts","plan"],queryFn:()=>wr(),staleTime:15e3}),[r,a]=l.useState(null),[i,o]=l.useState(!1);l.useEffect(()=>{n.data&&a(n.data)},[n.data]);const c=l.useMemo(()=>{const g=Array.isArray(r==null?void 0:r.days)?r.days.map(v=>String(v.day||"")):[];return new Set(g)},[r]),h=async g=>{if(r!=null&&r.id){o(!0);try{await cS({planId:r.id,op:g}),V({title:"Saved"}),await s.invalidateQueries({queryKey:["workouts","plan"]}),await s.invalidateQueries({queryKey:["workouts","workouts"]})}catch(v){V({title:"Could not save",description:(v==null?void 0:v.message)||"Please try again.",variant:"destructive"})}finally{o(!1)}}},m=(g,v,j)=>{a(y=>{var I;if(!(y!=null&&y.days))return y;const N=y.days.map(F=>({...F,exercises:[...F.exercises||[]]})),b=N[g],w=(I=b==null?void 0:b.exercises)==null?void 0:I[v];return!b||!w?y:(b.exercises[v]={...w,...j,sets:j.sets===void 0?w.sets:bd(j.sets,1,10)},{...y,days:N})})},u=(g,v,j)=>{a(y=>{var E,P;const N=(E=y==null?void 0:y.days)==null?void 0:E[g];if(!((P=N==null?void 0:N.exercises)!=null&&P.length)||v<0||v>=N.exercises.length)return y;const b=bd(j,0,N.exercises.length-1),w=y.days.map((k,C)=>C===g?{...k,exercises:[...k.exercises]}:k),I=w[g].exercises,[F]=I.splice(v,1);return I.splice(b,0,F),{...y,days:w}})},d=(g,v,j)=>{a(y=>{var F,E,P;const N=(F=y==null?void 0:y.days)==null?void 0:F[g],b=(E=y==null?void 0:y.days)==null?void 0:E[j];if(!((P=N==null?void 0:N.exercises)!=null&&P.length)||!b)return y;const w=y.days.map(k=>({...k,exercises:[...k.exercises||[]]})),[I]=w[g].exercises.splice(v,1);return I?(w[j].exercises.push(I),{...y,days:w}):y})},f=(g,v)=>{a(j=>{var w;if(!((w=j==null?void 0:j.days)!=null&&w[g]))return j;const y=String(j.days[g].day||""),N=new Set(j.days.map(I=>String(I.day||"")));if(N.delete(y),N.has(v))return V({title:"Day already used",description:"Pick a different day."}),j;const b=j.days.map((I,F)=>F===g?{...I,day:v}:I);return{...j,days:b}})},p=async g=>{if(r!=null&&r.id){o(!0);try{await Xh({planId:r.id,status:g}),V({title:g==="paused"?"Plan paused":"Plan ended"}),await s.invalidateQueries({queryKey:["workouts","plan"]}),await s.invalidateQueries({queryKey:["workouts","workouts"]}),t("/programs",{replace:!0})}catch(v){V({title:"Could not update plan",description:(v==null?void 0:v.message)||"Please try again.",variant:"destructive"})}finally{o(!1)}}},x=r;return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Edit plan – MyBodyScan",description:"Update your active plan."}),e.jsxs("main",{className:"mx-auto flex w-full max-w-3xl flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(_,{variant:"ghost",className:"w-fit",onClick:()=>t("/programs"),children:[e.jsx(la,{className:"mr-2 h-4 w-4"})," Back to Plans"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>void p("paused"),disabled:i,children:"Pause"}),e.jsx(_,{type:"button",variant:"destructive",onClick:()=>void p("ended"),disabled:i,children:"End plan"})]})]}),n.isLoading?e.jsx(Y,{children:e.jsxs(Q,{className:"flex items-center justify-center gap-2 py-10 text-sm text-muted-foreground",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Loading plan…"]})}):x?e.jsxs(Y,{className:"border bg-card/60",children:[e.jsxs(oe,{className:"space-y-1",children:[e.jsx(he,{className:"text-2xl font-semibold",children:x.title||"Active plan"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Edit exercises, sets/reps, and re-order workouts. Changes save instantly."})]}),e.jsx(Q,{className:"space-y-4",children:Array.isArray(x.days)&&x.days.map((g,v)=>e.jsxs(Y,{className:"border bg-background/60",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between gap-3 space-y-0",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Workout day"}),e.jsx("div",{className:"text-lg font-semibold",children:g.day})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fE.map(j=>e.jsx(_,{type:"button",size:"sm",variant:g.day===j?"default":"outline",onClick:()=>{f(v,j),h({type:"set_day_name",dayIndex:v,day:j})},disabled:i||c.has(j)&&g.day!==j,children:j},j))})]}),e.jsxs(Q,{className:"space-y-3",children:[(g.exercises??[]).map((j,y)=>{var N;return e.jsx("div",{className:"rounded-md border p-3",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr_90px_120px_auto] md:items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Exercise"}),e.jsx(We,{value:j.name??"",onChange:b=>m(v,y,{name:b.target.value}),onBlur:b=>void h({type:"update_exercise",dayIndex:v,exerciseIndex:y,name:b.target.value}),disabled:i})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Sets"}),e.jsx(We,{type:"number",min:1,max:10,value:Number(j.sets??3),onChange:b=>m(v,y,{sets:Number(b.target.value)}),onBlur:b=>void h({type:"update_exercise",dayIndex:v,exerciseIndex:y,sets:Number(b.target.value)}),disabled:i})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(je,{className:"text-xs",children:"Reps"}),e.jsx(We,{value:String(j.reps??""),onChange:b=>m(v,y,{reps:b.target.value}),onBlur:b=>void h({type:"update_exercise",dayIndex:v,exerciseIndex:y,reps:b.target.value}),disabled:i})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:justify-end",children:[e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>{u(v,y,y-1),h({type:"reorder_exercise",dayIndex:v,fromIndex:y,toIndex:y-1})},disabled:i||y===0,children:"Up"}),e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>{u(v,y,y+1),h({type:"reorder_exercise",dayIndex:v,fromIndex:y,toIndex:y+1})},disabled:i||y===(((N=g.exercises)==null?void 0:N.length)??1)-1,children:"Down"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Move to"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(x.days??[]).map((b,w)=>e.jsx(_,{type:"button",size:"sm",variant:"ghost",onClick:()=>{var I,F,E;d(v,y,w),h({type:"move_exercise",fromDayIndex:v,fromIndex:y,toDayIndex:w,toIndex:Number.isFinite((E=(F=(I=x.days)==null?void 0:I[w])==null?void 0:F.exercises)==null?void 0:E.length)?x.days[w].exercises.length:0})},disabled:i||w===v,children:b.day},`${b.day}-${w}`))})]})]})]})},`${j.id||y}`)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx(rg,{className:"mr-1 inline-block h-3 w-3"}),i?"Saving…":"Saved"]})]})]},`${g.day}-${v}`))})]}):e.jsx(Y,{children:e.jsx(Q,{className:"py-10 text-center text-sm text-muted-foreground",children:"No active plan found. Choose a plan to start."})})]})]})}const jd="mbs_policy_ok_v1";function gE(t){const[s,n]=l.useState(!0);l.useEffect(()=>{try{const a=localStorage.getItem(jd)==="1";n(a)}catch{n(!0)}},[]);function r(){try{localStorage.setItem(jd,"1")}catch{}try{location.reload()}catch{}}return s?null:e.jsx("div",{style:xE,role:"dialog","aria-modal":"true","aria-labelledby":"pg-title",children:e.jsxs("div",{style:yE,children:[e.jsx("h2",{id:"pg-title",style:bE,children:"Welcome to MyBodyScan"}),e.jsx("p",{style:jE,children:"Before using our app, please review and accept our policies."}),e.jsxs("ul",{style:wE,children:[e.jsx("li",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,readOnly:!0})," I accept the"," ",e.jsx("a",{href:"/terms",target:"_blank",rel:"noreferrer",children:"Terms of Service"})]})}),e.jsx("li",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,readOnly:!0})," I accept the"," ",e.jsx("a",{href:"/privacy",target:"_blank",rel:"noreferrer",children:"Privacy Policy"})]})}),e.jsx("li",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,readOnly:!0})," I understand the"," ",e.jsx("a",{href:"/medical",target:"_blank",rel:"noreferrer",children:"Medical Disclaimer"})]})})]}),e.jsx("button",{type:"button",onClick:r,style:vE,children:"I Accept"})]})})}const xE={position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"grid",placeItems:"center",zIndex:1e4},yE={width:"92%",maxWidth:540,background:"white",borderRadius:12,border:"1px solid #eee",boxShadow:"0 4px 20px rgba(0,0,0,0.12)",padding:16,display:"grid",gap:10},bE={margin:0,fontSize:18,fontWeight:700},jE={fontSize:13,color:"#555"},wE={margin:0,paddingLeft:18,display:"grid",gap:6,fontSize:13},vE={padding:"10px 12px",border:"1px solid #ddd",borderRadius:8,background:"white",cursor:"pointer"};function NE(){const t=Qt(),s=ze(),[n,r]=l.useState(!!(U!=null&&U.currentUser));l.useEffect(()=>{if(!U){r(!1);return}const a=kn(U,async i=>{r(!!i);try{i&&An()}catch(o){console.warn("demo_wipe_failed",o)}});return()=>a()},[]),l.useEffect(()=>{n&&t.search.includes("demo=")&&s({pathname:t.pathname,search:""},{replace:!0})},[n,t.pathname,t.search,s]),l.useEffect(()=>{if(n){Px();return}const i=new URLSearchParams(t.search||"").get("demo")==="1",o=t.pathname.startsWith("/demo");if(i||o){Pn();return}Yi()||Qo()},[n,t.pathname,t.search])}function SE(){var s,n;const t=(n=(s=In())==null?void 0:s.currentUser)==null?void 0:n.uid;if(!t)throw new Error("auth");return t}function Oa(t){return t&&typeof t=="string"&&t.trim().length?t:SE()}function Sl(t){const s=Oa(t);return Ot(Se(de,"users",s),"nutritionFavorites")}function kl(t){const s=Oa(t);return Ot(Se(de,"users",s),"nutritionTemplates")}function kE(t){const s=Oa(t);return Ft(Sl(s),Lt("updatedAt","desc"))}function EE(t){const s=Oa(t);return Ft(kl(s),Lt("updatedAt","desc"))}function CE(t,s){return dt(kE(s),n=>{const r=[];n.forEach(a=>{const i=a.data();r.push({id:a.id,...i})}),t(r)},n=>{console.warn("favorites_subscribe_error",{code:n==null?void 0:n.code,message:n==null?void 0:n.message}),t([])})}function C_(t,s){return dt(EE(s),n=>{const r=[];n.forEach(a=>{const i=a.data();r.push({id:a.id,...i})}),t(r)},n=>{console.warn("templates_subscribe_error",{code:n==null?void 0:n.code,message:n==null?void 0:n.message}),t([])})}async function _E(t,s){const n=Se(Sl(s),t.id),r={name:t.name,brand:t.brand,item:t,updatedAt:at()};await mt(n,r,{merge:!0})}async function PE(t,s){await lh(Se(Sl(s),t))}async function __(t,s,n,r){const a=t??(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`template-${Math.random().toString(36).slice(2,10)}`),i=Se(kl(r),a),o={name:s,items:n,updatedAt:at()};return await mt(i,o,{merge:!0}),a}async function P_(t,s){await lh(Se(kl(s),t))}function AE(t,s){const[n,r]=l.useState(t);return l.useEffect(()=>{const a=setTimeout(()=>r(t),s);return()=>clearTimeout(a)},[t,s]),n}function Ao(t){return t?t.normalize("NFKC").toLowerCase().replace(/[^-a-z0-9\s]/g," ").replace(/\s+/g," ").trim().slice(0,64):""}let gf=!1;const IE=new Set;function TE(){for(const t of IE)try{t(gf)}catch(s){console.warn("backend_fallback_listener_error",s)}}function RE(t){var n;const s=(t==null?void 0:t.code)||((n=t==null?void 0:t.error)==null?void 0:n.status)||"";return["app_check_required","failed-precondition","permission-denied","unauthenticated"].some(r=>String(s).includes(r))}async function Gr(t,s){try{await ts();const n=ur(hr,t.callableName),{data:r}=await n(s);return r}catch(n){if(!RE(n))throw n;gf=!0,TE();const r=t.method||"POST",a=t.mapRequestToHttp?t.mapRequestToHttp(s):s,i={method:r,headers:{"Content-Type":"application/json"}};let o=t.httpPath;if(r==="POST")i.body=JSON.stringify(a??{});else if(r==="GET"&&a&&typeof a=="object"){const c=new URLSearchParams;Object.entries(a).forEach(([m,u])=>{u!=null&&c.append(m,String(u))});const h=c.toString();h&&(o=`${o}${o.includes("?")?"&":"?"}${h}`)}try{const c=await ol(o,i);if(!c.ok){const u=new Error(`HTTP ${c.status}`);throw u.httpStatus=c.status,u}const m=(c.headers.get("Content-Type")||"").includes("application/json")?await c.json().catch(()=>({})):await c.text();return t.mapHttpToClient(m)}catch(c){const h=c instanceof Error?c:new Error(String(c));throw h.httpFallbackAttempted=!0,h}}}const xf={async createCheckout(t){return Gr({callableName:"createCheckout",httpPath:"/api/createCheckout",method:"POST",mapHttpToClient:s=>({sessionId:(s==null?void 0:s.sessionId)||(s==null?void 0:s.id)||null,url:(s==null?void 0:s.url)??null})},t)},async coachChat(t){return Gr({callableName:"coachChat",httpPath:"/api/coach/chat",method:"POST",mapHttpToClient:s=>({text:(s==null?void 0:s.text)??(s==null?void 0:s.answer)??(s==null?void 0:s.reply)??""})},t)},async nutritionSearch(t){return Gr({callableName:"nutritionSearch",httpPath:"/api/nutrition/search",method:"GET",mapHttpToClient:s=>({items:(s==null?void 0:s.items)??(s==null?void 0:s.results)??[]})},t)},async nutritionBarcode(t){return Gr({callableName:"nutritionBarcode",httpPath:"/api/nutrition/barcode",method:"GET",mapRequestToHttp:s=>{const n=s==null?void 0:s.upc;return n?{code:n}:void 0},mapHttpToClient:s=>({item:s==null?void 0:s.item,items:(s==null?void 0:s.items)??(s==null?void 0:s.results)})},t)}};async function ME(t){return rf(t)}function DE({onResult:t,onError:s}){const n=As.useRef(null),[r,a]=As.useState(!1),i=As.useRef(!1),o=As.useCallback(()=>{var u;a(!1),i.current=!1;const m=(u=n.current)==null?void 0:u.srcObject;m==null||m.getTracks().forEach(d=>d.stop()),n.current&&(n.current.srcObject=null)},[]),c=As.useCallback(async()=>{if(!("BarcodeDetector"in window))return!1;try{const m=new window.BarcodeDetector({formats:["ean_13","upc_a","upc_e","ean_8","code_128"]}),u=async()=>{var d;if(!(!i.current||!n.current)){try{const f=await m.detect(n.current),p=(d=f==null?void 0:f[0])==null?void 0:d.rawValue;if(p){o(),t(p);return}}catch(f){console.debug("barcode_detect_tick_error",f)}requestAnimationFrame(u)}};return requestAnimationFrame(u),!0}catch(m){return console.warn("barcode_native_init_failed",m),!1}},[t,o]),h=As.useCallback(async()=>{try{a(!0),i.current=!0;const m=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});if(n.current&&(n.current.srcObject=m,await n.current.play().catch(()=>{})),await c())return;const{BrowserMultiFormatReader:d}=await lt(async()=>{const{BrowserMultiFormatReader:x}=await import("./vendor-DGcCiWpO.js").then(g=>g.bQ);return{BrowserMultiFormatReader:x}},__vite__mapDeps([1,0])),p=await new d().decodeOnceFromVideoDevice(void 0,n.current);o(),t(p.getText())}catch(m){console.error("barcode_start_error",m),o(),s("Scanner unavailable – unable to load barcode library.")}},[s,t,c,o]);return As.useEffect(()=>()=>{o()},[o]),e.jsxs("div",{className:"space-y-3",children:[e.jsx("video",{ref:n,playsInline:!0,muted:!0,className:"w-full rounded-lg border bg-black/80",style:{minHeight:200}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",onClick:h,disabled:r,className:"flex-1",children:"Start"}),e.jsx(_,{type:"button",onClick:o,disabled:!r,variant:"secondary",className:"flex-1",children:"Stop"})]})]})}const yf="mbs_nutrition_recents_v3",El=50,FE=.0352739619;function LE(){if(typeof window>"u")return[];const t=window.localStorage.getItem(yf);if(!t)return[];try{const s=JSON.parse(t);if(Array.isArray(s))return s.slice(0,El)}catch(s){console.warn("recents_parse_error",s)}return[]}function BE(t){typeof window>"u"||window.localStorage.setItem(yf,JSON.stringify(t.slice(0,El)))}function OE(t,s=1){const n=10**s;return Math.round(t*n)/n}function bf(t,s){const n=Number.isFinite(s)?Math.max(0,s):0;if(!n)return{grams:0,kcal:0,protein:0,carbs:0,fat:0};const r=n/100;return{grams:n,kcal:qr([t==null?void 0:t.kcal])*r,protein:qr([t==null?void 0:t.protein])*r,carbs:qr([t==null?void 0:t.carbs])*r,fat:qr([t==null?void 0:t.fat])*r}}function UE(t){return!t||t<=0?null:OE(t*FE,2)}function $E(t){return t.find(s=>s.label.toLowerCase().includes("cup"))}function wd(t){const s=Number((t==null?void 0:t.calories)??(t==null?void 0:t.kcal)??(t==null?void 0:t.energyKcal)??0)||0,n=Number((t==null?void 0:t.protein)??(t==null?void 0:t.protein_g)??0)||0,r=Number((t==null?void 0:t.carbs)??(t==null?void 0:t.carbs_g)??0)||0,a=Number((t==null?void 0:t.fat)??(t==null?void 0:t.fat_g)??0)||0,i=typeof(t==null?void 0:t.source)=="string"?t.source:void 0,o=i||((t==null?void 0:t.provider)==="OFF"?"Open Food Facts":"USDA"),c={kcal:s,protein:n,carbs:r,fat:a},h={kcal:s||null,protein_g:n||null,carbs_g:r||null,fat_g:a||null},m=[{id:"100g",label:"100 g",grams:100,isDefault:!0}];typeof(t==null?void 0:t.serving)=="string"&&t.serving.trim().length&&m.push({id:"serving",label:t.serving.trim(),grams:Number(t.servingGrams??0)||0,isDefault:!1});const u=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`food-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return{id:(t==null?void 0:t.id)??u,name:(t==null?void 0:t.name)??"Unknown food",brand:(t==null?void 0:t.brand)??(t==null?void 0:t.brandOwner)??(t==null?void 0:t.brands)??null,source:o,basePer100g:c,servings:m,serving:{qty:1,unit:"serving",text:"1 serving"},per_serving:h,per_100g:h,raw:t}}const WE=["breakfast","lunch","dinner","snacks"],qE={breakfast:"Breakfast",lunch:"Lunch",dinner:"Dinner",snacks:"Snacks"};function zE({item:t,open:s,busy:n,onClose:r,onConfirm:a}){const i=l.useMemo(()=>{var y;return(y=t.servings)!=null&&y.length?t.servings.find(N=>N.isDefault)??t.servings[0]:null},[t.servings]),[o,c]=l.useState((i==null?void 0:i.grams)??100),[h,m]=l.useState(1),[u,d]=l.useState("snacks");l.useEffect(()=>{var N,b;const y=((N=t.servings)==null?void 0:N.find(w=>w.isDefault))??((b=t.servings)==null?void 0:b[0]);c((y==null?void 0:y.grams)??100),m(1),d("snacks")},[t]);const f=Math.max(0,o*h),p=bf(t.basePer100g,f),x=UE(f),g=l.useMemo(()=>$E(t.servings??[]),[t.servings]),v=[{label:"100 g",grams:100},{label:"1 oz",grams:28.35}];g&&v.push({label:"1 cup",grams:g.grams});const j=!o||o<=0||!h||h<=0;return e.jsx(Xs,{open:s,onOpenChange:y=>{y||r()},children:e.jsxs(Us,{className:"max-w-xl",children:[e.jsx(vs,{children:e.jsxs(Ns,{className:"flex flex-col gap-1",children:[e.jsx("span",{children:t.name}),e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:t.brand||t.source})]})}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"serving-grams",children:"Grams per quantity"}),e.jsx(We,{id:"serving-grams",type:"number",min:"0",step:"0.1",value:o,onChange:y=>{const N=Number(y.target.value);c(Number.isFinite(N)?Math.max(0,N):0)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"serving-quantity",children:"Quantity"}),e.jsx(We,{id:"serving-quantity",type:"number",min:"0",step:"0.1",value:h,onChange:y=>{const N=Number(y.target.value);m(Number.isFinite(N)?Math.max(0,N):0)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"serving-mealType",children:"Log to"}),e.jsx("select",{id:"serving-mealType",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u,onChange:y=>d(y.target.value),disabled:n,children:WE.map(y=>e.jsx("option",{value:y,children:qE[y]},y))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(y=>e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:()=>c(y.grams),children:y.label},y.label))}),e.jsxs("div",{className:"rounded-md bg-muted/60 p-4 text-sm",children:[e.jsx("div",{className:"font-medium text-foreground",children:"Total"}),e.jsxs("div",{className:"mt-1 text-muted-foreground",children:[p.grams?`${cs(p.grams)} g`:"0 g",x?` · ${x} oz`:""]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[bo(p.kcal)," kcal"]}),e.jsxs("span",{children:[cs(p.protein),"g P"]}),e.jsxs("span",{children:[cs(p.carbs),"g C"]}),e.jsxs("span",{children:[cs(p.fat),"g F"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{type:"button",variant:"ghost",onClick:r,disabled:n,children:"Cancel"}),e.jsx(qt,{type:"button",onClick:()=>a({grams:o,quantity:h,mealType:u}),disabled:n||j,children:n?"Adding…":"Add"})]})]})]})})}function VE(){const t=ft(),{user:s,authReady:n}=He(),r=n?(s==null?void 0:s.uid)??null:null,a=Qt(),i=`/auth?next=${encodeURIComponent(`${a.pathname}${a.search}`)}`,o=t&&!s,[c,h]=l.useState(""),[m,u]=l.useState(!1),[d,f]=l.useState([]),[p,x]=l.useState(null),[g,v]=l.useState(()=>LE()),[j,y]=l.useState([]),[N,b]=l.useState(null),[w,I]=l.useState(!1),[F,E]=l.useState(null),[P,k]=l.useState(""),[C,T]=l.useState(!1),L=AE(c,350),{health:M}=ns(),{nutritionConfigured:X}=ss(M??void 0),ce=X!==!1,re="Nutrition search is offline until nutrition API keys or rate limits are configured.",ge="Nutrition search is disabled in demo mode. Sign in to use it.",z=t?ge:re,fe=t||!ce;l.useEffect(()=>{if(!n||!r){y([]);return}try{const A=CE(y,r);return()=>A==null?void 0:A()}catch(A){console.warn("favorites_subscribe_error",A),y([]);return}},[n,r]),l.useEffect(()=>{if(t){u(!1),f([]),x(null),k(ge),E(ge);return}if(!ce){u(!1),f([]),x(null),k(re),E(re);return}const A=Ao(L);if(!A){f([]),x(null),u(!1),E(null),k("");return}let O=!1;return u(!0),E(null),k("Searching…"),(async()=>{try{const J=await ME(A);if(O)return;if(!J||J.status==="upstream_error"){const $=(J==null?void 0:J.message)??"Food database temporarily busy; try again.";f([]),x(null),k($),E($);return}const G=(J.results??[]).map(wd);f(G),x(G.length?G[0].source:null),k(G.length?`Found ${G.length} item${G.length===1?"":"s"}`:"No matches found."),E(G.length?null:"No foods matched. Try a different term.")}catch(J){if(O)return;console.error("nutritionSearch error",J),f([]),x(null);const G=typeof(J==null?void 0:J.message)=="string"&&J.message.length?J.message:String(J),$=G==="Bad Request"?"":G,R=$||"Food database temporarily busy; try again.";k(R),E(R),Ye({kind:"client_error",message:$||"nutritionSearch failed",code:(J==null?void 0:J.code)||"client_error",extra:{fn:"nutritionSearch"}})}finally{O||u(!1)}})(),()=>{O=!0}},[L,t,ce,V]);const pe=A=>{const O=[A,...g.filter(J=>J.id!==A.id)].slice(0,El);v(O),BE(O)},Ee=async A=>{var J;if(T(!1),fe){k(z),E(z);return}const O=Ao(A);if(!O){k("Invalid barcode"),E("Invalid barcode");return}u(!0),k(`Looking up barcode ${O}…`),E(null);try{const{item:G,items:$}=await xf.nutritionBarcode({upc:O}),W=($??(G?[G]:[])).map(wd).filter(Boolean);W.length?(f(W),x(((J=W[0])==null?void 0:J.source)==="Open Food Facts"?"Open Food Facts":"USDA"),k(W.length>1?`Found ${W.length} matches`:"Barcode match found"),E(null)):(f([]),x(null),k("Product not found"),E("Product not found"))}catch(G){console.error("nutritionBarcode error",G);const $=typeof(G==null?void 0:G.message)=="string"&&G.message.length?G.message:String(G),R=$==="Bad Request"?"":$,W=R||"Scan failed. Try again.";f([]),x(null),k(W),E(W),Ye({kind:"client_error",message:R||"nutritionBarcode failed",code:(G==null?void 0:G.code)||"client_error",extra:{fn:"nutritionBarcode"}})}finally{u(!1)}},Ie=A=>{if(T(!1),fe){k(z),E(z);return}k(A),E(A)},be=async A=>{if(!n||!r){V({title:"Initializing",description:"Secure favorites are almost ready. Try again in a moment."});return}try{const O=j.find(J=>J.id===A.id);O?(await PE(O.id,r??void 0),V({title:"Removed from favorites",description:A.name})):(await _E(A,r??void 0),V({title:"Added to favorites",description:A.name}))}catch(O){V(ls(O,{fallback:{title:"Favorite update failed",description:"Try again",variant:"destructive"}}))}},me=async(A,O,J,G)=>{var ie,le;if(t){V({title:"Demo mode: sign in to save"});return}if(!n||!s){V({title:"Sign in required",description:"Sign in to log meals.",variant:"destructive"});return}const $=O*J,R=bf(A.basePer100g,$),W=new Date().toISOString().slice(0,10);I(!0);try{await gl(W,{name:A.name,mealType:G,protein:cs(R.protein),carbs:cs(R.carbs),fat:cs(R.fat),calories:bo(R.kcal),entrySource:"search",serving:{qty:J,unit:"custom",grams:Math.round($),originalQty:J,originalUnit:((le=(ie=A.servings)==null?void 0:ie[0])==null?void 0:le.label)??void 0},item:{id:A.id,name:A.name,brand:A.brand??null,source:A.source,serving:A.serving??void 0,per_serving:A.per_serving??void 0,per_100g:A.per_100g??void 0}}),V({title:"Food logged",description:A.name}),pe(A),b(null)}catch(q){V(ls(q,{fallback:{title:"Unable to log",description:"Try again",variant:"destructive"}}))}finally{I(!1)}},xe=p==="Open Food Facts"?"OFF primary · USDA fallback":p==="USDA"?"USDA primary · OFF fallback":"USDA + OFF search",S=l.useMemo(()=>new Map(j.map(A=>[A.id,A])),[j]),K=null;return e.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-0","data-testid":"route-meals",children:[e.jsx(Ce,{title:"Food Search",description:"Find foods from USDA and OpenFoodFacts"}),o&&e.jsx("div",{className:"px-6",children:e.jsxs(tt,{variant:"default",className:"border-primary/40 bg-primary/5",children:[e.jsx(rt,{children:"Demo preview"}),e.jsxs(st,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{children:"Sign up to log meals, save favorites, and sync nutrition to your account."}),e.jsx(_,{asChild:!0,size:"sm",variant:"outline",children:e.jsx("a",{href:i,children:"Sign up to use this feature"})})]})]})}),e.jsxs("main",{className:"mx-auto flex max-w-4xl flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(ag,{className:"mx-auto h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Search Foods"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tap a result to adjust servings and log it to your meals."})]}),!ce&&!t&&e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Nutrition search unavailable"}),e.jsx(st,{children:re})]}),e.jsxs("form",{className:"flex gap-2",onSubmit:A=>A.preventDefault(),children:[e.jsx(We,{value:c,onChange:A=>h(A.target.value),placeholder:"Search chicken breast, oatmeal, whey…",className:"flex-1","data-testid":"nutrition-search",disabled:fe,title:fe?z:void 0}),e.jsxs(_,{type:"button",variant:"outline",onClick:()=>T(!0),disabled:fe||m,title:fe?z:void 0,children:[e.jsx(ig,{className:"mr-1 h-4 w-4"}),"Scan"]})]}),t&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Search is disabled in demo. Sign in to use."}),e.jsx(Xs,{open:C,onOpenChange:T,children:e.jsxs(Us,{className:"max-w-md",children:[e.jsx(vs,{children:e.jsx(Ns,{children:"Scan a barcode"})}),e.jsx(DE,{onResult:Ee,onError:Ie})]})}),j.length>0&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2 text-base",children:[e.jsx(Kl,{className:"h-4 w-4 text-yellow-500"})," Favorites"]})}),e.jsx(Q,{className:"flex flex-wrap gap-2",children:j.map(A=>e.jsx(_,{variant:"secondary",size:"sm",onClick:()=>b(A.item),children:A.item.name},A.id))})]}),g.length>0&&e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{className:"flex items-center gap-2 text-base",children:"Recent"})}),e.jsx(Q,{className:"flex flex-wrap gap-2",children:g.slice(0,8).map(A=>e.jsx(_,{variant:"outline",size:"sm",onClick:()=>b(A),children:A.name},A.id))})]}),e.jsxs(Y,{children:[e.jsxs(oe,{className:"flex items-center justify-between",children:[e.jsx(he,{children:"Results"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:xe})]}),e.jsxs(Q,{className:"space-y-3",children:[P&&e.jsx("p",{className:"text-xs text-muted-foreground",role:"status","aria-live":"polite",children:P}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Searching databases…"]}),m&&K,m&&!K&&(d==null?void 0:d.length)===0&&c.trim().length>0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No matches. Try ‘chicken breast’, ‘rice’, or scan a barcode."}),!m&&!c.trim()&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter a food name to begin."}),!m&&F&&e.jsx("p",{className:"text-sm text-muted-foreground",children:F}),d.map(A=>{const O=S.get(A.id),J=A.brand||A.source,G=A.basePer100g;return e.jsx(Y,{className:"border",children:e.jsxs(Q,{className:"flex flex-col gap-3 py-4 text-sm md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:A.name}),e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:J}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[bo(G.kcal)," kcal · ",cs(G.protein),"g P · ",cs(G.carbs),"g C ·"," ",cs(G.fat),"g F  ",e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"per 100 g"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(qt,{size:"sm",variant:"ghost",onClick:()=>be(A),"aria-label":O?`Remove ${A.name} from favorites`:`Add ${A.name} to favorites`,"aria-pressed":!!O,children:O?e.jsx(Kl,{className:"h-4 w-4 fill-yellow-500 text-yellow-500"}):e.jsx(og,{className:"h-4 w-4"})}),e.jsxs(_,{size:"sm",onClick:()=>b(A),children:[e.jsx($o,{className:"mr-1 h-4 w-4"})," Add"]})]})]})},A.id)})]})]})]}),e.jsx(xt,{}),N&&e.jsx(zE,{item:N,open:!!N,busy:w,onClose:()=>w?void 0:b(null),onConfirm:({grams:A,quantity:O,mealType:J})=>me(N,A,O,J)})]})}const KE="US",vd={"en-us":"US","en-gb":"GB","en-au":"AU","en-ca":"CA","fr-fr":"FR","fr-ca":"CA","de-de":"DE","es-mx":"MX","es-us":"US","pt-br":"BR"},Nd={us:"US",ca:"CA",gb:"GB",uk:"GB",au:"AU",fr:"FR",de:"DE",mx:"MX",br:"BR"};function GE(t){const s=(t||(typeof navigator<"u"?navigator.language:void 0)||KE).toLowerCase();if(vd[s])return vd[s];const n=s.split(/[-_]/),r=n[1]||n[0];return r&&Nd[r]?Nd[r]:"EU"}function HE({item:t,defaultQty:s=1,defaultUnit:n="serving",confirmLabel:r="Add",onConfirm:a,onCancel:i,busy:o,entrySource:c="search",readOnly:h=!1,onDemoAttempt:m}){const[u,d]=l.useState(s),[f,p]=l.useState(n),[x,g]=l.useState("");l.useEffect(()=>{d(s),p(n),g("")},[t,s,n]);const v=l.useMemo(()=>BN(t,u,f),[t,u,f]),j=l.useMemo(()=>Kh(t),[t]),y=()=>{if(h){m==null||m();return}const N=UN(t,u,f,v,c);x.trim()&&(N.notes=x.trim()),a({qty:u,unit:f,result:v,meal:N})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(je,{htmlFor:"serving-qty",children:"Quantity"}),e.jsx(We,{id:"serving-qty",type:"number",min:"0",step:"0.1",value:u,onChange:N=>d(Number(N.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(je,{htmlFor:"serving-unit",children:"Unit"}),e.jsxs(Rt,{value:f,onValueChange:N=>p(N),children:[e.jsx(kt,{id:"serving-unit",children:e.jsx(Mt,{})}),e.jsx(Et,{children:RN.map(N=>e.jsx(Ue,{value:N,children:N==="serving"&&t.serving.text?`serving (${t.serving.text})`:N},N))})]})]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(je,{children:"Calories"}),e.jsxs("div",{className:"text-lg font-semibold",children:[v.calories??"—"," kcal"]})]}),e.jsxs("div",{children:[e.jsx(je,{children:"Macros"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[v.protein??"—","g P • ",v.carbs??"—","g C •"," ",v.fat??"—","g F"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[v.grams?`${v.grams} g`:"",v.grams?` (${rd(v.grams)??"?"} oz)`:""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(je,{htmlFor:"serving-notes",children:"Notes (optional)"}),e.jsx(vn,{id:"serving-notes",value:x,onChange:N=>g(N.target.value),placeholder:"Add preparation notes",rows:2}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Database serving:"," ",t.serving.text||`${t.serving.qty??"?"} ${t.serving.unit??"unit"}`," ","· approx"," ",j?`${j} g / ${rd(j)??"?"} oz`:"weight unknown"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[i&&e.jsx(_,{type:"button",variant:"ghost",onClick:i,disabled:o,children:"Cancel"}),e.jsx(_,{type:"button",onClick:y,disabled:o||u<=0||h,title:h?"Demo mode: sign in to save":void 0,children:h?"Demo only":o?"Adding…":r})]})]})}async function YE(){try{return await lt(()=>import("./vendor-DGcCiWpO.js").then(t=>t.bQ),__vite__mapDeps([1,0]))}catch(t){return console.warn("ZXING import failed",t),null}}function QE(t,s,n){const r={kcal:(n==null?void 0:n.kcal)??0,protein:(n==null?void 0:n.protein_g)??0,carbs:(n==null?void 0:n.carbs_g)??0,fat:(n==null?void 0:n.fat_g)??0},a={kcal:(n==null?void 0:n.kcal)??null,protein_g:(n==null?void 0:n.protein_g)??null,carbs_g:(n==null?void 0:n.carbs_g)??null,fat_g:(n==null?void 0:n.fat_g)??null},i=typeof(s==null?void 0:s.id)=="string"?s.id.trim():"",o=typeof(s==null?void 0:s.code)=="string"?s.code.trim():"",c=i||o||`barcode:${t}`,h=typeof(s==null?void 0:s.source)=="string"&&s.source.trim().length?s.source:"Barcode";return{id:c,name:(n==null?void 0:n.name)||`Barcode ${t}`,brand:(n==null?void 0:n.brand)||null,source:h,basePer100g:r,servings:[{id:"100g",label:"100 g",grams:100,isDefault:!0}],serving:{qty:1,unit:"serving",text:"1 serving"},per_serving:a,per_100g:a,raw:s}}function JE(){var A,O,J,G;const t=l.useRef(null),s=l.useRef(null),n=l.useRef(),r=l.useRef(null),a=l.useRef(!1),i=ft(),{health:o}=ns(),{nutritionConfigured:c}=ss(o??void 0),m=i||c===!1,u=i?"Barcode scanner is disabled in demo mode. Sign in to try live nutrition lookups.":"Nutrition search is offline until nutrition API keys or rate limits are configured.",[d,f]=l.useState(""),[p,x]=l.useState(!1),[g,v]=l.useState(!1),[j,y]=l.useState(!1),[N,b]=l.useState(null),[w,I]=l.useState(null),[F,E]=l.useState(!1),[P,k]=l.useState(""),[C,T]=l.useState(!1),[L,M]=l.useState(null),[X,ce]=l.useState(!1),re="Scanner unavailable — enter barcode manually.",ge="Camera not available — enter barcode manually.",z=l.useMemo(()=>GE(typeof navigator<"u"?navigator.language:void 0),[]),fe=l.useCallback(async $=>{if(m){k(u),I(null);return}E(!0),I(null),k("Looking up…");try{const R=Ao($);if(!R){k("Invalid barcode"),V({title:"Invalid barcode",description:"Enter a valid UPC/EAN."});return}k(`Looking up barcode ${R}…`);const{item:W,items:ie}=await xf.nutritionBarcode({upc:R}),q=(ie??(W?[W]:[])).map(Ne=>({raw:Ne,normalized:sf(Ne)})).filter(Ne=>!!Ne.normalized);if(!q.length){k("No match found."),V({title:"No match",description:"Try manual entry or search."});return}const{raw:ee,normalized:H}=q[0],ye=QE(R,ee,H);I(ye),k(typeof(ee==null?void 0:ee.message)=="string"?ee.message:"Lookup complete")}catch(R){V({title:"Lookup failed",description:(R==null?void 0:R.message)||"Try again",variant:"destructive"}),k("Lookup failed. Try again.")}finally{E(!1)}},[u,m,V]),pe=l.useCallback(()=>{var $,R;if(a.current=!1,n.current&&(cancelAnimationFrame(n.current),n.current=void 0),r.current){try{(R=($=r.current).stop)==null||R.call($)}catch(W){console.warn("barcode.zxing_stop_failed",W)}r.current=null}s.current&&(s.current.getTracks().forEach(W=>W.stop()),s.current=null),t.current&&(t.current.pause(),t.current.srcObject=null),x(!1),y(!1),v(!1)},[]),Ee=l.useCallback($=>{if($){if(m){k(u);return}b($),pe(),fe($)}},[u,fe,m,pe]),Ie=l.useCallback(async()=>{const $=window.BarcodeDetector;if(!$)throw new Error("detector_unavailable");const R=new $({formats:["ean_13","ean_8","upc_a","code_128","code_39"]}),W=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});s.current=W,t.current&&(t.current.srcObject=W,await t.current.play()),x(!0),a.current=!0;const ie=W.getVideoTracks()[0];if(ie!=null&&ie.getCapabilities){const q=ie.getCapabilities();v(!!(q!=null&&q.torch))}else v(!1);const le=async()=>{var q;if(!(!a.current||!t.current)){try{const ee=await R.detect(t.current);if(Array.isArray(ee)&&ee.length){const H=(q=ee[0])==null?void 0:q.rawValue;if(H){Ee(H);return}}}catch(ee){console.error("barcode_detect_error",ee)}n.current=requestAnimationFrame(le)}};n.current=requestAnimationFrame(le)},[Ee]),be=l.useCallback(async()=>{const $=await YE();if(!$)return ce(!0),M(re),!1;try{const W=await new $.BrowserMultiFormatReader().decodeFromVideoDevice(null,t.current,(ie,le,q)=>{var ee;ie?(Ee(ie.getText()),(ee=q==null?void 0:q.stop)==null||ee.call(q)):le&&!(le instanceof $.NotFoundException)&&console.error("zxing_scan_error",le)});return r.current=W,s.current=(W==null?void 0:W.stream)??s.current,v(!1),x(!0),a.current=!0,!0}catch(R){return console.error("zxing_loader_error",R),M("Unable to start ZXing scanner. Enter code manually."),ce(!0),!1}},[Ee,re]),me=l.useCallback(async()=>{var $;if(m){ce(!0),M(u),k(u);return}if(!window.isSecureContext||!(($=navigator.mediaDevices)!=null&&$.getUserMedia)){ce(!0),M(ge);return}ce(!1),M(null),b(null),pe();try{if("BarcodeDetector"in window){await Ie();return}await be()||pe()}catch(R){console.error("scanner_start_failed",R),ce(!0),M(re),pe()}},[u,ge,m,Ie,be,pe,re]),xe=async()=>{var R,W;const $=(W=(R=s.current)==null?void 0:R.getVideoTracks())==null?void 0:W[0];if($!=null&&$.applyConstraints)try{await $.applyConstraints({advanced:[{torch:!j}]}),y(ie=>!ie)}catch(ie){console.error("torch_toggle_error",ie),V({title:"Torch unsupported",description:"Use additional light if needed."})}},S=async $=>{if($.preventDefault(),!!d.trim()){if(m){k(u);return}await fe(d.trim())}},K=async({meal:$})=>{if(w){T(!0);try{await gl(new Date().toISOString().slice(0,10),{...$,entrySource:"barcode"}),V({title:"Logged",description:`${w.name} added to today`})}catch(R){V({title:"Unable to log",description:(R==null?void 0:R.message)||"Try again",variant:"destructive"})}finally{T(!1)}}};return l.useEffect(()=>{var $;return typeof window<"u"&&(!window.isSecureContext||!(($=navigator.mediaDevices)!=null&&$.getUserMedia))&&(ce(!0),M(ge)),()=>{pe()}},[ge,pe,re]),l.useEffect(()=>{m&&(k(u),I(null))},[u,m]),e.jsxs("main",{className:"mx-auto flex min-h-screen w-full max-w-4xl flex-col gap-6 p-6 pb-20 md:pb-10",children:[e.jsx(Ce,{title:"Barcode Scan",description:"Scan UPCs to log foods"}),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Barcode Scanner"}),e.jsxs("p",{className:"text-muted-foreground",children:["Align the barcode within the frame. Scanning defaults to region"," ",z,". Use the torch in low light or enter the code manually."]})]}),m&&e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Nutrition search unavailable"}),e.jsx(st,{children:u})]}),e.jsxs(Y,{children:[e.jsxs(oe,{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"flex items-center gap-2 text-base",children:[e.jsx(Lu,{className:"h-4 w-4"})," Live scanner"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{size:"sm",variant:p?"outline":"default",onClick:p?pe:me,disabled:!p&&m,title:!p&&m?u:void 0,children:p?e.jsxs(e.Fragment,{children:[e.jsx(lg,{className:"mr-1 h-4 w-4"})," Stop"]}):e.jsxs(e.Fragment,{children:[e.jsx(zu,{className:"mr-1 h-4 w-4"})," Start"]})}),e.jsx(_,{size:"sm",variant:"ghost",onClick:xe,disabled:!g||m,children:j?e.jsx(cg,{className:"h-4 w-4"}):e.jsx(dg,{className:"h-4 w-4"})})]})]}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"relative h-72 w-full overflow-hidden rounded-lg bg-black",children:[e.jsx("video",{ref:t,className:"h-full w-full object-cover",muted:!0,playsInline:!0}),e.jsx("div",{className:"pointer-events-none absolute inset-0 border-2 border-white/40"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p?"Scanning…":L||(X?re:"Tap start to begin scanning"),N?` • Last detected: ${N}`:""]})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Manual entry"})}),e.jsxs(Q,{className:"space-y-2",children:[e.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(je,{htmlFor:"manual-code",children:"Enter barcode manually"}),e.jsx(We,{id:"manual-code",inputMode:"numeric",value:d,onChange:$=>f($.target.value),placeholder:`Enter UPC (${z})`,disabled:m})]}),e.jsx(_,{type:"submit",className:"self-end",disabled:!d.trim()||m,title:m?u:void 0,children:"Lookup"})]}),P&&e.jsx("p",{className:"text-xs text-muted-foreground",children:P})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Result"})}),e.jsxs(Q,{className:"space-y-3",children:[F&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"})," Looking up food…"]}),!F&&!w&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No food selected yet."}),w&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-foreground",children:w.name}),e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:w.brand||w.source}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((A=w.per_serving)==null?void 0:A.kcal)??"—"," kcal •"," ",((O=w.per_serving)==null?void 0:O.protein_g)??"—","g P •"," ",((J=w.per_serving)==null?void 0:J.carbs_g)??"—","g C •"," ",((G=w.per_serving)==null?void 0:G.fat_g)??"—","g F"]})]}),e.jsx(HE,{item:w,entrySource:"barcode",onConfirm:K,busy:C})]})]})]})]})}function XE({data:t}){return t.length?e.jsx("div",{className:"h-64 w-full",children:e.jsx(Wo,{children:e.jsxs(Ng,{data:t,margin:{top:16,right:12,bottom:8,left:0},children:[e.jsx(Hu,{strokeDasharray:"3 3",className:"text-muted"}),e.jsx(qo,{dataKey:"date",tick:{fontSize:12},tickMargin:8}),e.jsx(ca,{yAxisId:"calories",tick:{fontSize:12},width:48}),e.jsx(ca,{yAxisId:"macros",orientation:"right",tick:{fontSize:12},width:48}),e.jsx(zo,{contentStyle:{fontSize:"0.75rem"}}),e.jsx(Sg,{wrapperStyle:{fontSize:"0.75rem"}}),e.jsx(Yu,{yAxisId:"calories",dataKey:"calories",fill:"hsl(var(--primary))",radius:[4,4,0,0],name:"Calories"}),e.jsx(kg,{yAxisId:"macros",type:"monotone",dataKey:"protein",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent) / 0.2)",name:"Protein (g)"}),e.jsx(da,{yAxisId:"macros",type:"monotone",dataKey:"carbs",stroke:"hsl(var(--muted-foreground))",strokeWidth:2,name:"Carbs (g)"}),e.jsx(da,{yAxisId:"macros",type:"monotone",dataKey:"fat",stroke:"hsl(var(--secondary-foreground))",strokeDasharray:"4 4",name:"Fat (g)"})]})})}):e.jsx("div",{className:"flex h-48 w-full items-center justify-center rounded-md border border-dashed border-muted-foreground/40 text-sm text-muted-foreground",children:"No nutrition data yet"})}function ZE(){const[t,s]=l.useState(30),[n,r]=l.useState([]),[a,i]=l.useState(!1);l.useEffect(()=>{i(!0),Qh(t).then(r).catch(()=>r([])).finally(()=>i(!1))},[t]);const o=n.reduce((u,d)=>(u.calories+=d.totals.calories||0,u.protein+=d.totals.protein||0,u.carbs+=d.totals.carbs||0,u.fat+=d.totals.fat||0,u),{calories:0,protein:0,carbs:0,fat:0}),c=n.length||1,h=Math.max(...n.map(u=>u.totals.calories||0),1),m=n.map(u=>({date:new Date(u.date).toLocaleDateString(void 0,{month:"short",day:"numeric"}),calories:u.totals.calories||0,protein:u.totals.protein||0,carbs:u.totals.carbs||0,fat:u.totals.fat||0}));return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Meal History - MyBodyScan",description:"Review your recent nutrition trends"}),e.jsxs("main",{className:"mx-auto flex max-w-md flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(ug,{className:"mx-auto h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Nutrition History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compare 7-day and 30-day trends with adherence heatmap."})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[7,30].map(u=>e.jsxs(_,{size:"sm",variant:t===u?"default":"outline",onClick:()=>s(u),children:["Last ",u," days"]},u))}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Calories & macros"})}),e.jsx(Q,{children:a?e.jsx("div",{className:"flex h-64 items-center justify-center text-sm text-muted-foreground",children:"Loading chart…"}):e.jsx(XE,{data:m})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Averages"})}),e.jsxs(Q,{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:"Calories"}),e.jsx("div",{className:"text-lg font-semibold",children:Math.round(o.calories/c)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:"Protein"}),e.jsxs("div",{className:"text-lg font-semibold",children:[Math.round(o.protein/c),"g"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:"Carbs"}),e.jsxs("div",{className:"text-lg font-semibold",children:[Math.round(o.carbs/c),"g"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:"Fat"}),e.jsxs("div",{className:"text-lg font-semibold",children:[Math.round(o.fat/c),"g"]})]})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Adherence Heatmap"})}),e.jsx(Q,{className:"grid grid-cols-7 gap-2 text-xs",children:n.map(u=>{const d=u.totals.calories||0,p=`rgba(34,197,94,${.2+Math.min(1,d/h)*.6})`;return e.jsxs("div",{className:"flex h-12 flex-col items-center justify-center rounded-md text-foreground",style:{background:p},children:[e.jsx("span",{className:"font-medium",children:new Date(u.date).getDate()}),e.jsx("span",{className:"text-[10px]",children:Math.round(d)})]},u.date)})})]})]}),e.jsx(xt,{})]})}const eC=["Stand on a marker about 8 feet from the camera","Use bright, even lighting with minimal shadows","Wear fitted clothing and remove accessories","Keep arms slightly away from the torso","Frame head to toe with a neutral background"],tC=[{label:"Front",description:"Feet together, arms out"},{label:"Side",description:"Turn 90°, head forward"},{label:"Back",description:"Relaxed shoulders"}];function sC(){return e.jsxs("main",{className:"mx-auto flex min-h-screen w-full max-w-3xl flex-col gap-6 p-6",children:[e.jsx(Ce,{title:"Photo Tips",description:"Improve photo scan accuracy"}),e.jsx(Zn,{}),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Photo Tips"}),e.jsx("p",{className:"text-muted-foreground",children:"Better lighting, distance, and framing lead to more accurate body-fat estimates. Follow this checklist before each scan."})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(mg,{className:"h-5 w-5 text-primary"})," Checklist"]})}),e.jsx(Q,{children:e.jsx("ul",{className:"list-disc space-y-2 pl-6 text-sm text-muted-foreground",children:eC.map(t=>e.jsx("li",{children:t},t))})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(hg,{className:"h-5 w-5 text-primary"})," Lighting & Setup"]})}),e.jsxs(Q,{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Face a window or soft light source. Avoid overhead lights that cast harsh shadows. If possible, ask someone to take the photos or use a tripod at chest height."}),e.jsx("p",{children:"Mark a standing spot with tape so each scan uses the same distance. A consistent setup improves comparisons over time."})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(fg,{className:"h-5 w-5 text-primary"})," Poses"]})}),e.jsx(Q,{className:"grid gap-4 md:grid-cols-3",children:tC.map(t=>e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"flex h-32 w-24 items-end justify-center rounded-lg border bg-muted",children:e.jsx("div",{className:"h-28 w-6 rounded-full bg-gradient-to-t from-primary/70 to-primary/30"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:t.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]})]},t.label))})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(pg,{className:"h-5 w-5 text-primary"})," Need help?"]})}),e.jsx(Q,{className:"text-sm text-muted-foreground",children:"Share these tips with whoever is taking your photos. For the best accuracy, retake any photo that fails the gate or looks blurry before submitting your scan."})]})]})}function nC({data:t}){if(!t.length)return e.jsx("div",{className:"flex h-32 w-full items-center justify-center rounded-md border border-dashed border-muted-foreground/40 text-sm text-muted-foreground",children:"No workouts tracked yet"});const s=t.map(n=>({...n,value:n.completed?1:0}));return e.jsx("div",{className:"h-40 w-full",children:e.jsx(Wo,{children:e.jsxs(Eg,{data:s,margin:{top:12,right:16,bottom:8,left:0},children:[e.jsx(Hu,{strokeDasharray:"3 3"}),e.jsx(qo,{dataKey:"date",tick:{fontSize:10},interval:1,angle:-35,textAnchor:"end",height:48}),e.jsx(ca,{hide:!0,domain:[0,1]}),e.jsx(zo,{formatter:n=>n?"Completed":"Missed",labelFormatter:n=>new Date(n).toLocaleDateString(),contentStyle:{fontSize:"0.75rem"}}),e.jsx(Yu,{dataKey:"value",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})}function rC(){var f,p;const[t,s]=l.useState(null),[n,r]=l.useState(!1),[a,i]=l.useState(null),{health:o,error:c}=ns(),{workoutsConfigured:h}=ss(o??void 0),m=h?null:"Workout APIs are offline. Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to enable the library.";l.useEffect(()=>{if(!h){s(null),r(!1),i(m??"Workouts are disabled in this environment.");return}r(!0),xl().then(s).catch(x=>{i((x==null?void 0:x.message)||"Unable to load workouts")}).finally(()=>r(!1))},[h,m]);const u=l.useMemo(()=>{var v;if(!((v=t==null?void 0:t.days)!=null&&v.length))return null;const g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date().getDay()];return t.days.find(j=>j.day===g)??t.days[0]??null},[t]),d=l.useMemo(()=>{const x=new Date;return Array.from({length:14}).map((g,v)=>{var b,w;const j=new Date(x);j.setDate(x.getDate()-(13-v));const y=j.toISOString().slice(0,10),N=!!((w=(b=t==null?void 0:t.progress)==null?void 0:b[y])!=null&&w.length);return{date:y,completed:N}})},[t]);return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Workout Library - MyBodyScan",description:"Browse your plan and on-demand sessions"}),e.jsxs("main",{className:"mx-auto flex max-w-md flex-col gap-6 p-6",children:[e.jsx(Xt,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(gg,{className:"mx-auto h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Workout Library"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Today’s plan plus on-demand sessions to swap in."})]}),c?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"System health unavailable"}),e.jsx(st,{children:c})]}):null,m?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Workouts offline"}),e.jsx(st,{children:m})]}):null,n&&e.jsx(Y,{children:e.jsxs(Q,{className:"flex items-center justify-center gap-2 py-6 text-sm text-muted-foreground",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-primary"}),"Loading workouts…"]})}),a&&!n&&e.jsx(Y,{children:e.jsx(Q,{className:"py-8 text-center text-sm text-destructive",children:a})}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Today’s focus"})}),e.jsxs(Q,{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"font-medium text-foreground",children:u.day}),e.jsx("p",{className:"text-muted-foreground",children:"Complete each set to keep your streak alive. We’ll mark completions as you log them."}),e.jsx("ul",{className:"space-y-2",children:u.exercises.map(x=>e.jsxs("li",{className:"flex flex-col rounded-md border p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:x.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[x.sets??"-"," sets × ",x.reps??"-"]})]},x.id))})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Completion streak"})}),e.jsx(Q,{children:e.jsx(nC,{data:d})})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"This week’s plan"})}),e.jsxs(Q,{className:"space-y-3",children:[(f=t==null?void 0:t.days)==null?void 0:f.map(x=>e.jsxs("div",{className:"rounded-md border p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-foreground",children:x.day}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[x.exercises.length," movements"]})]}),e.jsxs("ul",{className:"mt-2 space-y-1 text-xs text-muted-foreground",children:[x.exercises.slice(0,3).map(g=>e.jsxs("li",{children:[g.name," — ",g.sets??"-","×",g.reps??"-"]},g.id)),x.exercises.length===0&&e.jsx("li",{children:"No exercises listed yet."})]})]},x.day)),!((p=t==null?void 0:t.days)!=null&&p.length)&&e.jsx("div",{className:"rounded-md border border-dashed p-3 text-center text-xs text-muted-foreground",children:"No workout plan found yet. Generate a plan to start tracking your sessions."})]})]})]}),!u&&!n&&!a&&e.jsx(Y,{children:e.jsx(Q,{className:"py-8 text-center text-sm text-muted-foreground",children:"No workout plan found yet. Generate a plan to start tracking sessions."})})]}),e.jsx(xt,{})]})}function aC(){const[t,s]=l.useState(null),[n,r]=l.useState(null),{health:a,error:i}=ns(),{workoutsConfigured:o}=ss(a??void 0),c=o?null:"Workout APIs are offline. Set VITE_FUNCTIONS_URL or VITE_FUNCTIONS_ORIGIN to view completions.";l.useEffect(()=>{if(!o){r(c??"Workouts are disabled in this environment."),s(null);return}xl().then(s).catch(m=>r((m==null?void 0:m.message)||"Unable to load workouts"))},[o,c]);const h=l.useMemo(()=>{const m=new Date;return Array.from({length:14}).reduce((u,d,f)=>{var v,j;const p=new Date(m);p.setDate(m.getDate()-f);const x=p.toISOString().slice(0,10),g=!!((j=(v=t==null?void 0:t.progress)==null?void 0:v[x])!=null&&j.length);return g&&u.push({date:x,completed:g}),u},[])},[t]);return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Completed Workouts - MyBodyScan",description:"Celebrate your recent streak"}),e.jsxs("main",{className:"mx-auto flex max-w-md flex-col gap-6 p-6",children:[e.jsx(Xt,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(xg,{className:"mx-auto h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Completed Workouts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Keep the streak alive! These were logged over the last 14 days."})]}),i?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"System health unavailable"}),e.jsx(st,{children:i})]}):null,c?e.jsxs(tt,{variant:"destructive",children:[e.jsx(rt,{children:"Workouts offline"}),e.jsx(st,{children:c})]}):null,h.length===0?e.jsx(Y,{children:e.jsx(Q,{className:"py-8 text-center text-sm text-muted-foreground",children:n||"No workouts logged yet — your next completion will show up here."})}):e.jsx("div",{className:"space-y-3",children:h.map(m=>e.jsx(Y,{children:e.jsxs(Q,{className:"flex items-center justify-between py-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:new Date(m.date).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Strength + conditioning"})]}),e.jsx("div",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:"Completed"})]})},m.date))})]}),e.jsx(xt,{})]})}const iC="https://linear.app/mybodyscan/issue/HEALTH-SHIM",jf="Health integrations are not live yet. This screen is gated until Apple Health/Google Fit connectors ship.";function wf(t){console.info(`[shim-disabled] ${t}() – real connector pending. TODO: ${iC}`)}async function oC(t){throw wf("connectMock"),new Error(jf)}async function lC(t){throw wf("syncDayMock"),new Error(jf)}function cC(){const t=async n=>{try{await oC(n||"manual")}catch(r){V({title:"Health sync coming soon",description:(r==null?void 0:r.message)||"We don't connect to Apple Health or Google Fit yet.",variant:"destructive"})}},s=async()=>{try{await lC("today")}catch(n){V({title:"Health sync unavailable",description:(n==null?void 0:n.message)||"We'll ship health integrations soon.",variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-background pb-16 md:pb-0",children:[e.jsx(Ce,{title:"Health Connect - MyBodyScan",description:"Link HealthKit or Health Connect"}),e.jsxs("main",{className:"mx-auto flex max-w-md flex-col gap-6 p-6",children:[e.jsx(Xt,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(qu,{className:"mx-auto h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Health integrations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pull in steps, calories, and sleep to power Today’s dashboard."})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Connect a source"})}),e.jsxs(Q,{className:"flex flex-col gap-3",children:[e.jsxs(_,{variant:"outline",disabled:!0,onClick:()=>t("apple-health"),className:"flex items-center justify-center gap-2",children:[e.jsx(yg,{className:"h-4 w-4"}),"Connect Apple HealthKit (coming soon)"]}),e.jsxs(_,{variant:"outline",disabled:!0,onClick:()=>t("google-health-connect"),className:"flex items-center justify-center gap-2",children:[e.jsx(bg,{className:"h-4 w-4"}),"Connect Health Connect (coming soon)"]}),e.jsx(_,{variant:"ghost",disabled:!0,onClick:()=>t("manual"),children:"Mock web data source (disabled)"}),e.jsx("div",{className:"rounded-md bg-amber-50 p-3 text-xs text-amber-900",children:"Health sync is gated until native connectors ship. No data is sent to or read from Apple Health or Google Fit yet."})]})]}),e.jsxs(Y,{children:[e.jsx(oe,{children:e.jsx(he,{children:"Sync a day"})}),e.jsxs(Q,{className:"flex flex-col gap-3",children:[e.jsx(_,{onClick:s,variant:"default",disabled:!0,children:"Sync today (disabled)"}),e.jsx("div",{className:"rounded-md border border-dashed p-3 text-center text-xs text-muted-foreground",children:"Real health imports will land once native connectors are wired. Nothing is being synced right now."})]})]})]}),e.jsx(xt,{})]})}class Ke extends l.Component{constructor(){super(...arguments);vt(this,"state",{hasError:!1});vt(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0})})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n){Ye({kind:"route_crash",message:(n==null?void 0:n.message)||"route crashed",code:"route_crash",stack:n==null?void 0:n.stack})}render(){return this.state.hasError?e.jsxs("div",{className:"flex min-h-[240px] flex-col items-center justify-center gap-3 rounded-lg border border-destructive/40 bg-destructive/5 p-6 text-center",children:[e.jsx("div",{className:"text-sm font-medium text-destructive",children:"We hit a snag loading this view."}),this.state.error&&e.jsx("div",{className:"text-xs text-muted-foreground",children:this.state.error.message}),e.jsx(_,{size:"sm",variant:"outline",onClick:this.handleReset,children:"Try again"})]}):this.props.children}}function Ge({name:t,fallback:s=null,children:n}){const{flags:r}=ex();return!(t==="coach"?r.enableCoach:t==="nutrition"?r.enableNutrition:!0)||!Ma(t)?e.jsx(e.Fragment,{children:s}):e.jsx(e.Fragment,{children:n})}function dC(){const{user:t,authReady:s}=He();return l.useEffect(()=>{Pn()},[]),s&&t?e.jsx(Le,{to:"/home",replace:!0}):e.jsx(ve,{children:e.jsx(Ym,{})})}function uC(){const[t,s]=l.useState([]);return l.useEffect(()=>{let n=1;const r=new Map;function a(i){const o=i==null?void 0:i.detail,c=String((o==null?void 0:o.message)||"").trim();if(!c)return;const h=(o==null?void 0:o.level)||"info",m=n++;s(d=>[...d,{id:m,message:c,level:h}]);const u=window.setTimeout(()=>{s(d=>d.filter(f=>f.id!==m)),r.delete(m)},3500);r.set(m,u)}return window.addEventListener("mbs:toast",a),()=>{window.removeEventListener("mbs:toast",a),r.forEach(i=>window.clearTimeout(i)),r.clear()}},[]),e.jsx("div",{style:mC,"aria-live":"polite",children:t.map(n=>{const r=n.level==="error"?"alert":"status";return e.jsx("div",{role:r,style:{...hC,...fC(n.level)},children:n.message},n.id)})})}const mC={position:"fixed",right:16,bottom:16,display:"grid",gap:8,zIndex:1e4},hC={padding:"10px 12px",borderRadius:10,border:"1px solid rgba(0,0,0,0.12)",background:"white",fontSize:13,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",maxWidth:320,wordBreak:"break-word"};function fC(t){switch(t){case"error":return{borderColor:"#ffb3b3",background:"#fff5f5"};case"success":return{borderColor:"#b3e6b3",background:"#f6fff6"};case"warn":return{borderColor:"#ffe2a6",background:"#fffbf0"};default:return{}}}class pC extends l.Component{constructor(){super(...arguments);vt(this,"state",{hasError:!1,message:"",details:""});vt(this,"handleReload",()=>{var n;try{typeof window<"u"&&typeof((n=window.location)==null?void 0:n.reload)=="function"?window.location.reload():typeof location<"u"&&typeof location.reload=="function"&&location.reload()}catch{}})}static getDerivedStateFromError(n){return{hasError:!0,message:Sd(n),details:""}}componentDidCatch(n,r){const a=Sd(n);n&&typeof n=="object"&&"stack"in n&&String(n.stack??""),console.error("[ui] error boundary:",{message:a,error:n,info:r}),Ye({kind:"ui_crash",message:a,code:"ui_crash",extra:{componentStack:(r==null?void 0:r.componentStack)??""}})}render(){return this.state.hasError?e.jsx("div",{style:gC,children:e.jsxs("div",{style:xC,children:[e.jsx("div",{style:yC,children:"Something went wrong"}),e.jsx("div",{style:bC,children:this.state.message||"Unknown error"}),null,e.jsx("button",{type:"button",onClick:this.handleReload,style:jC,children:"Reload"})]})}):this.props.children}}function Sd(t){if(!t)return"Something went wrong.";if(typeof t=="string")return t;if(typeof t=="object"){const s=t,n=typeof(s==null?void 0:s.code)=="string"&&s.code.trim().length?s.code.trim():null,r=typeof(s==null?void 0:s.message)=="string"&&s.message.trim().length?s.message.trim():null;if(n&&r&&!r.includes(n))return`${n}: ${r}`;if(r)return r}try{return JSON.stringify(t)}catch{return"Something went wrong."}}const gC={minHeight:"100vh",display:"grid",placeItems:"center",background:"#fafafa"},xC={maxWidth:560,width:"90%",padding:16,border:"1px solid #eee",borderRadius:12,background:"white",boxShadow:"0 2px 12px rgba(0,0,0,0.06)"},yC={fontWeight:700,marginBottom:8},bC={color:"#555",fontSize:13,marginBottom:12},jC={padding:"8px 10px",border:"1px solid #ddd",borderRadius:8,background:"white",cursor:"pointer",fontSize:12};function wC(){const[t,s]=l.useState({offline:typeof navigator<"u"?!navigator.onLine:!1}),n=l.useRef();if(l.useEffect(()=>{if(typeof window>"u")return;function i(){n.current&&(window.clearTimeout(n.current),n.current=void 0)}function o(){i(),s({offline:!0})}function c(){i(),s({offline:!1})}function h(m){const u=m==null?void 0:m.detail,d=(u==null?void 0:u.message)||"Network request failed.",f=typeof navigator<"u"?!navigator.onLine:!1,p=Date.now();s({offline:f,msg:d,t:p}),f||(i(),n.current=window.setTimeout(()=>{s(x=>x.t===p?{offline:!1}:x)},4e3))}return window.addEventListener("offline",o),window.addEventListener("online",c),window.addEventListener("mbs:net:error",h),()=>{i(),window.removeEventListener("offline",o),window.removeEventListener("online",c),window.removeEventListener("mbs:net:error",h)}},[]),!(t.offline||!!t.msg))return null;const a=t.offline?"You’re offline. Some features won’t work.":t.msg??"";return e.jsx("div",{style:vC,role:"status","aria-live":"polite",children:a})}const vC={position:"fixed",left:0,right:0,bottom:0,padding:"8px 12px",background:"#fffbe6",borderTop:"1px solid #f0e6a8",color:"#705e00",fontSize:13,zIndex:9999,textAlign:"center"};function NC(){const[t,s]=l.useState(!1),n={position:"absolute",left:"-9999px",top:0,zIndex:10001,background:"white",border:"1px solid #ddd",borderRadius:8,padding:"8px 10px",color:"inherit"},r={left:12,top:12};return e.jsx("a",{href:"#main-content",style:t?{...n,...r}:n,onFocus:()=>s(!0),onBlur:()=>s(!1),children:"Skip to content"})}function SC(){return e.jsx("style",{children:`
      :focus-visible {
        outline: 2px solid #7aa7ff;
        outline-offset: 2px;
      }

      [role="alert"] {
        /* Alerts rely on context styling; adjust globally if needed. */
      }
    `})}function kC(){const[t,s]=l.useState(null);return l.useEffect(()=>{const n=new AbortController,r=new URLSearchParams;return Yl&&r.set("clientKey",Yl),fetch(`/systemHealth${r.size?`?${r.toString()}`:""}`,{credentials:"include",signal:n.signal}).then(async a=>{if(!a.ok)return null;try{return await a.json()}catch{return null}}).then(a=>{a&&a.identityToolkitReachable===!1&&s(EC(a.identityToolkitReason))}).catch(()=>{}),()=>n.abort()},[]),t?e.jsxs("div",{style:CC,role:"status","aria-live":"polite",children:[e.jsx("span",{children:t}),e.jsx("span",{style:{marginLeft:8},children:e.jsx("a",{href:"/diagnostics",style:_C,children:"Diagnostics"})})]}):null}function EC(t){switch(t){case"no_client_key":return"Diagnostics missing client API key. Update environment settings.";case"timeout":return"Identity Toolkit check timed out.";case"network_error":return"Identity Toolkit check failed (network error).";default:return t!=null&&t.startsWith("status_")?`Identity Toolkit returned status ${t.replace("status_","")}.`:"Identity Toolkit might be unreachable for this API key."}}const CC={position:"sticky",top:0,left:0,right:0,padding:"8px 12px",background:"#fff5f5",borderBottom:"1px solid #ffd6d6",color:"#7a1f1f",fontSize:13,zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",gap:8},_C={color:"#7a1f1f",textDecoration:"underline"};function kd(t){if(typeof t!="string")return;const s=t.trim();return s||void 0}async function PC(t){if(!(t!=null&&t.uid))return;const s=Se(de,"users",t.uid),n=kd(t.email),r=kd(t.displayName),a={lastLoginAt:at(),...n?{email:n}:null,...r?{displayName:r}:null};try{await oh(s,a);return}catch(o){const c=typeof(o==null?void 0:o.code)=="string"?o.code:void 0;c!=="not-found"&&c!=="firestore/not-found"&&Ye({kind:"auth_profile_upsert_update_failed",message:(o==null?void 0:o.message)||"User profile update failed",code:c,extra:{uid:t.uid}})}const i={createdAt:at(),lastLoginAt:at(),...n?{email:n}:null,...r?{displayName:r}:null};try{await mt(s,i,{merge:!0})}catch(o){throw Ye({kind:"auth_profile_upsert_set_failed",message:(o==null?void 0:o.message)||"User profile write failed",code:typeof(o==null?void 0:o.code)=="string"?o.code:void 0,extra:{uid:t.uid}}),o}}function AC(){var t;try{const s=globalThis,n=s==null?void 0:s.Capacitor;if(n!=null&&n.getPlatform){const r=String(((t=n.getPlatform)==null?void 0:t.call(n))||"").toLowerCase();if(r==="ios"||r==="android")return r}}catch{}return"web"}function IC(){const t=AC(),s="".trim(),n="".trim();return t==="ios"?s:t==="android"?n:""}async function Ua(){return(await lt(()=>import("./vendor-DGcCiWpO.js").then(s=>s.bR),__vite__mapDeps([1,0]))).Purchases}async function TC(t){if(!Bt())return{ok:!1,code:"not_native",message:"IAP is only available on native builds."};const s=IC();if(!s)return{ok:!1,code:"missing_api_key",message:"RevenueCat API key missing for this platform."};const n=String(t.uid||"").trim();if(!n)return{ok:!1,code:"missing_uid",message:"Missing Firebase uid."};try{return await(await Ua()).configure({apiKey:s,appUserID:n}),{ok:!0,value:void 0}}catch(r){return{ok:!1,code:"configure_failed",message:"Failed to initialize in-app purchases.",cause:r}}}async function A_(){if(!Bt())return{ok:!1,code:"not_native",message:"IAP is only available on native builds."};try{return{ok:!0,value:await(await Ua()).getOfferings()}}catch(t){return{ok:!1,code:"offerings_failed",message:"Unable to load offerings.",cause:t}}}async function I_(t){if(!Bt())return{ok:!1,code:"not_native",message:"IAP is only available on native builds."};try{return{ok:!0,value:(await(await Ua()).purchasePackage({aPackage:t})).customerInfo}}catch(s){return!!(s!=null&&s.userCancelled)||!!(s!=null&&s.userCanceled)?{ok:!1,code:"cancelled",message:"Purchase cancelled.",cause:s}:{ok:!1,code:"purchase_failed",message:"Purchase failed.",cause:s}}}async function T_(){if(!Bt())return{ok:!1,code:"not_native",message:"IAP is only available on native builds."};try{return{ok:!0,value:(await(await Ua()).restorePurchases()).customerInfo}}catch(t){return{ok:!1,code:"restore_failed",message:"Restore failed.",cause:t}}}function RC(){const{user:t}=He(),s=l.useRef(null),n=l.useRef(0),r=l.useRef(0),{toast:a}=Cn();l.useEffect(()=>{if(!t){s.current=null;return}qm(),s.current!==t.uid&&(s.current=t.uid,(async()=>{try{PC(t).catch(()=>{a({title:"Signed in, but profile sync failed",description:"You’re still signed in. If this persists, check your connection or try again."})}),TC({uid:t.uid}).catch(()=>{}),await po(),await t.getIdToken(!0),n.current=0}catch(i){console.warn("bootstrap failed",i),n.current+=1;const o=Date.now();n.current>1&&o-r.current>1e4&&(a({title:"Refreshing access failed",description:"We could not refresh your permissions. Try signing out and back in.",variant:"destructive"}),r.current=o)}})())},[t,a])}const MC=l.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(_u,{ref:r,className:ae("relative overflow-hidden",t),...n,children:[e.jsx(lp,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(vf,{}),e.jsx(cp,{})]}));MC.displayName=_u.displayName;const vf=l.forwardRef(({className:t,orientation:s="vertical",...n},r)=>e.jsx(Pu,{ref:r,orientation:s,className:ae("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(dp,{className:"relative flex-1 rounded-full bg-border"})}));vf.displayName=Pu.displayName;const DC=ur(hr,"createCheckout");function FC(t){var r,a;const s=(r=t.customData)==null?void 0:r.serverResponse,n=s==null?void 0:s.details;if(n&&typeof n=="object")return n.debugId||((a=n==null?void 0:n.details)==null?void 0:a.debugId)}function LC(t){if(t instanceof Lo){const s=t.code??"";let n="We couldn't open checkout. Please try again.";s.includes("invalid-argument")?n="Invalid plan selected. Contact support if this persists.":s.includes("failed-precondition")?n="Billing is currently offline.":s.includes("unauthenticated")?n="Sign in to purchase a plan.":s.includes("permission-denied")?n="Your account cannot start checkout right now.":s.includes("unavailable")&&(n="Billing is temporarily unavailable. Please try again later.");const r=new Error(n);return r.code=s||t.name,r.debugId=FC(t),r}return t instanceof Error?t:new Error("We couldn't open checkout. Please try again.")}async function Ui(t,s="subscription",n){if(!(t!=null&&t.trim()))throw new Error("Plan unavailable");await ts();try{const r=await DC({priceId:t,mode:s,promoCode:n}),a=(r==null?void 0:r.data)??r,i=typeof(a==null?void 0:a.sessionId)=="string"&&a.sessionId?a.sessionId:null,o=typeof(a==null?void 0:a.url)=="string"&&a.url?a.url:null;return{sessionId:i,url:o,debugId:(a==null?void 0:a.debugId)??null}}catch(r){throw LC(r)}}async function BC(){const t=Jm("VITE_PORTAL_URL","createCustomerPortal"),s=await Lb(t,{}),n=s==null?void 0:s.url;if(!n||typeof n!="string")throw new Error("No portal URL returned");return n}const $i={one:"price_1RuOpKQQU5vuhlNjipfFBsR0".trim(),monthly:"price_1S4XsVQQU5vuhlNjzdQzeySA".trim(),yearly:"price_1S4Y6YQQU5vuhlNjeJFmshxX".trim(),extra:"".trim()},Wi={one:"payment",monthly:"subscription",yearly:"subscription",extra:"payment"};function OC(){const[t,s]=l.useState(null),[n,r]=l.useState(null),[a,i]=l.useState(!1),[o,c]=l.useState(null),h=l.useMemo(()=>{const d="pk_live_51RuLm5QQU5vuhlNjBb0nO9IO0zWk2Mql49wU0ORYDfXEAHKvHDFqVgUiS5QUvo07L2k9s3xgLY1YdzEVnO4YdHH100PhNSDrfr".trim();return d?gu(d):null},[]);l.useEffect(()=>{let d;if(!U){s(null),r(null);return}const f=kn(U,p=>{s((p==null?void 0:p.uid)||null),d&&(d(),d=void 0),p!=null&&p.uid&&de?d=dt(Se(de,"users",p.uid),x=>{var g;r(((g=x.data())==null?void 0:g.credits)??0)}):r(null)});return()=>{d&&d(),f()}},[]);async function m(d){i(!0),c(null);try{await d()}catch(f){c((f==null?void 0:f.message)||"Something went wrong")}finally{i(!1)}}return Bt()?e.jsx(Le,{to:"/paywall",replace:!0}):e.jsxs("div",{className:"mx-auto max-w-md p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Billing"}),e.jsx("p",{className:"mb-4 text-sm text-gray-600",children:"Credits let you run body scans. Subscriptions deposit credits every billing cycle."}),e.jsxs("div",{className:"mb-4",children:["Current credits: ",e.jsx("b",{children:n??"…"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full border rounded p-2",disabled:a||!t,onClick:()=>m(async()=>{const d=$i.one;if(!d)throw new Error("Plan unavailable");const{sessionId:f,url:p}=await Ui(d,Wi.one),x=h?await h:null;if(x&&f){const g=await x.redirectToCheckout({sessionId:f});if(g.error)throw new Error(g.error.message||"Stripe redirect failed");return}if(p){await Sr(p);return}throw new Error("Checkout unavailable")}),children:"Buy 1 Scan Credit"}),e.jsx("button",{className:"w-full border rounded p-2",disabled:a||!t,onClick:()=>m(async()=>{const d=$i.monthly;if(!d)throw new Error("Plan unavailable");const{sessionId:f,url:p}=await Ui(d,Wi.monthly),x=h?await h:null;if(x&&f){const g=await x.redirectToCheckout({sessionId:f});if(g.error)throw new Error(g.error.message||"Stripe redirect failed");return}if(p){await Sr(p);return}throw new Error("Checkout unavailable")}),children:"Subscribe — Monthly"}),e.jsx("button",{className:"w-full border rounded p-2",disabled:a||!t,onClick:()=>m(async()=>{const d=$i.yearly;if(!d)throw new Error("Plan unavailable");const{sessionId:f,url:p}=await Ui(d,Wi.yearly),x=h?await h:null;if(x&&f){const g=await x.redirectToCheckout({sessionId:f});if(g.error)throw new Error(g.error.message||"Stripe redirect failed");return}if(p){await Sr(p);return}throw new Error("Checkout unavailable")}),children:"Subscribe — Annual"}),e.jsx("button",{className:"w-full border rounded p-2",disabled:a||!t,onClick:()=>m(async()=>{const d=await BC();await Sr(d)}),children:"Manage Subscription"})]}),o&&e.jsx("p",{className:"text-red-600 text-sm mt-3",children:o})]})}const Nf=()=>lt(()=>Promise.resolve().then(()=>AN),void 0),UC=l.lazy(Nf),$C=l.lazy(()=>lt(()=>import("./OnboardingMBS-EeKFEXHb.js"),__vite__mapDeps([2,1,0,3,4,5]))),WC=l.lazy(()=>lt(()=>import("./DevAudit-IVNUHagv.js"),__vite__mapDeps([6,1,0,3,4,5]))),qC=l.lazy(()=>lt(()=>import("./Scan-Czy1Ex5B.js"),__vite__mapDeps([7,1,0,8,3,4,5]))),zC=l.lazy(()=>lt(()=>import("./Plans-D9-n0dRs.js"),__vite__mapDeps([9,1,0,3,4,5]))),VC=l.lazy(()=>lt(()=>import("./Paywall-DstYQkfz.js"),__vite__mapDeps([10,1,0,3,4,5]))),KC=l.lazy(()=>lt(()=>import("./index-CGD1fgoL.js"),__vite__mapDeps([11,1,0,12,3,4,5]))),GC=l.lazy(()=>lt(()=>import("./Meals-BzVTUWy-.js"),__vite__mapDeps([13,1,0,12,3,4,5]))),Ed=l.lazy(()=>lt(()=>import("./ScanResult-MEd3xqHV.js"),__vite__mapDeps([14,1,0,12,8,3,4,5]))),HC=l.lazy(()=>lt(()=>import("./ScanCompare-6x93etNp.js"),__vite__mapDeps([15,1,0,3,4,5]))),YC=l.lazy(()=>lt(()=>import("./Nutrition-B6HJhuRK.js"),__vite__mapDeps([16,1,0,3,4,5]))),Cd=l.lazy(()=>lt(()=>import("./Diagnostics-DhpBERqP.js"),__vite__mapDeps([17,1,0,3,4,5]))),QC=l.lazy(()=>lt(()=>import("./SmokeKit-SAguKesr.js"),__vite__mapDeps([18,1,0,3,4,5]))),JC=l.lazy(()=>lt(()=>import("./Admin-CfRaJDEO.js"),__vite__mapDeps([19,1,0,3,4,5]))),XC=l.lazy(()=>lt(()=>import("./AdminQuick-DNSZ3cg-.js"),__vite__mapDeps([20,1,0,3,4,5]))),ZC=l.lazy(()=>lt(()=>import("./ScanDiagnostics-8jSrWa2u.js"),__vite__mapDeps([21,1,0,3,4,5]))),e_=new jg,pt=({children:t,fallback:s})=>e.jsx(l.Suspense,{fallback:s??e.jsx(gs,{}),children:t}),Kt=(t,s)=>e.jsx(pt,{fallback:s,children:e.jsx(UC,{children:t})}),t_=()=>(NE(),null),s_=({children:t})=>{RC();const{user:s}=He(),{toast:n}=Cn(),r=l.useRef(0),a=l.useRef(0);return l.useEffect(()=>{if(!s){r.current=0;return}An(),(async()=>{try{await Ew(),r.current=0}catch(i){console.warn("claims_refresh_failed",i),r.current+=1;const o=Date.now();r.current>1&&o-a.current>1e4&&(n({title:"We’re having trouble refreshing your access",description:"If this continues, sign out and back in or contact support.",variant:"destructive"}),a.current=o)}})()},[s,n]),l.useEffect(()=>{typeof window<"u"&&console.log("[init] App mounted"),Ho.ENABLE_PUBLIC_MARKETING_PAGE&&Nf(),Cb()},[]),e.jsxs(pC,{children:[e.jsx(SC,{}),e.jsx(NC,{}),e.jsx(gE,{}),e.jsx(wg,{client:e_,children:e.jsx(dx,{children:e.jsxs(Lw,{children:[e.jsx(kC,{}),e.jsx(hx,{}),e.jsx(uC,{}),e.jsx(lx,{}),e.jsx(cx,{}),e.jsx(wC,{}),e.jsx(mp,{children:e.jsxs(Kx,{children:[e.jsx(t_,{}),e.jsx("div",{id:"main-content",role:"main",children:t})]})})]})})})]})},n_=()=>e.jsx(s_,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsxs(up,{children:[e.jsx(ne,{path:"/",element:Ho.ENABLE_PUBLIC_MARKETING_PAGE?Kt(e.jsx(Eh,{})):e.jsx(Rm,{})}),e.jsx(ne,{path:"/__previewframe/*",element:e.jsx(IN,{})}),e.jsx(ne,{path:"/demo",element:e.jsx(dC,{})}),e.jsx(ne,{path:"/welcome",element:Kt(e.jsx(Ny,{}))}),e.jsx(ne,{path:"/privacy",element:Kt(e.jsx(qw,{}))}),e.jsx(ne,{path:"/terms",element:Kt(e.jsx(zw,{}))}),e.jsx(ne,{path:"/legal/disclaimer",element:Kt(e.jsx(Kw,{}))}),e.jsx(ne,{path:"/support",element:Kt(e.jsx(Vw,{}))}),e.jsx(ne,{path:"/help",element:Kt(e.jsx(Zw,{}))}),e.jsx(ne,{path:"/legal/privacy",element:Kt(e.jsx(Yw,{}))}),e.jsx(ne,{path:"/legal/terms",element:Kt(e.jsx(Jw,{}))}),e.jsx(ne,{path:"/legal/refund",element:Kt(e.jsx(Xw,{}))}),e.jsx(ne,{path:"/system-check",element:e.jsx(pt,{children:e.jsx(Wc,{})})}),e.jsx(ne,{path:"/system-check-pro",element:e.jsx(pt,{children:e.jsx(qc,{})})}),e.jsx(ne,{path:"/checkout/success",element:Kt(e.jsx(ev,{}))}),e.jsx(ne,{path:"/checkout/canceled",element:Kt(e.jsx(tv,{}))}),e.jsx(ne,{path:"/auth",element:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(Xy,{})})}),e.jsx(ne,{path:"/auth/callback",element:e.jsx(av,{})}),e.jsx(ne,{path:"/oauth/return",element:e.jsx(sv,{})}),e.jsx(ne,{path:"/login",element:e.jsx(nv,{})}),e.jsx(ne,{path:"/home",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ym,{})})})}),e.jsx(ne,{path:"/billing",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(OC,{})})})}),e.jsx(ne,{path:"/today",element:e.jsx(Ge,{name:"health",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(mS,{})})})})})}),e.jsx(ne,{path:"/onboarding",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(Jo,{label:"Preparing onboarding?"}),children:e.jsx(NS,{})})})})}),e.jsx(ne,{path:"/scan",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(mi,{page:"scan",children:e.jsx(pt,{children:e.jsx(qC,{})})})})})})})})}),e.jsx(ne,{path:"/coach",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(mi,{page:"coach",children:e.jsx(pt,{children:e.jsx(KC,{})})})})})})})})}),e.jsx(ne,{path:"/coach/chat",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(VS,{})})})})})})}),e.jsx(ne,{path:"/coach/day",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(K1,{})})})})})})}),e.jsx(ne,{path:"/programs",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(nE,{})})})})})})}),e.jsx(ne,{path:"/programs/quiz",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(dE,{})})})})})})}),e.jsx(ne,{path:"/programs/customize",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(hE,{})})})})})})}),e.jsx(ne,{path:"/programs/active/edit",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(pE,{})})})})})})}),e.jsx(ne,{path:"/programs/:id",element:e.jsx(Ge,{name:"coach",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(oE,{})})})})})})}),e.jsx(ne,{path:"/nutrition",element:e.jsx(Ge,{name:"nutrition",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(mi,{page:"nutrition",children:e.jsx(pt,{children:e.jsx(YC,{})})})})})})})})}),e.jsx(ne,{path:"/workouts",element:e.jsx(Ge,{name:"workouts",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(RS,{})})})})})})}),e.jsx(ne,{path:"/workouts/library",element:e.jsx(Ge,{name:"workouts",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(rC,{})})})})})})}),e.jsx(ne,{path:"/workouts/completed",element:e.jsx(Ge,{name:"workouts",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(aC,{})})})})})})}),e.jsx(ne,{path:"/meals",element:e.jsx(Ge,{name:"nutrition",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(pt,{children:e.jsx(GC,{})})})})})})})}),e.jsx(ne,{path:"/meals/search",element:e.jsx(Ge,{name:"nutrition",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(VE,{})})})})})})}),e.jsx(ne,{path:"/barcode",element:e.jsx(Ge,{name:"nutrition",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(JE,{})})})})})})}),e.jsx(ne,{path:"/meals/barcode",element:e.jsx(Le,{to:"/barcode",replace:!0})}),e.jsx(ne,{path:"/meals/history",element:e.jsx(Ge,{name:"nutrition",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(ZE,{})})})})})})}),e.jsx(ne,{path:"/capture",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(bc,{})})})})}),e.jsx(ne,{path:"/capture/photos",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(px,{}),children:e.jsx(jc,{})})})})})}),e.jsx(ne,{path:"/capture-picker",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(bc,{})})})})}),e.jsx(ne,{path:"/photo-capture",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(jc,{})})})})}),e.jsx(ne,{path:"/processing/:uid/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(Pc,{})})})})})}),e.jsx(ne,{path:"/processing/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(Pc,{})})})})})}),e.jsx(ne,{path:"/scans/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(Ed,{})})})})})}),e.jsx(ne,{path:"/scans/compare/:leftId/:rightId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(HC,{})})})})})}),e.jsx(ne,{path:"/results/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(l.Suspense,{fallback:e.jsx(gs,{}),children:e.jsx(mj,{})})})})})}),e.jsx(ne,{path:"/history",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Sj,{})})})})})})}),e.jsx(ne,{path:"/plans",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(pt,{children:e.jsx(zC,{})})})})})})}),e.jsx(ne,{path:"/paywall",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(pt,{children:e.jsx(VC,{})})})})})})}),e.jsx(ne,{path:"/settings",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Mw,{})})})})})}),e.jsx(ne,{path:"/settings/account",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Dw,{})})})})})}),e.jsx(ne,{path:"/settings/system-check",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Wc,{})})})})})}),e.jsx(ne,{path:"/settings/system-check-pro",element:e.jsx(Ge,{name:"account",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(qc,{})})})})})}),e.jsx(ne,{path:"/health",element:e.jsx(Ge,{name:"health",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(cC,{})})})})})}),e.jsx(ne,{path:"/settings/units",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(QN,{})})})}),e.jsx(ne,{path:"/coach/onboarding",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(TN,{})})})})}),e.jsx(ne,{path:"/coach/tracker",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(HN,{})})})})}),e.jsx(ne,{path:"/settings/health",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(YN,{})})})}),e.jsx(ne,{path:"/scan/start",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(xv,{})})})})})})}),e.jsx(ne,{path:"/scan/capture",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(jv,{})})})})})})}),e.jsx(ne,{path:"/scan/flow",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(tN,{})})})})})})}),e.jsx(ne,{path:"/scan/result",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Zv,{})})})})})})}),e.jsx(ne,{path:"/scan/refine",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(Qv,{})})})})})})}),e.jsx(ne,{path:"/scan/history",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(eN,{})})})})})})}),e.jsx(ne,{path:"/scan/diagnostics",element:e.jsx(Ge,{name:"scan",fallback:e.jsx(Le,{to:"/home",replace:!0}),children:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(pt,{children:e.jsx(ZC,{})})})})})})}),e.jsx(ne,{path:"/scan/new",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(iv,{})})})})}),e.jsx(ne,{path:"/scan/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(pt,{children:e.jsx(Ed,{})})})})})}),e.jsx(ne,{path:"/scan/tips",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(sC,{})})})})}),e.jsx(ne,{path:"/report",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(td,{})})})})}),e.jsx(ne,{path:"/report/:scanId",element:e.jsx(we,{children:e.jsx(Oe,{children:e.jsx(ve,{children:e.jsx(td,{})})})})}),e.jsx(ne,{path:"/dev/audit",element:e.jsx(pt,{children:e.jsx(WC,{})})}),e.jsx(ne,{path:"/diagnostics",element:e.jsx(pt,{children:e.jsx(Cd,{})})}),e.jsx(ne,{path:"/__diag",element:e.jsx(pt,{children:e.jsx(Cd,{})})}),e.jsx(ne,{path:"/__admin",element:e.jsx(we,{children:e.jsx(pt,{children:e.jsx(JC,{})})})}),e.jsx(ne,{path:"/__admin/quick",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(pt,{children:e.jsx(XC,{})})})})}),e.jsx(ne,{path:"/__smoke",element:e.jsx(we,{children:e.jsx(ve,{children:e.jsx(Ke,{children:e.jsx(pt,{children:e.jsx(QC,{})})})})})}),!1,e.jsx(ne,{path:"/debug/credits",element:e.jsx(cN,{})}),e.jsx(ne,{path:"/debug/plan",element:e.jsx(JN,{})}),e.jsx(ne,{path:"/debug/health",element:e.jsx(sS,{})}),e.jsx(ne,{path:"/onboarding-mbs",element:e.jsx(pt,{children:e.jsx($C,{})})}),e.jsx(ne,{path:"/not-found",element:e.jsx(zc,{})}),e.jsx(ne,{path:"*",element:e.jsx(zc,{})})]})})}),r_="support@mybodyscan.com",_d="__mbs_app_crash_logged__";class a_ extends l.Component{constructor(){super(...arguments);vt(this,"state",{hasError:!1})}static getDerivedStateFromError(n){const r=n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error");return{hasError:!0,message:r.message??"Unknown error",stack:r.stack}}componentDidCatch(n,r){const a=n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error"),i=In(),o=i==null?void 0:i.currentUser,c=typeof window<"u"?window.location.href:void 0,h=wm(o??null);try{const u=window;if(u&&u[_d])return;u&&(u[_d]=!0)}catch{}const m=a.stack||this.state.stack;console.error("App crashed:",{message:a.message,stack:m,componentStack:r==null?void 0:r.componentStack,context:{location:c,user:o?{uid:o.uid,isAnonymous:o.isAnonymous,email:o.email}:null,demoMode:h}}),Ye({kind:"app_crash",message:a.message||"app crashed",code:"app_crash",stack:m,extra:{componentStack:r==null?void 0:r.componentStack,location:c,demoMode:h,uid:o==null?void 0:o.uid}})}render(){return this.state.hasError?e.jsxs("div",{style:{padding:24,maxWidth:520,margin:"0 auto",textAlign:"center",minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",marginBottom:12},children:"We hit a snag."}),e.jsx("p",{style:{marginBottom:16,color:"#475467"},children:"Try reload, or continue in demo mode while we fix it."}),this.state.message?e.jsxs("p",{style:{marginBottom:20,color:"#6b7280",fontSize:"0.9rem"},children:["Details: ",this.state.message]}):null,e.jsxs("p",{style:{marginBottom:20,color:"#6b7280",fontSize:"0.9rem"},children:["Need a hand?"," ",e.jsx("a",{href:`mailto:${r_}`,style:{color:"#2563eb",textDecoration:"underline"},children:"Contact support"}),"."]}),null,e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>{try{window.location.reload()}catch{window.location.href="/"}},style:{padding:"10px 16px",borderRadius:8,border:"none",background:"#2563eb",color:"white",cursor:"pointer"},children:"Reload"}),e.jsx("button",{onClick:()=>{window.location.href="/demo"},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #d0d5dd",background:"white",color:"#111827",cursor:"pointer"},children:"Explore demo"})]})]}):this.props.children}}const Pd={minHeight:"100vh",display:"grid",placeItems:"center",padding:24,textAlign:"center",color:"#6b7280",fontFamily:'system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif'},i_="mybodyscan:auth:oauth:pending";function o_({children:t,fallback:s}){const[n,r]=l.useState(!1),a=l.useMemo(()=>{if(typeof window>"u")return"Loading…";try{return window.sessionStorage.getItem(i_)?"Completing sign-in…":"Loading…"}catch{return"Loading…"}},[]);return l.useEffect(()=>{let i=!1;return(async()=>(await Rw(),Vg(),Wm(),i||r(!0)))(),()=>{i=!0}},[]),n?e.jsx(l.Suspense,{fallback:e.jsx("div",{style:Pd,children:"Loading…"}),children:t}):e.jsx("div",{style:Pd,children:s??a})}globalThis.sanitizeFoodItem=globalThis.sanitizeFoodItem||nf;Jj();typeof window<"u"&&(window.addEventListener("error",t=>{var s;window.__firstBootError||(window.__firstBootError=!0,console.error("[boot] first error:",(t==null?void 0:t.error)||(t==null?void 0:t.message),t==null?void 0:t.filename,t==null?void 0:t.lineno,t==null?void 0:t.colno,(s=t==null?void 0:t.error)==null?void 0:s.stack))}),window.addEventListener("unhandledrejection",t=>{window.__firstBootError||(window.__firstBootError=!0,console.error("[boot] first unhandledrejection:",t==null?void 0:t.reason))}),console.log("[init] App mounted"),Sx());typeof window<"u"&&typeof document<"u"&&hp.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(a_,{children:e.jsx(o_,{children:e.jsx(n_,{})})})}));export{Cn as $,tt as A,Xe as B,Y as C,qt as D,st as E,Jv as F,Jc as G,rl as H,Kg as I,V as J,U as K,ej as L,bt as M,ah as N,La as O,Bt as P,ft as Q,Ra as R,qh as S,Ce as T,xt as U,Tn as V,Ye as W,BC as X,Sr as Y,Wt as Z,Ui as _,mt as a,p_ as a$,xr as a0,Ta as a1,TC as a2,A_ as a3,I_ as a4,T_ as a5,cj as a6,WS as a7,Ba as a8,OS as a9,XE as aA,v_ as aB,je as aC,We as aD,N_ as aE,__ as aF,BN as aG,UN as aH,P_ as aI,y_ as aJ,lo as aK,Hn as aL,b_ as aM,zi as aN,Vm as aO,no as aP,g_ as aQ,pf as aR,Uw as aS,wj as aT,Zb as aU,x_ as aV,rr as aW,k_ as aX,S_ as aY,sf as aZ,AE as a_,Zn as aa,Rt as ab,kt as ac,Mt as ad,Et as ae,Ue as af,ae as ag,Fj as ah,_t as ai,Xs as aj,Us as ak,vs as al,Ns as am,HE as an,rf as ao,gl as ap,uo as aq,Uj as ar,j_ as as,w_ as at,Yh as au,Qh as av,CE as aw,C_ as ax,cs as ay,rd as az,Rx as b,St as b0,bo as b1,Mx as b2,tr as b3,f_ as b4,Tw as b5,Wg as b6,ll as b7,Gt as b8,hm as b9,ts as ba,MC as bb,es as bc,Hj as bd,Gj as be,pw as bf,kr as bg,rm as bh,gw as bi,fm as bj,Yg as bk,sN as bl,$h as bm,ia as bn,Wh as bo,ul as bp,ml as bq,lr as br,cr as bs,hl as bt,dr as bu,ls as bv,vn as bw,il as bx,tm as by,oe as c,de as d,he as e,Ca as f,fr as g,fa as h,Yy as i,Q as j,Pt as k,gt as l,_ as m,Rj as n,co as o,Os as p,Zs as q,cl as r,WN as s,ns as t,He as u,ss as v,ws as w,ih as x,si as y,rt as z};
